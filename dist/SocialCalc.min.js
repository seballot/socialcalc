!function(e,t){"function"==typeof define&&define.amd?define([],t.bind(e,this)):"object"==typeof module&&module.exports?module.exports=t.call(e,this):e.SocialCalc=t.call(e,this)}(this,function(U){var Oe;return Oe||(Oe={}),Oe.Constants={cellDataType:{v:"value",n:"value",t:"text",f:"formula",c:"constant"},textdatadefaulttype:"t",s_BrowserNotSupported:"Browser not supported.",s_InternalError:"Internal SocialCalc error (probably an internal bug): ",s_pssUnknownColType:"Unknown col type item",s_pssUnknownRowType:"Unknown row type item",s_pssUnknownLineType:"Unknown line type",s_cfspUnknownCellType:"Unknown cell type item",doCanonicalizeSheet:!0,s_escUnknownSheetCmd:"Unknown sheet command: ",s_escUnknownSetCoordCmd:"Unknown set coord command: ",s_escUnknownCmd:"Unknown command: ",s_caccCircRef:"Circular reference to ",defaultRowNameWidth:"30",defaultAssumedRowHeight:15,defaultCellIDPrefix:"cell_",defaultCellLayout:"padding:2px 2px 1px 2px;vertical-align:top;",defaultCellFontStyle:"normal normal",defaultCellFontSize:"small",defaultCellFontFamily:"Verdana,Arial,Helvetica,sans-serif",defaultPaneDividerWidth:"3",defaultPaneDividerHeight:"3",defaultGridCSS:"1px solid #C0C0C0;",defaultCommentClass:"",defaultCommentStyle:"background-repeat:no-repeat;background-position:top right;background-image:url(images/sc-commentbg.gif);",defaultCommentNoGridClass:"",defaultCommentNoGridStyle:"",defaultReadonlyClass:"",defaultReadonlyStyle:"background-repeat:no-repeat;background-position:top right;background-image:url(images/sc-lockbg.gif);",defaultReadonlyNoGridClass:"",defaultReadonlyNoGridStyle:"",defaultReadonlyComment:"Locked cell",defaultColWidth:"80",defaultMinimumColWidth:10,defaultHighlightTypeCursorClass:"",defaultHighlightTypeCursorStyle:"color:#FFF;backgroundColor:#A6A6A6;",defaultHighlightTypeRangeClass:"",defaultHighlightTypeRangeStyle:"color:#000;backgroundColor:#E5E5E5;",defaultColnameClass:"",defaultColnameStyle:"overflow:visible;font-size:small;text-align:center;color:#FFFFFF;background-color:#808080;",defaultSelectedColnameClass:"",defaultSelectedColnameStyle:"overflow:visible;font-size:small;text-align:center;color:#FFFFFF;background-color:#404040;",defaultRownameClass:"",defaultRownameStyle:"position:relative;overflow:visible;font-size:small;text-align:right;color:#FFFFFF;background-color:#808080;",defaultSelectedRownameClass:"",defaultSelectedRownameStyle:"position:relative;overflow:visible;font-size:small;text-align:right;color:#FFFFFF;background-color:#404040;",defaultUpperLeftClass:"",defaultUpperLeftStyle:"font-size:small;",defaultSkippedCellClass:"",defaultSkippedCellStyle:"font-size:small;background-color:#CCC",defaultPaneDividerClass:"",defaultPaneDividerStyle:"font-size:small;background-color:#C0C0C0;padding:0px;",defaultUnhideLeftClass:"",defaultUnhideLeftStyle:"float:right;width:9px;height:12px;cursor:pointer;background-image:url(images/sc-unhideleft.gif);padding:0;",defaultUnhideRightClass:"",defaultUnhideRightStyle:"float:left;width:9px;height:12px;cursor:pointer;background-image:url(images/sc-unhideright.gif);padding:0;",defaultUnhideTopClass:"",defaultUnhideTopStyle:"float:left;left:1px;position:absolute;bottom:-4px;width:12px;height:9px;cursor:pointer;background-image:url(images/sc-unhidetop.gif);padding:0;",defaultUnhideBottomClass:"",defaultUnhideBottomStyle:"float:left;width:12px;height:9px;cursor:pointer;background-image:url(images/sc-unhidebottom.gif);padding:0;",defaultColResizeBarClass:"col-resize-bar",defaultRowResizeBarClass:"row-resize-bar",s_rcMissingSheet:"Render Context must have a sheet object",defaultLinkFormatString:'<span style="font-size:smaller;text-decoration:none !important;background-color:#66B;color:#FFF;">Link</span>',defaultPageLinkFormatString:'<span style="font-size:smaller;text-decoration:none !important;background-color:#66B;color:#FFF;">Page</span>',defaultFormatp:"#,##0.0%",defaultFormatc:"[$$]#,##0.00",defaultFormatdt:"d-mmm-yyyy h:mm:ss",defaultFormatd:"d-mmm-yyyy",defaultFormatt:"[h]:mm:ss",defaultDisplayTRUE:"TRUE",defaultDisplayFALSE:"FALSE",defaultImagePrefix:"assets/images/sc_",defaultTableEditorIDPrefix:"te_",defaultPageUpDnAmount:15,AllowCtrlS:!0,defaultTableControlThickness:20,cteGriddivClass:"",s_statusline_executing:"Executing...",s_statusline_displaying:"Displaying...",s_statusline_ordering:"Ordering...",s_statusline_calculating:"Calculating...",s_statusline_calculatingls:"Calculating... Loading Sheet...",s_statusline_doingserverfunc:"doing server function ",s_statusline_incell:" in cell ",s_statusline_calcstart:"Calculation start...",s_statusline_sum:"SUM",s_statusline_recalcneeded:'<span style="color:#999;">(Recalc needed)</span>',s_statusline_circref:'<span style="color:red;">Circular reference: ',s_statusline_sendemail:"Sending Email ",s_inputboxdisplaymultilinetext:"[Multi-line text: Click icon on right to edit]",defaultInputEchoClass:"",defaultInputEchoStyle:"filter:alpha(opacity=90);opacity:.9;backgroundColor:#FFD;border:1px solid #884;fontSize:small;padding:2px 10px 1px 2px;cursor:default;",defaultInputEchoPromptClass:"",defaultInputEchoPromptStyle:"filter:alpha(opacity=90);opacity:.9;backgroundColor:#FFD;borderLeft:1px solid #884;borderRight:1px solid #884;borderBottom:1px solid #884;fontSize:small;fontStyle:italic;padding:2px 10px 1px 2px;cursor:default;",defaultInputEchoHintClass:"",defaultInputEchoHintStyle:"filter:alpha(opacity=80);opacity:.8;backgroundColor:#884;border:1px solid #884;fontSize:small;fontWeight:bold;padding:2px 2px 2px 2px;color:#FFF;position:absolute;top:-20px;cursor:default;",ietUnknownFunction:"Unknown function ",CH_radius1:29,CH_radius2:41,s_CHfillAllTooltip:"Fill Contents and Formats Down/Right",s_CHfillContentsTooltip:"Fill Contents Only Down/Right",s_CHmovePasteAllTooltip:"Move Contents and Formats",s_CHmovePasteContentsTooltip:"Move Contents Only",s_CHmoveInsertAllTooltip:"Slide Contents and Formats within Row/Col",s_CHmoveInsertContentsTooltip:"Slide Contents within Row/Col",s_CHindicatorOperationLookup:{Fill:"Fill",FillC:"Fill Contents",Move:"Move",MoveI:"Slide",MoveC:"Move Contents",MoveIC:"Slide Contents"},s_CHindicatorDirectionLookup:{Down:" Down",Right:" Right",Horizontal:" Horizontal",Vertical:" Vertical"},defaultTCSliderThickness:9,defaultTCButtonThickness:20,defaultTCThumbThickness:15,TCmainStyle:"backgroundColor:#EEE;",TCmainClass:"",TCendcapStyle:"backgroundColor:#FFF;",TCendcapClass:"",TCpanesliderClass:"tc-paneslider",s_panesliderTooltiph:"Drag to lock pane vertically",s_panesliderTooltipv:"Drag to lock pane horizontally",TClessbuttonStyle:"backgroundColor:#AAA;",TClessbuttonClass:"",TClessbuttonRepeatWait:300,TClessbuttonRepeatInterval:20,TCmorebuttonStyle:"backgroundColor:#AAA;",TCmorebuttonClass:"",TCmorebuttonRepeatWait:300,TCmorebuttonRepeatInterval:20,TCscrollareaStyle:"backgroundColor:#DDD;",TCscrollareaClass:"",TCscrollareaRepeatWait:500,TCscrollareaRepeatInterval:100,TCthumbClass:"",TCthumbStyle:"backgroundColor:#CCC;",TCPStrackinglineClass:"tracklingine",TCPStrackinglineStyle:"overflow:hidden;position:absolute;zIndex:100;",TCPStrackinglineThickness:"2px",TCTDFSthumbstatusvClass:"",TCTDFSthumbstatusvStyle:"height:20px;width:auto;border:3px solid #808080;overflow:hidden;backgroundColor:#FFF;fontSize:small;position:absolute;zIndex:100;",TCTDFSthumbstatushClass:"",TCTDFSthumbstatushStyle:"height:20px;width:auto;border:1px solid black;padding:2px;backgroundColor:#FFF;fontSize:small;position:absolute;zIndex:100;",TCTDFSthumbstatusrownumClass:"",TCTDFSthumbstatusrownumStyle:"color:#FFF;background-color:#808080;font-size:small;white-space:nowrap;padding:3px;",TCTDFStopOffsetv:0,TCTDFSleftOffsetv:-80,s_TCTDFthumbstatusPrefixv:"Row ",TCTDFStopOffseth:-30,TCTDFSleftOffseth:0,s_TCTDFthumbstatusPrefixh:"Col ",TooltipOffsetX:2,TooltipOffsetY:10,TDpopupElementClass:"",TDpopupElementStyle:"border:1px solid black;padding:1px 2px 2px 2px;textAlign:center;backgroundColor:#FFF;fontSize:7pt;fontFamily:Verdana,Arial,Helvetica,sans-serif;position:absolute;width:auto;zIndex:110;",SCToolbarbackground:"background-color:#ffffff;",SCTabbackground:"background-color:#CCC;",SCTabselectedCSS:"font-size:small;padding:6px 30px 6px 8px;color:#FFF;background-color:#404040;cursor:default;border-right:1px solid #CCC;",SCTabplainCSS:"font-size:small;padding:6px 30px 6px 8px;color:#FFF;background-color:#808080;cursor:default;border-right:1px solid #CCC;",SCToolbartext:"font-size:x-small;font-weight:bold;color:#888",SCFormulabarheight:30,SCStatuslineheight:20,SCStatuslineCSS:"font-size:10px;padding:3px 0px;",SCFormatNumberFormats:"[cancel]:|[break]:|%loc!Default!:|[custom]:|%loc!Automatic!:general|%loc!Auto w/ commas!:[,]General|[break]:|00:00|000:000|0000:0000|00000:00000|[break]:|%loc!Formula!:formula|%loc!Hidden!:hidden|[newcol]:1234:0|1,234:#,##0|1,234.5:#,##0.0|1,234.56:#,##0.00|1,234.567:#,##0.000|1,234.5678:#,##0.0000|[break]:|1,234%:#,##0%|1,234.5%:#,##0.0%|1,234.56%:#,##0.00%|[newcol]:|$1,234:$#,##0|$1,234.5:$#,##0.0|$1,234.56:$#,##0.00|[break]:|(1,234):#,##0_);(#,##0)|(1,234.5):#,##0.0_);(#,##0.0)|(1,234.56):#,##0.00_);(#,##0.00)|[break]:|($1,234):$#,##0_);($#,##0)|($1,234.5):$#,##0.0_);($#,##0.0)|($1,234.56):$#,##0.00_);($#,##0.00)|[newcol]:|1/4/06:m/d/yy|01/04/2006:mm/dd/yyyy|2006-01-04:yyyy-mm-dd|4-Jan-06:d-mmm-yy|04-Jan-2006:dd-mmm-yyyy|January 4, 2006:mmmm d, yyyy|[break]:|1\\c23:h:mm|1\\c23 PM:h:mm AM/PM|1\\c23\\c45:h:mm:ss|01\\c23\\c45:hh:mm:ss|26\\c23 (h\\cm):[hh]:mm|69\\c45 (m\\cs):[mm]:ss|69 (s):[ss]|[newcol]:|2006-01-04 01\\c23\\c45:yyyy-mm-dd hh:mm:ss|January 4, 2006:mmmm d, yyyy hh:mm:ss|Wed:ddd|Wednesday:dddd|",SCFormatTextFormats:"[cancel]:|[break]:|%loc!Default!:|[custom]:|%loc!Automatic!:general|%loc!Plain Text!:text-plain|HTML:text-html|%loc!Wikitext!:text-wiki|%loc!Link!:text-link|%loc!Formula!:formula|%loc!Hidden!:hidden|",SCFormatPadsizes:"[cancel]:|[break]:|%loc!Default!:|[custom]:|%loc!No padding!:0px|[newcol]:|1 pixel:1px|2 pixels:2px|3 pixels:3px|4 pixels:4px|5 pixels:5px|6 pixels:6px|7 pixels:7px|8 pixels:8px|[newcol]:|9 pixels:9px|10 pixels:10px|11 pixels:11px|12 pixels:12px|13 pixels:13px|14 pixels:14px|16 pixels:16px|18 pixels:18px|[newcol]:|20 pixels:20px|22 pixels:22px|24 pixels:24px|28 pixels:28px|36 pixels:36px|",SCFormatFontsizes:"[cancel]:|[break]:|%loc!Default!:|[custom]:|X-Small:x-small|Small:small|Medium:medium|Large:large|X-Large:x-large|[newcol]:|6pt:6pt|7pt:7pt|8pt:8pt|9pt:9pt|10pt:10pt|11pt:11pt|12pt:12pt|14pt:14pt|16pt:16pt|[newcol]:|18pt:18pt|20pt:20pt|22pt:22pt|24pt:24pt|28pt:28pt|36pt:36pt|48pt:48pt|72pt:72pt|[newcol]:|8 pixels:8px|9 pixels:9px|10 pixels:10px|11 pixels:11px|12 pixels:12px|13 pixels:13px|14 pixels:14px|[newcol]:|16 pixels:16px|18 pixels:18px|20 pixels:20px|22 pixels:22px|24 pixels:24px|28 pixels:28px|36 pixels:36px|",SCFormatFontfamilies:"[cancel]:|[break]:|%loc!Default!:|[custom]:|Verdana:Verdana,Arial,Helvetica,sans-serif|Arial:arial,helvetica,sans-serif|Courier:'Courier New',Courier,monospace|",SCFormatFontlook:"[cancel]:|[break]:|%loc!Default!:|%loc!Normal!:normal normal|%loc!Bold!:normal bold|%loc!Italic!:italic normal|%loc!Bold Italic!:italic bold",SCFormatTextAlignhoriz:"[cancel]:|[break]:|%loc!Default!:|%loc!Left!:left|%loc!Center!:center|%loc!Right!:right|",SCFormatNumberAlignhoriz:"[cancel]:|[break]:|%loc!Default!:|%loc!Left!:left|%loc!Center!:center|%loc!Right!:right|",SCFormatAlignVertical:"[cancel]:|[break]:|%loc!Default!:|%loc!Top!:top|%loc!Middle!:middle|%loc!Bottom!:bottom|",SCFormatColwidth:"[cancel]:|[break]:|%loc!Default!:|[custom]:|[newcol]:|20 pixels:20|40:40|60:60|80:80|100:100|120:120|140:140|160:160|[newcol]:|180 pixels:180|200:200|220:220|240:240|260:260|280:280|300:300|",SCFormatRecalc:"[cancel]:|[break]:|%loc!Auto!:|%loc!Manual!:off|",SCFormatUserMaxCol:"[cancel]:|[break]:|%loc!Default!:|[custom]:|[newcol]:|Unlimited:0|10:10|20:20|30:30|40:40|50:50|60:60|80:80|100:100|",SCFormatUserMaxRow:"[cancel]:|[break]:|%loc!Default!:|[custom]:|[newcol]:|Unlimited:0|10:10|20:20|30:30|40:40|50:50|60:60|80:80|100:100|",ISCButtonNormalBackground:"transparent",ISCButtonBorderNormal:"none",ISCButtonBorderHover:"none",ISCButtonBorderDown:"none",ISCButtonDownBackground:"#888",s_PopupListCancel:"[Cancel]",s_PopupListCustom:"Custom",s_loc_align_center:"Align Center",s_loc_align_left:"Align Left",s_loc_align_right:"Align Right",s_loc_alignment:"Alignment",s_loc_audit:"Audit",s_loc_audit_trail_this_session:"Audit Trail This Session",s_loc_auto:"Auto",s_loc_auto_sum:"Auto Sum",s_loc_auto_wX_commas:"Auto w/ commas",s_loc_automatic:"Automatic",s_loc_background:"Background",s_loc_bold:"Bold",s_loc_bold_XampX_italics:"Bold &amp; Italics",s_loc_bold_italic:"Bold Italic",s_loc_borders:"Borders",s_loc_borders_off:"Borders Off",s_loc_borders_on:"Borders On",s_loc_bottom:"Bottom",s_loc_bottom_border:"Bottom Border",s_loc_cell_settings:"CELL SETTINGS",s_loc_csv_format:"CSV format",s_loc_cancel:"Cancel",s_loc_category:"Category",s_loc_center:"Center",s_loc_clear:"Clear",s_loc_clear_socialcalc_clipboard:"Clear SocialCalc Clipboard",s_loc_clipboard:"Clipboard",s_loc_color:"Color",s_loc_column_:"Column ",s_loc_comment:"Comment",s_loc_copy:"Copy",s_loc_custom:"Custom",s_loc_cut:"Cut",s_loc_default:"Default",s_loc_default_alignment:"Default Alignment",s_loc_default_column_width:"Default Column Width",s_loc_default_font:"Default Font",s_loc_default_format:"Default Format",s_loc_default_padding:"Default Padding",s_loc_delete:"Delete",s_loc_delete_column:"Delete Column",s_loc_delete_contents:"Delete Cell Contents",s_loc_delete_row:"Delete Row",s_loc_description:"Description",s_loc_display_clipboard_in:"Display Clipboard in",s_loc_down:"Down",s_loc_edit:"Edit",s_loc_existing_names:"Existing Names",s_loc_family:"Family",s_loc_fill_down:"Fill Down",s_loc_fill_right:"Fill Right",s_loc_font:"Font",s_loc_format:"Format",s_loc_formula:"Formula",s_loc_function_list:"Function List",s_loc_functions:"Functions",s_loc_grid:"Grid",s_loc_hidden:"Hidden",s_loc_hide_column:"Hide Column",s_loc_hide_row:"Hide Row",s_loc_horizontal:"Horizontal",s_loc_insert_column:"Insert Column Before",s_loc_insert_row:"Insert Row Before",s_loc_italic:"Italic",s_loc_last_sort:"Last Sort",s_loc_left:"Left",s_loc_left_border:"Left Border",s_loc_link:"Link",s_loc_link_input_box:"Link Input Box",s_loc_list:"List",s_loc_load_socialcalc_clipboard_with_this:"Load SocialCalc Clipboard With This",s_loc_lock_cell:"Lock Cell",s_loc_major_sort:"Major Sort",s_loc_manual:"Manual",s_loc_merge_cells:"Merge/Unmerge Cells",s_loc_middle:"Middle",s_loc_minor_sort:"Minor Sort",s_loc_move_insert:"Move Insert",s_loc_move_paste:"Move Paste",s_loc_multiXline_input_box:"Multi-line Input Box",s_loc_name:"Name",s_loc_names:"Names",s_loc_no_padding:"No padding",s_loc_normal:"Normal",s_loc_number:"Number",s_loc_number_horizontal:"Number Horizontal",s_loc_ok:"OK",s_loc_padding:"Padding",s_loc_page_name:"Page Name",s_loc_paste:"Paste",s_loc_paste_formats:"Paste Formats",s_loc_plain_text:"Plain Text",s_loc_recalc:"Recalc",s_loc_recalculation:"Recalculation",s_loc_redo:"Redo",s_loc_right:"Right",s_loc_right_border:"Right Border",s_loc_sheet_settings:"SHEET SETTINGS",s_loc_save:"Save",s_loc_save_to:"Save to",s_loc_set_cell_contents:"Set Cell Contents",s_loc_set_cells_to_sort:"Set Cells To Sort",s_loc_set_value_to:"Set Value To",s_loc_set_to_link_format:"Set to Link format",s_loc_setXclear_move_from:"Set/Clear Move From",s_loc_show_cell_settings:"Show Cell Settings",s_loc_show_sheet_settings:"Show Sheet Settings",s_loc_show_in_new_browser_window:"Show in new browser window",s_loc_size:"Size",s_loc_socialcalcXsave_format:"SocialCalc-save format",s_loc_sort:"Sort",s_loc_sort_:"Sort ",s_loc_sort_cells:"Sort Cells",s_loc_swap_colors:"Swap Colors",s_loc_tabXdelimited_format:"Tab-delimited format",s_loc_text:"Text",s_loc_text_horizontal:"Text Horizontal",s_loc_this_is_aXbrXsample:"This is a<br>sample",s_loc_top:"Top",s_loc_top_border:"Top Border",s_loc_undone_steps:"UNDONE STEPS",s_loc_url:"URL",s_loc_undo:"Undo",s_loc_unlock_cell:"Unlock Cell",s_loc_unmerge_cells:"Unmerge Cells",s_loc_up:"Up",s_loc_value:"Value",s_loc_vertical:"Vertical",s_loc_wikitext:"Wikitext",s_loc_workspace:"Workspace",s_loc_XnewX:"[New]",s_loc_XnoneX:"[None]",s_loc_Xselect_rangeX:"[select range]",SVStatuslineheight:20,SVStatuslineCSS:"font-size:10px;padding:3px 0px;",FormatNumber_separatorchar:",",FormatNumber_decimalchar:".",FormatNumber_defaultCurrency:"$",s_FormatNumber_daynames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],s_FormatNumber_daynames3:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],s_FormatNumber_monthnames:["January","February","March","April","May","June","July","August","September","October","November","December"],s_FormatNumber_monthnames3:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s_FormatNumber_am:"AM",s_FormatNumber_am1:"A",s_FormatNumber_pm:"PM",s_FormatNumber_pm1:"P",s_parseerrexponent:"Improperly formed number exponent",s_parseerrchar:"Unexpected character in formula",s_parseerrstring:"Improperly formed string",s_parseerrspecialvalue:"Improperly formed special value",s_parseerrtwoops:"Error in formula (two operators inappropriately in a row)",s_parseerrmissingopenparen:"Missing open parenthesis in list with comma(s). ",s_parseerrcloseparennoopen:"Closing parenthesis without open parenthesis. ",s_parseerrmissingcloseparen:"Missing close parenthesis. ",s_parseerrmissingoperand:"Missing operand. ",s_parseerrerrorinformula:"Error in formula.",s_calcerrerrorvalueinformula:"Error value in formula",s_parseerrerrorinformulabadval:"Error in formula resulting in bad value",s_formularangeresult:"Formula results in range value:",s_calcerrnumericnan:"Formula results in an bad numeric value",s_calcerrnumericoverflow:"Numeric overflow",s_sheetunavailable:"Sheet unavailable:",s_calcerrcellrefmissing:"Cell reference missing when expected.",s_calcerrsheetnamemissing:"Sheet name missing when expected.",s_circularnameref:"Circular name reference to name",s_calcerrunknownname:"Unknown name",s_calcerrincorrectargstofunction:"Incorrect arguments to function",s_sheetfuncunknownfunction:"Unknown function",s_sheetfunclnarg:"LN argument must be greater than 0",s_sheetfunclog10arg:"LOG10 argument must be greater than 0",s_sheetfunclogsecondarg:"LOG second argument must be numeric greater than 0",s_sheetfunclogfirstarg:"LOG first argument must be greater than 0",s_sheetfuncroundsecondarg:"ROUND second argument must be numeric",s_sheetfuncddblife:"DDB life must be greater than 1",s_sheetfuncslnlife:"SLN life must be greater than 1",s_fdef_ABS:"Absolute value function. ",s_fdef_ACOS:"Trigonometric arccosine function. ",s_fdef_AND:"True if all arguments are true. ",s_fdef_ASIN:"Trigonometric arcsine function. ",s_fdef_ATAN:"Trigonometric arctan function. ",s_fdef_ATAN2:"Trigonometric arc tangent function (result is in radians). ",s_fdef_AVERAGE:"Averages the values. ",s_fdef_CHOOSE:"Returns the value specified by the index. The values may be ranges of cells. ",s_fdef_COLUMNS:"Returns the number of columns in the range. ",s_fdef_COS:"Trigonometric cosine function (value is in radians). ",s_fdef_CONCAT:"Join Together Text & Values to Create a Single Combined Text String. ",s_fdef_CONCATENATE:"Join Together Text & Values to Create a Single Combined Text String. ",s_fdef_COUNT:"Counts the number of numeric values, not blank, text, or error. ",s_fdef_COUNTA:"Counts the number of non-blank values. ",s_fdef_COUNTBLANK:'Counts the number of blank values. (Note: "" is not blank.) ',s_fdef_COUNTIF:'Counts the number of number of cells in the range that meet the criteria. The criteria may be a value ("x", 15, 1+3) or a test (>25). ',s_fdef_DATE:'Returns the appropriate date value given numbers for year, month, and day. For example: DATE(2006,2,1) for February 1, 2006. Note: In this program, day "1" is December 31, 1899 and the year 1900 is not a leap year. Some programs use January 1, 1900, as day "1" and treat 1900 as a leap year. In both cases, though, dates on or after March 1, 1900, are the same. ',s_fdef_DAVERAGE:"Averages the values in the specified field in records that meet the criteria. ",s_fdef_DAY:"Returns the day of month for a date value. ",s_fdef_DCOUNT:"Counts the number of numeric values, not blank, text, or error, in the specified field in records that meet the criteria. ",s_fdef_DCOUNTA:"Counts the number of non-blank values in the specified field in records that meet the criteria. ",s_fdef_DDB:"Returns the amount of depreciation at the given period of time (the default factor is 2 for double-declining balance).   ",s_fdef_DEGREES:"Converts value in radians into degrees. ",s_fdef_DGET:"Returns the value of the specified field in the single record that meets the criteria. ",s_fdef_DMAX:"Returns the maximum of the numeric values in the specified field in records that meet the criteria. ",s_fdef_DMIN:"Returns the maximum of the numeric values in the specified field in records that meet the criteria. ",s_fdef_DPRODUCT:"Returns the result of multiplying the numeric values in the specified field in records that meet the criteria. ",s_fdef_DSTDEV:"Returns the sample standard deviation of the numeric values in the specified field in records that meet the criteria. ",s_fdef_DSTDEVP:"Returns the standard deviation of the numeric values in the specified field in records that meet the criteria. ",s_fdef_DSUM:"Returns the sum of the numeric values in the specified field in records that meet the criteria. ",s_fdef_DVAR:"Returns the sample variance of the numeric values in the specified field in records that meet the criteria. ",s_fdef_DVARP:"Returns the variance of the numeric values in the specified field in records that meet the criteria. ",s_fdef_EVEN:"Rounds the value up in magnitude to the nearest even integer. ",s_fdef_EXACT:'Returns "true" if the values are exactly the same, including case, type, etc. ',s_fdef_EXP:"Returns e raised to the value power. ",s_fdef_FACT:"Returns factorial of the value. ",s_fdef_FALSE:'Returns the logical value "false". ',s_fdef_FIND:'Returns the starting position within string2 of the first occurrence of string1 at or after "start". If start is omitted, 1 is assumed. ',s_fdef_FV:"Returns the future value of repeated payments of money invested at the given rate for the specified number of periods, with optional present value (default 0) and payment type (default 0 = at end of period, 1 = beginning of period). ",s_fdef_HLOOKUP:"Look for the matching value for the given value in the range and return the corresponding value in the cell specified by the row offset. If rangelookup is 1 (the default) and not 0, match if within numeric brackets (match<=value) instead of exact match. ",s_fdef_HOUR:"Returns the hour portion of a time or date/time value. ",s_fdef_IF:"Results in true-value if logical-expression is TRUE or non-zero, otherwise results in false-value. ",s_fdef_INDEX:"Returns a cell or range reference for the specified row and column in the range. If range is 1-dimensional, then only one of rownum or colnum are needed. If range is 2-dimensional and rownum or colnum are zero, a reference to the range of just the specified column or row is returned. You can use the returned reference value in a range, e.g., sum(A1:INDEX(A2:A10,4)). ",s_fdef_INT:"Returns the value rounded down to the nearest integer (towards -infinity). ",s_fdef_IRR:"Returns the interest rate at which the cash flows in the range have a net present value of zero. Uses an iterative process that will return #NUM! error if it does not converge. There may be more than one possible solution. Providing the optional guess value may help in certain situations where it does not converge or finds an inappropriate solution (the default guess is 10%). ",s_fdef_ISBLANK:'Returns "true" if the value is a reference to a blank cell. ',s_fdef_ISERR:'Returns "true" if the value is of type "Error" but not "NA". ',s_fdef_ISERROR:'Returns "true" if the value is of type "Error". ',s_fdef_ISLOGICAL:'Returns "true" if the value is of type "Logical" (true/false). ',s_fdef_ISNA:'Returns "true" if the value is the error type "NA". ',s_fdef_ISNONTEXT:'Returns "true" if the value is not of type "Text". ',s_fdef_ISNUMBER:'Returns "true" if the value is of type "Number" (including logical values). ',s_fdef_ISTEXT:'Returns "true" if the value is of type "Text". ',s_fdef_LEFT:"Returns the specified number of characters from the text value. If count is omitted, 1 is assumed. ",s_fdef_LEN:"Returns the number of characters in the text value. ",s_fdef_LN:"Returns the natural logarithm of the value. ",s_fdef_LOG:"Returns the logarithm of the value using the specified base. ",s_fdef_LOG10:"Returns the base 10 logarithm of the value. ",s_fdef_LOWER:"Returns the text value with all uppercase characters converted to lowercase. ",s_fdef_MATCH:"Look for the matching value for the given value in the range and return position (the first is 1) in that range. If rangelookup is 1 (the default) and not 0, match if within numeric brackets (match<=value) instead of exact match. If rangelookup is -1, act like 1 but the bracket is match>=value. ",s_fdef_MAX:"Returns the maximum of the numeric values. ",s_fdef_MID:"Returns the specified number of characters from the text value starting from the specified position. ",s_fdef_MIN:"Returns the minimum of the numeric values. ",s_fdef_MINUTE:"Returns the minute portion of a time or date/time value. ",s_fdef_MOD:"Returns the remainder of the first value divided by the second. ",s_fdef_MONTH:"Returns the month part of a date value. ",s_fdef_N:"Returns the value if it is a numeric value otherwise an error. ",s_fdef_NA:"Returns the #N/A error value which propagates through most operations. ",s_fdef_NOT:"Returns FALSE if value is true, and TRUE if it is false. ",s_fdef_NOW:"Returns the current date/time. ",s_fdef_NPER:"Returns the number of periods at which payments invested each period at the given rate with optional future value (default 0) and payment type (default 0 = at end of period, 1 = beginning of period) has the given present value. ",s_fdef_NPV:"Returns the net present value of cash flows (which may be individual values and/or ranges) at the given rate. The flows are positive if income, negative if paid out, and are assumed at the end of each period. ",s_fdef_ODD:"Rounds the value up in magnitude to the nearest odd integer. ",s_fdef_OR:"True if any argument is true ",s_fdef_PI:"The value 3.1415926... ",s_fdef_PMT:"Returns the amount of each payment that must be invested at the given rate for the specified number of periods to have the specified present value, with optional future value (default 0) and payment type (default 0 = at end of period, 1 = beginning of period). ",s_fdef_POWER:"Returns the first value raised to the second value power. ",s_fdef_PRODUCT:"Returns the result of multiplying the numeric values. ",s_fdef_PROPER:"Returns the text value with the first letter of each word converted to uppercase and the others to lowercase. ",s_fdef_PV:"Returns the present value of the given number of payments each invested at the given rate, with optional future value (default 0) and payment type (default 0 = at end of period, 1 = beginning of period). ",s_fdef_RADIANS:"Converts value in degrees into radians. ",s_fdef_RATE:"Returns the rate at which the given number of payments each invested at the given rate has the specified present value, with optional future value (default 0) and payment type (default 0 = at end of period, 1 = beginning of period). Uses an iterative process that will return #NUM! error if it does not converge. There may be more than one possible solution. Providing the optional guess value may help in certain situations where it does not converge or finds an inappropriate solution (the default guess is 10%). ",s_fdef_REPLACE:"Returns text1 with the specified number of characters starting from the specified position replaced by text2. ",s_fdef_REPT:"Returns the text repeated the specified number of times. ",s_fdef_RIGHT:"Returns the specified number of characters from the text value starting from the end. If count is omitted, 1 is assumed. ",s_fdef_ROUND:"Rounds the value to the specified number of decimal places. If precision is negative, then round to powers of 10. The default precision is 0 (round to integer). ",s_fdef_ROWS:"Returns the number of rows in the range. ",s_fdef_SECOND:"Returns the second portion of a time or date/time value (truncated to an integer). ",s_fdef_SIN:"Trigonometric sine function (value is in radians) ",s_fdef_SLN:"Returns the amount of depreciation at each period of time using the straight-line method. ",s_fdef_SQRT:"Square root of the value ",s_fdef_STDEV:"Returns the sample standard deviation of the numeric values. ",s_fdef_STDEVP:"Returns the standard deviation of the numeric values. ",s_fdef_SUBSTITUTE:'Returns text1 with the all occurrences of oldtext replaced by newtext. If "occurrence" is present, then only that occurrence is replaced. ',s_fdef_SUM:"Adds the numeric values. The values to the sum function may be ranges in the form similar to A1:B5. ",s_fdef_SUMIF:'Sums the numeric values of cells in the range that meet the criteria. The criteria may be a value ("x", 15, 1+3) or a test (>25). If range2 is present, then range1 is tested and the corresponding range2 value is summed. ',s_fdef_SUMIFS:'Sums the numeric values of cells in the sum_range that meet the multiple criteria. The criteria may be a value ("x", 15, 1+3) or a test (>25).  ',s_fdef_SYD:"Depreciation by Sum of Year's Digits method. ",s_fdef_T:"Returns the text value or else a null string. ",s_fdef_TAN:"Trigonometric tangent function (value is in radians) ",s_fdef_TIME:"Returns the time value given the specified hour, minute, and second. ",s_fdef_TODAY:'Returns the current date (an integer). Note: In this program, day "1" is December 31, 1899 and the year 1900 is not a leap year. Some programs use January 1, 1900, as day "1" and treat 1900 as a leap year. In both cases, though, dates on or after March 1, 1900, are the same. ',s_fdef_TRIM:"Returns the text value with leading, trailing, and repeated spaces removed. ",s_fdef_TRUE:'Returns the logical value "true". ',s_fdef_TRUNC:"Truncates the value to the specified number of decimal places. If precision is negative, truncate to powers of 10. ",s_fdef_UPPER:"Returns the text value with all lowercase characters converted to uppercase. ",s_fdef_VALUE:"Converts the specified text value into a numeric value. Various forms that look like numbers (including digits followed by %, forms that look like dates, etc.) are handled. This may not handle all of the forms accepted by other spreadsheets and may be locale dependent. ",s_fdef_VAR:"Returns the sample variance of the numeric values. ",s_fdef_VARP:"Returns the variance of the numeric values. ",s_fdef_VLOOKUP:"Look for the matching value for the given value in the range and return the corresponding value in the cell specified by the column offset. If rangelookup is 1 (the default) and not 0, match if within numeric brackets (match>=value) instead of exact match. ",s_fdef_WEEKDAY:"Returns the day of week specified by the date value. If type is 1 (the default), Sunday is day and Saturday is day 7. If type is 2, Monday is day 1 and Sunday is day 7. If type is 3, Monday is day 0 and Sunday is day 6. ",s_fdef_YEAR:"Returns the year part of a date value. ",s_fdef_SUMPRODUCT:"Sums the pairwise products of 2 or more ranges. The ranges must be of equal length.",s_fdef_CEILING:"Rounds the given number up to the nearest integer or multiple of significance. Significance is the value to whose multiple of ten the value is to be rounded up (.01, .1, 1, 10, etc.)",s_fdef_FLOOR:"Rounds the given number down to the nearest multiple of significance. Significance is the value to whose multiple of ten the number is to be rounded down (.01, .1, 1, 10, etc.)",s_farg_v:"value",s_farg_vn:"value1, value2, ...",s_farg_xy:"valueX, valueY",s_farg_choose:"index, value1, value2, ...",s_farg_range:"range",s_farg_rangec:"range, criteria",s_farg_date:"year, month, day",s_farg_dfunc:"databaserange, fieldname, criteriarange",s_farg_ddb:"cost, salvage, lifetime, period, [factor]",s_farg_find:"string1, string2, [start]",s_farg_fv:"rate, n, payment, [pv, [paytype]]",s_farg_hlookup:"value, range, row, [rangelookup]",s_farg_iffunc:"logical-expression, true-value, [false-value]",s_farg_index:"range, rownum, colnum",s_farg_irr:"range, [guess]",s_farg_tc:"text, count",s_farg_log:"value, base",s_farg_match:"value, range, [rangelookup]",s_farg_mid:"text, start, length",s_farg_nper:"rate, payment, pv, [fv, [paytype]]",s_farg_npv:"rate, value1, value2, ...",s_farg_pmt:"rate, n, pv, [fv, [paytype]]",s_farg_pv:"rate, n, payment, [fv, [paytype]]",s_farg_rate:"n, payment, pv, [fv, [paytype, [guess]]]",s_farg_replace:"text1, start, length, text2",s_farg_vp:"value, [precision]",s_farg_valpre:"value, precision",s_farg_csl:"cost, salvage, lifetime",s_farg_cslp:"cost, salvage, lifetime, period",s_farg_subs:"text1, oldtext, newtext, [occurrence]",s_farg_sumif:"range1, criteria, [range2]",s_farg_hms:"hour, minute, second",s_farg_txt:"text",s_farg_vlookup:"value, range, col, [rangelookup]",s_farg_weekday:"date, [type]",s_farg_dt:"date",s_farg_rangen:"range1, range2, ...",s_farg_vsig:"value, [significance]",function_classlist:["all","stat","lookup","datetime","financial","test","math","text","gui","action"],s_fclass_all:"All",s_fclass_stat:"Statistics",s_fclass_lookup:"Lookup",s_fclass_datetime:"Date & Time",s_fclass_financial:"Financial",s_fclass_test:"Test",s_fclass_math:"Math",s_fclass_text:"Text",s_fclass_action:"Email & Copy",s_fclass_gui:"Button & Input",lastone:null},Oe.ConstantsDefaultClasses={defaultComment:"",defaultCommentNoGrid:"",defaultHighlightTypeCursor:"",defaultHighlightTypeRange:"",defaultColname:"",defaultSelectedColname:"",defaultRowname:"",defaultSelectedRowname:"",defaultUpperLeft:"",defaultSkippedCell:"",defaultPaneDivider:"",cteGriddiv:"",defaultInputEcho:{classname:"",style:"filter:alpha(opacity=90);opacity:.9;"},TCmain:"",TCendcap:"",TCpaneslider:"",TClessbutton:"",TCmorebutton:"",TCscrollarea:"",TCthumb:"",TCPStrackingline:"",TCTDFSthumbstatus:"",TDpopupElement:""},Oe.ConstantsSetClasses=function(e){var t,o=Oe.ConstantsDefaultClasses,r=Oe.Constants;for(t in e=e||"",o)"string"==typeof o[t]?(r[t+"Class"]=e+(o[t]||t),void 0!==r[t+"Style"]&&(r[t+"Style"]="")):"object"==typeof o[t]&&(r[t+"Class"]=e+(o[t].classname||t),r[t+"Style"]=o[t].style)},Oe.ConstantsSetImagePrefix=function(e){var t=Oe.Constants;for(var o in t)"string"==typeof t[o]&&(t[o]=t[o].replace(t.defaultImagePrefix,e));t.defaultImagePrefix=e},Oe||(Oe={}),Oe.Callbacks={expand_wiki:null,expand_markup:function(e,t,o){return Oe.default_expand_markup(e,t,o)},MakePageLink:null,NormalizeSheetName:null},Oe.Cell=function(e){this.coord=e,this.datavalue="",this.datatype=null,this.formula="",this.valuetype="b",this.readonly=!1},Oe.CellProperties={coord:1,datavalue:1,datatype:1,formula:1,valuetype:1,errors:1,comment:1,readonly:1,bt:2,br:2,bb:2,bl:2,layout:2,font:2,color:2,bgcolor:2,cellformat:2,nontextvalueformat:2,textvalueformat:2,colspan:2,rowspan:2,cssc:2,csss:2,mod:2,displaystring:3,parseinfo:3,hcolspan:3,hrowspan:3},Oe.CellPropertiesTable={bt:"borderstyle",br:"borderstyle",bb:"borderstyle",bl:"borderstyle",layout:"layout",font:"font",color:"color",bgcolor:"color",cellformat:"cellformat",nontextvalueformat:"valueformat",textvalueformat:"valueformat"},Oe.Sheet=function(){Oe.ResetSheet(this),this.statuscallback=null,this.statuscallbackparams=null},Oe.ResetSheet=function(e,t){e.cells={},e.attribs={lastcol:1,lastrow:1,defaultlayout:0,usermaxcol:0,usermaxrow:0},e.rowattribs={hide:{},height:{}},e.colattribs={width:{},hide:{}},e.names={},e.layouts=[],e.layouthash={},e.fonts=[],e.fonthash={},e.colors=[],e.colorhash={},e.borderstyles=[],e.borderstylehash={},e.cellformats=[],e.cellformathash={},e.valueformats=[],e.valueformathash={},e.matched_cells=[],e.selected_search_cell=void 0,e.copiedfrom="",e.changes=new Oe.UndoStack,e.renderneeded=!1,e.changedrendervalues=!0,e.recalcchangedavalue=!1,e.hiddencolrow="",e.sci=new Oe.SheetCommandInfo(e),e.ioEventTree={},e.ioParameterList={}},Oe.Sheet.prototype.ResetSheet=function(){Oe.ResetSheet(this)},Oe.Sheet.prototype.AddCell=function(e){return this.cells[e.coord]=e},Oe.Sheet.prototype.LastCol=function(){var e=1;for(var t in this.cells){var o=Oe.coordToCr(t);o.col>e&&(e=o.col)}return e},Oe.Sheet.prototype.LastRow=function(){var e=1;for(var t in this.cells){var o=Oe.coordToCr(t);o.row>e&&(e=o.row)}return e},Oe.Sheet.prototype.GetAssuredCell=function(e){return this.cells[e]||this.AddCell(new Oe.Cell(e))},Oe.Sheet.prototype.ParseSheetSave=function(e){Oe.ParseSheetSave(e,this)},Oe.Sheet.prototype.CellFromStringParts=function(e,t,o){return Oe.CellFromStringParts(this,e,t,o)},Oe.Sheet.prototype.CreateSheetSave=function(e,t){return Oe.CreateSheetSave(this,e,t)},Oe.Sheet.prototype.CellToString=function(e){return Oe.CellToString(this,e)},Oe.Sheet.prototype.CanonicalizeSheet=function(e){return Oe.CanonicalizeSheet(this,e)},Oe.Sheet.prototype.EncodeCellAttributes=function(e){return Oe.EncodeCellAttributes(this,e)},Oe.Sheet.prototype.EncodeSheetAttributes=function(){return Oe.EncodeSheetAttributes(this)},Oe.Sheet.prototype.DecodeCellAttributes=function(e,t,o){return Oe.DecodeCellAttributes(this,e,t,o)},Oe.Sheet.prototype.DecodeSheetAttributes=function(e){return Oe.DecodeSheetAttributes(this,e)},Oe.Sheet.prototype.ScheduleSheetCommands=function(e,t){return Oe.ScheduleSheetCommands(this,e,t)},Oe.Sheet.prototype.SheetUndo=function(){return Oe.SheetUndo(this)},Oe.Sheet.prototype.SheetRedo=function(){return Oe.SheetRedo(this)},Oe.Sheet.prototype.CreateAuditString=function(){return Oe.CreateAuditString(this)},Oe.Sheet.prototype.GetStyleNum=function(e,t){return Oe.GetStyleNum(this,e,t)},Oe.Sheet.prototype.GetStyleString=function(e,t){return Oe.GetStyleString(this,e,t)},Oe.Sheet.prototype.RecalcSheet=function(){return Oe.RecalcSheet(this)},Oe.ParseSheetSave=function(e,t){var o,r,a,n,l,s,i,c,d=e.split(/\r\n|\n/),u=[],p=Oe.Constants;for(o=0;o<d.length;o++){switch((u=d[o].split(":"))[0]){case"cell":s=t.GetAssuredCell(u[1]),r=2,t.CellFromStringParts(s,u,r);break;case"col":for(l=u[1],r=2;a=u[r++];)switch(a){case"w":t.colattribs.width[l]=u[r++];break;case"hide":t.colattribs.hide[l]=u[r++];break;default:throw p.s_pssUnknownColType+" '"+a+"'"}break;case"row":for(l=u[1]-0,r=2;a=u[r++];)switch(a){case"h":t.rowattribs.height[l]=u[r++]-0;break;case"hide":t.rowattribs.hide[l]=u[r++];break;default:throw p.s_pssUnknownRowType+" '"+a+"'"}break;case"sheet":for(i=t.attribs,r=1;a=u[r++];)switch(a){case"c":i.lastcol=u[r++]-0;break;case"r":i.lastrow=u[r++]-0;break;case"w":i.defaultcolwidth=u[r++]+"";break;case"h":i.defaultrowheight=u[r++]-0;break;case"tf":i.defaulttextformat=u[r++]-0;break;case"ntf":i.defaultnontextformat=u[r++]-0;break;case"layout":i.defaultlayout=u[r++]-0;break;case"font":i.defaultfont=u[r++]-0;break;case"tvf":i.defaulttextvalueformat=u[r++]-0;break;case"ntvf":i.defaultnontextvalueformat=u[r++]-0;break;case"color":i.defaultcolor=u[r++]-0;break;case"bgcolor":i.defaultbgcolor=u[r++]-0;break;case"circularreferencecell":i.circularreferencecell=u[r++];break;case"recalc":i.recalc=u[r++];break;case"needsrecalc":i.needsrecalc=u[r++];break;case"usermaxcol":i.usermaxcol=u[r++]-0;break;case"usermaxrow":i.usermaxrow=u[r++]-0;break;default:r+=1}break;case"name":c=Oe.decodeFromSave(u[1]).toUpperCase(),t.names[c]={desc:Oe.decodeFromSave(u[2])},t.names[c].definition=Oe.decodeFromSave(u[3]);break;case"layout":u=d[o].match(/^layout\:(\d+)\:(.+)$/),t.layouts[u[1]-0]=u[2],t.layouthash[u[2]]=u[1]-0;break;case"font":t.fonts[u[1]-0]=u[2],t.fonthash[u[2]]=u[1]-0;break;case"color":t.colors[u[1]-0]=u[2],t.colorhash[u[2]]=u[1]-0;break;case"border":t.borderstyles[u[1]-0]=u[2],t.borderstylehash[u[2]]=u[1]-0;break;case"cellformat":n=Oe.decodeFromSave(u[2]),t.cellformats[u[1]-0]=n,t.cellformathash[n]=u[1]-0;break;case"valueformat":n=Oe.decodeFromSave(u[2]),t.valueformats[u[1]-0]=n,t.valueformathash[n]=u[1]-0;break;case"version":break;case"copiedfrom":t.copiedfrom=u[1]+":"+u[2];break;case"clipboardrange":case"clipboard":case"":break;default:throw alert(p.s_pssUnknownLineType+" '"+u[0]+"'"),p.s_pssUnknownLineType+" '"+u[0]+"'"}u=null}},Oe.CellFromStringParts=function(e,t,o,r){for(var a,n;a=o[r++];)switch(a){case"v":t.datavalue=Oe.decodeFromSave(o[r++])-0,t.datatype="v",t.valuetype="n";break;case"t":t.datavalue=Oe.decodeFromSave(o[r++]),t.datatype="t",t.valuetype=Oe.Constants.textdatadefaulttype;break;case"vt":n=o[r++],"n"==(t.valuetype=n).charAt(0)?(t.datatype="v",t.datavalue=Oe.decodeFromSave(o[r++])-0):(t.datatype="t",t.datavalue=Oe.decodeFromSave(o[r++]));break;case"vtf":n=o[r++],"n"==(t.valuetype=n).charAt(0)?t.datavalue=Oe.decodeFromSave(o[r++])-0:t.datavalue=Oe.decodeFromSave(o[r++]),t.formula=Oe.decodeFromSave(o[r++]),t.datatype="f";break;case"vtc":n=o[r++],"n"==(t.valuetype=n).charAt(0)?t.datavalue=Oe.decodeFromSave(o[r++])-0:t.datavalue=Oe.decodeFromSave(o[r++]),t.formula=Oe.decodeFromSave(o[r++]),t.datatype="c";break;case"ro":ro=Oe.decodeFromSave(o[r++]),t.readonly="yes"==ro.toLowerCase();break;case"e":t.errors=Oe.decodeFromSave(o[r++]);break;case"b":t.bt=o[r++]-0,t.br=o[r++]-0,t.bb=o[r++]-0,t.bl=o[r++]-0;break;case"l":t.layout=o[r++]-0;break;case"f":t.font=o[r++]-0;break;case"c":t.color=o[r++]-0;break;case"bg":t.bgcolor=o[r++]-0;break;case"cf":t.cellformat=o[r++]-0;break;case"ntvf":t.nontextvalueformat=o[r++]-0;break;case"tvf":t.textvalueformat=o[r++]-0;break;case"colspan":t.colspan=o[r++]-0;break;case"rowspan":t.rowspan=o[r++]-0;break;case"cssc":t.cssc=o[r++];break;case"csss":t.csss=Oe.decodeFromSave(o[r++]);break;case"mod":r+=1;break;case"comment":t.comment=Oe.decodeFromSave(o[r++]);break;default:throw Oe.Constants.s_cfspUnknownCellType+" '"+a+"'"}},Oe.sheetfields=["defaultrowheight","defaultcolwidth","circularreferencecell","recalc","needsrecalc","usermaxcol","usermaxrow"],Oe.sheetfieldsshort=["h","w","circularreferencecell","recalc","needsrecalc","usermaxcol","usermaxrow"],Oe.sheetfieldsxlat=["defaulttextformat","defaultnontextformat","defaulttextvalueformat","defaultnontextvalueformat","defaultcolor","defaultbgcolor","defaultfont","defaultlayout"],Oe.sheetfieldsxlatshort=["tf","ntf","tvf","ntvf","color","bgcolor","font","layout"],Oe.sheetfieldsxlatxlt=["cellformat","cellformat","valueformat","valueformat","color","color","font","layout"],Oe.CreateSheetSave=function(e,t,o){var r,a,n,l,s,i,c,d,u,p,h,m=[];e.CanonicalizeSheet(o||Oe.Constants.doCanonicalizeSheet);var f=e.xlt;for(a=(h=t?Oe.ParseRange(t):{cr1:{row:1,col:1},cr2:{row:f.maxrow,col:f.maxcol}}).cr1,n=h.cr2,m.push("version:1.5"),l=a.row;l<=n.row;l++)for(s=a.col;s<=n.col;s++)i=Oe.crToCoord(s,l),(r=e.cells[i])&&0!=(c=e.CellToString(r)).length&&(c="cell:"+i+c,m.push(c));for(s=1;s<=f.maxcol;s++)i=Oe.rcColname(s),e.colattribs.width[i]&&m.push("col:"+i+":w:"+e.colattribs.width[i]),e.colattribs.hide[i]&&m.push("col:"+i+":hide:"+e.colattribs.hide[i]);for(l=1;l<=f.maxrow;l++)e.rowattribs.height[l]&&m.push("row:"+l+":h:"+e.rowattribs.height[l]),e.rowattribs.hide[l]&&m.push("row:"+l+":hide:"+e.rowattribs.hide[l]);for(c="sheet:c:"+f.maxcol+":r:"+f.maxrow,u=0;u<Oe.sheetfields.length;u++)(d=Oe.encodeForSave(e.attribs[Oe.sheetfields[u]]))&&(c+=":"+Oe.sheetfieldsshort[u]+":"+d);for(u=0;u<Oe.sheetfieldsxlat.length;u++)(d=e.attribs[Oe.sheetfieldsxlat[u]])&&(c+=":"+Oe.sheetfieldsxlatshort[u]+":"+f[Oe.sheetfieldsxlatxlt[u]+"sxlat"][d]);for(m.push(c),u=1;u<f.newborderstyles.length;u++)m.push("border:"+u+":"+f.newborderstyles[u]);for(u=1;u<f.newcellformats.length;u++)m.push("cellformat:"+u+":"+Oe.encodeForSave(f.newcellformats[u]));for(u=1;u<f.newcolors.length;u++)m.push("color:"+u+":"+f.newcolors[u]);for(u=1;u<f.newfonts.length;u++)m.push("font:"+u+":"+f.newfonts[u]);for(u=1;u<f.newlayouts.length;u++)m.push("layout:"+u+":"+f.newlayouts[u]);for(u=1;u<f.newvalueformats.length;u++)m.push("valueformat:"+u+":"+Oe.encodeForSave(f.newvalueformats[u]));for(u=0;u<f.namesorder.length;u++)p=f.namesorder[u],m.push("name:"+Oe.encodeForSave(p).toUpperCase()+":"+Oe.encodeForSave(e.names[p].desc)+":"+Oe.encodeForSave(e.names[p].definition));return t&&m.push("copiedfrom:"+Oe.crToCoord(a.col,a.row)+":"+Oe.crToCoord(n.col,n.row)),m.push(""),delete e.xlt,m.join("\n")},Oe.CellToString=function(e,t){var o,r,a,n,l,s,i,c;return o="",t&&(r=Oe.encodeForSave(t.datavalue),"v"==t.datatype?"n"==t.valuetype?o+=":v:"+r:o+=":vt:"+t.valuetype+":"+r:"t"==t.datatype?t.valuetype==Oe.Constants.textdatadefaulttype?o+=":t:"+r:o+=":vt:"+t.valuetype+":"+r:(a=Oe.encodeForSave(t.formula),"f"==t.datatype?o+=":vtf:"+t.valuetype+":"+r+":"+a:"c"==t.datatype&&(o+=":vtc:"+t.valuetype+":"+r+":"+a)),t.readonly&&(o+=":ro:yes"),t.errors&&(o+=":e:"+Oe.encodeForSave(t.errors)),n=t.bt||"",l=t.br||"",s=t.bb||"",i=t.bl||"",e.xlt?(c=e.xlt,(n||l||s||i)&&(o+=":b:"+c.borderstylesxlat[n||0]+":"+c.borderstylesxlat[l||0]+":"+c.borderstylesxlat[s||0]+":"+c.borderstylesxlat[i||0]),t.layout&&(o+=":l:"+c.layoutsxlat[t.layout]),t.font&&(o+=":f:"+c.fontsxlat[t.font]),t.color&&(o+=":c:"+c.colorsxlat[t.color]),t.bgcolor&&(o+=":bg:"+c.colorsxlat[t.bgcolor]),t.cellformat&&(o+=":cf:"+c.cellformatsxlat[t.cellformat]),t.textvalueformat&&(o+=":tvf:"+c.valueformatsxlat[t.textvalueformat]),t.nontextvalueformat&&(o+=":ntvf:"+c.valueformatsxlat[t.nontextvalueformat])):((n||l||s||i)&&(o+=":b:"+n+":"+l+":"+s+":"+i),t.layout&&(o+=":l:"+t.layout),t.font&&(o+=":f:"+t.font),t.color&&(o+=":c:"+t.color),t.bgcolor&&(o+=":bg:"+t.bgcolor),t.cellformat&&(o+=":cf:"+t.cellformat),t.textvalueformat&&(o+=":tvf:"+t.textvalueformat),t.nontextvalueformat&&(o+=":ntvf:"+t.nontextvalueformat)),t.colspan&&(o+=":colspan:"+t.colspan),t.rowspan&&(o+=":rowspan:"+t.rowspan),t.cssc&&(o+=":cssc:"+t.cssc),t.csss&&(o+=":csss:"+Oe.encodeForSave(t.csss)),t.mod&&(o+=":mod:"+t.mod),t.comment&&(o+=":comment:"+Oe.encodeForSave(t.comment))),o},Oe.CanonicalizeSheet=function(e,t){var o,r,a,n,l,s,i,c,d,u,p,h,m=0,f=0,g=["borderstyle","cellformat","color","font","layout","valueformat"],v={namesorder:[]};for(i in e.names)v.namesorder.push(i);if(v.namesorder.sort(),!Oe.Constants.doCanonicalizeSheet||!t){for(s=0;s<g.length;s++){for(v["new"+(i=g[s])+"s"]=e[i+"s"],o=e[i+"s"].length,(d=new Array(o))[0]="",p=1;p<o;p++)d[p]=p;v[i+"sxlat"]=d}return v.maxrow=e.attribs.lastrow,v.maxcol=e.attribs.lastcol,void(e.xlt=v)}for(s=0;s<g.length;s++)v[(i=g[s])+"sUsed"]={};var b=v.colorsUsed,C=v.borderstylesUsed,y=v.fontsUsed,S=v.layoutsUsed,w=v.cellformatsUsed,x=v.valueformatsUsed;for(r in e.cells)a=Oe.coordToCr(r),l=!1,(n=e.cells[r]).valuetype&&"b"!=n.valuetype&&(l=!0),n.color&&(b[n.color]=1,l=!0),n.bgcolor&&(b[n.bgcolor]=1,l=!0),n.bt&&(C[n.bt]=1,l=!0),n.br&&(C[n.br]=1,l=!0),n.bb&&(C[n.bb]=1,l=!0),n.bl&&(C[n.bl]=1,l=!0),n.layout&&(S[n.layout]=1,l=!0),n.font&&(y[n.font]=1,l=!0),n.cellformat&&(w[n.cellformat]=1,l=!0),n.textvalueformat&&(x[n.textvalueformat]=1,l=!0),n.nontextvalueformat&&(x[n.nontextvalueformat]=1,l=!0),l&&(a.row>m&&(m=a.row),a.col>f&&(f=a.col));for(p=0;p<Oe.sheetfieldsxlat.length;p++)(h=e.attribs[Oe.sheetfieldsxlat[p]])&&(v[Oe.sheetfieldsxlatxlt[p]+"sUsed"][h]=1);for(h in i={height:1,hide:1})for(a in e.rowattribs[h])m<a&&(m=a);for(h in i={hide:1,width:1})for(r in e.colattribs[h])(a=Oe.coordToCr(r+"1")).col>f&&(f=a.col);for(s=0;s<g.length;s++){for(h in c=[],v[(i=g[s])+"sUsed"])c.push(e[i+"s"][h]);for(c.sort(),c.unshift(""),d=[""],u=e[i+"hash"],p=1;p<c.length;p++)d[u[c[p]]]=p;v[i+"sxlat"]=d,v["new"+i+"s"]=c}v.maxrow=m||1,v.maxcol=f||1,e.xlt=v},Oe.EncodeCellAttributes=function(e,t){function o(e){c[e]={def:!0,val:""}}function r(e){for(var t=0;t<e.length;t++)o(e[t])}function a(e,t){c[e].def=!1,c[e].val=t||""}function n(e,t){"*"!=t&&(c[e].def=!1,c[e].val=t)}var l,s,i,c={},d=e.GetAssuredCell(t);for(o("alignhoriz"),d.cellformat&&a("alignhoriz",e.cellformats[d.cellformat]),r(["alignvert","padtop","padright","padbottom","padleft"]),d.layout&&(parts=e.layouts[d.layout].match(/^padding:\s*(\S+)\s+(\S+)\s+(\S+)\s+(\S+);vertical-align:\s*(\S+);/),n("padtop",parts[1]),n("padright",parts[2]),n("padbottom",parts[3]),n("padleft",parts[4]),n("alignvert",parts[5])),r(["fontfamily","fontlook","fontsize"]),d.font&&(parts=e.fonts[d.font].match(/^(\*|\S+? \S+?) (\S+?) (\S.*)$/),n("fontfamily",parts[3]),n("fontsize",parts[2]),n("fontlook",parts[1])),o("textcolor"),d.color&&a("textcolor",e.colors[d.color]),o("bgcolor"),d.bgcolor&&a("bgcolor",e.colors[d.bgcolor]),r(["numberformat","textformat"]),d.nontextvalueformat&&a("numberformat",e.valueformats[d.nontextvalueformat]),d.textvalueformat&&a("textformat",e.valueformats[d.textvalueformat]),r(["colspan","rowspan"]),a("colspan",d.colspan||1),a("rowspan",d.rowspan||1),l=0;l<4;l++)s="trbl".charAt(l),o(i="b"+s),a(i,d[i]?e.borderstyles[d[i]]:""),o(i+"thickness"),o(i+"style"),o(i+"color"),d[i]&&(parts=e.borderstyles[d[i]].match(/(\S+)\s+(\S+)\s+(\S.+)/),a(i+"thickness",parts[1]),a(i+"style",parts[2]),a(i+"color",parts[3]));return r(["cssc","csss","mod"]),a("cssc",d.cssc||""),a("csss",d.csss||""),a("mod",d.mod||"n"),c},Oe.EncodeSheetAttributes=function(e){function o(e){l[e]={def:!0,val:""}}function t(e){for(var t=0;t<e.length;t++)o(e[t])}function r(e,t){l[e].def=!1,l[e].val=t||void 0}function a(e,t){"*"!=t&&(l[e].def=!1,l[e].val=t)}var n=e.attribs,l={};return o("colwidth"),n.defaultcolwidth&&r("colwidth",n.defaultcolwidth),o("rowheight"),n.rowheight&&r("rowheight",n.defaultrowheight),o("textalignhoriz"),n.defaulttextformat&&r("textalignhoriz",e.cellformats[n.defaulttextformat]),o("numberalignhoriz"),n.defaultnontextformat&&r("numberalignhoriz",e.cellformats[n.defaultnontextformat]),t(["alignvert","padtop","padright","padbottom","padleft"]),n.defaultlayout&&(parts=e.layouts[n.defaultlayout].match(/^padding:\s*(\S+)\s+(\S+)\s+(\S+)\s+(\S+);vertical-align:\s*(\S+);/),a("padtop",parts[1]),a("padright",parts[2]),a("padbottom",parts[3]),a("padleft",parts[4]),a("alignvert",parts[5])),t(["fontfamily","fontlook","fontsize"]),n.defaultfont&&(parts=e.fonts[n.defaultfont].match(/^(\*|\S+? \S+?) (\S+?) (\S.*)$/),a("fontfamily",parts[3]),a("fontsize",parts[2]),a("fontlook",parts[1])),o("textcolor"),n.defaultcolor&&r("textcolor",e.colors[n.defaultcolor]),o("bgcolor"),n.defaultbgcolor&&r("bgcolor",e.colors[n.defaultbgcolor]),t(["numberformat","textformat"]),n.defaultnontextvalueformat&&r("numberformat",e.valueformats[n.defaultnontextvalueformat]),n.defaulttextvalueformat&&r("textformat",e.valueformats[n.defaulttextvalueformat]),o("recalc"),n.recalc&&r("recalc",n.recalc),o("usermaxcol"),n.usermaxcol&&r("usermaxcol",n.usermaxcol),o("usermaxrow"),n.usermaxrow&&r("usermaxrow",n.usermaxrow),l},Oe.DecodeCellAttributes=function(e,t,a,o){function r(e,t,o){var r;a[e]&&(r=a[e].def?"":a[e].val)!=(t||"")&&u(o+" "+r)}var n,l,s=e.GetAssuredCell(t),c=!1,d="",u=function(e){d&&(d+="\n"),d+="set "+(o||t)+" "+e,c=!0};for(r("alignhoriz",e.cellformats[s.cellformat],"cellformat"),(n=a.alignvert.def&&a.padtop.def&&a.padright.def&&a.padbottom.def&&a.padleft.def?"":"padding:"+(a.padtop.def?"* ":a.padtop.val+" ")+(a.padright.def?"* ":a.padright.val+" ")+(a.padbottom.def?"* ":a.padbottom.val+" ")+(a.padleft.def?"*":a.padleft.val)+";vertical-align:"+(a.alignvert.def?"*;":a.alignvert.val+";"))!=(e.layouts[s.layout]||"")&&u("layout "+n),(n=a.fontlook.def&&a.fontsize.def&&a.fontfamily.def?"":(a.fontlook.def?"* ":a.fontlook.val+" ")+(a.fontsize.def?"* ":a.fontsize.val+" ")+(a.fontfamily.def?"*":a.fontfamily.val))!=(e.fonts[s.font]||"")&&u("font "+n),r("textcolor",e.colors[s.color],"color"),r("bgcolor",e.colors[s.bgcolor],"bgcolor"),r("numberformat",e.valueformats[s.nontextvalueformat],"nontextvalueformat"),r("textformat",e.valueformats[s.textvalueformat],"textvalueformat"),i=0;i<4;i++)r(l="b"+"trbl".charAt(i),e.borderstyles[s[l]],l);return r("cssc",s.cssc,"cssc"),r("csss",s.csss,"csss"),a.mod&&(n=a.mod.def?"n":a.mod.val)!=(s.mod||"n")&&("n"==n&&(n=""),u("mod "+n)),c?d:null},Oe.DecodeSheetAttributes=function(e,a){function t(e,t,o){var r;a[e]&&(r=a[e].def?"":a[e].val)!=(t||"")&&s(o+" "+r)}var o,r=e.attribs,n=!1,l="",s=function(e){l&&(l+="\n"),l+="set sheet "+e,n=!0};return t("colwidth",r.defaultcolwidth,"defaultcolwidth"),t("rowheight",r.defaultrowheight,"defaultrowheight"),t("textalignhoriz",e.cellformats[r.defaulttextformat],"defaulttextformat"),t("numberalignhoriz",e.cellformats[r.defaultnontextformat],"defaultnontextformat"),(o=a.alignvert.def&&a.padtop.def&&a.padright.def&&a.padbottom.def&&a.padleft.def?"":"padding:"+(a.padtop.def?"* ":a.padtop.val+" ")+(a.padright.def?"* ":a.padright.val+" ")+(a.padbottom.def?"* ":a.padbottom.val+" ")+(a.padleft.def?"*":a.padleft.val)+";vertical-align:"+(a.alignvert.def?"*;":a.alignvert.val+";"))!=(e.layouts[r.defaultlayout]||"")&&s("defaultlayout "+o),(o=a.fontlook.def&&a.fontsize.def&&a.fontfamily.def?"":(a.fontlook.def?"* ":a.fontlook.val+" ")+(a.fontsize.def?"* ":a.fontsize.val+" ")+(a.fontfamily.def?"*":a.fontfamily.val))!=(e.fonts[r.defaultfont]||"")&&s("defaultfont "+o),t("textcolor",e.colors[r.defaultcolor],"defaultcolor"),t("bgcolor",e.colors[r.defaultbgcolor],"defaultbgcolor"),t("numberformat",e.valueformats[r.defaultnontextvalueformat],"defaultnontextvalueformat"),t("textformat",e.valueformats[r.defaulttextvalueformat],"defaulttextvalueformat"),t("recalc",e.attribs.recalc,"recalc"),t("usermaxcol",e.attribs.usermaxcol,"usermaxcol"),t("usermaxrow",e.attribs.usermaxrow,"usermaxrow"),n?l:null},Oe.SheetCommandInfo=function(e){this.sheetobj=e,this.timerobj=null,this.firsttimerdelay=50,this.timerdelay=1,this.maxtimeslice=100,this.saveundo=!1,this.CmdExtensionCallbacks={}},Oe.ScheduleSheetCommands=function(e,t,o){var r=e.sci,a=new Oe.Parse(t);r.sheetobj.statuscallback&&e.statuscallback(r,"cmdstart","",r.sheetobj.statuscallbackparams),o&&r.sheetobj.changes.PushChange(""),r.timerobj=U.setTimeout(function(){Oe.SheetCommandsTimerRoutine(r,a,o)},r.firsttimerdelay)},Oe.SheetCommandsTimerRoutine=function(e,t,o){var r,a=new Date;for(e.timerobj=null;!t.EOF();){try{r=Oe.ExecuteSheetCommand(e.sheetobj,t,o)}catch(e){r=e.message}if(r&&("function"==typeof alert?alert(r):console.log(r)),t.NextLine(),new Date-a>=e.maxtimeslice)return void(e.timerobj=U.setTimeout(function(){Oe.SheetCommandsTimerRoutine(e,t,o)},e.timerdelay))}e.sheetobj.statuscallback&&e.sheetobj.statuscallback(e,"cmdend","",e.sheetobj.statuscallbackparams)},Oe.ExecuteSheetCommand=function(s,e,t){function o(){var e=Oe.ParseRange(l);f=e.cr1,(g=e.cr2).col>me.lastcol&&(me.lastcol=g.col),g.row>me.lastrow&&(me.lastrow=g.row)}var r,a,n,l,i,c,d,u,p,h,m,f,g,v,b,C,y,S,w,x,F,T,k,E,_,P,R,A,L,M,I,D,N,O,U,z,B,G,V,H,j,W,K,$,X,Y,q,Z,J,Q,ee,te,oe,re,ae,ne,le,se,ie,ce,de,ue,pe,he,me=s.attribs,fe=s.changes,ge=Oe.CellProperties,ve=Oe.Constants,be=!1;switch(p="",r=e.RestOfStringNoMove(),t&&s.changes.AddDo(r),a=e.NextToken()){case"set":if(l=e.NextToken(),i=e.NextToken(),n=e.RestOfString(),h="set "+l+" "+i,"sheet"==l)switch(s.renderneeded=!0,i){case"defaultcolwidth":t&&fe.AddUndo(h,me[i]),me[i]=n;break;case"defaultcolor":case"defaultbgcolor":t&&fe.AddUndo(h,s.GetStyleString("color",me[i])),me[i]=s.GetStyleNum("color",n);break;case"defaultlayout":t&&fe.AddUndo(h,s.GetStyleString("layout",me[i])),me[i]=s.GetStyleNum("layout",n);break;case"defaultfont":t&&fe.AddUndo(h,s.GetStyleString("font",me[i])),"* * *"==n&&(n=""),me[i]=s.GetStyleNum("font",n);break;case"defaulttextformat":case"defaultnontextformat":t&&fe.AddUndo(h,s.GetStyleString("cellformat",me[i])),me[i]=s.GetStyleNum("cellformat",n);break;case"defaulttextvalueformat":case"defaultnontextvalueformat":for(v in t&&fe.AddUndo(h,s.GetStyleString("valueformat",me[i])),me[i]=s.GetStyleNum("valueformat",n),s.cells)delete s.cells[v].displaystring;break;case"lastcol":case"lastrow":t&&fe.AddUndo(h,me[i]-0),"number"==typeof(c=n-0)&&(me[i]=0<c?c:1);break;case"recalc":t&&fe.AddUndo(h,me[i]),"off"==n?me.recalc=n:delete me.recalc;break;case"usermaxcol":case"usermaxrow":t&&fe.AddUndo(h,me[i]-0),"number"==typeof(c=n-0)&&(me[i]=0<c?c:0);break;default:p=ve.s_escUnknownSheetCmd+r}else if(/^[a-z]{1,2}(:[a-z]{1,2})?$/i.test(l))for(s.renderneeded=!0,d=(l=l.toUpperCase()).indexOf(":"),g=0<=d?(f=Oe.coordToCr(l.substring(0,d)+"1"),Oe.coordToCr(l.substring(d+1)+"1")):f=Oe.coordToCr(l+"1"),ce=f.col;ce<=g.col;ce++)"width"==i?(v=Oe.rcColname(ce),t&&fe.AddUndo("set "+v+" width",s.colattribs.width[v]),0<n.length?s.colattribs.width[v]=n:delete s.colattribs.width[v]):"hide"==i&&(s.hiddencolrow="col",v=Oe.rcColname(ce),t&&fe.AddUndo("set "+v+" hide",s.colattribs.hide[v]),0<n.length?s.colattribs.hide[v]=n:delete s.colattribs.hide[v]);else if(/^\d+(:\d+)?$/i.test(l))for(s.renderneeded=!0,d=(l=l.toUpperCase()).indexOf(":"),g=0<=d?(f=Oe.coordToCr("A"+l.substring(0,d)),Oe.coordToCr("A"+l.substring(d+1))):f=Oe.coordToCr("A"+l),de=f.row;de<=g.row;de++)"height"==i?(t&&fe.AddUndo("set "+de+" height",s.rowattribs.height[de]),0<n.length?s.rowattribs.height[de]=n:delete s.rowattribs.height[de]):"hide"==i&&(s.hiddencolrow="row",t&&fe.AddUndo("set "+de+" hide",s.rowattribs.hide[de]),0<n.length?s.rowattribs.hide[de]=n:delete s.rowattribs.hide[de]);else if(/^[a-z]{1,2}\d+(:[a-z]{1,2}\d+)?$/i.test(l))for(be=!0,o(),f.row!=g.row||f.col!=g.col||s.celldisplayneeded||s.renderneeded?(s.renderneeded=!0,s.celldisplayneeded=""):s.celldisplayneeded=Oe.crToCoord(f.col,f.row),de=f.row;de<=g.row;de++)for(ce=f.col;ce<=g.col;ce++)v=Oe.crToCoord(ce,de),(b=s.GetAssuredCell(v)).readonly&&"readonly"!=i||(t&&fe.AddUndo("set "+v+" all",s.CellToString(b)),"value"==i?(d=n.indexOf(" "),b.datavalue=n.substring(d+1)-0,delete b.errors,b.datatype="v",b.valuetype=n.substring(0,d),delete b.displaystring,delete b.parseinfo,me.needsrecalc="yes"):"text"==i?(d=n.indexOf(" "),b.datavalue=Oe.decodeFromSave(n.substring(d+1)),delete b.errors,b.datatype="t",b.valuetype=n.substring(0,d),delete b.displaystring,delete b.parseinfo,me.needsrecalc="yes"):"formula"==i?(b.datavalue=0,delete b.errors,b.datatype="f",Oe._app&&"e#N/A"!=b.valuetype&&(b.prevvaluetype=b.valuetype),b.valuetype="e#N/A",b.formula=n,delete b.displaystring,delete b.parseinfo,me.needsrecalc="yes"):"constant"==i?(d=n.indexOf(" "),u=n.substring(d+1).indexOf(" "),b.datavalue=n.substring(d+1,d+1+u)-0,b.valuetype=n.substring(0,d),"e"==b.valuetype.charAt(0)?b.errors=b.valuetype.substring(1):delete b.errors,b.datatype="c",b.formula=n.substring(d+u+2),delete b.displaystring,delete b.parseinfo,me.needsrecalc="yes"):"empty"==i?(b.datavalue="",delete b.errors,b.datatype=null,b.formula="",b.valuetype="b",delete b.displaystring,delete b.parseinfo,me.needsrecalc="yes"):"all"==i?(0<n.length?(b=new Oe.Cell(v),s.CellFromStringParts(b,n.split(":"),1),s.cells[v]=b):delete s.cells[v],me.needsrecalc="yes"):/^b[trbl]$/.test(i)?(b[i]=s.GetStyleNum("borderstyle",n),s.renderneeded=!0):"color"==i||"bgcolor"==i?b[i]=s.GetStyleNum("color",n):"layout"==i||"cellformat"==i?b[i]=s.GetStyleNum(i,n):"font"==i?("* * *"==n&&(n=""),b[i]=s.GetStyleNum("font",n)):"textvalueformat"==i||"nontextvalueformat"==i?(b[i]=s.GetStyleNum("valueformat",n),delete b.displaystring):"cssc"==i?(n=n.replace(/[^a-zA-Z0-9\-]/g,""),b.cssc=n):"csss"==i?(n=n.replace(/\n/g,""),b.csss=n):"mod"==i?(n=n.replace(/[^yY]/g,"").toLowerCase(),b.mod=n):"comment"==i?b.comment=Oe.decodeFromSave(n):"readonly"==i?b.readonly="yes"==n.toLowerCase():p=ve.s_escUnknownSetCoordCmd+r);break;case"merge":if(s.renderneeded=!0,l=e.NextToken(),n=e.RestOfString(),o(),(b=s.GetAssuredCell(f.coord)).readonly)break;for(de=f.row;de<=g.row;de++)for(ce=f.col;ce<=g.col;ce++)de==f.row&&ce==f.col||(quashedCellCoord=Oe.crToCoord(ce,de),quashedCell=s.GetAssuredCell(quashedCellCoord),t&&fe.AddUndo("set "+quashedCellCoord+" all",s.CellToString(quashedCell)),delete s.cells[quashedCellCoord]);t&&fe.AddUndo("unmerge "+f.coord),g.col>f.col?b.colspan=g.col-f.col+1:delete b.colspan,g.row>f.row?b.rowspan=g.row-f.row+1:delete b.rowspan,s.changedrendervalues=!0;break;case"unmerge":if(s.renderneeded=!0,l=e.NextToken(),n=e.RestOfString(),o(),(b=s.GetAssuredCell(f.coord)).readonly)break;t&&fe.AddUndo("merge "+f.coord+":"+Oe.crToCoord(f.col+(b.colspan||1)-1,f.row+(b.rowspan||1)-1)),delete b.colspan,delete b.rowspan,s.changedrendervalues=!0;break;case"erase":case"cut":for(s.renderneeded=!0,s.changedrendervalues=!0,l=e.NextToken(),n=e.RestOfString(),o(),t&&fe.AddUndo("changedrendervalues"),"cut"==a&&(t&&fe.AddUndo("loadclipboard",Oe.encodeForSave(Oe.Clipboard.clipboard)),Oe.Clipboard.clipboard=Oe.CreateSheetSave(s,l)),de=f.row;de<=g.row;de++)for(ce=f.col;ce<=g.col;ce++)v=Oe.crToCoord(ce,de),(b=s.GetAssuredCell(v)).readonly||(t&&fe.AddUndo("set "+v+" all",s.CellToString(b)),"all"==n?delete s.cells[v]:"formulas"==n?(b.datavalue="",b.datatype=null,b.formula="",b.valuetype="b",delete b.errors,delete b.displaystring,delete b.parseinfo,b.comment&&delete b.comment):"formats"==n&&((C=new Oe.Cell(v)).datavalue=b.datavalue,C.datatype=b.datatype,C.formula=b.formula,C.valuetype=b.valuetype,b.comment&&(C.comment=b.comment),s.cells[v]=C));me.needsrecalc="yes";break;case"fillright":case"filldown":function Ce(e){function t(e){return"v"==e||"c"==e}var o,r,a=Oe.GetSpreadsheetControlObject().editor,n=a.range2,l=void 0;n.hasrange&&(e&&n.bottom-n.top==1&&n.left==n.right?(o=s.GetAssuredCell(Oe.crToCoord(n.left,n.top)),r=s.GetAssuredCell(Oe.crToCoord(n.left,n.bottom)),t(o.datatype)&&t(r.datatype)&&(l=r.datavalue-o.datavalue)):e||n.left==n.right||(o=s.GetAssuredCell(Oe.crToCoord(n.left,n.top)),r=s.GetAssuredCell(Oe.crToCoord(n.right,n.top)),t(o.datatype)&&t(r.datatype)&&(l=r.datavalue-o.datavalue)));return a.Range2Remove(),l}var ye;for(s.renderneeded=!0,s.changedrendervalues=!0,t&&fe.AddUndo("changedrendervalues"),l=e.NextToken(),n=e.RestOfString(),o(),ye="fillright"==a?(y=!0,S=f.row,w=f.col+1,Ce(!1)):(y=!1,S=f.row+1,w=f.col,Ce(!0)),de=S;de<=g.row;de++)for(ce=w;ce<=g.col;ce++)if(v=Oe.crToCoord(ce,de),!(b=s.GetAssuredCell(v)).readonly){if(t&&fe.AddUndo("set "+v+" all",s.CellToString(b)),F=y?(x=Oe.crToCoord(f.col,de),T=ce-w+1,0):(x=Oe.crToCoord(ce,f.row),T=0,de-S+1),k=s.GetAssuredCell(x),"all"==n||"formats"==n)for(i in ge)1!=ge[i]&&(k[i],3==ge[i]?delete b[i]:b[i]=k[i]);"all"!=n&&"formulas"!=n||(b.datavalue=void 0!==ye?k.datavalue+(y?T:F)*ye:k.datavalue,b.datatype=k.datatype,b.valuetype=k.valuetype,"f"==b.datatype?b.formula=Oe.OffsetFormulaCoords(k.formula,T,F):b.formula=k.formula,delete b.parseinfo,b.errors=k.errors),delete b.displaystring}me.needsrecalc="yes";break;case"copy":l=e.NextToken(),n=e.RestOfString(),t&&fe.AddUndo("loadclipboard",Oe.encodeForSave(Oe.Clipboard.clipboard)),Oe.Clipboard.clipboard=Oe.CreateSheetSave(s,l);break;case"loadclipboard":n=e.RestOfString(),t&&fe.AddUndo("loadclipboard",Oe.encodeForSave(Oe.Clipboard.clipboard)),Oe.Clipboard.clipboard=Oe.decodeFromSave(n);break;case"clearclipboard":t&&fe.AddUndo("loadclipboard",Oe.encodeForSave(Oe.Clipboard.clipboard)),Oe.Clipboard.clipboard="";break;case"paste":if(s.renderneeded=!0,s.changedrendervalues=!0,t&&fe.AddUndo("changedrendervalues"),l=e.NextToken(),n=e.RestOfString(),o(),!Oe.Clipboard.clipboard)break;for((E=new Oe.Sheet).ParseSheetSave(Oe.Clipboard.clipboard),_=Oe.ParseRange(E.copiedfrom),P=Math.max(g.col-f.col+1,_.cr2.col-_.cr1.col+1),R=Math.max(g.row-f.row+1,_.cr2.row-_.cr1.row+1),f.col+P-1>me.lastcol&&(me.lastcol=f.col+P-1),f.row+R-1>me.lastrow&&(me.lastrow=f.row+R-1),de=f.row;de<f.row+R;de++)for(ce=f.col;ce<f.col+P;ce++)if(v=Oe.crToCoord(ce,de),!(b=s.GetAssuredCell(v)).readonly){t&&fe.AddUndo("set "+v+" all",s.CellToString(b));var Se=_.cr1.col+(ce-f.col)%(_.cr2.col-_.cr1.col+1),we=_.cr1.row+(de-f.row)%(_.cr2.row-_.cr1.row+1);if(x=Oe.crToCoord(Se,we),k=E.GetAssuredCell(x),"all"==n||"formats"==n)for(i in de==f.row&&(sourceColname=Oe.rcColname(_.cr1.col+(ce-f.col)%(_.cr2.col-_.cr1.col+1)),colWidth=E.colattribs.width[sourceColname],colHide=E.colattribs.hide[sourceColname],null!=colWidth&&(s.colattribs.width[Oe.rcColname(ce)]=colWidth),null!=colHide&&(s.colattribs.hide[Oe.rcColname(ce)]=colHide)),ce==f.col&&(sourceRow=_.cr1.row+(de-f.row)%(_.cr2.row-_.cr1.row+1),rowHide=E.rowattribs.hide[sourceRow],null!=rowHide&&(s.rowattribs.hide[de]=rowHide)),ge)1!=ge[i]&&(k[i],3==ge[i]?delete b[i]:(A=Oe.CellPropertiesTable[i])&&k[i]?b[i]=s.GetStyleNum(A,E.GetStyleString(A,k[i])):b[i]=k[i]);"all"!=n&&"formulas"!=n||(b.datavalue=k.datavalue,b.datatype=k.datatype,b.valuetype=k.valuetype,"f"==b.datatype?b.formula=Oe.OffsetFormulaCoords(k.formula,ce-Se,de-we):b.formula=k.formula,delete b.parseinfo,b.errors=k.errors,k.comment?b.comment=k.comment:b.comment&&delete b.comment),delete b.displaystring}me.needsrecalc="yes";break;case"sort":for(s.renderneeded=!0,s.changedrendervalues=!0,t&&fe.AddUndo("changedrendervalues"),l=e.NextToken(),o(),$=[],X=[],q=Y=0;q<=3;q++)$[q]=e.NextToken(),X[q]=e.NextToken(),$[q]&&(Y=q);for(J={},Z=[],Q=[],ee=[],de=f.row;de<=g.row;de++){for(ce=f.col;ce<=g.col;ce++)v=Oe.crToCoord(ce,de),(b=s.cells[v])?(J[v]=s.CellToString(b),t&&fe.AddUndo("set "+v+" all",J[v])):t&&fe.AddUndo("set "+v+" all");for(Z.push(Z.length),Q.push([]),ee.push([]),slast=ee.length-1,q=0;q<=Y;q++)v=$[q]+de,m=(b=s.GetAssuredCell(v)).datavalue,"t"==(oe=b.valuetype.charAt(0)||"b")&&(m=m.toLowerCase()),Q[slast].push(m),ee[slast].push(oe)}for(te=function(e,t){var o,r,a,n,l;for(o=0;o<=Y;o++)if(a="up"==X[o]?(r=e,t):(r=t,e),n=ee[r][o],tb=ee[a][o],"t"==n?"t"==tb?(r=Q[r][o],l=(a=Q[a][o])<r?1:r<a?-1:0):"n"==tb?l=1:"b"==tb?l="up"==X[o]?-1:1:"e"==tb&&(l=-1):"n"==n?"t"==tb?l=-1:"n"==tb?(r=Q[r][o]-0,l=(a=Q[a][o]-0)<r?1:r<a?-1:0):"b"==tb?l="up"==X[o]?-1:1:"e"==tb&&(l=-1):"e"==n?l="e"==tb?(r=Q[r][o],(a=Q[a][o])<r?1:r<a?-1:0):"b"==tb&&"up"==X[o]?-1:1:"b"==n&&(l="b"==tb?0:"up"==X[o]?1:-1),l)return l;return l=t<e?1:e<t?-1:0},Z.sort(te),de=f.row;de<=g.row;de++)for(re=Z[de-f.row],ce=f.col;ce<=g.col;ce++)v=Oe.crToCoord(ce,de),J[ae=Oe.crToCoord(ce,re+f.row)]?(b=new Oe.Cell(v),s.CellFromStringParts(b,J[ae].split(":"),1),"f"==b.datatype&&(b.formula=Oe.OffsetFormulaCoords(b.formula,0,de-f.row-re)),s.cells[v]=b):delete s.cells[v];me.needsrecalc="yes";break;case"insertcol":case"insertrow":for(s.renderneeded=!0,s.changedrendervalues=!0,s.widgetsClean=!1,l=e.NextToken(),n=e.RestOfString(),o(),"insertcol"==a?(T=1,L=f.col,F=0,M=1,I=f.col,N=f.col,D=1,O=me.lastrow,t&&fe.AddUndo("deletecol "+f.coord)):(T=0,F=L=1,M=f.row,I=1,N=me.lastcol,D=f.row,O=f.row,t&&fe.AddUndo("deleterow "+f.coord)),de=me.lastrow;M<=de;de--)for(ce=me.lastcol;L<=ce;ce--)x=Oe.crToCoord(ce,de),v=Oe.crToCoord(ce+T,de+F),s.cells[x]?s.cells[v]=s.cells[x]:delete s.cells[v];for(de=D;de<=O;de++)for(ce=I;ce<=N;ce++)for(i in v=Oe.crToCoord(ce,de),b=new Oe.Cell(v),s.cells[v]=b,x=Oe.crToCoord(ce-T,de-F),k=s.GetAssuredCell(x),ge)2==ge[i]&&(b[i]=k[i]);for(v in s.cells)(b=s.cells[v])&&"f"==b.datatype&&(b.formula=Oe.AdjustFormulaCoords(b.formula,f.col,T,f.row,F)),b&&delete b.parseinfo;for(ne in s.names)s.names[ne]&&(se="","="==(le=s.names[ne].definition).charAt(0)&&(se="=",le=le.substring(1)),s.names[ne].definition=se+Oe.AdjustFormulaCoords(le,f.col,T,f.row,F));for(de=me.lastrow;M<=de&&"insertrow"==a;de--)for(i in U=de+F,s.rowattribs)m=s.rowattribs[i][de],s.rowattribs[i][U]!=m&&(m?s.rowattribs[i][U]=m:delete s.rowattribs[i][U]);for(ce=me.lastcol;L<=ce&&"insertcol"==a;ce--)for(i in B=Oe.rcColname(ce),z=Oe.rcColname(ce+T),s.colattribs)m=s.colattribs[i][B],s.colattribs[i][z]!=m&&(m?s.colattribs[i][z]=m:delete s.colattribs[i][z]);(Ee=new Oe.RenderContext(s)).CalculateCellSkipData();var xe={};for(var Fe in Ee.cellskip){var Te=Oe.coordToCr(Fe),ke=Ee.cellskip[Fe];"insertcol"===a&&Te.col===I&&(xe[ke]||(s.GetAssuredCell(ke).colspan+=T),xe[ke]=!0),"insertrow"===a&&Te.row===D&&(xe[ke]||(s.GetAssuredCell(ke).rowspan+=F),xe[ke]=!0)}me.lastcol+=T,me.lastrow+=F,me.needsrecalc="yes";break;case"deletecol":case"deleterow":for(s.renderneeded=!0,s.changedrendervalues=!0,s.widgetsClean=!1,l=e.NextToken(),n=e.RestOfString(),V=me.lastcol,G=me.lastrow,o(),de=S="deletecol"==a?(T=f.col-g.col-1,F=0,w=g.col+1,1):(T=0,F=f.row-g.row-1,w=1,g.row+1);de<=G-F;de++)for(ce=w;ce<=V-T;ce++)if(v=Oe.crToCoord(ce+T,de+F),(b=s.cells[v])&&b.readonly)return p="Unable to remove "+("deletecol"==a?"column":"row")+", because cell "+b.coord+" is locked";for(de=S;de<=G-F;de++)for(ce=w;ce<=V-T;ce++)v=Oe.crToCoord(ce+T,de+F),t&&(de<S-F||ce<w-T)&&((b=s.cells[v])?fe.AddUndo("set "+v+" all",s.CellToString(b)):fe.AddUndo("erase "+v+" all")),x=Oe.crToCoord(ce,de),(b=s.cells[x])?s.cells[v]=b:delete s.cells[v];for(v in s.cells)(b=s.cells[v])&&("f"==b.datatype?(W=b.formula,b.formula=Oe.AdjustFormulaCoords(W,f.col,T,f.row,F),b.formula!=W&&(delete b.parseinfo,t&&-1!=b.formula.indexOf("#REF!")&&(K=Oe.coordToCr(v),fe.AddUndo("set "+Oe.rcColname(K.col-T)+(K.row-F)+" formula "+W)))):delete b.parseinfo);for(ne in s.names)s.names[ne]&&(se="","="==(le=s.names[ne].definition).charAt(0)&&(se="=",le=le.substring(1)),s.names[ne].definition=se+Oe.AdjustFormulaCoords(le,f.col,T,f.row,F));for(de=S;de<=G-F&&"deleterow"==a;de++)for(i in H=de+F,s.rowattribs)m=s.rowattribs[i][de],s.rowattribs[i][H]!=m&&(t&&fe.AddUndo("set "+H+" "+i,s.rowattribs[i][H]),m?s.rowattribs[i][H]=m:delete s.rowattribs[i][H]);for(ce=w;ce<=V-T&&"deletecol"==a;ce++)for(i in B=Oe.rcColname(ce),j=Oe.rcColname(ce+T),s.colattribs)m=s.colattribs[i][B],s.colattribs[i][j]!=m&&(t&&fe.AddUndo("set "+j+" "+i,s.colattribs[i][j]),m?s.colattribs[i][j]=m:delete s.colattribs[i][j]);var Ee;(Ee=new Oe.RenderContext(s)).CalculateCellSkipData();var _e={};for(var Fe in Ee.cellskip){Te=Oe.coordToCr(Fe),ke=Ee.cellskip[Fe];var Pe=Ee.coordToCR[ke];"deletecol"===a&&Te.col===w+T&&Pe.col<Te.col&&(_e[ke]||(s.GetAssuredCell(ke).colspan+=T),_e[ke]=!0),"deleterow"===a&&Te.row===S+F&&Pe.row<Te.row&&(_e[ke]||(s.GetAssuredCell(ke).rowspan+=F),_e[ke]=!0)}if(t)if("deletecol"==a)for(ce=f.col;ce<=g.col;ce++)fe.AddUndo("insertcol "+Oe.rcColname(f.col));else for(de=f.row;de<=g.row;de++)fe.AddUndo("insertrow "+f.row);"deletecol"==a?f.col<=V&&(g.col<=V?me.lastcol+=T:me.lastcol=f.col-1):f.row<=G&&(g.row<=G?me.lastrow+=F:me.lastrow=f.row-1),me.needsrecalc="yes";break;case"movepaste":case"moveinsert":var Re,Ae,Le,Me,Ie,De,Ne;for(s.renderneeded=!0,s.changedrendervalues=!0,t&&fe.AddUndo("changedrendervalues"),l=e.NextToken(),Ae=e.NextToken(),""==(n=e.RestOfString())&&(n="all"),o(),T=(Le=Oe.coordToCr(Ae)).col-f.col,F=Le.row-f.row,P=g.col-f.col+1,R=g.row-f.row+1,Re={},de=f.row;de<=g.row;de++)for(ce=f.col;ce<=g.col;ce++)if(v=Oe.crToCoord(ce,de),!(b=s.GetAssuredCell(v)).readonly&&(t&&fe.AddUndo("set "+v+" all",s.CellToString(b)),s.cells[v])){for(i in Re[v]=new Oe.Cell(v),ge)b[i],Re[v][i]=b[i],"all"==n&&delete b[i],"formulas"==n&&(1!=ge[i]&&3!=ge[i]||delete b[i]),"formats"==n&&2==ge[i]&&delete b[i];"formulas"==n&&(b.datavalue="",b.datatype=null,b.formula="",b.valuetype="b"),"all"==n&&delete s.cells[v]}if("moveinsert"==a&&(Ie=Me=!1,0==F&&(Le.col<f.col||Le.col>g.col)?Me=Le.col<f.col?(De=f.col-Le.col,-1):(Le.col-=1,T=Le.col-g.col,De=Le.col-g.col,1):0==T&&(Le.row<f.row||Le.row>g.row)?Ie=Le.row<f.row?(De=f.row-Le.row,-1):(Le.row-=1,F=Le.row-g.row,De=Le.row-g.row,1):a="movepaste"),Ne={},Ie)for(de=0;de<De;de++)for(ce=f.col;ce<=g.col;ce++){if(v=Ie<0?(x=Oe.crToCoord(ce,Le.row+De-de-1),Oe.crToCoord(ce,g.row-de)):(x=Oe.crToCoord(ce,Le.row-De+de+1),Oe.crToCoord(ce,f.row+de)),k=s.GetAssuredCell(x),t&&fe.AddUndo("set "+x+" all",s.CellToString(k)),b=s.GetAssuredCell(v),"all"==n||"formats"==n)for(i in ge)1!=ge[i]&&(k[i],3==ge[i]?delete b[i]:b[i]=k[i]);"all"!=n&&"formulas"!=n||(b.datavalue=k.datavalue,b.datatype=k.datatype,b.valuetype=k.valuetype,b.formula=k.formula,delete b.parseinfo,b.errors=k.errors),delete b.displaystring,Ne[x]=v}if(Me)for(ce=0;ce<De;ce++)for(de=f.row;de<=g.row;de++){if(v=Me<0?(x=Oe.crToCoord(Le.col+De-ce-1,de),Oe.crToCoord(g.col-ce,de)):(x=Oe.crToCoord(Le.col-De+ce+1,de),Oe.crToCoord(f.col+ce,de)),k=s.GetAssuredCell(x),t&&fe.AddUndo("set "+x+" all",s.CellToString(k)),b=s.GetAssuredCell(v),"all"==n||"formats"==n)for(i in ge)1!=ge[i]&&(k[i],3==ge[i]?delete b[i]:b[i]=k[i]);"all"!=n&&"formulas"!=n||(b.datavalue=k.datavalue,b.datatype=k.datatype,b.valuetype=k.valuetype,b.formula=k.formula,delete b.parseinfo,b.errors=k.errors),delete b.displaystring,Ne[x]=v}for(Le.col+P-1>me.lastcol&&(me.lastcol=Le.col+P-1),Le.row+R-1>me.lastrow&&(me.lastrow=Le.row+R-1),de=f.row;de<f.row+R;de++)for(ce=f.col;ce<f.col+P;ce++)if(v=Oe.crToCoord(ce+T,de+F),!(b=s.GetAssuredCell(v)).readonly)if(t&&fe.AddUndo("set "+v+" all",s.CellToString(b)),Ne[x=Oe.crToCoord(ce,de)]=v,"all"!=n||Re[x]){if((k=Re[x])||(k=s.GetAssuredCell(x)),"all"==n||"formats"==n)for(i in ge)1!=ge[i]&&(k[i],3==ge[i]?delete b[i]:b[i]=k[i]);"all"!=n&&"formulas"!=n||(b.datavalue=k.datavalue,b.datatype=k.datatype,b.valuetype=k.valuetype,b.formula=k.formula,delete b.parseinfo,b.errors=k.errors,k.comment?b.comment=k.comment:b.comment&&delete b.comment),delete b.displaystring}else delete s.cells[v];for(v in s.cells)(b=s.cells[v])&&("f"==b.datatype?(W=b.formula,b.formula=Oe.ReplaceFormulaCoords(W,Ne),b.formula!=W&&(delete b.parseinfo,t&&!Ne[v]&&fe.AddUndo("set "+v+" formula "+W))):delete b.parseinfo);for(ne in s.names)s.names[ne]&&(se="","="==(W=le=s.names[ne].definition).charAt(0)&&(se="=",le=le.substring(1)),s.names[ne].definition=se+Oe.ReplaceFormulaCoords(le,Ne),t&&s.names[ne].definition!=W&&fe.AddUndo("name define "+ne+" "+W));me.needsrecalc="yes";break;case"name":if(l=e.NextToken(),ne=e.NextToken(),n=e.RestOfString(),""==(ne=ne.toUpperCase().replace(/[^A-Z0-9_\.]/g,"")))break;if("define"==l){if(""==n)break;s.names[ne]?(t&&fe.AddUndo("name define "+ne+" "+s.names[ne].definition),s.names[ne].definition=n):(t&&fe.AddUndo("name delete "+ne),s.names[ne]={definition:n,desc:""})}else"desc"==l?s.names[ne]&&(t&&fe.AddUndo("name desc "+ne+" "+s.names[ne].desc),s.names[ne].desc=n):"delete"==l&&(t&&(s.names[ne].desc&&fe.AddUndo("name desc "+ne+" "+s.names[ne].desc),fe.AddUndo("name define "+ne+" "+s.names[ne].definition)),delete s.names[ne]);me.needsrecalc="yes";break;case"recalc":me.needsrecalc="yes",s.recalconce=!0;break;case"redisplay":s.renderneeded=!0;break;case"changedrendervalues":s.changedrendervalues=!0;break;case"pane":if(ne=e.NextToken().toUpperCase(),pe=1,ue=Oe.GetSpreadsheetControlObject().editor,"ROW"===ne.toUpperCase()){for(de=parseInt(e.NextToken(),10),void 0!==ue.context.rowpanes[1]&&"number"==typeof ue.context.rowpanes[1].first&&(pe=ue.context.rowpanes[1].first),t&&fe.AddUndo("pane row "+pe);"yes"==ue.context.sheetobj.rowattribs.hide[de];)de++;(!de||de<=ue.context.rowpanes[0].first)&&1<ue.context.rowpanes.length?ue.context.rowpanes.length=1:(ue.context.rowpanes.length-1&&ue.timeout,ue.context.SetRowPaneFirstLast(0,ue.context.rowpanes[0].first,de-1),ue.context.SetRowPaneFirstLast(1,de,de)),ue.griddiv&&(he=document.getElementById("trackingline-vertical"))&&(ue.griddiv.removeChild(he),ue.FitToEditTable())}else{for(ce=parseInt(e.NextToken(),10),void 0!==ue.context.colpanes[1]&&"number"==typeof ue.context.colpanes[1].first&&(pe=ue.context.colpanes[1].first),t&&fe.AddUndo("pane col "+pe);"yes"==ue.context.sheetobj.colattribs.hide[Oe.rcColname(ce)];)ce++;(!ce||ce<=ue.context.colpanes[0].first)&&1<ue.context.colpanes.length?ue.context.colpanes.length=1:(ue.context.colpanes.length-1&&ue.timeout,ue.context.SetColPaneFirstLast(0,ue.context.colpanes[0].first,ce-1),ue.context.SetColPaneFirstLast(1,ce,ce)),ue.griddiv&&(he=document.getElementById("trackingline-horizon"))&&(ue.griddiv.removeChild(he),ue.FitToEditTable())}s.renderneeded=!0;break;case"startcmdextension":ne=e.NextToken(),(ie=s.sci.CmdExtensionCallbacks[ne])&&ie.func(ne,ie.data,s,e,t);break;case"settimetrigger":case"sendemail":case"submitform":break;default:p=ve.s_escUnknownCmd+r}return Oe._app&&(be?1==s.renderneeded&&"value"!=i&&"text"!=i&&"formula"!=i&&"constant"!=i&&"empty"!=i?s.widgetsClean=!1:"all"==i&&(s.widgetsClean=!1):1==s.renderneeded&&(s.widgetsClean=!1)),p},Oe.SheetUndo=function(e){var t,o=e.changes.TOS(),r="";for(t=o?o.undo.length-1:-1;0<=t;t--)r&&(r+="\n"),r+=o.undo[t];e.changes.Undo(),e.ScheduleSheetCommands(r,!1)},Oe.SheetRedo=function(e){var t,o;if(e.changes.Redo()){t=e.changes.TOS();var r="";for(o=0;t&&o<t.command.length;o++)r&&(r+="\n"),r+=t.command[o];e.ScheduleSheetCommands(r,!1)}else e.ScheduleSheetCommands("",!1)},Oe.CreateAuditString=function(e){var t,o,r="",a=e.changes.stack,n=e.changes.tos;for(t=0;t<=n;t++)for(o=0;o<a[t].command.length;o++)r+=a[t].command[o]+"\n";return r},Oe.GetStyleNum=function(e,t,o){var r;return 0==o.length?0:((r=e[t+"hash"][o])||(e[t+"s"].length<1&&e[t+"s"].push(""),r=e[t+"s"].push(o)-1,e[t+"hash"][o]=r,e.changedrendervalues=!0),r)},Oe.GetStyleString=function(e,t,o){return o?e[t+"s"][o]:null},Oe.OffsetFormulaCoords=function(e,t,o){var r,a,n,l,s,i,c="",d=Oe.Formula;if(!d)return"Need SocialCalc.Formula";var u=d.TokenType,p=u.op,h=u.string,m=u.coord,f=d.TokenOpExpansion;for(r=d.ParseFormulaIntoTokens(e),l=0;l<r.length;l++)n=r[l].type,a=r[l].text,n==m?(i="",s=Oe.coordToCr(a),"$"!=a.charAt(0)?s.col+=t:i+="$",i+=Oe.rcColname(s.col),-1==a.indexOf("$",1)?s.row+=o:i+="$",i+=s.row,(s.row<1||s.col<1)&&(i="#REF!"),c+=i):n==h?0<=a.indexOf('"')?c+='"'+a.replace(/"/,'""')+'"':c+='"'+a+'"':c+=n==p&&f[a]||a;return c},Oe.AdjustFormulaCoords=function(e,t,o,r,a){var n,l,s,i,c="",d=!1,u=Oe.Formula;if(!u)return"Need SocialCalc.Formula";var p=u.TokenType,h=p.op,m=p.string,f=p.coord,g=u.TokenOpExpansion;for(parseinfo=Oe.Formula.ParseFormulaIntoTokens(e),s=0;s<parseinfo.length;s++)n=parseinfo[s].type,l=parseinfo[s].text,n==h&&("!"==l?d=!0:":"!=l&&(d=!1),l=g[l]||l),n==f?(cr=Oe.coordToCr(l),(o<0&&cr.col>=t&&cr.col<t-o||a<0&&cr.row>=r&&cr.row<r-a)&&(d||(cr.col=0,cr.row=0)),d||(cr.col>=t&&(cr.col+=o),cr.row>=r&&(cr.row+=a)),i="$"==l.charAt(0)?"$"+Oe.rcColname(cr.col):Oe.rcColname(cr.col),-1!=l.indexOf("$",1)?i+="$"+cr.row:i+=cr.row,(cr.row<1||cr.col<1)&&(i="#REF!"),l=i):n==m&&(l=0<=l.indexOf('"')?'"'+l.replace(/"/,'""')+'"':'"'+l+'"'),c+=l;return c},Oe.ReplaceFormulaCoords=function(e,t){var o,r,a,n,l,s="",i=!1,c=Oe.Formula;if(!c)return"Need SocialCalc.Formula";var d=c.TokenType,u=d.op,p=d.string,h=d.coord,m=c.TokenOpExpansion;for(parseinfo=Oe.Formula.ParseFormulaIntoTokens(e),a=0;a<parseinfo.length;a++)o=parseinfo[a].type,r=parseinfo[a].text,o==u&&("!"==r?i=!0:":"!=r&&(i=!1),r=m[r]||r),o==h?(cr=Oe.coordToCr(r),t[l=Oe.crToCoord(cr.col,cr.row)]&&!i&&(cr=Oe.coordToCr(t[l]),n="$"==r.charAt(0)?"$"+Oe.rcColname(cr.col):Oe.rcColname(cr.col),-1!=r.indexOf("$",1)?n+="$"+cr.row:n+=cr.row,r=n)):o==p&&(r=0<=r.indexOf('"')?'"'+r.replace(/"/,'""')+'"':'"'+r+'"'),s+=r;return s},Oe.RecalcInfo={sheet:null,currentState:0,state:{idle:0,start_calc:1,order:2,calc:3,start_wait:4,done_wait:5},recalctimer:null,maxtimeslice:100,timeslicedelay:1,starttime:0,queue:[],LoadSheet:function(e){return!1}},Oe.RecalcData=function(){this.inrecalc=!0,this.celllist=[],this.celllistitem=0,this.calclist=null,this.calclistlength=0,this.firstcalc=null,this.lastcalc=null,this.nextcalc=null,this.count=0,this.checkinfo={}},Oe.RecalcCheckInfo=function(){this.oldcoord=null,this.parsepos=0,this.inrange=!1,this.inrangestart=!1,this.cr1=null,this.cr2=null,this.c1=null,this.c2=null,this.r1=null,this.r2=null,this.c=null,this.r=null},Oe.RecalcSheet=function(e){var t=Oe.RecalcInfo;t.currentState==t.state.idle?(delete e.attribs.circularreferencecell,Oe.Formula.FreshnessInfoReset(),Oe.RecalcClearTimeout(),t.sheet=e,t.currentState=t.state.start_calc,t.starttime=new Date,e.statuscallback&&e.statuscallback(t,"calcstart",null,e.statuscallbackparams),Oe.RecalcSetTimeout()):t.queue.push(e)},Oe.RecalcSetTimeout=function(){var e=Oe.RecalcInfo;e.recalctimer=U.setTimeout(Oe.RecalcTimerRoutine,e.timeslicedelay)},Oe.RecalcClearTimeout=function(){var e=Oe.RecalcInfo;e.recalctimer&&(U.clearTimeout(e.recalctimer),e.recalctimer=null)},Oe.RecalcLoadedSheet=function(e,t,o,r){var a,n=Oe.RecalcInfo,l=Oe.Formula;a=Oe.Formula.AddSheetToCache(e||l.SheetCache.waitingForLoading,t,r),o&&a&&"off"!=a.attribs.recalc&&(a.previousrecalcsheet=n.sheet,n.sheet=a,n.currentState=n.state.start_calc),l.SheetCache.waitingForLoading=null,Oe.RecalcSetTimeout()},Oe.RecalcTimerRoutine=function(){var e,t,o,r=new Date,a=0,n=Oe.Formula;if(!n)return"Need SocialCalc.Formula";var l=Oe.RecalcInfo,s=l.sheet;if(s){function i(e,t){s.statuscallback&&s.statuscallback(c,e,t,s.statuscallbackparams)}var c=s.recalcdata||(s.recalcdata={});if(Oe.RecalcClearTimeout(),l.currentState==l.state.start_calc){for(o in c=new Oe.RecalcData,s.recalcdata=c,s.cells)o&&c.celllist.push(o);c.calclist={},l.currentState=l.state.order}if(l.currentState==l.state.order){for(;c.celllistitem<c.celllist.length;)if(o=c.celllist[c.celllistitem++],Oe.RecalcCheckCell(s,o),new Date-r>=l.maxtimeslice)return i("calcorder",{coord:o,total:c.celllist.length,count:c.celllistitem}),void Oe.RecalcSetTimeout();return i("calccheckdone",c.calclistlength),c.nextcalc=c.firstcalc,l.currentState=l.state.calc,void Oe.RecalcSetTimeout()}if(l.currentState!=l.state.start_wait){if(l.currentState==l.state.done_wait)return l.currentState=l.state.calc,void Oe.RecalcSetTimeout();for(l.currentState!=l.state.calc&&alert("Recalc state error: "+l.currentState+". Error in SocialCalc code."),o=s.recalcdata.nextcalc;o;){if((t=s.cells[o]).parseinfo||(t.parseinfo=n.ParseFormulaIntoTokens(t.formula)),t.parseinfo.coord=o,e=n.evaluate_parsed_formula(t.parseinfo,s,!1),n.SheetCache.waitingForLoading){if(1!=l.firstRenderScheduled)Oe.GetSpreadsheetControlObject().editor.ScheduleRender(!1),l.firstRenderScheduled=!0;return c.nextcalc=o,c.count+=a,i("calcloading",{sheetname:n.SheetCache.waitingForLoading}),l.currentState=l.state.start_wait,void Oe.RecalcSetTimeout()}if(n.RemoteFunctionInfo.waitingForServer)return c.nextcalc=o,c.count+=a,i("calcserverfunc",{funcname:n.RemoteFunctionInfo.waitingForServer,coord:o,total:c.calclistlength,count:c.count}),void(l.currentState=l.state.done_wait);if(t.datavalue==e.value&&t.valuetype==e.type||(t.datavalue=e.value,t.valuetype=e.type,delete t.displaystring,s.recalcchangedavalue=!0),e.error&&(t.errors=e.error),a++,o=s.recalcdata.calclist[o],new Date-r>=l.maxtimeslice)return c.nextcalc=o,c.count+=a,i("calcstep",{coord:o,total:c.calclistlength,count:c.count}),void Oe.RecalcSetTimeout()}if(c.inrecalc=!1,s.reRenderCellList=s.recalcdata.celllist,delete s.recalcdata,delete s.attribs.needsrecalc,l.sheet=s.previousrecalcsheet||null,l.sheet)return l.currentState=l.state.calc,void Oe.RecalcSetTimeout();n.FreshnessInfo.recalc_completed=!0,l.currentState=l.state.idle,i("calcfinished",new Date-l.starttime),0<l.queue.length&&(s=l.queue.shift()).RecalcSheet()}else{if(l.currentState=l.state.done_wait,l.LoadSheet&&l.LoadSheet(n.SheetCache.waitingForLoading))return;Oe.RecalcLoadedSheet(null,"",!1)}}},Oe.RecalcCheckCell=function(e,t){var o,r,a,n,l,s,i,c,d,u,p=Oe.Formula;if(!p)return"Need SocialCalc.Formula";var h=p.TokenType,m=h.op,f=h.name,g=h.coord,v=e.recalcdata,b=v.checkinfo,C=!1,y=null,S=t;e:for(;S;)if(d=e.cells[S],u=b[S],!d||"f"!=d.datatype||u&&"object"!=typeof u)b[S=y]&&(y=b[S].oldcoord);else{for(u||(u=new Oe.RecalcCheckInfo,b[S]=u),d.errors&&delete d.errors,d.parseinfo||(d.parseinfo=p.ParseFormulaIntoTokens(d.formula)),o=d.parseinfo,n=u.parsepos;n<o.length;n++){if(u.inrange){if(u.inrangestart&&(u.cr1.col>u.cr2.col?(u.c1=u.cr2.col,u.c2=u.cr1.col):(u.c1=u.cr1.col,u.c2=u.cr2.col),u.c=u.c1-1,u.cr1.row>u.cr2.row?(u.r1=u.cr2.row,u.r2=u.cr1.row):(u.r1=u.cr1.row,u.r2=u.cr2.row),u.r=u.r1,u.inrangestart=!1),u.c+=1,u.c>u.c2){if(u.r+=1,u.r>u.r2){u.inrange=!1;continue}u.c=u.c1}if(l=Oe.crToCoord(u.c,u.r),u.parsepos=n,u.oldcoord=y,y=S,b[S=l]&&"object"==typeof b[S])return d.errors=Oe.Constants.s_caccCircRef+t,b[t]=!0,v.firstcalc?v.calclist[v.lastcalc]=t:v.firstcalc=t,v.lastcalc=t,v.calclistlength++,e.attribs.circularreferencecell=S+"|"+y,d.errors;continue e}if(a=o[n].type,r=o[n].text,a==m&&("!"==r?C=!0:":"!=r&&(C=!1)),a==f)if("range"==(s=p.LookupName(e,r)).type){if(-1!=(i=s.value.indexOf("|"))){u.cr1=Oe.coordToCr(s.value.substring(0,i)),c=s.value.indexOf("|",i+1),u.cr2=Oe.coordToCr(s.value.substring(i+1,c)),u.inrange=!0,u.inrangestart=!0,n-=1;continue}}else"coord"==s.type&&(a=g,r=s.value);if(a==g){if(2<=n&&o[n-1].type==m&&":"==o[n-1].text&&o[n-2].type==g&&!C){u.cr1=Oe.coordToCr(o[n-2].text),u.cr2=Oe.coordToCr(r),u.inrange=!0,u.inrangestart=!0,n-=1;continue}if(!C){if(-1!=r.indexOf("$")&&(r=r.replace(/\$/g,"")),u.parsepos=n+1,u.oldcoord=y,y=S,b[S=r]&&"object"==typeof b[S])return d.errors=Oe.Constants.s_caccCircRef+t,b[t]=!0,v.firstcalc?v.calclist[v.lastcalc]=t:v.firstcalc=t,v.lastcalc=t,v.calclistlength++,e.attribs.circularreferencecell=S+"|"+y,d.errors;continue e}}}C=!1,b[S]=!0,v.firstcalc?v.calclist[v.lastcalc]=S:v.firstcalc=S,v.lastcalc=S,v.calclistlength++,y=b[S=y]?b[S].oldcoord:null}return""},Oe.Parse=function(e){this.str=e,this.pos=0,this.delimiter=" ",this.lineEnd=e.indexOf("\n"),this.lineEnd<0&&(this.lineEnd=e.length)},Oe.Parse.prototype.NextToken=function(){if(this.pos<0)return"";var e=this.str.indexOf(this.delimiter,this.pos),t=this.pos;return e>this.lineEnd&&(e=this.lineEnd),0<=e?(this.pos=e+1,this.str.substring(t,e)):(this.pos=this.lineEnd,this.str.substring(t,this.lineEnd))},Oe.Parse.prototype.RestOfString=function(){var e=this.pos;return this.pos<0||this.pos>=this.lineEnd?"":(this.pos=this.lineEnd,this.str.substring(e,this.lineEnd))},Oe.Parse.prototype.RestOfStringNoMove=function(){return this.pos<0||this.pos>=this.lineEnd?"":this.str.substring(this.pos,this.lineEnd)},Oe.Parse.prototype.NextLine=function(){this.pos=this.lineEnd+1,this.lineEnd=this.str.indexOf("\n",this.pos),this.lineEnd<0&&(this.lineEnd=this.str.length)},Oe.Parse.prototype.EOF=function(){return this.pos<0||this.pos>=this.str.length},Oe.UndoStack=function(){this.stack=[],this.tos=-1,this.maxRedo=0,this.maxUndo=50},Oe.UndoStack.prototype.PushChange=function(e){for(;0<this.stack.length&&this.stack.length-1>this.tos;)this.stack.pop();this.stack.push({command:[],type:e,undo:[]}),this.maxRedo&&this.stack.length>this.maxRedo&&this.stack.shift(),this.maxUndo&&this.stack.length>this.maxUndo&&(this.stack[this.stack.length-this.maxUndo-1].undo=[]),this.tos=this.stack.length-1},Oe.UndoStack.prototype.AddDo=function(){if(this.stack[this.stack.length-1]){for(var e=[],t=0;t<arguments.length;t++)null!=arguments[t]&&e.push(arguments[t]);var o=e.join(" ");this.stack[this.stack.length-1].command.push(o)}},Oe.UndoStack.prototype.AddUndo=function(){if(this.stack[this.stack.length-1]){for(var e=[],t=0;t<arguments.length;t++)null!=arguments[t]&&e.push(arguments[t]);var o=e.join(" ");this.stack[this.stack.length-1].undo.push(o)}},Oe.UndoStack.prototype.TOS=function(){return 0<=this.tos?this.stack[this.tos]:null},Oe.UndoStack.prototype.Undo=function(){return 0<=this.tos&&(!this.maxUndo||this.tos>this.stack.length-this.maxUndo-1)&&(this.tos-=1,!0)},Oe.UndoStack.prototype.Redo=function(){return this.tos<this.stack.length-1&&(this.tos+=1,!0)},Oe.Clipboard={clipboard:""},Oe.RenderContext=function(e){var t=e.attribs,o=Oe.Constants;if(this.sheetobj=e,this.hideRowsCols=!1,this.showGrid=!1,this.showRCHeaders=!1,this.rownamewidth=o.defaultRowNameWidth,this.pixelsPerRow=o.defaultAssumedRowHeight,this.cellskip={},this.coordToCR={},this.colwidth=[],this.rowheight=[],this.totalwidth=0,this.totalheight=0,this.rowpanes=[],this.colpanes=[],this.colunhideleft=[],this.colunhideright=[],this.rowunhidetop=[],this.rowunhidebottom=[],this.maxcol=0,this.maxrow=0,this.highlights={},this.cursorsuffix="",this.highlightTypes={cursor:{style:o.defaultHighlightTypeCursorStyle,className:o.defaultHighlightTypeCursorClass},range:{style:o.defaultHighlightTypeRangeStyle,className:o.defaultHighlightTypeRangeClass},cursorinsertup:{style:"color:#FFF;backgroundColor:#A6A6A6;backgroundRepeat:repeat-x;backgroundPosition:top left;backgroundImage:url("+o.defaultImagePrefix+"cursorinsertup.gif);",className:o.defaultHighlightTypeCursorClass},cursorinsertleft:{style:"color:#FFF;backgroundColor:#A6A6A6;backgroundRepeat:repeat-y;backgroundPosition:top left;backgroundImage:url("+o.defaultImagePrefix+"cursorinsertleft.gif);",className:o.defaultHighlightTypeCursorClass},range2:{style:"color:#000;backgroundColor:#FFF;backgroundImage:url("+o.defaultImagePrefix+"range2.gif);",className:""}},this.cellIDprefix=o.defaultCellIDPrefix,this.defaultlinkstyle=null,this.defaultHTMLlinkstyle={type:"html"},this.defaultfontstyle=o.defaultCellFontStyle,this.defaultfontsize=o.defaultCellFontSize,this.defaultfontfamily=o.defaultCellFontFamily,this.defaultlayout=o.defaultCellLayout,this.defaultpanedividerwidth=o.defaultPaneDividerWidth,this.defaultpanedividerheight=o.defaultPaneDividerHeight,this.gridCSS=o.defaultGridCSS,this.commentClassName=o.defaultCommentClass,this.commentCSS=o.defaultCommentStyle,this.commentNoGridClassName=o.defaultCommentNoGridClass,this.commentNoGridCSS=o.defaultCommentNoGridStyle,this.readonlyClassName=o.defaultReadonlyClass,this.readonlyCSS=o.defaultReadonlyStyle,this.readonlyNoGridClassName=o.defaultReadonlyNoGridClass,this.readonlyNoGridCSS=o.defaultReadonlyNoGridStyle,this.readonlyComment=o.defaultReadonlyComment,this.classnames={colname:o.defaultColnameClass,rowname:o.defaultRownameClass,selectedcolname:o.defaultSelectedColnameClass,selectedrowname:o.defaultSelectedRownameClass,upperleft:o.defaultUpperLeftClass,skippedcell:o.defaultSkippedCellClass,panedivider:o.defaultPaneDividerClass,unhideleft:o.defaultUnhideLeftClass,unhideright:o.defaultUnhideRightClass,unhidetop:o.defaultUnhideTopClass,unhidebottom:o.defaultUnhideBottomClass,colresizebar:o.defaultColResizeBarClass,rowresizebar:o.defaultRowResizeBarClass},this.explicitStyles={colname:o.defaultColnameStyle,rowname:o.defaultRownameStyle,selectedcolname:o.defaultSelectedColnameStyle,selectedrowname:o.defaultSelectedRownameStyle,upperleft:o.defaultUpperLeftStyle,skippedcell:o.defaultSkippedCellStyle,panedivider:o.defaultPaneDividerStyle,unhideleft:o.defaultUnhideLeftStyle,unhideright:o.defaultUnhideRightStyle,unhidetop:o.defaultUnhideTopStyle,unhidebottom:o.defaultUnhideBottomStyle},this.cellskip=null,this.needcellskip=!0,this.fonts=[],this.layouts=[],this.needprecompute=!0,!t)throw o.s_rcMissingSheet;this.rowpanes[0]={first:1,last:t.lastrow},this.colpanes[0]={first:1,last:t.lastcol},this.usermaxcol=t.usermaxcol,this.usermaxrow=t.usermaxrow},Oe.RenderContext.prototype.PrecomputeSheetFontsAndLayouts=function(){Oe.PrecomputeSheetFontsAndLayouts(this)},Oe.RenderContext.prototype.CalculateCellSkipData=function(){Oe.CalculateCellSkipData(this)},Oe.RenderContext.prototype.CalculateColWidthData=function(){Oe.CalculateColWidthData(this)},Oe.RenderContext.prototype.CalculateRowHeightData=function(){Oe.CalculateRowHeightData(this)},Oe.RenderContext.prototype.SetRowPaneFirstLast=function(e,t,o){this.rowpanes[e]={first:t,last:o}},Oe.RenderContext.prototype.SetColPaneFirstLast=function(e,t,o){this.colpanes[e]={first:t,last:o}},Oe.RenderContext.prototype.CoordInPane=function(e,t,o){return Oe.CoordInPane(this,e,t,o)},Oe.RenderContext.prototype.CellInPane=function(e,t,o,r){return Oe.CellInPane(this,e,t,o,r)},Oe.RenderContext.prototype.InitializeTable=function(e){Oe.InitializeTable(this,e)},Oe.RenderContext.prototype.RenderSheet=function(e,t){return Oe.RenderSheet(this,e,t)},Oe.RenderContext.prototype.RenderColGroup=function(){return Oe.RenderColGroup(this)},Oe.RenderContext.prototype.RenderColHeaders=function(){return Oe.RenderColHeaders(this)},Oe.RenderContext.prototype.RenderSizingRow=function(){return Oe.RenderSizingRow(this)},Oe.RenderContext.prototype.RenderRow=function(e,t,o){return Oe.RenderRow(this,e,t,o)},Oe.RenderContext.prototype.RenderSpacingRow=function(){return Oe.RenderSpacingRow(this)},Oe.RenderContext.prototype.RenderCell=function(e,t,o,r,a,n){return Oe.RenderCell(this,e,t,o,r,a,n)},Oe.PrecomputeSheetFontsAndLayouts=function(e){var t,o,r,a,n,l,s=e.sheetobj,i=s.attribs;for(i.defaultfont&&(t=s.fonts[i.defaultfont].replace(/^\*/,Oe.Constants.defaultCellFontStyle).replace(/(.+)\*(.+)/,"$1"+Oe.Constants.defaultCellFontSize+"$2").replace(/\*$/,Oe.Constants.defaultCellFontFamily).match(/^(\S+? \S+?) (\S+?) (\S.*)$/),e.defaultfontstyle=t[1],e.defaultfontsize=t[2],e.defaultfontfamily=t[3]),n=1;n<s.fonts.length;n++)(t=s.fonts[n].replace(/^\*/,e.defaultfontstyle).replace(/(.+)\*(.+)/,"$1"+e.defaultfontsize+"$2").replace(/\*$/,e.defaultfontfamily).match(/^(\S+?) (\S+?) (\S+?) (\S.*)$/))&&(e.fonts[n]={style:t[1],weight:t[2],size:t[3],family:t[4]});for(o=/^padding:\s*(\S+)\s+(\S+)\s+(\S+)\s+(\S+);vertical-align:\s*(\S+);/,r=Oe.Constants.defaultCellLayout.match(o),a=i.defaultlayout?s.layouts[i.defaultlayout].match(o):["","*","*","*","*","*"],n=1;n<s.layouts.length;n++)if(t=s.layouts[n].match(o)){for(l=1;l<=5;l++)"*"==t[l]&&(t[l]="*"!=a[l]?a[l]:r[l]);e.layouts[n]="padding:"+t[1]+" "+t[2]+" "+t[3]+" "+t[4]+";vertical-align:"+t[5]+";"}e.needprecompute=!1},Oe.CalculateCellSkipData=function(e){var t,o,r,a,n,l,s,i,c,d=e.sheetobj;d.rowattribs,d.colattribs;for(e.maxrow=0,e.maxcol=0,e.cellskip={},t=1;t<=d.attribs.lastrow;t++)for(o=1;o<=d.attribs.lastcol;o++)if(r=Oe.crToCoord(o,t),void 0!==(a=d.cells[r])&&!e.cellskip[r]&&(n=a.colspan||1,l=a.rowspan||1,1<n||1<l))for(s=t;s<t+l;s++)for(i=o;i<o+n;i++)(c=Oe.crToCoord(i,s))==r?e.coordToCR[r]={row:t,col:o}:e.cellskip[c]=r,s>e.maxrow&&(maxrow=s),i>e.maxcol&&(maxcol=i);e.needcellskip=!1},Oe.CalculateColWidthData=function(e){var t,o,r,a,n=e.sheetobj;n.colattribs;for(a=e.showRCHeaders?e.rownamewidth-0:0,colpane=0;colpane<e.colpanes.length;colpane++)for(t=e.colpanes[colpane].first;t<=e.colpanes[colpane].last;t++)o=Oe.rcColname(t),"yes"==n.colattribs.hide[o]?e.colwidth[t]=0:("blank"!=(r=n.colattribs.width[o]||n.attribs.defaultcolwidth||Oe.Constants.defaultColWidth)&&"auto"!=r||(r=""),e.colwidth[t]=r+"",a+=r&&0<r-0?r-0:10);e.totalwidth=a},Oe.CalculateRowHeightData=function(e){var t,o,r,a=e.sheetobj;for(r=e.showRCHeaders?e.pixelsPerRow:0,rowpane=0;rowpane<e.rowpanes.length;rowpane++)for(t=e.rowpanes[rowpane].first;t<=e.rowpanes[rowpane].last;t++)"yes"===a.rowattribs.hide[t]?e.rowheight[t]=0:("blank"!==(o=a.rowattribs.height[t]||a.attribs.defaultrowheight||Oe.Constants.defaultAssumedRowHeight)&&"auto"!==o||(o=""),e.rowheight[t]=o+"",r+=o&&0<o-0?o-0:10);e.totalheight=r},Oe.InitializeTable=function(e,t){t.style.borderCollapse="collapse",t.cellSpacing="0",t.cellPadding="0",t.style.width=e.totalwidth+"px"},Oe.RenderSheet=function(e,t,o){var r,a,n,l,s,i;for(e.sheetobj.changedrendervalues&&(e.needcellskip=!0,e.needprecompute=!0,e.sheetobj.changedrendervalues=!1),e.needcellskip&&e.CalculateCellSkipData(),e.needprecompute&&e.PrecomputeSheetFontsAndLayouts(),e.CalculateColWidthData(),e.CalculateRowHeightData(),n=document.createElement("table"),e.InitializeTable(n),l=e.RenderColGroup(),n.appendChild(l),(s=document.createElement("tbody")).appendChild(e.RenderSizingRow()),e.showRCHeaders&&(r=e.RenderColHeaders())&&s.appendChild(r),a=0;a<e.rowpanes.length;a++){for(rownum=e.rowpanes[a].first;rownum<=e.rowpanes[a].last;rownum++)r=e.RenderRow(rownum,a,o),s.appendChild(r);a<e.rowpanes.length-1&&(r=e.RenderSpacingRow(),s.appendChild(r))}return n.appendChild(s),t&&(i=t.parentNode)&&i.replaceChild(n,t),n},Oe.RenderRow=function(e,t,o,r){var a,n,l,s,i=e.sheetobj,c=document.createElement("tr");if(e.showRCHeaders){if(n=document.createElement("td"),e.classnames&&(n.className=e.classnames.rowname),e.explicitStyles&&(n.style.cssText=e.explicitStyles.rowname),n.width=e.rownamewidth,n.height=e.rowheight[t],n.style.verticalAlign="top",n.innerHTML=t+"",t<e.rowpanes[e.rowpanes.length-1].last&&"yes"==i.rowattribs.hide[t+1]){var d=document.createElement("div");d.style.position="relative";var u=document.createElement("div");e.classnames&&(u.className=e.classnames.unhidetop),e.explicitStyles&&(u.style.cssText=e.explicitStyles.unhidetop);var p=e.rowheight[t]-0-Oe.Constants.defaultAssumedRowHeight;p=0===p?4:p,u.style.bottom="-"+p+"px",e.rowunhidetop[t]=u,d.appendChild(u),n.appendChild(d)}if(1<t&&"yes"==i.rowattribs.hide[t-1]){u=document.createElement("div");e.classnames&&(u.className=e.classnames.unhidebottom),e.explicitStyles&&(u.style.cssText=e.explicitStyles.unhidebottom),e.rowunhidebottom[t]=u,n.appendChild(u)}var h=document.createElement("div");h.className=e.classnames.rowresizebar,n.appendChild(h),c.appendChild(n)}for(l=0;l<e.colpanes.length;l++){for(a=e.colpanes[l].first;a<=e.colpanes[l].last;a++)(n=e.RenderCell(t,a,o,l,null,r))&&c.appendChild(n);l<e.colpanes.length-1&&((n=document.createElement("td")).width=e.defaultpanedividerwidth,e.classnames.panedivider&&(n.className=e.classnames.panedivider),e.explicitStyles.panedivider&&(n.style.cssText=e.explicitStyles.panedivider),(s=document.createElement("div")).style.width=e.defaultpanedividerwidth+"px",s.style.overflow="hidden",n.appendChild(s),c.appendChild(n))}return"yes"==i.rowattribs.hide[t]&&(c.style.cssText+=";display:none"),c},Oe.RenderSpacingRow=function(e){e.sheetobj;var t,o,r,a,n=document.createElement("tr");for(e.showRCHeaders&&((o=document.createElement("td")).width=e.rownamewidth,o.height=e.defaultpanedividerheight,e.classnames.panedivider&&(o.className=e.classnames.panedivider),e.explicitStyles.panedivider&&(o.style.cssText=e.explicitStyles.panedivider),n.appendChild(o)),r=0;r<e.colpanes.length;r++){for(t=e.colpanes[r].first;t<=e.colpanes[r].last;t++)o=document.createElement("td"),(a=e.colwidth[t])&&(o.width=a),o.height=e.defaultpanedividerheight,e.classnames.panedivider&&(o.className=e.classnames.panedivider),e.explicitStyles.panedivider&&(o.style.cssText=e.explicitStyles.panedivider),o&&n.appendChild(o);r<e.colpanes.length-1&&((o=document.createElement("td")).width=e.defaultpanedividerwidth,o.height=e.defaultpanedividerheight,e.classnames.panedivider&&(o.className=e.classnames.panedivider),e.explicitStyles.panedivider&&(o.style.cssText=e.explicitStyles.panedivider),n.appendChild(o))}return n},Oe.RenderColHeaders=function(e){var t,o,r=e.sheetobj,a=document.createElement("tr");if(!e.showRCHeaders)return null;for(o=document.createElement("td"),e.classnames&&(o.className=e.classnames.upperleft),e.explicitStyles&&(o.style.cssText=e.explicitStyles.upperleft),o.width=e.rownamewidth,a.appendChild(o),colpane=0;colpane<e.colpanes.length;colpane++){for(t=e.colpanes[colpane].first;t<=e.colpanes[colpane].last;t++){if(o=document.createElement("td"),e.classnames&&(o.className=e.classnames.colname),e.explicitStyles&&(o.style.cssText=e.explicitStyles.colname),"yes"==r.colattribs.hide[Oe.rcColname(t)]&&(o.style.cssText+=";display:none"),o.innerHTML=Oe.rcColname(t),t<e.colpanes[e.colpanes.length-1].last&&"yes"==r.colattribs.hide[Oe.rcColname(t+1)]){var n=document.createElement("div");e.classnames&&(n.className=e.classnames.unhideleft),e.explicitStyles&&(n.style.cssText=e.explicitStyles.unhideleft),e.colunhideleft[t]=n,o.appendChild(n)}1<t&&"yes"==r.colattribs.hide[Oe.rcColname(t-1)]&&(n=document.createElement("div"),e.classnames&&(n.className=e.classnames.unhideright),e.explicitStyles&&(n.style.cssText=e.explicitStyles.unhideright),e.colunhideright[t]=n,o.appendChild(n));var l=document.createElement("span");l.style.height=Oe.Constants.defaultAssumedRowHeight+"px",l.className=e.classnames.colresizebar,o.appendChild(l),a.appendChild(o)}colpane<e.colpanes.length-1&&((o=document.createElement("td")).width=e.defaultpanedividerwidth,e.classnames.panedivider&&(o.className=e.classnames.panedivider),e.explicitStyles.panedivider&&(o.style.cssText=e.explicitStyles.panedivider),a.appendChild(o))}return a},Oe.RenderColGroup=function(e){var t,o,r,a,n=e.sheetobj,l=document.createElement("colgroup");for(e.showRCHeaders&&((r=document.createElement("col")).width=e.rownamewidth,l.appendChild(r)),t=0;t<e.colpanes.length;t++){for(o=e.colpanes[t].first;o<=e.colpanes[t].last;o++)r=document.createElement("col"),"yes"==n.colattribs.hide[Oe.rcColname(o)]?r.width="1":((a=e.colwidth[o])&&(r.width=a),l.appendChild(r));t<e.colpanes.length-1&&((r=document.createElement("col")).width=e.defaultpanedividerwidth,l.appendChild(r))}return l},Oe.RenderSizingRow=function(e){var t,o,r,a,n=e.sheetobj,l=document.createElement("tr");for(e.showRCHeaders&&((r=document.createElement("td")).style.width=e.rownamewidth+"px",r.height="1",l.appendChild(r)),t=0;t<e.colpanes.length;t++){for(o=e.colpanes[t].first;o<=e.colpanes[t].last;o++)r=document.createElement("td"),"yes"==n.colattribs.hide[Oe.rcColname(o)]?r.width="1":(a=e.colwidth[o])&&(r.width=a),r.height="1",l.appendChild(r);t<e.colpanes.length-1&&((r=document.createElement("td")).width=e.defaultpanedividerwidth,r.height="1",l.appendChild(r))}return l},Oe.RenderCell=function(e,t,o,r,a,n,l){var s,i,c,d,u,p,h,m=e.sheetobj,f="";t-=0,o-=0;var g=Oe.crToCoord(o,t);if(e.cellskip[g])return e.CoordInPane(e.cellskip[g],r,a)?null:(c=n?Oe.CreatePseudoElement():document.createElement("td"),e.classnames.skippedcell&&(c.className=e.classnames.skippedcell),e.explicitStyles.skippedcell&&(c.style.cssText=e.explicitStyles.skippedcell),c.innerHTML="&nbsp;",c);if(c=n?Oe.CreatePseudoElement():document.createElement("td"),e.cellIDprefix&&(c.id=e.cellIDprefix+g),(u=m.cells[g])||(u=new Oe.Cell(g)),h=m.attribs,scc=Oe.Constants,1<u.colspan){for(s=d=1;s<u.colspan;s++)"yes"!=m.colattribs.hide[Oe.rcColname(o+s)]&&e.CellInPane(t,o+s,r,a)&&d++;c.colSpan=d}if(1<u.rowspan){for(s=d=1;s<u.rowspan;s++)"yes"!=m.rowattribs.hide[t+s+""]&&e.CellInPane(t+s,o,r,a)&&d++;c.rowSpan=d}return null!=u.displaystring&&0!=m.widgetsClean||(u.displaystring=Oe.FormatValueForDisplay(m,u.datavalue,g,l||e.defaultlinkstyle)),c.innerHTML=u.displaystring,(s=u.layout||h.defaultlayout)&&void 0!==e.layouts[s]?f+=e.layouts[s]:f+=scc.defaultCellLayout,(s=u.font||h.defaultfont)&&void 0!==e.fonts[s]?f+="font-style:"+(i=e.fonts[s]).style+";font-weight:"+i.weight+";font-size:"+i.size+";font-family:"+i.family+";":(scc.defaultCellFontSize&&(f+="font-size:"+scc.defaultCellFontSize+";"),scc.defaultCellFontFamily&&(f+="font-family:"+scc.defaultCellFontFamily+";")),(s=u.color||h.defaultcolor)&&void 0!==m.colors[s]&&(f+="color:"+m.colors[s]+";"),(s=u.bgcolor||h.defaultbgcolor)&&void 0!==m.colors[s]&&(f+="background-color:"+m.colors[s]+";"),(s=u.cellformat)&&void 0!==m.cellformats[s]?f+="text-align:"+m.cellformats[s]+";":"t"==(i=u.valuetype.charAt(0))?(s=h.defaulttextformat)&&void 0!==m.cellformats[s]&&(f+="text-align:"+m.cellformats[s]+";"):"n"==i?(s=h.defaultnontextformat)&&void 0!==m.cellformats[s]?f+="text-align:"+m.cellformats[s]+";":f+="text-align:right;":f+="text-align:left;",(1<u.colspan||1<u.rowspan)&&(p=m.cells[Oe.crToCoord(o+(u.colspan||1)-1,t+(u.rowspan||1)-1)]),(s=u.bt)&&void 0!==m.borderstyles[s]&&(f+="border-top:"+m.borderstyles[s]+";"),(s=void 0!==p?p.br:u.br)&&void 0!==m.borderstyles[s]?f+="border-right:"+m.borderstyles[s]+";":e.showGrid&&(i=e.CellInPane(t,o+(u.colspan||1),r,a)?Oe.crToCoord(o+(u.colspan||1),t):"nomatch",e.cellskip[i]&&(i=e.cellskip[i]),m.cells[i]&&m.cells[i].bl||(f+="border-right:"+e.gridCSS)),(s=void 0!==p?p.bb:u.bb)&&void 0!==m.borderstyles[s]?f+="border-bottom:"+m.borderstyles[s]+";":e.showGrid&&(i=e.CellInPane(t+(u.rowspan||1),o,r,a)?Oe.crToCoord(o,t+(u.rowspan||1)):"nomatch",e.cellskip[i]&&(i=e.cellskip[i]),m.cells[i]&&m.cells[i].bt||(f+="border-bottom:"+e.gridCSS)),(s=u.bl)&&void 0!==m.borderstyles[s]&&(f+="border-left:"+m.borderstyles[s]+";"),u.comment&&(c.title=u.comment,e.showGrid?(e.commentClassName&&(c.className=(c.className?c.className+" ":"")+e.commentClassName),f+=e.commentCSS):(e.commentNoGridClassName&&(c.className=(c.className?c.className+" ":"")+e.commentNoGridClassName),f+=e.commentNoGridCSS)),u.readonly&&(u.comment||(c.title=e.readonlyComment),e.showGrid?(e.readonlyClassName&&(c.className=(c.className?c.className+" ":"")+e.readonlyClassName),f+=e.readonlyCSS):(e.readonlyNoGridClassName&&(c.className=(c.className?c.className+" ":"")+e.readonlyNoGridClassName),f+=e.readonlyNoGridCSS)),c.style.cssText=f,void 0!==u.cssc&&(n?c.className=(c.className?c.className+" ":"")+u.cssc:c.classList.add(u.cssc)),(i=e.highlights[g])&&("cursor"==i&&(i+=e.cursorsuffix),e.highlightTypes[i].className&&(c.className=(c.className?c.className+" ":"")+e.highlightTypes[i].className),Oe.setStyles(c,e.highlightTypes[i].style)),"yes"==m.colattribs.hide[Oe.rcColname(o)]&&(c.style.cssText+=";display:none"),"yes"==m.rowattribs.hide[t]&&(c.style.cssText+=";display:none"),c},Oe.CoordInPane=function(e,t,o,r){var a=e.coordToCR[t];if(!a||!a.row||!a.col)throw"Bad coordToCR for "+t;return e.CellInPane(a.row,a.col,o,r)},Oe.CellInPane=function(e,t,o,r,a){var n=e.rowpanes[r],l=e.colpanes[a];if(!n||!l)throw"CellInPane called with unknown panes "+r+"/"+a;return!(t<n.first||t>n.last)&&!(o<l.first||o>l.last)},Oe.CreatePseudoElement=function(){return{style:{cssText:""},innerHTML:"",className:""}},Oe.rcColname=function(e){702<e&&(e=702),e<1&&(e=1);var t=(e-1)%26+65,o=Math.floor((e-1)/26);return o?String.fromCharCode(o+64)+String.fromCharCode(t):String.fromCharCode(t)},Oe.letters=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],Oe.crToCoord=function(e,t){e<1&&(e=1),702<e&&(e=702),t<1&&(t=1);var o=(e-1)%26,r=Math.floor((e-1)/26);return r?Oe.letters[r-1]+Oe.letters[o]+t:Oe.letters[o]+t},Oe.coordToCol={},Oe.coordToRow={},Oe.coordToCr=function(e){var t,o,r,a=Oe.coordToRow[e];if(a)return{row:a,col:Oe.coordToCol[e]};for(o=a=t=0;o<e.length;o++)36==(r=e.charCodeAt(o))||(r<=57?a=10*a+r-48:97<=r?t=26*t+r-96:65<=r&&(t=26*t+r-64));return Oe.coordToCol[e]=t,{row:Oe.coordToRow[e]=a,col:t}},Oe.ParseRange=function(e){var t,o,r,a;return e||(e="A1:A1"),0<=(t=(e=e.toUpperCase()).indexOf(":"))?(o=e.substring(0,t),(r=Oe.coordToCr(o)).coord=o,o=e.substring(t+1),(a=Oe.coordToCr(o)).coord=o):((r=Oe.coordToCr(e)).coord=e,(a=Oe.coordToCr(e)).coord=e),{cr1:r,cr2:a}},Oe.decodeFromSave=function(e){if("string"!=typeof e)return e;if(-1==e.indexOf("\\"))return e;var t=e.replace(/\\c/g,":");return(t=t.replace(/\\n/g,"\n")).replace(/\\b/g,"\\")},Oe.decodeFromAjax=function(e){if("string"!=typeof e)return e;if(-1==e.indexOf("\\"))return e;var t=e.replace(/\\c/g,":");return(t=(t=t.replace(/\\n/g,"\n")).replace(/\\e/g,"]]")).replace(/\\b/g,"\\")},Oe.encodeForSave=function(e){return"string"!=typeof e||(-1!=e.indexOf("\\")&&(e=e.replace(/\\/g,"\\b")),-1!=e.indexOf(":")&&(e=e.replace(/:/g,"\\c")),-1!=e.indexOf("\n")&&(e=e.replace(/\n/g,"\\n"))),e},Oe.special_chars=function(e){return/[&<>"]/.test(e)&&(e=(e=(e=(e=e.replace(/&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/"/g,"&quot;")),e},Oe.Lookup=function(e,t){for(i=0;i<t.length;i++)if(t[i]>e)return 0<i?i-1:null;return t.length-1},Oe.setStyles=function(e,t){var o,r,a,n,l;if(t)for(o=t.split(";"),r=0;r<o.length;r++)-1!=(a=o[r].indexOf(":"))&&(n=o[r].substring(0,a),l=o[r].substring(a+1),n&&l&&(e.style[n]=l))},Oe.GetViewportInfo=function(){var e={};return U.innerWidth?(e.width=U.innerWidth,e.height=U.innerHeight,e.horizontalScroll=U.pageXOffset,e.verticalScroll=U.pageYOffset):document.documentElement&&document.documentElement.clientWidth?(e.width=document.documentElement.clientWidth,e.height=document.documentElement.clientHeight,e.horizontalScroll=document.documentElement.scrollLeft,e.verticalScroll=document.documentElement.scrollTop):document.body.clientWidth&&(e.width=document.body.clientWidth,e.height=document.body.clientHeight,e.horizontalScroll=document.body.scrollLeft,e.verticalScroll=document.body.scrollTop),e},Oe.GetElementPosition=function(e){for(var t=0,o=0;e&&"relative"!=Oe.GetComputedStyle(e,"position");)t+=e.offsetLeft,o+=e.offsetTop,e=e.offsetParent;return{left:t,top:o}},Oe.GetElementPositionWithScroll=function(e){var t=e.getBoundingClientRect();return{left:t.left,right:t.right,top:t.top,bottom:t.bottom,width:t.width?t.width:t.right-t.left,height:t.height?t.height:t.bottom-t.top}},Oe.GetElementFixedParent=function(e){for(;e&&"HTML"!=e.tagName;){if("fixed"==Oe.GetComputedStyle(e,"position"))return e;e=e.parentNode}return!1},Oe.GetComputedStyle=function(e,t){return(void 0!==e.currentStyle?e.currentStyle:document.defaultView.getComputedStyle(e,null))[t]},Oe.LookupElement=function(e,t){var o;for(o=0;o<t.length;o++)if(t[o].element==e)return t[o];return null},Oe.AssignID=function(e,t,o){e.idPrefix&&(t.id=e.idPrefix+o)},Oe.GetCellContents=function(e,t){var o="",r=e.cells[t];if(r)switch(r.datatype){case"v":o=r.datavalue+"";break;case"t":o="'"+r.datavalue;break;case"f":o="="+r.formula;break;case"c":o=r.formula}return o},Oe.FormatValueForDisplay=function(e,t,o,r){var a,n,l,s,i=e.attribs,c=(Oe.Constants,e.cells[o]);c||(c=new Oe.Cell(o)),s=t,l=(n=c.valuetype||"").substring(1),valueinputwidget=n.charAt(1);var d=n.substring(2),u=null,p=null;if(n=n.charAt(0),c.errors||"e"==n)return s=c.errors||l||"Error in cell";if("t"==n){if("formula"==(a=e.valueformats[c.textvalueformat-0]||e.valueformats[i.defaulttextvalueformat-0]||""))return s="f"==c.datatype?Oe.special_chars("="+c.formula)||"&nbsp;":"c"==c.datatype?Oe.special_chars("'"+c.formula)||"&nbsp;":Oe.special_chars("'"+s)||"&nbsp;";u=s,p=s=Oe.format_text_for_display(s,c.valuetype,a,e,r,c.nontextvalueformat)}else if("n"==n){if(null!=(a=c.nontextvalueformat)&&""!=a||(a=i.defaultnontextvalueformat),null!=(a=e.valueformats[a-0])&&"none"!=a||(a=""),"formula"==a)return s="f"==c.datatype?Oe.special_chars("="+c.formula)||"&nbsp;":"c"==c.datatype?Oe.special_chars("'"+c.formula)||"&nbsp;":Oe.special_chars("'"+s)||"&nbsp;";if("forcetext"==a)return s="f"==c.datatype?Oe.special_chars("="+c.formula)||"&nbsp;":"c"==c.datatype?Oe.special_chars(c.formula)||"&nbsp;":Oe.special_chars(s)||"&nbsp;";u=s,p=s=Oe.format_number_for_display(s,c.valuetype,a)}else s="&nbsp;";if("i"!=valueinputwidget||null==u||null==p)return s;var h=e.ioParameterList[o],m=Oe.Formula.FunctionList[d];if(m){var f,g=m[5],v=0==u?"":"checked";if(g=(g=(g=g.replace(/<%=checked%>/g,v)).replace(/<%=formated_value%>/g,p)).replace(/<%=display_value%>/g,u),h){for(var b=0;b<h.length;b++){f="coord"==h[b].type?e.GetAssuredCell(h[b].value).datavalue:h[b].value;var C=new RegExp("<%=parameter"+b+"_value%>","g");g=g.replace(C,f)}if(h.html)for(var y=0;y<h.html.length;y++){C=new RegExp("<%=html"+y+"_value%>","g");g=g.replace(C,h.html[y])}h.css&&(g=g.replace(/^(<\w+)(\W)/,"$1 style='"+h.css+"'$2"))}return g.replace(/<%=cell_reference%>/g,o)}return"error:Widget HTML missing"},Oe.format_text_for_display=function(e,t,o,r,a,n){var l,s,i,c,d;return l=t.substring(1),d=e,"none"!=o&&null!=o||(o=""),/^(text-|custom|hidden)/.test(o)||(o=""),""!=o&&"General"!=o||("h"==l&&(o="text-html"),"w"!=l&&"r"!=l||(o="text-wiki"),"l"==l&&(o="text-link"),l||(o="text-plain")),"text-html"==o||(Oe.Callbacks.expand_wiki&&/^text-wiki/.test(o)?d=Oe.Callbacks.expand_wiki(d,r,a,o):"text-wiki"==o?d=Oe.Callbacks.expand_markup&&Oe.Callbacks.expand_markup(d,r,a)||Oe.special_chars("wiki-text:"+d):"text-url"==o?(s=Oe.special_chars(d),d='<a href="'+(i=encodeURI(d))+'">'+s+"</a>"):"text-link"==o?d=Oe.expand_text_link(d,r,a,o):"text-image"==o?d='<img src="'+(i=encodeURI(d))+'">':"text-custom:"==o.substring(0,12)?(s=(s=(s=Oe.special_chars(d)).replace(/  /g,"&nbsp; ")).replace(/\n/g,"<br>"),i=encodeURI(d),(c={}).r=d,c.s=s,c.u=i,d=(d=o.substring(12)).replace(/@(r|s|u)/g,function(e,t){return c[t]})):"custom"==o.substring(0,6)?(d=(d=(d=Oe.special_chars(d)).replace(/  /g,"&nbsp; ")).replace(/\n/g,"<br>"),d+=" (custom format)"):d="hidden"==o?"&nbsp;":null!=n&&""!=n&&"none"!=r.valueformats[n-0]&&""!=r.valueformats[n-0]?(o=r.valueformats[n],Oe.format_number_for_display(e,t,o)):(d=(d=Oe.special_chars(d)).replace(/  /g,"&nbsp; ")).replace(/\n/g,"<br>")),d},Oe.format_number_for_display=function(e,t,o){var r,a,n=Oe.Constants;return r=e-0,a=t.substring(1),"Auto"!=o&&""!=o||(o="%"==a?n.defaultFormatp:"$"==a?n.defaultFormatc:"dt"==a?n.defaultFormatdt:"d"==a?n.defaultFormatd:"t"==a?n.defaultFormatt:"l"==a?"logical":"General"),"logical"==o?r?n.defaultDisplayTRUE:n.defaultDisplayFALSE:"hidden"==o?"&nbsp;":Oe.FormatNumber.formatNumberWithFormat(e,o,"")},Oe.DetermineValueType=function(e){var t,o,r,a,n,l,s,i,c,d,u=e+"",p="t";return t=(t=u.replace(/^\s+/,"")).replace(/\s+$/,""),0==u.length?p="":u.match(/^\s+$/)||(t.match(/^[-+]?\d*(?:\.)?\d*(?:[eE][-+]?\d+)?$/)?(u=t-0,isNaN(u)?u=e+"":p="n"):t.match(/^[-+]?\d*(?:\.)?\d*\s*%$/)?(u=(t.slice(0,-1)-0)/100,p="n%"):t.match(/^[-+]?\$\s*\d*(?:\.)?\d*\s*$/)&&t.match(/\d/)?(u=t.replace(/\$/,"")-0,p="n$"):t.match(/^[-+]?(\d*,\d*)+(?:\.)?\d*$/)?(u=t.replace(/,/g,"")-0,p="n"):t.match(/^[-+]?(\d*,\d*)+(?:\.)?\d*\s*%$/)?(u=(t.replace(/[%,]/g,"")-0)/100,p="n%"):t.match(/^[-+]?\$\s*(\d*,\d*)+(?:\.)?\d*$/)&&t.match(/\d/)?(u=t.replace(/[\$,]/g,"")-0,p="n$"):(o=u.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{1,4})\s*$/))?(r=(r=o[3]-0)<1e3?r+2e3:r,u=0===navigator.language.indexOf("fr")?Oe.FormatNumber.convert_date_gregorian_to_julian(r,o[2]-0,o[1]-0)-2415019:Oe.FormatNumber.convert_date_gregorian_to_julian(r,o[1]-0,o[2]-0)-2415019,p="nd"):(o=u.match(/^(\d{4})[\/\-](\d{1,2})[\/\-](\d{1,2})\s*$/))?(r=(r=o[1]-0)<1e3?r+2e3:r,u=Oe.FormatNumber.convert_date_gregorian_to_julian(r,o[2]-0,o[3]-0)-2415019,p="nd"):(o=u.match(/^(\d{4})[\/\-](\d{1,2})[\/\-](\d{1,2}) (\d{1,2}):(\d{1,2})\s*$/))?(r=(r=o[1]-0)<1e3?r+2e3:r,a=o[4]-0,n=o[5]-0,u=Oe.FormatNumber.convert_date_gregorian_to_julian(r,o[2]-0,o[3]-0)-2415019,p="nd",a<24&&n<60&&(u+=a/24+n/1440,p="ndt")):(o=u.match(/^(\d{4})[\/\-](\d{1,2})[\/\-](\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})\s*$/))?(r=(r=o[1]-0)<1e3?r+2e3:r,a=o[4]-0,n=o[5]-0,l=o[6]-0,u=Oe.FormatNumber.convert_date_gregorian_to_julian(r,o[2]-0,o[3]-0)-2415019,p="nd",a<24&&n<60&&l<60&&(u+=a/24+n/1440+l/86400,p="ndt")):(o=u.match(/^(\d{1,2}):(\d{1,2})\s*$/))?(a=o[1]-0,n=o[2]-0,a<24&&n<60&&(u=a/24+n/1440,p="nt")):(o=u.match(/^(\d{1,2}):(\d{1,2}):(\d{1,2})\s*$/))?(a=o[1]-0,n=o[2]-0,l=o[3]-0,a<24&&n<60&&l<60&&(u=a/24+n/1440+l/86400,p="nt")):(o=u.match(/^\s*([-+]?\d+) (\d+)\/(\d+)\s*$/))?(c=o[1]-0,i=o[2]-0,(s=o[3]-0)&&0<s&&(u=c+(c<0?-i/s:i/s),p="n")):(d=Oe.InputConstants[u.toUpperCase()])?(i=d.indexOf(","),u=d.substring(0,i)-0,p=d.substring(i+1)):7<t.length&&"http://"==t.substring(0,7).toLowerCase()?(u=t,p="tl"):t.match(/<([A-Z][A-Z0-9]*)\b[^>]*>[\s\S]*?<\/\1>/i)&&(u=t,p="th")),{value:u,type:p}},Oe.InputConstants={TRUE:"1,nl",FALSE:"0,nl","#N/A":"0,e#N/A","#NULL!":"0,e#NULL!","#NUM!":"0,e#NUM!","#DIV/0!":"0,e#DIV/0!","#VALUE!":"0,e#VALUE!","#REF!":"0,e#REF!","#NAME?":"0,e#NAME?"},Oe.default_expand_markup=function(e,t,o){var r=e;return r=(r=(r=Oe.special_chars(r)).replace(/  /g,"&nbsp; ")).replace(/\n/g,"<br>")},Oe.expand_text_link=function(e,t,o,r){var a,n,l=Oe.Constants,s="",i=Oe.ParseCellLinkText(e+"");return a=i.desc?Oe.special_chars(i.desc):i.pagename?l.defaultPageLinkFormatString:l.defaultLinkFormatString,7<e.length&&"http://"==e.substring(0,7).toLowerCase()&&">"!=e.charAt(e.length-1)&&(a=a.substring(7)),n=i.newwin||!o?' target="_blank"':"",i.pagename?Oe.Callbacks.MakePageLink&&(s=Oe.Callbacks.MakePageLink(i.pagename,i.workspacename,o,r)):s=encodeURI(i.url),'<a href="'+s+'"'+n+">"+a+"</a>"},Oe.ParseCellLinkText=function(e){var t={url:"",desc:"",newwin:!1,pagename:"",workspace:""},o=!1,r=e.length-1,a=0,n=e.lastIndexOf("<"),l=e.lastIndexOf("["),s=e.lastIndexOf("{"),i=-1;return">"==e.charAt(r)&&-1!=n||"]"==e.charAt(r)&&-1!=l||!("}"!=e.charAt(r)||"]"!=e.charAt(r-1)||-1==s||-1==l||l<s)?(">"==e.charAt(r)?(i=n-1,0<n&&"<"==e.charAt(i)&&">"==e.charAt(r-1)&&(i--,r--,t.newwin=!0)):"]"==e.charAt(r)?(i=l-1,o=!0,0<l&&"["==e.charAt(i)&&"]"==e.charAt(r-1)&&(i--,r--,t.newwin=!0)):"}"==e.charAt(r)&&(i=s-1,o=!0,r--,0<(wsend=l)&&"["==e.charAt(l-1)&&"]"==e.charAt(r-1)&&(wsend=l-1,r--,t.newwin=!0)," "==e.charAt(wsend-1)&&wsend--,t.workspace=e.substring(s+1,wsend)||"")," "==e.charAt(i)&&i--,'"'==e.charAt(a)&&'"'==e.charAt(i)&&(a++,i--)):i=++r,o?t.pagename=e.substring(l+1,r)||"":t.url=e.substring(n+1,r)||"",a<=i&&(t.desc=e.substring(a,i+1)),t},Oe.ConvertSaveToOtherFormat=function(e,t,o){var r,a,n,l,s,i,c,d,u,p,h="";if("scsave"==t)return e;if(""==e)return"";if((r=new Oe.Sheet).ParseSheetSave(e),o)throw"SocialCalc.ConvertSaveToOtherFormat: Not doing recalc.";if(n=r.copiedfrom?Oe.ParseRange(r.copiedfrom):{cr1:{row:1,col:1},cr2:{row:r.attribs.lastrow,col:r.attribs.lastcol}},"html"==t)return a=new Oe.RenderContext(r),r.copiedfrom&&(a.rowpanes[0]={first:n.cr1.row,last:n.cr2.row},a.colpanes[0]={first:n.cr1.col,last:n.cr2.col}),l=document.createElement("div"),s=a.RenderSheet(null,a.defaultHTMLlinkstyle),l.appendChild(s),delete a,delete r,h=l.innerHTML,delete s,delete l,h;for(i=n.cr1.row;i<=n.cr2.row;i++){for(c=n.cr1.col;c<=n.cr2.col;c++)d=Oe.crToCoord(c,i),p=(u=r.GetAssuredCell(d)).errors?u.errors:u.datavalue+"","csv"==t?(-1!=p.indexOf('"')&&(p=p.replace(/"/g,'""')),/[, \n"]/.test(p)&&(p='"'+p+'"'),c>n.cr1.col&&(p=","+p)):"tab"==t&&(-1!=p.indexOf("\n")&&(-1!=p.indexOf('"')&&(p=p.replace(/"/g,'""')),p='"'+p+'"'),c>n.cr1.col&&(p="\t"+p)),h+=p;h+="\n"}return h},Oe.ConvertOtherFormatToSave=function(e,t){function o(){m<++p&&(m=p),h=Oe.crToCoord(p,u),Oe.SetConvertedCell(r,h,s),s=""}var r,a,n,l,s,i,c,d,u,p,h,m,f="";if("scsave"==t)return e;if(r=new Oe.Sheet,a=e.split(/\r\n|\n/),m=0,"csv"==t){for(i=!1,n=u=0;n<a.length&&(n!=a.length-1||""!=a[n]);n++)for(i?s+="\n":(s="",u++,p=0),l=a[n],c=0;c<l.length;c++)'"'!=(d=l.charAt(c))?(","!=d||i?s+=d:o(),c!=l.length-1||i||o()):i?c<l.length-1&&'"'==l.charAt(c+1)?(c++,s+='"'):(i=!1,c==l.length-1&&o()):i=!0;0<m&&(r.attribs.lastrow=u,r.attribs.lastcol=m,f=r.CreateSheetSave("A1:"+Oe.crToCoord(m,u)))}if("tab"==t){for(i=!1,n=u=0;n<a.length&&(n!=a.length-1||""!=a[n]);n++)for(i?s+="\n":(s="",u++,p=0),l=a[n],c=0;c<l.length;c++){if('"'==(d=l.charAt(c))){if(i){c<l.length-1?'"'==l.charAt(c+1)?(c++,s+='"'):"\t"==l.charAt(c+1)&&(c++,i=!1,o()):(i=!1,o());continue}if(""==s){i=!0;continue}}"\t"!=d||i?s+=d:o(),c!=l.length-1||i||o()}0<m&&(r.attribs.lastrow=u,r.attribs.lastcol=m,f=r.CreateSheetSave("A1:"+Oe.crToCoord(m,u)))}return f},Oe.SetConvertedCell=function(e,t,o){var r,a;r=e.GetAssuredCell(t),"n"==(a=Oe.DetermineValueType(o)).type&&a.value==o?(r.datatype="v",r.valuetype="n",r.datavalue=a.value):"t"==a.type.charAt(0)?(r.datatype="t",r.valuetype=a.type,r.datavalue=a.value):(r.datatype="c",r.valuetype=a.type,r.datavalue=a.value,r.formula=o)},Oe||(Oe={}),Oe.TableEditor=function(e){var t=Oe.Constants;this.context=e,this.toplevel=null,this.fullgrid=null,this.noEdit=!1,this.width=null,this.tablewidth=null,this.height=null,this.tableheight=null,this.inputBox=null,this.inputEcho=null,this.verticaltablecontrol=null,this.horizontaltablecontrol=null,this.logo=null,this.cellhandles=null,this.timeout=null,this.busy=!1,this.ensureecell=!1,this.deferredCommands=[],this.deferredEmailCommands=[],this.gridposition=null,this.headposition=null,this.firstscrollingrow=null,this.firstscrollingrowtop=null,this.lastnonscrollingrow=null,this.lastvisiblerow=null,this.firstscrollingcol=null,this.firstscrollingcolleft=null,this.lastnonscrollingcol=null,this.lastvisiblecol=null,this.rowpositions=[],this.colpositions=[],this.rowheight=[],this.colwidth=[],this.ecell=null,this.state="start",this.workingvalues={},this.imageprefix=t.defaultImagePrefix,this.idPrefix=t.defaultTableEditorIDPrefix,this.pageUpDnAmount=t.defaultPageUpDnAmount,this.recalcFunction=function(e){if(!e.context.sheetobj.RecalcSheet)return null;e.context.sheetobj.RecalcSheet(Oe.EditorSheetStatusCallback,e)},this.ctrlkeyFunction=function(s,e){var t,o,r,a,n,l;switch(e){case"[ctrl-a]":return s.MoveECell("A1"),s.RangeAnchor("A1"),s.RangeExtend(Oe.crToCoord(s.context.sheetobj.attribs.lastcol,s.context.sheetobj.attribs.lastrow)),!1;case"[ctrl-c]":case"[ctrl-x]":return(t=s.pasteTextarea).value="",(o=Oe.GetEditorCellElement(s,s.ecell.row,s.ecell.col))&&(r=Oe.GetElementPosition(o.element),t.style.left=r.left-1+"px",t.style.top=r.top-1+"px"),n=s.range.hasrange?Oe.crToCoord(s.range.left,s.range.top)+":"+Oe.crToCoord(s.range.right,s.range.bottom):s.ecell.coord,l=Oe.ConvertSaveToOtherFormat(Oe.CreateSheetSave(s.context.sheetobj,n),"tab"),a="[ctrl-c]"==e||s.noEdit||s.ECellReadonly()?"copy "+n+" formulas":"cut "+n+" formulas",s.EditorScheduleSheetCommands(a,!0,!1),t.style.display="block",t.value=l,t.focus(),t.select(),U.setTimeout(function(){var e=s.pasteTextarea;e.blur(),e.style.display="none",Oe.KeyboardFocus()},200),!0;case"[ctrl-v]":return s.noEdit||s.ECellReadonly()||((t=s.pasteTextarea).value="",(o=Oe.GetEditorCellElement(s,s.ecell.row,s.ecell.col))&&(r=Oe.GetElementPosition(o.element),t.style.left=r.left-1+"px",t.style.top=r.top-1+"px"),t.style.display="block",t.value="",t.focus(),U.setTimeout(function(){var e=s.pasteTextarea,t=e.value;e.blur(),e.style.display="none";var o,r="";if(s.pastescclipboard)s.pastescclipboard=!1;else{var a=Oe.ConvertSaveToOtherFormat(Oe.Clipboard.clipboard,"tab");(t=t.replace(/\r\n/g,"\n"))==a||t.length-a.length==1&&t.substring(0,t.length-1)==a||(r="loadclipboard "+Oe.encodeForSave(Oe.ConvertOtherFormatToSave(t,"tab"))+"\n")}if(s.range.hasrange){var n=new Oe.Sheet;n.ParseSheetSave(Oe.Clipboard.clipboard);var l=n.copiedfrom.match(/(.+):(.+)/);o=null!==l&&l[1]===l[2]?Oe.crToCoord(s.range.left,s.range.top)+":"+Oe.crToCoord(s.range.right,s.range.bottom):Oe.crToCoord(s.range.left,s.range.top)}else o=s.ecell.coord;r+="paste "+o+" formulas",s.EditorScheduleSheetCommands(r,!0,!1),Oe.KeyboardFocus()},200)),!0;case"[ctrl-z]":return s.EditorScheduleSheetCommands("undo",!0,!1),!1;case"[ctrl-s]":if(!Oe.Constants.AllowCtrlS)break;return U.setTimeout(function(){var e=s.context.sheetobj,t=e.GetAssuredCell(s.ecell.coord),o=t.nontextvalueformat&&e.valueformats[t.nontextvalueformat-0]||"",r=U.prompt("Advanced Feature:\n\nCustom Numeric Format or Command",o);if(null!=r){if(r.match(/^cmd:/))a=r.substring(4);else{if(r.match(/^edit:/))return a=r.substring(5),void(Oe.CtrlSEditor&&Oe.CtrlSEditor(a));n=s.range.hasrange?Oe.crToCoord(s.range.left,s.range.top)+":"+Oe.crToCoord(s.range.right,s.range.bottom):s.ecell.coord,a="set "+n+" nontextvalueformat "+r}s.EditorScheduleSheetCommands(a,!0,!1)}},200),!1}return!0},e.sheetobj.statuscallback=Oe.EditorSheetStatusCallback,(e.sheetobj.statuscallbackparams=this).StatusCallback={},this.MoveECellCallback={},this.RangeChangeCallback={},this.SettingsCallbacks={},this.ecell={coord:"A1",row:1,col:1},e.highlights[this.ecell.coord]="cursor",this.range={hasrange:!1},this.range2={hasrange:!1}},Oe.TableEditor.prototype.CreateTableEditor=function(e,t){return Oe.CreateTableEditor(this,e,t)},Oe.TableEditor.prototype.ResizeTableEditor=function(e,t){return Oe.ResizeTableEditor(this,e,t)},Oe.TableEditor.prototype.SaveEditorSettings=function(){return Oe.SaveEditorSettings(this)},Oe.TableEditor.prototype.LoadEditorSettings=function(e,t){return Oe.LoadEditorSettings(this,e,t)},Oe.TableEditor.prototype.EditorRenderSheet=function(){Oe.EditorRenderSheet(this)},Oe.TableEditor.prototype.EditorScheduleSheetCommands=function(e,t,o){Oe.EditorScheduleSheetCommands(this,e,t,o)},Oe.TableEditor.prototype.ScheduleSheetCommands=function(e,t){this.context.sheetobj.ScheduleSheetCommands(e,t)},Oe.TableEditor.prototype.SheetUndo=function(){this.context.sheetobj.SheetUndo()},Oe.TableEditor.prototype.SheetRedo=function(){this.context.sheetobj.SheetRedo()},Oe.TableEditor.prototype.EditorStepSet=function(e,t){Oe.EditorStepSet(this,e,t)},Oe.TableEditor.prototype.GetStatuslineString=function(e,t,o){return Oe.EditorGetStatuslineString(this,e,t,o)},Oe.TableEditor.prototype.EditorMouseRegister=function(){return Oe.EditorMouseRegister(this)},Oe.TableEditor.prototype.EditorMouseUnregister=function(){return Oe.EditorMouseUnregister(this)},Oe.TableEditor.prototype.EditorMouseRange=function(e){return Oe.EditorMouseRange(this,e)},Oe.TableEditor.prototype.EditorProcessKey=function(e,t){return Oe.EditorProcessKey(this,e,t)},Oe.TableEditor.prototype.EditorAddToInput=function(e,t){return Oe.EditorAddToInput(this,e,t)},Oe.TableEditor.prototype.DisplayCellContents=function(){return Oe.EditorDisplayCellContents(this)},Oe.TableEditor.prototype.EditorSaveEdit=function(e){return Oe.EditorSaveEdit(this,e)},Oe.TableEditor.prototype.EditorApplySetCommandsToRange=function(e,t){return Oe.EditorApplySetCommandsToRange(this,e,t)},Oe.TableEditor.prototype.MoveECellWithKey=function(e){return Oe.MoveECellWithKey(this,e)},Oe.TableEditor.prototype.MoveECell=function(e){return Oe._app?"A1":Oe.MoveECell(this,e)},Oe.TableEditor.prototype.ReplaceCell=function(e,t,o){Oe.ReplaceCell(this,e,t,o)},Oe.TableEditor.prototype.UpdateCellCSS=function(e,t,o){Oe.UpdateCellCSS(this,e,t,o)},Oe.TableEditor.prototype.SetECellHeaders=function(e){Oe.SetECellHeaders(this,e)},Oe.TableEditor.prototype.EnsureECellVisible=function(){Oe.EnsureECellVisible(this)},Oe.TableEditor.prototype.ECellReadonly=function(e){return Oe.ECellReadonly(this,e)},Oe.TableEditor.prototype.RangeAnchor=function(e){Oe.RangeAnchor(this,e)},Oe.TableEditor.prototype.RangeExtend=function(e){Oe.RangeExtend(this,e)},Oe.TableEditor.prototype.RangeRemove=function(){Oe.RangeRemove(this)},Oe.TableEditor.prototype.Range2Remove=function(){Oe.Range2Remove(this)},Oe.TableEditor.prototype.FitToEditTable=function(){Oe.FitToEditTable(this)},Oe.TableEditor.prototype.CalculateEditorPositions=function(){Oe.CalculateEditorPositions(this)},Oe.TableEditor.prototype.ScheduleRender=function(){this.ScheduleRender(!0)},Oe.TableEditor.prototype.ScheduleRender=function(e){Oe._app&&1==e&&(this.context.sheetobj.widgetsClean=!1),Oe.ScheduleRender(this)},Oe.TableEditor.prototype.DoRenderStep=function(){Oe.DoRenderStep(this)},Oe.TableEditor.prototype.SchedulePositionCalculations=function(){Oe.SchedulePositionCalculations(this)},Oe.TableEditor.prototype.DoPositionCalculations=function(){Oe.DoPositionCalculations(this)},Oe.TableEditor.prototype.CalculateRowPositions=function(e,t,o){return Oe.CalculateRowPositions(this,e,t,o)},Oe.TableEditor.prototype.CalculateColPositions=function(e,t,o){return Oe.CalculateColPositions(this,e,t,o)},Oe.TableEditor.prototype.ScrollRelative=function(e,t){Oe.ScrollRelative(this,e,t)},Oe.TableEditor.prototype.ScrollRelativeBoth=function(e,t){Oe.ScrollRelativeBoth(this,e,t)},Oe.TableEditor.prototype.PageRelative=function(e,t){Oe.PageRelative(this,e,t)},Oe.TableEditor.prototype.LimitLastPanes=function(){Oe.LimitLastPanes(this)},Oe.TableEditor.prototype.ScrollTableUpOneRow=function(){return Oe.ScrollTableUpOneRow(this)},Oe.TableEditor.prototype.ScrollTableDownOneRow=function(){return Oe.ScrollTableDownOneRow(this)},Oe.TableEditor.prototype.ScrollTableLeftOneCol=function(){return Oe.ScrollTableLeftOneCol(this)},Oe.TableEditor.prototype.ScrollTableRightOneCol=function(){return Oe.ScrollTableRightOneCol(this)},Oe.TableEditor.prototype.StopPropagation=function(){return Oe.StopPropagation(this)},Oe.TableEditor.prototype.SetMouseMoveUp=function(){return Oe.SetMouseMoveUp(this)},Oe.TableEditor.prototype.RemoveMouseMoveUp=function(){return Oe.RemoveMouseMoveUp(this)},Oe.CreateTableEditor=function(e,t,o){var r,a,n,l,s,i=Oe.Constants,c=Oe.AssignID;return e.toplevel=document.createElement("div"),e.toplevel.style.position="relative",c(e,e.toplevel,"toplevel"),e.width=t,e.height=o,e.griddiv=document.createElement("div"),e.tablewidth=Math.max(0,t-i.defaultTableControlThickness),e.tableheight=Math.max(0,o-i.defaultTableControlThickness),e.griddiv.style.width=e.tablewidth+"px",e.griddiv.style.height=e.tableheight+"px",e.griddiv.style.overflow="hidden",e.griddiv.style.cursor="default",i.cteGriddivClass&&(e.griddiv.className=i.cteGriddivClass),c(e,e.griddiv,"griddiv"),e.FitToEditTable(),e.EditorRenderSheet(),e.griddiv.appendChild(e.fullgrid),e.verticaltablecontrol=new Oe.TableControl(e,!0,e.tableheight),e.verticaltablecontrol.CreateTableControl(),c(e,e.verticaltablecontrol.main,"tablecontrolv"),e.horizontaltablecontrol=new Oe.TableControl(e,!1,e.tablewidth),e.horizontaltablecontrol.CreateTableControl(),c(e,e.horizontaltablecontrol.main,"tablecontrolh"),r=document.createElement("table"),(e.layouttable=r).cellSpacing=0,r.cellPadding=0,c(e,r,"layouttable"),a=document.createElement("tbody"),r.appendChild(a),n=document.createElement("tr"),a.appendChild(n),(l=document.createElement("td")).appendChild(e.griddiv),n.appendChild(l),1!=Oe._app&&((l=document.createElement("td")).appendChild(e.verticaltablecontrol.main),n.appendChild(l)),n=document.createElement("tr"),a.appendChild(n),1!=Oe._app&&((l=document.createElement("td")).appendChild(e.horizontaltablecontrol.main),n.appendChild(l)),l=document.createElement("td"),Oe._app?l.style.background="url("+e.imageprefix+"logo.gif) no-repeat right center":l.style.background="url("+e.imageprefix+"logo.gif) no-repeat center center",l.innerHTML="<div style='cursor:pointer;font-size:1px;'><img src='"+e.imageprefix+"1x1.gif' border='0' width='18' height='18'></div>",n.appendChild(l),e.logo=l,c(e,e.logo,"logo"),l.firstChild.firstChild.title="SocialCalc",e.toplevel.appendChild(e.layouttable),e.noEdit||(e.inputEcho=new Oe.InputEcho(e),c(e,e.inputEcho.main,"inputecho")),e.cellhandles=new Oe.CellHandles(e),s=document.createElement("textarea"),Oe.setStyles(s,"display:none;position:absolute;height:1px;width:1px;opacity:0;filter:alpha(opacity=0);"),s.value="",e.pasteTextarea=s,c(e,e.pasteTextarea,"pastetextarea"),navigator.userAgent.match(/Safari\//)&&!navigator.userAgent.match(/Chrome\//)&&(U.removeEventListener("beforepaste",Oe.SafariPasteFunction,!1),U.addEventListener("beforepaste",Oe.SafariPasteFunction,!1),U.removeEventListener("beforecopy",Oe.SafariPasteFunction,!1),U.addEventListener("beforecopy",Oe.SafariPasteFunction,!1),U.removeEventListener("beforecut",Oe.SafariPasteFunction,!1),U.addEventListener("beforecut",Oe.SafariPasteFunction,!1)),e.toplevel.appendChild(e.pasteTextarea),Oe.MouseWheelRegister(e.toplevel,{WheelMove:Oe.EditorProcessMouseWheel,editor:e}),Oe.KeyboardSetFocus(e),Oe.EditorSheetStatusCallback(null,"startup",null,e),e.toplevel},Oe.SafariPasteFunction=function(e){e.preventDefault()},Oe.ResizeTableEditor=function(e,t,o){var r=Oe.Constants;e.width=t,e.height=o,e.toplevel.style.width=t+"px",e.toplevel.style.height=o+"px",Oe._app?e.tablewidth=Math.max(0,t):e.tablewidth=Math.max(0,t-r.defaultTableControlThickness),e.tableheight=Math.max(0,o-r.defaultTableControlThickness),e.griddiv.style.width=e.tablewidth+"px",e.griddiv.style.height=e.tableheight+"px",e.verticaltablecontrol.main.style.height=e.tableheight+"px",e.horizontaltablecontrol.main.style.width=e.tablewidth+"px",e.FitToEditTable(),e.ScheduleRender()},Oe.SaveEditorSettings=function(e){var t,o,r=e.context,a=e.range,n="";for(n+="version:1.0\n",t=0;t<r.rowpanes.length;t++)n+="rowpane:"+t+":"+r.rowpanes[t].first+":"+r.rowpanes[t].last+"\n";for(t=0;t<r.colpanes.length;t++)n+="colpane:"+t+":"+r.colpanes[t].first+":"+r.colpanes[t].last+"\n";for(o in e.ecell&&(n+="ecell:"+e.ecell.coord+"\n"),a.hasrange&&(n+="range:"+a.anchorcoord+":"+a.top+":"+a.bottom+":"+a.left+":"+a.right+"\n"),e.SettingsCallbacks)n+=e.SettingsCallbacks[o].save(e,o);return n},Oe.LoadEditorSettings=function(e,t,o){var r,a,n,l,s,i,c,d,u,p=t.split(/\r\n|\n/),h=[],m=e.context;for(m.rowpanes=[{first:1,last:1}],m.colpanes=[{first:1,last:1}],e.ecell=null,e.range={hasrange:!1},e.range2={hasrange:!1},u=e.range,m.highlights={},d=m.highlights,a=0;a<p.length;a++)switch(c=(h=(r=p[a]).split(":"))[0]){case"version":break;case"rowpane":m.rowpanes[h[1]-0]={first:h[2]-0,last:h[3]-0};break;case"colpane":m.colpanes[h[1]-0]={first:h[2]-0,last:h[3]-0};break;case"ecell":e.ecell=Oe.coordToCr(h[1]),e.ecell.coord=h[1],d[h[1]]="cursor";break;case"range":for(u.hasrange=!0,u.anchorcoord=h[1],n=Oe.coordToCr(u.anchorcoord),u.anchorrow=n.row,u.anchorcol=n.col,u.top=h[2]-0,u.bottom=h[3]-0,u.left=h[4]-0,u.right=h[5]-0,l=u.top;l<=u.bottom;l++)for(s=u.left;s<=u.right;s++)"cursor"!=d[i=Oe.crToCoord(s,l)]&&(d[i]="range");break;default:e.SettingsCallbacks[c]&&e.SettingsCallbacks[c].load(e,c,r,o)}},Oe.EditorRenderSheet=function(e){e.EditorMouseUnregister();var t=e.context.sheetobj;if(null!=t.reRenderCellList&&Oe._app&&!0===t.widgetsClean){for(var o in t.reRenderCellList){var r=t.reRenderCellList[o],a=t.cells[r].valuetype;"i"==a.charAt(1)&&a==t.cells[r].prevvaluetype||(cr=Oe.coordToCr(r),cell=Oe.GetEditorCellElement(e,cr.row,cr.col),null!=cell&&e.ReplaceCell(cell,cr.row,cr.col))}t.reRenderCellList=[]}else e.fullgrid=e.context.RenderSheet(e.fullgrid),null!=t.reRenderCellList&&Oe._app&&(t.widgetsClean=!0,t.reRenderCellList=[]);e.ecell&&e.SetECellHeaders("selected"),Oe.AssignID(e,e.fullgrid,"fullgrid"),Oe._app||(e.fullgrid.className="te_download"),e.EditorMouseRegister()},Oe.EditorScheduleSheetCommands=function(e,t,o,r){if("start"==e.state||r)if(!e.busy||r){var a=t.split(" ");switch(a[0]){case"recalc":case"redisplay":e.context.sheetobj.ScheduleSheetCommands(t,!1);break;case"undo":Oe._app&&(e.context.sheetobj.widgetsClean=!1),e.SheetUndo();break;case"redo":Oe._app&&(e.context.sheetobj.widgetsClean=!1),e.SheetRedo();break;case"setemailparameters":Oe.TriggerIoAction.Email(a[1],a[2]);break;default:e.context.sheetobj.ScheduleSheetCommands(t,o)}}else e.deferredCommands.push({cmdstr:t,saveundo:o})},Oe.EditorSheetStatusCallback=function(e,t,o,r){function a(e){for(n in r.StatusCallback)r.StatusCallback[n].func&&r.StatusCallback[n].func(r,e,o,r.StatusCallback[n].params)}var n,l,s,i=r.context.sheetobj;switch(t){case"startup":break;case"cmdstart":r.busy=!0,i.celldisplayneeded="";break;case"cmdextension":break;case"cmdend":if(a(t),i.changedrendervalues&&(r.context.PrecomputeSheetFontsAndLayouts(),r.context.CalculateCellSkipData(),i.changedrendervalues=!1),i.celldisplayneeded&&!i.renderneeded&&i.cells[i.celldisplayneeded]&&"e#N/A"!=i.cells[i.celldisplayneeded].valuetype&&(cr=Oe.coordToCr(i.celldisplayneeded),l=Oe.GetEditorCellElement(r,cr.row,cr.col),r.ReplaceCell(l,cr.row,cr.col)),r.deferredCommands.length)return s=r.deferredCommands.shift(),void r.EditorScheduleSheetCommands(s.cmdstr,s.saveundo,!0);if(i.attribs.needsrecalc&&("off"!=i.attribs.recalc||i.recalconce)&&r.recalcFunction?(r.FitToEditTable(),i.renderneeded=!1,i.recalconce&&delete i.recalconce,r.recalcFunction(r)):i.renderneeded?(r.FitToEditTable(),i.renderneeded=!1,r.ScheduleRender(!1)):r.SchedulePositionCalculations(),"col"==i.hiddencolrow&&null!==r.ecell){for(var c=r.ecell.col;"yes"==i.colattribs.hide[Oe.rcColname(c)];)c++;var d=Oe.crToCoord(c,r.ecell.row);r.MoveECell(d),i.hiddencolrow=""}if("row"==i.hiddencolrow&&null!==r.ecell){for(var u=r.ecell.row;"yes"==i.rowattribs.hide[u];)u++;d=Oe.crToCoord(r.ecell.col,u);r.MoveECell(d),i.hiddencolrow=""}return;case"calcstart":r.busy=!0;break;case"calccheckdone":case"calcorder":case"calcstep":case"calcloading":case"calcserverfunc":break;case"calcfinished":return a(t),void r.ScheduleRender(!1);case"schedrender":r.busy=!0;break;case"renderdone":break;case"schedposcalc":r.busy=!0;break;case"doneposcalc":if(r.deferredEmailCommands.length){a(t);var p=r.deferredEmailCommands.shift();return void r.EditorScheduleSheetCommands(p.cmdstr,p.saveundo,!0)}return void(r.deferredCommands.length?(a(t),s=r.deferredCommands.shift(),r.EditorScheduleSheetCommands(s.cmdstr,s.saveundo,!0)):(r.busy=!1,a(t),"start"==r.state&&r.DisplayCellContents()));case"emailing":case"confirmemailsent":break;default:alert("Unknown status: "+t)}a(t)},Oe.EditorGetStatuslineString=function(e,t,o,r){var a,n,l,s,i,c,d,u=Oe.Constants;switch(n="",t){case"moveecell":case"rangechange":case"startup":break;case"cmdstart":r.command=!0,document.body.style.cursor="progress",e.griddiv.style.cursor="progress",n=u.s_statusline_executing;break;case"cmdextension":n="Command Extension: "+o;break;case"cmdend":r.command=!1;break;case"schedrender":n=u.s_statusline_displaying;break;case"renderdone":n=" ";break;case"schedposcalc":n=u.s_statusline_displaying;break;case"cmdendnorender":case"doneposcalc":document.body.style.cursor="default",e.griddiv.style.cursor="default","sent"==r.emailing&&(n=r.emailreponse,r.emailreponse="",r.emailing="done");break;case"calcorder":n=u.s_statusline_ordering+Math.floor(100*o.count/(o.total||1))+"%";break;case"calcstep":n=u.s_statusline_calculating+Math.floor(100*o.count/(o.total||1))+"%";break;case"calcloading":n=u.s_statusline_calculatingls+": "+o.sheetname;break;case"calcserverfunc":n=u.s_statusline_calculating+Math.floor(100*o.count/(o.total||1))+"%, "+u.s_statusline_doingserverfunc+o.funcname+u.s_statusline_incell+o.coord;break;case"calcstart":r.calculating=!0,document.body.style.cursor="progress",e.griddiv.style.cursor="progress",n=u.s_statusline_calcstart;break;case"calccheckdone":break;case"calcfinished":r.calculating=!1;break;case"emailing":r.emailing="sending",r.emailreponse="";break;case"confirmemailsent":r.emailing="sent",void 0===r.emailreponse&&(r.emailreponse=""),r.emailreponse+=o;break;default:n=t}if("sending"==r.emailing&&(n+=u.s_statusline_sendemail),"sent"==r.emailing&&(n+=r.emailreponse),!n&&r.calculating&&(n=u.s_statusline_calculating),!r.calculating&&!r.command&&!n&&e.range.hasrange&&(e.range.left!=e.range.right||e.range.top!=e.range.bottom)){for(d=0,s=e.range.top;s<=e.range.bottom;s++)for(i=e.range.left;i<=e.range.right;i++)(c=e.context.sheetobj.cells[Oe.crToCoord(i,s)])&&c.valuetype&&"n"==c.valuetype.charAt(0)&&(d+=c.datavalue-0);d=Oe.FormatNumber.formatNumberWithFormat(d,"[,]General",""),n=Oe.crToCoord(e.range.left,e.range.top)+":"+Oe.crToCoord(e.range.right,e.range.bottom)+" ("+(e.range.right-e.range.left+1)+"x"+(e.range.bottom-e.range.top+1)+") "+u.s_statusline_sum+"="+d+" "+n}return a=(e.ecell||{}).coord+" &nbsp; "+n,r.calculating||"yes"!=e.context.sheetobj.attribs.needsrecalc||(a+=" &nbsp; "+u.s_statusline_recalcneeded),(l=e.context.sheetobj.attribs.circularreferencecell)&&(l=l.replace(/\|/," referenced by "),a+=" &nbsp; "+u.s_statusline_circref+l+"</span>"),a+=""},Oe.EditorMouseInfo={registeredElements:[],editor:null,element:null,ignore:!1,mousedowncoord:"",mouselastcoord:"",mouseresizecol:"",mouseresizeclientx:null,mouseresizedisplay:null},Oe.EditorMouseRegister=function(e){var t,o=Oe.EditorMouseInfo,r=e.fullgrid;for(t=0;t<o.registeredElements.length;t++)if(o.registeredElements[t].editor==e){if(o.registeredElements[t].element==r)return;break}if(t<o.registeredElements.length?o.registeredElements[t].element=r:o.registeredElements.push({element:r,editor:e}),r.addEventListener)r.addEventListener("mousedown",Oe.ProcessEditorMouseDown,!1),r.addEventListener("dblclick",Oe.ProcessEditorDblClick,!1);else{if(!r.attachEvent)throw"Browser not supported";r.attachEvent("onmousedown",Oe.ProcessEditorMouseDown),r.attachEvent("ondblclick",Oe.ProcessEditorDblClick)}o.ignore=!1},Oe.EditorMouseUnregister=function(e){var t,o,r=Oe.EditorMouseInfo;e.fullgrid;for(t=0;t<r.registeredElements.length&&r.registeredElements[t].editor!=e;t++);t<r.registeredElements.length&&((o=r.registeredElements[t].element).removeEventListener?(o.removeEventListener("mousedown",Oe.ProcessEditorMouseDown,!1),o.removeEventListener("dblclick",Oe.ProcessEditorDblClick,!1)):o.detachEvent&&(o.detachEvent("onmousedown",Oe.ProcessEditorMouseDown),o.detachEvent("ondblclick",Oe.ProcessEditorDblClick)),r.registeredElements.splice(t,1))},Oe.StopPropagation=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1},Oe.SetMouseMoveUp=function(e,t,o,r){document.addEventListener?(document.addEventListener("mousemove",e,!0),document.addEventListener("mouseup",t,!0)):o.attachEvent&&(o.setCapture(),o.attachEvent("onmousemove",e),o.attachEvent("onmouseup",t),o.attachEvent("onlosecapture",t)),Oe.StopPropagation(r)},Oe.RemoveMouseMoveUp=function(e,t,o,r){Oe.StopPropagation(r),document.removeEventListener?(document.removeEventListener("mousemove",e,!0),document.removeEventListener("mouseup",t,!0)):o.detachEvent&&(o.detachEvent("onlosecapture",t),o.detachEvent("onmouseup",t),o.detachEvent("onmousemove",e),o.releaseCapture())},Oe.ProcessEditorMouseDown=function(e){var t,o,r,a,n,l=e||U.event,s=Oe.EditorMouseInfo,i=l.target||l.srcElement,c=i;if(3==c.nodeType&&(c=c.parentNode),!s.ignore){for(n=null;!n&&i;i=i.parentNode)n=Oe.LookupElement(i,s.registeredElements);if(n){t=n.editor,s.element=i,a=t.range;var d=Oe.GetElementPositionWithScroll(t.toplevel),u=l.clientX-d.left,p=l.clientY-d.top;if(o=Oe.GridMousePosition(t,u,p))if(s.editor=t,o.rowheader)o.rowselect?Oe.ProcessEditorRowselectMouseDown(e,i,o):Oe.ProcessEditorRowsizeMouseDown(e,i,o);else if(o.colheader)o.colselect?Oe.ProcessEditorColselectMouseDown(e,i,o):Oe.ProcessEditorColsizeMouseDown(e,i,o);else if(o.coord)if(a.hasrange||e.shiftKey&&t.RangeAnchor(),r=t.MoveECell(o.coord),1!=Oe._app){var h=t.context.sheetobj.cells[r];if(h&&"i"==h.valuetype.charAt(1)){var m=h.valuetype.substring(2)+"_"+r;if(c&&m==c.id){var f=document.getElementById(m);Oe.CmdGotFocus(f)}}else a.hasrange&&(e.shiftKey?t.RangeExtend():t.RangeRemove()),s.mousedowncoord=r,s.mouselastcoord=r,t.EditorMouseRange(r),Oe.KeyboardSetFocus(t),"start"!=t.state&&t.inputBox&&t.inputBox.element.focus(),Oe.SetMouseMoveUp(Oe.ProcessEditorMouseMove,Oe.ProcessEditorMouseUp,i,l)}else Oe.CmdGotFocus(!0)}else s.editor=null}},Oe.EditorMouseRange=function(e,t){var o,r,a=e.range;switch(e.state){case"input":o=e.inputBox.GetText(),r=e.workingvalues,(0<="(+-*/,:!&<>=^".indexOf(o.slice(-1))&&"="==o.slice(0,1)||"="==o)&&(r.partialexpr=o),r.partialexpr?t&&(a.hasrange?e.inputBox.SetText(r.partialexpr+Oe.crToCoord(a.left,a.top)+":"+Oe.crToCoord(a.right,a.bottom)):e.inputBox.SetText(r.partialexpr+t)):(e.inputBox.Blur(),e.inputBox.ShowInputBox(!1),e.state="start",e.cellhandles.ShowCellHandles(!0),e.EditorSaveEdit(),e.inputBox.DisplayCellContents(null));break;case"inputboxdirect":e.inputBox.Blur(),e.inputBox.ShowInputBox(!1),e.state="start",e.cellhandles.ShowCellHandles(!0),e.EditorSaveEdit(),e.inputBox.DisplayCellContents(null)}},Oe.ProcessEditorMouseMove=function(e){var t,o,r=e||U.event,a=Oe.EditorMouseInfo;if((t=a.editor)&&!a.ignore){a.element;var n=Oe.GetElementPositionWithScroll(t.toplevel),l=r.clientX-n.left,s=r.clientY-n.top;(o=Oe.GridMousePosition(t,l,s))&&(!o||o.coord?(Oe.SetDragAutoRepeat(t,null),o.coord&&(o.coord!=a.mouselastcoord&&(e.shiftKey||t.range.hasrange||t.RangeAnchor(a.mousedowncoord),t.MoveECell(o.coord),t.RangeExtend()),a.mouselastcoord=o.coord,t.EditorMouseRange(o.coord),Oe.StopPropagation(r))):Oe.SetDragAutoRepeat(t,o))}},Oe.ProcessEditorMouseUp=function(e){var t,o,r,a=e||U.event,n=Oe.EditorMouseInfo;if((t=n.editor)&&!n.ignore){o=n.element;var l=Oe.GetElementPositionWithScroll(t.toplevel),s=a.clientX-l.left,i=a.clientY-l.top;if(r=Oe.GridMousePosition(t,s,i),Oe.SetDragAutoRepeat(t,null),r)return r.coord||(r.coord=t.ecell.coord),t.range.hasrange?(t.MoveECell(r.coord),t.RangeExtend()):r.coord&&r.coord!=n.mousedowncoord&&(t.RangeAnchor(n.mousedowncoord),t.MoveECell(r.coord),t.RangeExtend()),t.EditorMouseRange(r.coord),n.editor=null,Oe.RemoveMouseMoveUp(Oe.ProcessEditorMouseMove,Oe.ProcessEditorMouseUp,o,a),!1}},Oe.ProcessEditorColsizeMouseDown=function(e,t,o){var r=e||U.event,a=Oe.EditorMouseInfo,n=a.editor,l=Oe.GetElementPositionWithScroll(n.toplevel),s=r.clientX-l.left;if(a.mouseresizecolnum=o.coltoresize,a.mouseresizecol=Oe.rcColname(o.coltoresize),a.mousedownclientx=s,a.mousecoltounhide=o.coltounhide,o.coltoresize){var i=document.createElement("div");(a.mouseresizedisplay=i).style.width="auto",i.style.position="absolute",i.style.zIndex=100,i.style.top=n.headposition.top+"px",i.style.left=n.colpositions[o.coltoresize]+"px",i.innerHTML='<table cellpadding="0" cellspacing="0"><tr><td style="height:100px;border:1px dashed black;background-color:white;width:'+(n.context.colwidth[a.mouseresizecolnum]-2)+'px;">&nbsp;</td><td><div style="font-size:small;color:white;background-color:gray;padding:4px;">'+n.context.colwidth[a.mouseresizecolnum]+"</div></td></tr></table>",Oe.setStyles(i.firstChild.lastChild.firstChild.childNodes[0],"filter:alpha(opacity=85);opacity:.85;"),n.toplevel.appendChild(i)}Oe.SetMouseMoveUp(Oe.ProcessEditorColsizeMouseMove,Oe.ProcessEditorColsizeMouseUp,n.toplevel,r)},Oe.ProcessEditorColsizeMouseMove=function(e){var t=e||U.event,o=Oe.EditorMouseInfo,r=o.editor;if(r){if(o.mouseresizecolnum){var a=Oe.GetElementPositionWithScroll(r.toplevel),n=t.clientX-a.left,l=r.context.colwidth[o.mouseresizecolnum]-0+(n-o.mousedownclientx);l<Oe.Constants.defaultMinimumColWidth&&(l=Oe.Constants.defaultMinimumColWidth);var s=o.mouseresizedisplay;s.innerHTML='<table cellpadding="0" cellspacing="0"><tr><td style="height:100px;border:1px dashed black;background-color:white;width:'+(l-2)+'px;">&nbsp;</td><td><div style="font-size:small;color:white;background-color:gray;padding:4px;">'+l+"</div></td></tr></table>",Oe.setStyles(s.firstChild.lastChild.firstChild.childNodes[0],"filter:alpha(opacity=85);opacity:.85;")}Oe.StopPropagation(t)}},Oe.ProcessEditorColsizeMouseUp=function(e){var t=e||U.event,o=Oe.EditorMouseInfo,r=o.editor;if(r){element=o.element;var a=Oe.GetElementPositionWithScroll(r.toplevel),n=t.clientX-a.left;if(Oe.RemoveMouseMoveUp(Oe.ProcessEditorColsizeMouseMove,Oe.ProcessEditorColsizeMouseUp,r.toplevel,t),o.mousecoltounhide)r.EditorScheduleSheetCommands("set "+Oe.rcColname(o.mousecoltounhide)+" hide",!0,!1);else if(o.mouseresizecolnum){var l=r.context.colwidth[o.mouseresizecolnum]-0+(n-o.mousedownclientx);l<Oe.Constants.defaultMinimumColWidth&&(l=Oe.Constants.defaultMinimumColWidth),r.EditorScheduleSheetCommands("set "+o.mouseresizecol+" width "+l,!0,!1),r.timeout&&U.clearTimeout(r.timeout),r.timeout=U.setTimeout(Oe.FinishColRowSize,1)}return!1}},Oe.FinishColRowSize=function(){var e=Oe.EditorMouseInfo,t=e.editor;t&&(t.toplevel.removeChild(e.mouseresizedisplay),e.mouseresizedisplay=null,e.editor=null)},Oe.ProcessEditorRowselectMouseDown=function(e,t,o){var r=e||U.event,a=Oe.EditorMouseInfo.editor,n=Oe.GetSpreadsheetControlObject().sheet;coord1=Oe.crToCoord(1,o.row),coord2=Oe.crToCoord(n.LastCol(),o.row),coord3=Oe.crToCoord(a.firstscrollingcol,o.row),a.RangeAnchor(coord1),a.RangeExtend(coord2),a.MoveECell(coord3),Oe.SetMouseMoveUp(Oe.ProcessEditorRowselectMouseMove,Oe.ProcessEditorRowselectMouseUp,a.toplevel,r)},Oe.ProcessEditorRowselectMouseMove=function(e){var t=e||U.event,o=Oe.EditorMouseInfo.editor,r=Oe.GetSpreadsheetControlObject().sheet;if(o){var a=Oe.GetElementPositionWithScroll(o.toplevel),n=t.clientX-a.left,l=t.clientY-a.top;result=Oe.GridMousePosition(o,n,l),coord2=Oe.crToCoord(r.LastCol(),result.row),coord3=Oe.crToCoord(o.firstscrollingcol,result.row),o.RangeExtend(coord2),o.MoveECell(coord3)}},Oe.ProcessEditorRowselectMouseUp=function(e){e||U.event;var t=Oe.EditorMouseInfo.editor;t&&Oe.RemoveMouseMoveUp(Oe.ProcessEditorRowselectMouseMove,Oe.ProcessEditorRowselectMouseUp,t.toplevel,e)},Oe.ProcessEditorColselectMouseDown=function(e,t,o){var r=e||U.event,a=Oe.EditorMouseInfo.editor,n=Oe.GetSpreadsheetControlObject().sheet;coord1=Oe.crToCoord(o.col,1),coord2=Oe.crToCoord(o.col,n.LastRow()),coord3=Oe.crToCoord(o.col,a.firstscrollingrow),a.RangeAnchor(coord1),a.RangeExtend(coord2),a.MoveECell(coord3),Oe.SetMouseMoveUp(Oe.ProcessEditorColselectMouseMove,Oe.ProcessEditorColselectMouseUp,a.toplevel,r)},Oe.ProcessEditorColselectMouseMove=function(e){var t=e||U.event,o=Oe.EditorMouseInfo.editor,r=Oe.GetSpreadsheetControlObject().sheet;if(o){var a=Oe.GetElementPositionWithScroll(o.toplevel),n=t.clientX-a.left,l=t.clientY-a.top;result=Oe.GridMousePosition(o,n,l),coord2=Oe.crToCoord(result.col,r.LastRow()),coord3=Oe.crToCoord(result.col,o.firstscrollingrow),o.RangeExtend(coord2),o.MoveECell(coord3)}},Oe.ProcessEditorColselectMouseUp=function(e){e||U.event;var t=Oe.EditorMouseInfo.editor;t&&Oe.RemoveMouseMoveUp(Oe.ProcessEditorColselectMouseMove,Oe.ProcessEditorColselectMouseUp,t.toplevel,e)},Oe.ProcessEditorRowsizeMouseDown=function(e,t,o){var r=e||U.event,a=Oe.EditorMouseInfo,n=a.editor,l=Oe.GetSpreadsheetControlObject().spreadsheetDiv.firstChild.offsetHeight,s=r.clientY-l;if(a.mouseresizerownum=o.rowtoresize,a.mouseresizerow=o.rowtoresize,a.mousedownclienty=s,a.mouserowtounhide=o.rowtounhide,o.rowtoresize){var i=document.createElement("div");(a.mouseresizedisplay=i).style.width=n.context.totalwidth+"px",i.style.height=n.rowpositions[o.rowtoresize]+"px",i.style.position="absolute",i.style.zIndex=100,i.style.top=n.rowpositions[o.rowtoresize]+"px",i.style.left=n.headposition.left+"px",i.innerHTML='<table cellpadding="0" cellspacing="0"><tr><td style="width:100pxborder:1px dashed black;background-color:white;height:'+(n.context.rowheight[a.mouseresizerownum]-2)+'px;">&nbsp;</td><td><div style="font-size:small;color:white;background-color:gray;padding:4px;">'+n.context.rowheight[a.mouseresizerownum]+"</div></td></tr></table>",Oe.setStyles(i.firstChild.lastChild.firstChild.childNodes[0],"filter:alpha(opacity=85);opacity:.5;"),n.toplevel.appendChild(i)}Oe.SetMouseMoveUp(Oe.ProcessEditorRowsizeMouseMove,Oe.ProcessEditorRowsizeMouseUp,n.toplevel,r)},Oe.ProcessEditorRowsizeMouseMove=function(e){var t=e||U.event,o=Oe.EditorMouseInfo,r=o.editor;if(r){if(o.mouseresizerownum){var a=Oe.GetSpreadsheetControlObject().spreadsheetDiv.firstChild.offsetHeight,n=t.clientY-a,l=r.context.rowheight[o.mouseresizerownum]-0+(n-o.mousedownclienty);l<Oe.Constants.defaultAssumedRowHeight&&(l=Oe.Constants.defaultAssumedRowHeight);var s=o.mouseresizedisplay;s.innerHTML='<table cellpadding="0" cellspacing="0"><tr><td style="width:100px;border:1px dashed black;background-color:white;height:'+(l-2)+'px;">&nbsp;</td><td><div style="font-size:small;color:white;background-color:gray;padding:4px;">'+l+"</div></td></tr></table>",Oe.setStyles(s.firstChild.lastChild.firstChild.childNodes[0],"filter:alpha(opacity=85);opacity:.5;")}Oe.StopPropagation(t)}},Oe.ProcessEditorRowsizeMouseUp=function(e){var t=e||U.event,o=Oe.EditorMouseInfo,r=o.editor;if(r){element=o.element;var a=Oe.GetSpreadsheetControlObject().spreadsheetDiv.firstChild.offsetHeight,n=t.clientY-a;if(Oe.RemoveMouseMoveUp(Oe.ProcessEditorRowsizeMouseMove,Oe.ProcessEditorRowsizeMouseUp,r.toplevel,t),o.mouserowtounhide)r.EditorScheduleSheetCommands("set "+o.mouserowtounhide+" hide",!0,!1);else if(o.mouseresizerownum){var l=r.context.rowheight[o.mouseresizerownum]-0+(n-o.mousedownclienty);l<Oe.Constants.defaultAssumedRowHeight&&(l=Oe.Constants.defaultAssumedRowHeight),r.EditorScheduleSheetCommands("set "+o.mouseresizerownum+" height "+l,!0,!1),r.timeout&&U.clearTimeout(r.timeout),r.timeout=U.setTimeout(Oe.FinishColRowSize,1)}return!1}},Oe.AutoRepeatInfo={timer:null,mouseinfo:null,repeatinterval:1e3,editor:null,repeatcallback:null},Oe.SetDragAutoRepeat=function(e,t,o){var r,a,n=Oe.AutoRepeatInfo;if(n.repeatcallback=o,!t)return n.timer&&(U.clearTimeout(n.timer),n.timer=null),void(n.mouseinfo=null);if(n.editor=e,n.mouseinfo&&(t.rowheader||t.rowfooter?t.row!=n.mouseinfo.row&&(r=Oe.crToCoord(e.ecell.col,t.row),n.repeatcallback?(a=t.row<n.mouseinfo.row?"left":t.row>n.mouseinfo.row?"right":"",n.repeatcallback(r,a)):(e.MoveECell(r),e.MoveECell(r),e.RangeExtend(),e.EditorMouseRange(r))):(t.colheader||t.colfooter)&&t.col!=n.mouseinfo.col&&(r=Oe.crToCoord(t.col,e.ecell.row),n.repeatcallback?(a=t.row<n.mouseinfo.row?"left":t.row>n.mouseinfo.row?"right":"",n.repeatcallback(r,a)):(e.MoveECell(r),e.RangeExtend(),e.EditorMouseRange(r)))),(n.mouseinfo=t).distance<5)n.repeatinterval=333;else if(t.distance<10)n.repeatinterval=250;else if(t.distance<25)n.repeatinterval=100;else{if(!(t.distance<35))return void(n.timer&&(U.clearTimeout(n.timer),n.timer=null));n.repeatinterval=75}n.timer||(n.timer=U.setTimeout(Oe.DragAutoRepeat,n.repeatinterval))},Oe.DragAutoRepeat=function(){var e,t,o,r=Oe.AutoRepeatInfo,a=r.mouseinfo;a.rowheader?e="left":a.rowfooter?e="right":a.colheader?e="up":a.colfooter&&(e="down"),r.repeatcallback?(o=Oe.coordToCr(r.editor.ecell.coord),"left"==e&&1<o.col?o.col--:"right"==e?o.col++:"up"==e&&1<o.row?o.row--:"down"==e&&o.row++,t=Oe.crToCoord(o.col,o.row),r.repeatcallback(t,e)):(t=r.editor.MoveECellWithKey("[a"+e+"]shifted"))&&r.editor.EditorMouseRange(t),r.timer=U.setTimeout(Oe.DragAutoRepeat,r.repeatinterval)},Oe.ProcessEditorDblClick=function(e){var t,o,r,a=e||U.event,n=Oe.EditorMouseInfo,l=a.target||a.srcElement;if(!n.ignore){for(r=null;!r&&l;l=l.parentNode)r=Oe.LookupElement(l,n.registeredElements);if(r){t=r.editor;var s=Oe.GetElementPositionWithScroll(t.toplevel),i=a.clientX-s.left,c=a.clientY-s.top;if((o=Oe.GridMousePosition(t,i,c))&&o.coord){switch(n.editor=t,n.element=l,t.range,sheetobj=t.context.sheetobj,t.state){case"start":Oe.EditorOpenCellEdit(t)}Oe.StopPropagation(a)}}else n.editor=null}},Oe.EditorOpenCellEdit=function(e){var t;return!e.ecell||(!e.inputBox||(!!e.inputBox.element.disabled||(e.inputBox.ShowInputBox(!0),e.inputBox.Focus(),e.inputBox.SetText(""),e.inputBox.DisplayCellContents(),e.inputBox.Select("end"),(t=e.workingvalues).partialexpr="",t.ecoord=e.ecell.coord,t.erow=e.ecell.row,void(t.ecol=e.ecell.col))))},Oe.EditorProcessKey=function(e,t,o){e.context.sheetobj;var r,a,n,l=e.workingvalues,s=e.range;switch("string"!=typeof t&&(t=""),e.state){case"start":if(o.shiftKey&&"[a"==t.substr(0,2)&&(t+="shifted"),"[enter]"==t&&(t="[adown]"),"[tab]"==t&&(t=o.shiftKey?"[aleft]":"[aright]"),"[a"==t.substr(0,2)||"[pg"==t.substr(0,3)||"[home]"==t)return!e.MoveECellWithKey(t);if("[del]"==t||"[backspace]"==t){e.noEdit||e.ECellReadonly()||e.EditorApplySetCommandsToRange("empty","");break}if("[esc]"==t){if(s.hasrange)for(n in e.RangeRemove(),e.MoveECell(s.anchorcoord),e.StatusCallback)e.StatusCallback[n].func(e,"specialkey",t,e.StatusCallback[n].params);return!1}if("[f2]"==t)return!(!e.noEdit&&!e.ECellReadonly())||(Oe.EditorOpenCellEdit(e),!(e.state="inputboxdirect"));if(1<t.length&&"["==t.substr(0,1)||0==t.length)return!(e.ctrlkeyFunction&&0<t.length)||e.ctrlkeyFunction(e,t);if(!e.ecell)return!0;if(!e.inputBox)return!0;if(e.ECellReadonly())return!0;e.inputBox.element.disabled=!1,e.state="input",e.inputBox.ShowInputBox(!0),e.inputBox.Focus(),e.inputBox.SetText(t),e.inputBox.Select("end"),l.partialexpr="",l.ecoord=e.ecell.coord,l.erow=e.ecell.row,l.ecol=e.ecell.col,e.RangeRemove();break;case"input":if(a=e.inputBox.GetText(),e.inputBox.skipOne)return!1;if("[esc]"==t||"[enter]"==t||"[tab]"==t||t&&"[a"==t.substr(0,2)){if((0<="(+-*/,:!&<>=^".indexOf(a.slice(-1))&&"="==a.slice(0,1)||"="==a)&&(l.partialexpr=a),l.partialexpr&&(o.shiftKey&&"[a"==t.substr(0,2)&&(t+="shifted"),r=e.MoveECellWithKey(t)))return s.hasrange?e.inputBox.SetText(l.partialexpr+Oe.crToCoord(s.left,s.top)+":"+Oe.crToCoord(s.right,s.bottom)):e.inputBox.SetText(l.partialexpr+r),!1;e.inputBox.Blur(),e.inputBox.ShowInputBox(!1),e.state="start",e.cellhandles.ShowCellHandles(!0),"[esc]"!=t?(e.EditorSaveEdit(),e.ecell.coord!=l.ecoord&&e.MoveECell(l.ecoord),"[enter]"==t&&(t="[adown]"),"[tab]"==t&&(t=o.shiftKey?"[aleft]":"[aright]"),"[a"==t.substr(0,2)&&e.MoveECellWithKey(t)):(e.inputBox.DisplayCellContents(),e.RangeRemove(),e.MoveECell(l.ecoord));break}return l.partialexpr&&"[backspace]"==t?(e.inputBox.SetText(l.partialexpr),l.partialexpr="",e.RangeRemove(),e.MoveECell(l.ecoord),e.inputBox.ShowInputBox(!0),!1):"[f2]"==t?!(e.state="inputboxdirect"):(s.hasrange&&e.RangeRemove(),e.MoveECell(l.ecoord),l.partialexpr&&(e.inputBox.ShowInputBox(!0),l.partialexpr=""),!0);case"inputboxdirect":if(a=e.inputBox.GetText(),"[esc]"!=t&&"[enter]"!=t&&"[tab]"!=t)return"[f2]"!=t||!(e.state="input");e.inputBox.Blur(),e.inputBox.ShowInputBox(!1),e.state="start",e.cellhandles.ShowCellHandles(!0),"[esc]"==t?e.inputBox.DisplayCellContents():(e.EditorSaveEdit(),e.ecell.coord!=l.ecoord&&e.MoveECell(l.ecoord),"[enter]"==t&&(t="[adown]"),"[tab]"==t&&(t=o.shiftKey?"[aleft]":"[aright]"),"[a"==t.substr(0,2)&&e.MoveECellWithKey(t));break;case"skip-and-start":return e.state="start",e.cellhandles.ShowCellHandles(!0),!1;default:return!0}return!1},Oe.EditorAddToInput=function(e,t,o){var r=e.workingvalues;if(!e.noEdit&&!e.ECellReadonly())switch(e.state){case"start":e.state="input",e.inputBox.ShowInputBox(!0),e.inputBox.element.disabled=!1,e.inputBox.Focus(),e.inputBox.SetText((o||"")+t),e.inputBox.Select("end"),r.partialexpr="",r.ecoord=e.ecell.coord,r.erow=e.ecell.row,r.ecol=e.ecell.col,e.RangeRemove();break;case"input":case"inputboxdirect":e.inputBox.element.focus(),r.partialexpr&&(e.inputBox.SetText(r.partialexpr),r.partialexpr="",e.RangeRemove(),e.MoveECell(r.ecoord)),e.inputBox.SetText(e.inputBox.GetText()+t)}},Oe.EditorDisplayCellContents=function(e){e.inputBox&&e.inputBox.DisplayCellContents()},Oe.EditorSaveEdit=function(e,t){var o,r,a,n,l,s=e.context.sheetobj,i=e.workingvalues;a="text t",(n="string"==typeof t?t:e.inputBox.GetText())!=Oe.GetCellContents(s,i.ecoord)+""&&("="==(r=n.charAt(0))&&-1==n.indexOf("\n")?(a="formula",n=n.substring(1)):"'"==r?(a="text t",n=n.substring(1),"t"==(o=Oe.DetermineValueType(n)).type.charAt(0)&&(a="text "+o.type)):a=0==n.length?"empty":"n"==(o=Oe.DetermineValueType(n)).type&&n==o.value+""?"value n":"t"==o.type.charAt(0)?"text "+o.type:""==o.type?"text t":"constant "+o.type+" "+o.value,"t"==a.charAt(0)&&(n=Oe.encodeForSave(n)),l="set "+i.ecoord+" "+a+" "+n,e.EditorScheduleSheetCommands(l,!0,!1),void 0!==s.ioEventTree&&void 0!==s.ioParameterList&&void 0!==s.ioEventTree[i.ecoord]&&Oe.EditedTriggerCell(s.ioEventTree[i.ecoord],i.ecoord,e,s))},Oe.EditedTriggerCell=function(e,t,o,r){for(var a in e){var n=r.ioParameterList[a];if(void 0!==n)switch(n.function_name){case"EMAILONEDIT":case"EMAILONEDITIF":cmdline="setemailparameters "+a+" "+t,o.deferredEmailCommands.push({cmdstr:cmdline,saveundo:!1})}}},Oe.EditorApplySetCommandsToRange=function(e,t){e.context.sheetobj;var o,r=e.ecell,a=e.range;o=a.hasrange?(coord=Oe.crToCoord(a.left,a.top)+":"+Oe.crToCoord(a.right,a.bottom),"set "+coord+" "+t):"set "+r.coord+" "+t,e.EditorScheduleSheetCommands(o,!0,!1),e.DisplayCellContents()},Oe.EditorProcessMouseWheel=function(e,t,o,r){r.functionobj.editor.busy||(0<t&&r.functionobj.editor.ScrollRelative(!0,Math.floor(1.5*-t)),t<0&&r.functionobj.editor.ScrollRelative(!0,Math.ceil(1.5*-t)))},Oe.GridMousePosition=function(e,t,o){var r,a,n,l,s,i,c={};for(r=1;r<e.rowpositions.length&&!(e.rowheight[r]&&e.rowpositions[r]+e.rowheight[r]>o);r++);for(n=1;n<e.colpositions.length&&!(e.colwidth[n]&&e.colpositions[n]+e.colwidth[n]>t);n++);if(c.row=r,c.col=n,e.headposition&&1!=Oe._app){if(t<e.headposition.left&&t>=e.gridposition.left){for(c.rowheader=!0,c.distance=e.headposition.left-t,c.rowtoresize=!1,c.rowselect=!1,s=1;s<e.rowpositions.length;s++)if(e.rowheight[s]&&e.rowpositions[s]+e.rowheight[s]-3<=o&&e.rowpositions[s]+e.rowheight[s]+3>=o){c.rowtoresize=s;break}if((unhide=e.context.rowunhidetop[r])&&(pos=Oe.GetElementPosition(unhide),t>=pos.left&&t<pos.left+unhide.offsetWidth&&o>=e.rowpositions[r]+e.rowheight[r]-unhide.offsetHeight&&o<e.rowpositions[r]+e.rowheight[r]&&(c.rowtounhide=r+1)),(unhide=e.context.rowunhidebottom[r])&&(pos=Oe.GetElementPosition(unhide),t>=pos.left&&t<pos.left+unhide.offsetWidth&&o>=e.rowpositions[r]&&o<e.rowpositions[r]+unhide.offsetHeight&&(c.rowtounhide=r-1)),null==c.rowtounhide){for(a=0;a<e.context.rowpanes.length;a++)if(c.rowtoresize>=e.context.rowpanes[a].first&&c.rowtoresize<=e.context.rowpanes[a].last)return c;c.rowselect=!0}return delete c.rowtoresize,c}if(o<e.headposition.top&&o>e.gridposition.top){for(c.colheader=!0,c.distance=e.headposition.top-o,c.coltoresize=!1,c.colselect=!1,i=1;i<e.colpositions.length;i++)if(e.colwidth[i]&&e.colpositions[i]+e.colwidth[i]-3<=t&&e.colpositions[i]+e.colwidth[i]+3>=t){c.coltoresize=i;break}if((unhide=e.context.colunhideleft[n])&&(pos=Oe.GetElementPosition(unhide),t>=pos.left&&t<pos.left+unhide.offsetWidth&&o>=pos.top&&o<pos.top+unhide.offsetHeight&&(c.coltounhide=n+1)),(unhide=e.context.colunhideright[n])&&(pos=Oe.GetElementPosition(unhide),t>=pos.left&&t<pos.left+unhide.offsetWidth&&o>=pos.top&&o<pos.top+unhide.offsetHeight&&(c.coltounhide=n-1)),null==c.coltounhide){for(l=0;l<e.context.colpanes.length;l++)if(c.coltoresize>=e.context.colpanes[l].first&&c.coltoresize<=e.context.colpanes[l].last)return c;c.colselect=!0}return delete c.coltoresize,c}return t>=e.verticaltablecontrol.controlborder?(c.rowfooter=!0,c.distance=t-e.verticaltablecontrol.controlborder):o>=e.horizontaltablecontrol.controlborder?(c.colfooter=!0,c.distance=o-e.horizontaltablecontrol.controlborder):t<e.gridposition.left?(c.rowheader=!0,c.distance=e.headposition.left-t):o<=e.gridposition.top?(c.colheader=!0,c.distance=e.headposition.top-o):(c.coord=Oe.crToCoord(c.col,c.row),e.context.cellskip[c.coord]&&(c.coord=e.context.cellskip[c.coord])),c}return null},Oe.GetEditorCellElement=function(e,t,o){var r,a,n,l,s=0,i=0;if(0==e.context.showRCHeaders)s=-1,i=-1;var c=0,d=0;for(r=0;r<e.context.rowpanes.length;r++){if(t>=e.context.rowpanes[r].first&&t<=e.context.rowpanes[r].last)for(a=0;a<e.context.colpanes.length;a++){if(o>=e.context.colpanes[a].first&&o<=e.context.colpanes[a].last){for(c+=t-e.context.rowpanes[r].first+2,n=e.context.colpanes[a].first;n<=o;n++)(l=e.context.cellskip[Oe.crToCoord(n,t)])&&e.context.CoordInPane(l,r,a)||d++;return{element:e.griddiv.firstChild.lastChild.childNodes[c+i].childNodes[d+s],rowpane:r,colpane:a}}for(n=e.context.colpanes[a].first;n<=e.context.colpanes[a].last;n++)(l=e.context.cellskip[Oe.crToCoord(n,t)])&&e.context.CoordInPane(l,r,a)||d++;d+=1}c+=e.context.rowpanes[r].last-e.context.rowpanes[r].first+1+1}return null},Oe.MoveECellWithKey=function(e,t){var o,r,a,n,l=!1,s=1;if(!e.ecell)return null;switch("shifted"==t.slice(-7)&&(t=t.slice(0,-7),l=!0),r=e.ecell.row,a=e.ecell.col,n=e.context.sheetobj.cells[e.ecell.coord],t){case"[adown]":r+=n&&n.rowspan||1;break;case"[aup]":r--,s=-1;break;case"[pgdn]":r+=e.pageUpDnAmount-1+(n&&n.rowspan||1);break;case"[pgup]":r-=e.pageUpDnAmount,s=-1;break;case"[aright]":a+=n&&n.colspan||1;break;case"[aleft]":a--,s=-1;break;case"[home]":a=r=1;break;default:return null}for(e.context.sheetobj.attribs.usermaxcol&&(a=Math.min(e.context.sheetobj.attribs.usermaxcol,a)),e.context.sheetobj.attribs.usermaxrow&&(r=Math.min(e.context.sheetobj.attribs.usermaxrow,r));"yes"==e.context.sheetobj.colattribs.hide[Oe.rcColname(a)];)(a+=s)<1&&(s=-s,a=1);for(;"yes"==e.context.sheetobj.rowattribs.hide[r];)(r+=s)<1&&(s=-s,r=1);return e.range.hasrange||l&&e.RangeAnchor(),o=e.MoveECell(Oe.crToCoord(a,r)),e.range.hasrange&&(l?e.RangeExtend():e.RangeRemove()),o},Oe.MoveECell=function(e,t){var o,r,a=e.context.highlights,n=Oe.coordToCr(t);if(e.context.sheetobj.attribs.usermaxcol&&n.col>e.context.sheetobj.attribs.usermaxcol&&(n.col=e.context.sheetobj.attribs.usermaxcol),e.context.sheetobj.attribs.usermaxrow&&n.row>e.context.sheetobj.attribs.usermaxrow&&(n.row=e.context.sheetobj.attribs.usermaxrow),t=Oe.crToCoord(n.col,n.row),e.ecell){if(e.ecell.coord==t)return t;o=Oe.GetEditorCellElement(e,e.ecell.row,e.ecell.col),delete a[e.ecell.coord],e.range2.hasrange&&e.ecell.row>=e.range2.top&&e.ecell.row<=e.range2.bottom&&e.ecell.col>=e.range2.left&&e.ecell.col<=e.range2.right&&(a[e.ecell.coord]="range2"),e.UpdateCellCSS(o,e.ecell.row,e.ecell.col),e.SetECellHeaders(""),e.cellhandles&&e.cellhandles.ShowCellHandles(!1)}for(r in t=e.context.cellskip[t]||t,e.ecell=Oe.coordToCr(t),e.ecell.coord=t,o=Oe.GetEditorCellElement(e,e.ecell.row,e.ecell.col),a[t]="cursor",e.MoveECellCallback)e.MoveECellCallback[r](e);for(r in e.UpdateCellCSS(o,e.ecell.row,e.ecell.col),e.SetECellHeaders("selected"),e.StatusCallback)e.StatusCallback[r].func(e,"moveecell",t,e.StatusCallback[r].params);return e.busy?e.ensureecell=!0:(e.ensureecell=!1,e.EnsureECellVisible()),t},Oe.EnsureECellVisible=function(e){var t=0,o=0;e.ecell.row>e.lastnonscrollingrow&&(e.ecell.row<e.firstscrollingrow?t=e.ecell.row-e.firstscrollingrow-Math.floor((e.lastvisiblerow-e.firstscrollingrow)/2):e.ecell.row+1>e.lastvisiblerow&&(t=e.ecell.row-e.lastvisiblerow+Math.floor((e.lastvisiblerow-e.firstscrollingrow)/2))),e.ecell.col>e.lastnonscrollingcol&&(e.ecell.col<e.firstscrollingcol?o=e.ecell.col-e.firstscrollingcol-Math.floor((e.lastvisiblecol-e.firstscrollingcol)/2):e.ecell.col+1>e.lastvisiblecol&&(o=e.ecell.col-e.lastvisiblecol+Math.floor((e.lastvisiblecol-e.firstscrollingcol)/2))),0!=t||0!=o?e.ScrollRelativeBoth(t,o):e.cellhandles.ShowCellHandles(!0)},Oe.ReplaceCell=function(e,t,o,r){var a,n;if(t&&(a=e.context.RenderCell(o,r,t.rowpane,t.colpane,!0,null))&&t.element)for(n in t.element.innerHTML=a.innerHTML,t.element.style.cssText="",t.element.className=a.className,a.style)"cssText"!=a.style[n]&&(t.element.style[n]=a.style[n])},Oe.UpdateCellCSS=function(e,t,o,r){var a,n;if(t&&(a=e.context.RenderCell(o,r,t.rowpane,t.colpane,!0,null)))for(n in t.element.style.cssText="",t.element.className=a.className,a.style)"cssText"!=a.style[n]&&(t.element.style[n]=a.style[n])},Oe.SetECellHeaders=function(e,t){if(!1!==e.context.showRCHeaders){var o,r,a,n,l,s=e.ecell,i=e.context,c=0,d=0;if(s){for(;"yes"==i.sheetobj.colattribs.hide[Oe.rcColname(s.col)];)s.col++;for(;"yes"==i.sheetobj.rowattribs.hide[s.row];)s.row++;for(s.coord=Oe.crToCoord(s.col,s.row),o=0;o<i.rowpanes.length;o++){if(a=i.rowpanes[o].first,n=i.rowpanes[o].last,s.row>=a&&s.row<=n){var u=2+c+s.row-a;null!==e.fullgrid&&0<=u&&(l=e.fullgrid.childNodes[1].childNodes[u].childNodes[0])&&(i.classnames&&(l.className=i.classnames[t+"rowname"]),i.explicitStyles&&(l.style.cssText=i.explicitStyles[t+"rowname"]),l.style.verticalAlign="top")}c+=n-a+1+1}for(r=0;r<i.colpanes.length;r++){if(a=i.colpanes[r].first,n=i.colpanes[r].last,s.col>=a&&s.col<=n){u=1+d+s.col-a;null!==e.fullgrid&&0<=u&&(l=e.fullgrid.childNodes[1].childNodes[1].childNodes[u])&&(i.classnames&&(l.className=i.classnames[t+"colname"]),i.explicitStyles&&(l.style.cssText=i.explicitStyles[t+"colname"]))}d+=n-a+1+1}}}},Oe.ECellReadonly=function(e,t){if(!t&&e.ecell&&(t=e.ecell.coord),!t)return!1;var o=e.context.sheetobj.cells[t];return o&&o.readonly},Oe.RangeAnchor=function(e,t){e.range.hasrange&&e.RangeRemove(),e.RangeExtend(t)},Oe.RangeExtend=function(e,t){var o,r,a,n,l,s,i,c=e.context.highlights,d=e.range,u=e.range2;if(t?(i=Oe.coordToCr(t)).coord=t:i=e.ecell,i){for(a in d.hasrange||(d.anchorcoord=i.coord,d.anchorrow=i.row,d.top=i.row,d.bottom=i.row,d.anchorcol=i.col,d.left=i.col,d.right=i.col,d.hasrange=!0),d.anchorrow<i.row?(d.top=d.anchorrow,d.bottom=i.row):(d.top=i.row,d.bottom=d.anchorrow),d.anchorcol<i.col?(d.left=d.anchorcol,d.right=i.col):(d.left=i.col,d.right=d.anchorcol),c)switch(c[a]){case"range":c[a]="unrange";break;case"range2":c[a]="unrange2"}for(n=d.top;n<=d.bottom;n++)for(l=d.left;l<=d.right;l++)switch(c[a=Oe.crToCoord(l,n)]){case"unrange":c[a]="range";break;case"cursor":break;case"unrange2":default:c[a]="newrange"}for(n=u.top;u.hasrange&&n<=u.bottom;n++)for(l=u.left;l<=u.right;l++)switch(c[a=Oe.crToCoord(l,n)]){case"unrange2":c[a]="range2";break;case"range":case"newrange":case"cursor":break;default:c[a]="newrange2"}for(a in c){switch(c[a]){case"unrange":delete c[a];break;case"newrange":c[a]="range";break;case"newrange2":c[a]="range2";break;case"range":case"range2":case"cursor":continue}r=Oe.coordToCr(a),o=Oe.GetEditorCellElement(e,r.row,r.col),e.UpdateCellCSS(o,r.row,r.col)}for(s in e.RangeChangeCallback)e.RangeChangeCallback[s](e);for(s in a=Oe.crToCoord(e.range.left,e.range.top),e.range.left==e.range.right&&e.range.top==e.range.bottom||(a+=":"+Oe.crToCoord(e.range.right,e.range.bottom)),e.StatusCallback)e.StatusCallback[s].func(e,"rangechange",a,e.StatusCallback[s].params)}},Oe.RangeRemove=function(e){var t,o,r,a,n,l,s=e.context.highlights,i=e.range,c=e.range2;if(i.hasrange||c.hasrange){for(a=c.top;c.hasrange&&a<=c.bottom;a++)for(n=c.left;n<=c.right;n++)switch(s[r=Oe.crToCoord(n,a)]){case"range":s[r]="newrange2";break;case"range2":case"cursor":break;default:s[r]="newrange2"}for(r in s){switch(s[r]){case"range":delete s[r];break;case"newrange2":s[r]="range2";break;case"cursor":continue}o=Oe.coordToCr(r),t=Oe.GetEditorCellElement(e,o.row,o.col),e.UpdateCellCSS(t,o.row,o.col)}for(l in i.hasrange=!1,e.RangeChangeCallback)e.RangeChangeCallback[l](e);for(l in e.StatusCallback)e.StatusCallback[l].func(e,"rangechange","",e.StatusCallback[l].params)}},Oe.Range2Remove=function(e){var t,o,r,a=e.context.highlights,n=e.range2;if(n.hasrange){for(r in a){switch(a[r]){case"range2":delete a[r];break;case"range":case"cursor":continue}o=Oe.coordToCr(r),t=Oe.GetEditorCellElement(e,o.row,o.col),e.UpdateCellCSS(t,o.row,o.col)}n.hasrange=!1}},Oe.FitToEditTable=function(e){var t,o,r,a,n,l,s,i,c=e.context,d=c.sheetobj;d.colattribs;for(a=c.showRCHeaders?c.rownamewidth-0:0,colpane=0;colpane<c.colpanes.length-1;colpane++)for(t=c.colpanes[colpane].first;t<=c.colpanes[colpane].last;t++)o=Oe.rcColname(t),"yes"!=d.colattribs.hide[o]&&("blank"!=(r=d.colattribs.width[o]||d.attribs.defaultcolwidth||Oe.Constants.defaultColWidth)&&"auto"!=r||(r=""),a+=r&&0<r-0?r-0:10);for(t=c.colpanes[colpane].first;t<=1e4&&(o=Oe.rcColname(t),"yes"!=d.colattribs.hide[o]&&("blank"!=(r=d.colattribs.width[o]||d.attribs.defaultcolwidth||Oe.Constants.defaultColWidth)&&"auto"!=r||(r=""),a+=r&&0<r-0?r-0:10),!(a>e.tablewidth));t++);c.colpanes[colpane].last=c.sheetobj.attribs.usermaxcol||t;for(var u=c.rowpanes[0].first,p=c.sheetobj.attribs.lastrow;"yes"==d.rowattribs.hide[u]&&u<p;)u++;for(c.rowpanes[0].first=u,n=c.showRCHeaders?1:0,s=0;s<c.rowpanes.length-1;s++)for(n+=c.rowpanes[s].last-c.rowpanes[s].first+1,l=c.rowpanes[s].first;l<=c.rowpanes[s].last;l++)"yes"==d.rowattribs.hide[l]&&n--;i=e.tableheight-n*c.pixelsPerRow,c.rowpanes[s].last=c.sheetobj.attribs.usermaxrow||c.rowpanes[s].first+Math.floor(i/c.pixelsPerRow)+1},Oe.CalculateEditorPositions=function(e){var t,o,r;e.gridposition=Oe.GetElementPosition(e.griddiv);var a=e.griddiv.firstChild.lastChild.childNodes[1].childNodes[0];for(e.headposition=Oe.GetElementPosition(a),e.headposition.left+=a.offsetWidth,e.headposition.top+=a.offsetHeight,e.rowpositions=[],t=0;t<e.context.rowpanes.length;t++)e.CalculateRowPositions(t,e.rowpositions,e.rowheight);for(r=0;r<e.rowpositions.length&&!(e.rowpositions[r]>e.gridposition.top+e.tableheight);r++);for(e.lastvisiblerow=r-1,e.colpositions=[],o=0;o<e.context.colpanes.length;o++)e.CalculateColPositions(o,e.colpositions,e.colwidth);for(r=0;r<e.colpositions.length&&!(e.colpositions[r]>e.gridposition.left+e.tablewidth);r++);for(e.lastvisiblecol=r-1,e.firstscrollingrow=e.context.rowpanes[e.context.rowpanes.length-1].first;"yes"==e.context.sheetobj.rowattribs.hide[e.firstscrollingrow];)e.firstscrollingrow++;for(e.firstscrollingrowtop=e.rowpositions[e.firstscrollingrow]||e.headposition.top,e.lastnonscrollingrow=0<e.context.rowpanes.length-1?e.context.rowpanes[e.context.rowpanes.length-2].last:0,e.firstscrollingcol=e.context.colpanes[e.context.colpanes.length-1].first;"yes"==e.context.sheetobj.colattribs.hide[Oe.rcColname(e.firstscrollingcol)];)e.firstscrollingcol++;e.firstscrollingcolleft=e.colpositions[e.firstscrollingcol]||e.headposition.left,e.lastnonscrollingcol=0<e.context.colpanes.length-1?e.context.colpanes[e.context.colpanes.length-2].last:0,e.verticaltablecontrol.ComputeTableControlPositions(),e.horizontaltablecontrol.ComputeTableControlPositions()},Oe.ScheduleRender=function(e){1!=e.ignoreRender&&(e.timeout&&U.clearTimeout(e.timeout),Oe.EditorSheetStatusCallback(null,"schedrender",null,e),e.timeout=U.setTimeout(function(){Oe.DoRenderStep(e)},1))},Oe.DoRenderStep=function(e){e.timeout=null,e.EditorRenderSheet(),Oe.EditorSheetStatusCallback(null,"renderdone",null,e),Oe.EditorSheetStatusCallback(null,"schedposcalc",null,e),e.timeout=U.setTimeout(function(){Oe.DoPositionCalculations(e)},1)},Oe.SchedulePositionCalculations=function(e){Oe.EditorSheetStatusCallback(null,"schedposcalc",null,e),e.timeout=U.setTimeout(function(){Oe.DoPositionCalculations(e)},1)},Oe.DoPositionCalculations=function(e){e.timeout=null,e.CalculateEditorPositions(),e.verticaltablecontrol.PositionTableControlElements(),e.horizontaltablecontrol.PositionTableControlElements(),Oe.EditorSheetStatusCallback(null,"doneposcalc",null,e),e.ensureecell&&e.ecell&&!e.deferredCommands.length&&(e.ensureecell=!1,e.EnsureECellVisible()),e.cellhandles.ShowCellHandles(!0)},Oe.CalculateRowPositions=function(e,t,o,r){var a,n,l,s,i,c,d=e.context;d.sheetobj;if(d.showRCHeaders){for(c=e.fullgrid.lastChild,a=2,n=0;n<t;n++)a+=d.rowpanes[n].last-d.rowpanes[n].first+2;for(s=0,l=d.rowpanes[n].first;l<=d.rowpanes[n].last;l++)i=c.childNodes[a+s],s++,i&&(o[l]||(o[l]=i.firstChild.offsetTop,r[l]=i.firstChild.offsetHeight))}},Oe.CalculateColPositions=function(e,t,o,r){var a,n,l,s,i,c,d,u=e.context;u.sheetobj;if(u.showRCHeaders){for(d=e.fullgrid.lastChild,a=1,n=0;n<t;n++)a+=u.colpanes[n].last-u.colpanes[n].first+2;for(i=d.childNodes[1],s=0,l=u.colpanes[n].first;l<=u.colpanes[n].last;l++)c=Oe.GetElementPosition(i.childNodes[a+s]),o[l]||(o[l]=c.left,i.childNodes[a+s]&&(r[l]=i.childNodes[a+s].offsetWidth)),s++}},Oe.ScrollRelative=function(e,t,o){t?e.ScrollRelativeBoth(o,0):e.ScrollRelativeBoth(0,o)},Oe.ScrollRelativeBoth=function(e,t,o){var r=e.context,a=0<t?1:-1,n=0<o?1:-1,l=r.rowpanes.length,s=1<l?r.rowpanes[l-2].last+1:1;r.rowpanes[l-1].first+t<s&&(t=-r.rowpanes[l-1].first+s);var i=r.colpanes.length,c=1<i?r.colpanes[i-2].last+1:1;for(r.colpanes[i-1].first+o<c&&(o=-r.colpanes[i-1].first+c);"yes"==r.sheetobj.colattribs.hide[Oe.rcColname(r.colpanes[i-1].first+o)];)if((o+=n)<1){o=0;break}for(;"yes"==r.sheetobj.rowattribs.hide[r.rowpanes[l-1].first+t];)if((t+=a)<1){t=0;break}if((1==t||-1==t)&&0==o)return 1==t?e.ScrollTableUpOneRow():e.ScrollTableDownOneRow(),e.ecell&&e.SetECellHeaders("selected"),void e.SchedulePositionCalculations();0==t&&0==o||(r.rowpanes[l-1].first+=t,r.rowpanes[l-1].last+=t,r.colpanes[i-1].first+=o,r.colpanes[i-1].last+=o,e.LimitLastPanes(),e.FitToEditTable(),e.ScheduleRender())},Oe.PageRelative=function(e,t,o){var r,a,n,l,s=e.context,i=t?"rowpanes":"colpanes",c=s[i][s[i].length-1],d=t?"lastvisiblerow":"lastvisiblecol",u=t?e.rowheight:e.colwidth,p=t?Oe.Constants.defaultAssumedRowHeight:Oe.Constants.defaultColWidth;if(0<o)(a=e[d])==c.first&&(a+=1);else{for(n=t?e.tableheight-(e.firstscrollingrowtop-e.gridposition.top):e.tablewidth-(e.firstscrollingcolleft-e.gridposition.left),n-=0<u[e[d]]?u[e[d]]:p,a=c.first-1;0<a&&!(n<(r=0<u[a]?u[a]:p));a--)n-=r;(l=c.first)<=a&&(a=l-1),a<1&&(a=1)}c.first=a,c.last=a+1,e.LimitLastPanes(),e.FitToEditTable(),e.ScheduleRender()},Oe.LimitLastPanes=function(e){var t,o=e.context;1<(t=o.rowpanes.length)&&o.rowpanes[t-1].first<=o.rowpanes[t-2].last&&(o.rowpanes[t-1].first=o.rowpanes[t-2].last+1),o.sheetobj.attribs.usermaxrow&&o.rowpanes[t-1].first>o.sheetobj.attribs.usermaxrow&&(o.rowpanes[t-1].first=o.sheetobj.attribs.usermaxrow),1<(t=o.colpanes.length)&&o.colpanes[t-1].first<=o.colpanes[t-2].last&&(o.colpanes[t-1].first=o.colpanes[t-2].last+1),o.sheetobj.attribs.usermaxcol&&o.colpanes[t-1].first>o.sheetobj.attribs.usermaxcol&&(o.colpanes[t-1].first=o.sheetobj.attribs.usermaxcol)},Oe.ScrollTableUpOneRow=function(e){var t,o,r,a,n,l,s,i,c,d,u,p,h={},m=e.context,f=m.sheetobj,g=e.fullgrid;for(p=g.lastChild,t=m.showRCHeaders?2:1,o=0;o<m.rowpanes.length-1;o++)t+=m.rowpanes[o].last-m.rowpanes[o].first+2;if(m.sheetobj.attribs.usermaxrow&&m.sheetobj.attribs.usermaxrow-m.rowpanes[o].first<1)return g;for(p.removeChild(p.childNodes[t]),m.rowpanes[o].first++,m.rowpanes[o].last++,e.FitToEditTable(),m.CalculateColWidthData(),m.sheetobj.attribs.usermaxrow&&m.rowpanes[o].last==m.sheetobj.attribs.usermaxrow||(i=m.RenderRow(m.rowpanes[o].last,o),p.appendChild(i)),maxrowspan=1,s=m.rowpanes[o].first-1,n=0;n<m.colpanes.length;n++)for(a=m.colpanes[n].first;a<=m.colpanes[n].last;a++)coord=Oe.crToCoord(a,s),m.cellskip[coord]||(l=f.cells[coord])&&l.rowspan>maxrowspan&&(maxrowspan=l.rowspan);if(1<maxrowspan)for(r=1;r<maxrowspan&&!(r+s>=m.rowpanes[o].last);r++)c=m.RenderRow(r+s,o),d=p.childNodes[t+r-1],p.replaceChild(c,d);for(u=m.rowpanes[o].last,n=0;n<m.colpanes.length;n++)for(a=m.colpanes[n].first;a<=m.colpanes[n].last;a++)coord=m.cellskip[Oe.crToCoord(a,u)],coord&&((r=m.coordToCR[coord].row-0)==m.rowpanes[o].last||r<m.rowpanes[o].first||(l=f.cells[coord])&&1<l.rowspan&&(h[r]=!0));for(r in h)c=m.RenderRow(r,o),d=p.childNodes[t+(r-m.rowpanes[o].first)],p.replaceChild(c,d);return g},Oe.ScrollTableDownOneRow=function(e){var t,o,r,a,n,l,s,i,c,d,u,p={},h=e.context,m=h.sheetobj,f=e.fullgrid;for(u=f.lastChild,t=h.showRCHeaders?2:1,o=0;o<h.rowpanes.length-1;o++)t+=h.rowpanes[o].last-h.rowpanes[o].first+2;for(h.sheetobj.attribs.usermaxrow||u.removeChild(u.childNodes[t+(h.rowpanes[o].last-h.rowpanes[o].first)]),h.rowpanes[o].first--,h.rowpanes[o].last--,e.FitToEditTable(),h.CalculateColWidthData(),i=h.RenderRow(h.rowpanes[o].first,o),u.insertBefore(i,u.childNodes[t]),maxrowspan=1,s=h.rowpanes[o].first,n=0;n<h.colpanes.length;n++)for(a=h.colpanes[n].first;a<=h.colpanes[n].last;a++)coord=Oe.crToCoord(a,s),h.cellskip[coord]||(l=m.cells[coord])&&l.rowspan>maxrowspan&&(maxrowspan=l.rowspan);if(1<maxrowspan)for(r=1;r<maxrowspan&&!(r+s>h.rowpanes[o].last);r++)i=h.RenderRow(r+s,o),c=u.childNodes[t+r],u.replaceChild(i,c);for(d=h.rowpanes[o].last,n=0;n<h.colpanes.length;n++)for(a=h.colpanes[n].first;a<=h.colpanes[n].last;a++)coord=Oe.crToCoord(a,d),(l=m.cells[coord])&&1<l.rowspan?p[d]=!0:(coord=h.cellskip[Oe.crToCoord(a,d)],coord&&((r=h.coordToCR[coord].row-0)==d||r<h.rowpanes[o].first||(l=m.cells[coord])&&1<l.rowspan&&(p[r]=!0)));for(r in p)i=h.RenderRow(r,o),c=u.childNodes[t+(r-h.rowpanes[o].first)],u.replaceChild(i,c);return f},Oe.InputBox=function(e,t){e&&(this.element=e,this.editor=t,this.inputEcho=null,t.inputBox=this,e.onmousedown=Oe.InputBoxOnMouseDown,t.MoveECellCallback.formulabar=function(e){"start"==e.state&&t.inputBox.DisplayCellContents(e.ecell.coord)})},Oe.InputBox.prototype.DisplayCellContents=function(e){Oe.InputBoxDisplayCellContents(this,e)},Oe.InputBox.prototype.ShowInputBox=function(e){this.editor.inputEcho.ShowInputEcho(e)},Oe.InputBox.prototype.GetText=function(){return this.element.value},Oe.InputBox.prototype.SetText=function(e){this.element&&(this.element.value=e,this.editor.inputEcho.SetText(e+"_"))},Oe.InputBox.prototype.Focus=function(){Oe.InputBoxFocus(this)},Oe.InputBox.prototype.Blur=function(){return this.element.blur()},Oe.InputBox.prototype.Select=function(e){if(this.element)switch(e){case"end":if(document.selection&&document.selection.createRange)try{var t=document.selection.createRange().duplicate();t.moveToElementText(this.element),t.collapse(!1),t.select()}catch(e){null!=this.element.selectionStart&&(this.element.selectionStart=this.element.value.length,this.element.selectionEnd=this.element.value.length)}else null!=this.element.selectionStart&&(this.element.selectionStart=this.element.value.length,this.element.selectionEnd=this.element.value.length)}},Oe.InputBoxDisplayCellContents=function(e,t){var o=Oe.Constants;if(e){if(!t){if(!e.editor)return;if(!e.editor.ecell)return;t=e.editor.ecell.coord}var r=Oe.GetCellContents(e.editor.context.sheetobj,t);-1!=r.indexOf("\n")?(r=o.s_inputboxdisplaymultilinetext,e.element.disabled=!0):e.editor.ECellReadonly()?e.element.disabled=!0:e.element.disabled=!1,e.SetText(r)}},Oe.InputBoxFocus=function(e){if(e){e.element.focus();var t=e.editor;t.state="input";var o=t.workingvalues;o.partialexpr="",o.ecoord=t.ecell.coord,o.erow=t.ecell.row,o.ecol=t.ecell.col}},Oe.InputBoxOnMouseDown=function(e){var t=Oe.Keyboard.focusTable;if(!t)return!0;var o=t.workingvalues;switch(t.state){case"start":t.state="inputboxdirect",o.partialexpr="",o.ecoord=t.ecell.coord,o.erow=t.ecell.row,o.ecol=t.ecell.col,t.inputEcho.ShowInputEcho(!0);break;case"input":o.partialexpr="",t.MoveECell(o.ecoord),t.state="inputboxdirect",Oe.KeyboardFocus()}},Oe.InputEcho=function(e){var t=Oe.Constants;this.editor=e,this.text="",this.interval=null,this.container=null,this.main=null,this.prompt=null,this.hint=null,this.functionbox=null,this.container=document.createElement("div"),Oe.setStyles(this.container,"display:none;position:absolute;zIndex:10;"),this.main=document.createElement("div"),t.defaultInputEchoClass&&(this.main.className=t.defaultInputEchoClass),t.defaultInputEchoStyle&&Oe.setStyles(this.main,t.defaultInputEchoStyle),this.main.innerHTML="&nbsp;",this.hint=document.createElement("div"),t.defaultInputEchoHintClass&&(this.hint.className=t.defaultInputEchoHintClass),t.defaultInputEchoHintStyle&&Oe.setStyles(this.hint,t.defaultInputEchoHintStyle),this.hint.innerHTML="",this.container.appendChild(this.hint),this.container.appendChild(this.main),this.prompt=document.createElement("div"),t.defaultInputEchoPromptClass&&(this.prompt.className=t.defaultInputEchoPromptClass),t.defaultInputEchoPromptStyle&&Oe.setStyles(this.prompt,t.defaultInputEchoPromptStyle),this.prompt.innerHTML="",this.container.appendChild(this.prompt),Oe.DragRegister(this.main,!0,!0,{MouseDown:Oe.DragFunctionStart,MouseMove:Oe.DragFunctionPosition,MouseUp:Oe.DragFunctionPosition,Disabled:null,positionobj:this.container},this.editor.toplevel),e.toplevel.appendChild(this.container)},Oe.InputEcho.prototype.ShowInputEcho=function(e){return Oe.ShowInputEcho(this,e)},Oe.InputEcho.prototype.SetText=function(e){return Oe.SetInputEchoText(this,e)},Oe.ShowInputEcho=function(e,t){var o,r,a=e.editor;a&&(t?(a.cellhandles.ShowCellHandles(!1),(o=Oe.GetEditorCellElement(a,a.ecell.row,a.ecell.col))&&(r=Oe.GetElementPosition(o.element),e.container.style.left=r.left-1+"px",e.container.style.top=r.top-1+"px"),e.hint.innerHTML=a.ecell.coord,e.container.style.display="block",e.interval&&U.clearInterval(e.interval),e.interval=U.setInterval(Oe.InputEchoHeartbeat,50)):(e.interval&&U.clearInterval(e.interval),e.container.style.display="none"))},Oe.SetInputEchoText=function(e,t){var o,r,a=Oe.Constants,n=Oe.special_chars(t);n=n.replace(/\n/g,"<br>"),e.text!=n&&(e.main.innerHTML=n,e.text=n);var l=t.match(/.*[\+\-\*\/\&\^\<\>\=\,\(]([A-Za-z][A-Za-z][\w\.]*?)\([^\)]*$/);"="==t.charAt(0)&&l?(o=l[1].toUpperCase(),r=Oe.Formula.FunctionList[o]?(Oe.Formula.FillFunctionInfo(),Oe.special_chars(o+"("+Oe.Formula.FunctionArgString(o)+")")):a.ietUnknownFunction+o,e.prompt.innerHTML!=r&&(e.prompt.innerHTML=r,e.prompt.style.display="block")):"none"!=e.prompt.style.display&&(e.prompt.innerHTML="",e.prompt.style.display="none")},Oe.InputEchoHeartbeat=function(){var e=Oe.Keyboard.focusTable;if(!e)return!0;e.inputEcho.SetText(e.inputBox.GetText()+"_")},Oe.InputEchoMouseDown=function(e){e||U.event;var t=Oe.Keyboard.focusTable;if(!t)return!0;t.inputBox.element.focus()},Oe.CellHandles=function(e){Oe.Constants;if(!e.noEdit){this.editor=e,this.noCursorSuffix=!1,this.movedmouse=!1,this.draghandle=document.createElement("div"),Oe.setStyles(this.draghandle,"display:none;position:absolute;zIndex:8;border:1px solid white;width:4px;height:4px;fontSize:1px;backgroundColor:#0E93D8;cursor:default;"),this.draghandle.innerHTML="&nbsp;",e.toplevel.appendChild(this.draghandle),Oe.AssignID(e,this.draghandle,"draghandle");var t="png";if(navigator.userAgent.match(/MSIE 6\.0/)&&(t="gif"),this.dragpalette=document.createElement("div"),Oe.setStyles(this.dragpalette,"display:none;position:absolute;zIndex:8;width:90px;height:90px;fontSize:1px;textAlign:center;cursor:default;backgroundImage:url("+Oe.Constants.defaultImagePrefix+"drag-handles."+t+");"),this.dragpalette.innerHTML="&nbsp;",e.toplevel.appendChild(this.dragpalette),Oe.AssignID(e,this.dragpalette,"dragpalette"),this.dragtooltip=document.createElement("div"),Oe.setStyles(this.dragtooltip,"display:none;position:absolute;zIndex:9;border:1px solid black;width:100px;height:auto;fontSize:10px;backgroundColor:#FFFFFF;"),this.dragtooltip.innerHTML="&nbsp;",e.toplevel.appendChild(this.dragtooltip),Oe.AssignID(e,this.dragtooltip,"dragtooltip"),this.fillinghandle=document.createElement("div"),Oe.setStyles(this.fillinghandle,"display:none;position:absolute;zIndex:9;border:1px solid black;width:auto;height:14px;fontSize:10px;backgroundColor:#FFFFFF;"),this.fillinghandle.innerHTML="&nbsp;",e.toplevel.appendChild(this.fillinghandle),Oe.AssignID(e,this.fillinghandle,"fillinghandle"),this.draghandle.addEventListener)this.draghandle.addEventListener("mousemove",Oe.CellHandlesMouseMoveOnHandle,!1),this.dragpalette.addEventListener("mousedown",Oe.CellHandlesMouseDown,!1),this.dragpalette.addEventListener("mousemove",Oe.CellHandlesMouseMoveOnHandle,!1);else{if(!this.draghandle.attachEvent)throw"Browser not supported";this.draghandle.attachEvent("onmousemove",Oe.CellHandlesMouseMoveOnHandle),this.dragpalette.attachEvent("onmousedown",Oe.CellHandlesMouseDown),this.dragpalette.attachEvent("onmousemove",Oe.CellHandlesMouseMoveOnHandle)}}},Oe.CellHandles.prototype.ShowCellHandles=function(e,t){return Oe.ShowCellHandles(this,e,t)},Oe.ShowCellHandles=function(e,t,o){var r,a,n,l=e.editor,s=!1,i=1,c=1;if(l&&l.ecell){do{if(!t)break;if(a=l.ecell.row,n=l.ecell.col,"start"!=l.state)break;if(a>=l.lastvisiblerow)break;if(n>=l.lastvisiblecol)break;if(a<l.firstscrollingrow)break;if(n<l.firstscrollingcol)break;for(;"yes"==l.context.sheetobj.colattribs.hide[Oe.rcColname(n+i)];)i++;for(;"yes"==l.context.sheetobj.rowattribs.hide[a+c];)c++;if(void 0!==(r=l.context.sheetobj.cells[Oe.crToCoord(n+i-1,a+c-1)])&&(i+=(r.colspan||1)-1,c+=(r.rowspan||1)-1),l.rowpositions[a+c]+20>l.horizontaltablecontrol.controlborder)break;if(l.rowpositions[a+c]-10<l.headposition.top)break;if(l.colpositions[n+i]+20>l.verticaltablecontrol.controlborder)break;if(l.colpositions[n+i]-30<l.headposition.left)break;e.draghandle.style.left=l.colpositions[n+i]-1+"px",e.draghandle.style.top=l.rowpositions[a+c]-1+"px",e.draghandle.style.display="block",o&&(e.draghandle.style.display="none",e.dragpalette.style.left=l.colpositions[n+i]-45+"px",e.dragpalette.style.top=l.rowpositions[a+c]-45+"px",e.dragpalette.style.display="block",e.dragtooltip.style.left=l.colpositions[n+i]-45+"px",e.dragtooltip.style.top=l.rowpositions[a+c]+45+"px",e.dragtooltip.style.display="none"),s=!0}while(0);s||(e.draghandle.style.display="none"),o||(e.dragpalette.style.display="none",e.dragtooltip.style.display="none")}},Oe.CellHandlesMouseMoveOnHandle=function(e){var t=Oe.Constants,o=e||U.event,r=o.target||o.srcElement,a=Oe.Keyboard.focusTable;if(!a)return!0;var n=a.cellhandles;if(!n.editor)return!0;var l=Oe.GetElementPositionWithScroll(a.toplevel),s=o.clientX-l.left,i=o.clientY-l.top;if(!a.cellhandles.mouseDown){if(a.cellhandles.ShowCellHandles(!0,!0),r==n.dragpalette)if(0==Oe.SegmentDivHit([t.CH_radius1,t.CH_radius2],a.cellhandles.dragpalette,s,i))return void Oe.CellHandlesHoverTimeout();n.timer&&(U.clearTimeout(n.timer),n.timer=null),n.timer=U.setTimeout(Oe.CellHandlesHoverTimeout,3e3)}},Oe.SegmentDivHit=function(e,t,o,r){var a=t.offsetWidth,n=t.offsetHeight,l=t.offsetLeft,s=t.offsetTop,i=0,c=e,d=Math.sqrt(Math.pow(o-l-(a/2-.5),2)+Math.pow(r-s-(n/2-.5),2));if(2==c.length)return l<=o&&o<l+a/2&&s<=r&&r<s+n/2&&(d<=e[0]?i=-1:d<=e[1]&&(i=1)),l+a/2<=o&&o<l+a&&s<=r&&r<s+n/2&&(d<=e[0]?i=-2:d<=e[1]&&(i=2)),l+a/2<=o&&o<l+a&&s+n/2<=r&&r<s+n&&(d<=e[0]?i=-3:d<=e[1]&&(i=3)),l<=o&&o<l+a/2&&s+n/2<=r&&r<s+n&&(d<=e[0]?i=-4:d<=e[1]&&(i=4)),i;for(;;)if(l<=o&&o<l+a/2&&s<=r&&r<s+n/2){if(quadrant+="1","number"==typeof(i=c[0]))break;c=i,a/=2,n/=2}else if(l+a/2<=o&&o<l+a&&s<=r&&r<s+n/2){if(quadrant+="2","number"==typeof(i=c[1]))break;c=i,l+=a/=2,n/=2}else if(l+a/2<=o&&o<l+a&&s+n/2<=r&&r<s+n){if(quadrant+="3","number"==typeof(i=c[2]))break;c=i,l+=a/=2,s+=n/=2}else{if(!(l<=o&&o<l+a/2&&s+n/2<=r&&r<s+n))return 0;if(quadrant+="4","number"==typeof(i=c[3]))break;c=i,a/=2,s+=n/=2}return i},Oe.CellHandlesHoverTimeout=function(){if(editor=Oe.Keyboard.focusTable,!editor)return!0;var e=editor.cellhandles;e.timer&&(U.clearTimeout(e.timer),e.timer=null),editor.cellhandles.ShowCellHandles(!0,!1)},Oe.CellHandlesMouseDown=function(e){var t,o,r,a=Oe.Constants,n=e||U.event,l=Oe.EditorMouseInfo;if(!(t=Oe.Keyboard.focusTable))return!0;if(!t.busy){var s=t.cellhandles;s.movedmouse=!1;var i=Oe.GetElementPositionWithScroll(t.toplevel),c=n.clientX-i.left,d=n.clientY-i.top;s.timer&&(U.clearTimeout(s.timer),s.timer=null),s.dragtooltip.innerHTML="&nbsp;",s.dragtooltip.style.display="none",r=t.range;var u=Oe.SegmentDivHit([a.CH_radius1,a.CH_radius2],t.cellhandles.dragpalette,c,d);if(1!=u&&-1!=u&&0!=u){switch(l.ignore=!0,-3==u?(s.dragtype="Fill",s.noCursorSuffix=!1):3==u?(s.dragtype="FillC",s.noCursorSuffix=!1):-2==u?(s.dragtype="Move",s.noCursorSuffix=!0):-4==u?(s.dragtype="MoveI",s.noCursorSuffix=!1):2==u?(s.dragtype="MoveC",s.noCursorSuffix=!0):4==u&&(s.dragtype="MoveIC",s.noCursorSuffix=!1),s.filltype=null,s.dragtype){case"Fill":case"FillC":r.hasrange||t.RangeAnchor(),t.range2.top=t.range.top,t.range2.right=t.range.right,t.range2.bottom=t.range.bottom,t.range2.left=t.range.left,t.range2.hasrange=!0;break;case"Move":case"MoveI":case"MoveC":case"MoveIC":r.hasrange||t.RangeAnchor(),t.range2.top=t.range.top,t.range2.right=t.range.right,t.range2.bottom=t.range.bottom,t.range2.left=t.range.left,t.range2.hasrange=!0,t.RangeRemove();break;default:return}s.fillinghandle.style.left=c+"px",s.fillinghandle.style.top=d-17+"px",s.fillinghandle.innerHTML=a.s_CHindicatorOperationLookup[s.dragtype]+(a.s_CHindicatorDirectionLookup[t.cellhandles.filltype]||""),s.fillinghandle.style.display="block",s.ShowCellHandles(!0,!1),s.mouseDown=!0,o=(l.editor=t).ecell.coord,s.startingcoord=o,s.startingX=c,s.startingY=d,l.mouselastcoord=o,Oe.KeyboardSetFocus(t),document.addEventListener?(document.addEventListener("mousemove",Oe.CellHandlesMouseMove,!0),document.addEventListener("mouseup",Oe.CellHandlesMouseUp,!0)):s.draghandle.attachEvent&&(s.draghandle.setCapture(),s.draghandle.attachEvent("onmousemove",Oe.CellHandlesMouseMove),s.draghandle.attachEvent("onmouseup",Oe.CellHandlesMouseUp),s.draghandle.attachEvent("onlosecapture",Oe.CellHandlesMouseUp)),Oe.StopPropagation(n)}else s.ShowCellHandles(!0,!1)}},Oe.CellHandlesMouseMove=function(e){var t,o,r,a,n,l,s=Oe.Constants,i=e||U.event,c=Oe.EditorMouseInfo;if(t=c.editor){var d=t.cellhandles;c.element;var u=Oe.GetElementPositionWithScroll(t.toplevel),p=i.clientX-u.left,h=i.clientY-u.top;if(o=Oe.GridMousePosition(t,p,h))if(!o||o.coord){if(Oe.SetDragAutoRepeat(t,null),o.coord){switch(r=Oe.coordToCr(t.cellhandles.startingcoord),a=Oe.coordToCr(o.coord),d.movedmouse=!0,d.dragtype){case"Fill":case"FillC":o.coord==d.startingcoord?(d.filltype=null,d.startingX=p,d.startingY=h):d.filltype?"Down"==d.filltype?(a.col=r.col,a.row<r.row&&(a.row=r.row)):(a.row=r.row,a.col<r.col&&(a.col=r.col)):(10<Math.abs(h-d.startingY)?d.filltype="Down":10<Math.abs(p-d.startingX)&&(d.filltype="Right"),a.col=r.col,a.row=r.row),o.coord=Oe.crToCoord(a.col,a.row),o.coord!=c.mouselastcoord&&(t.MoveECell(o.coord),t.RangeExtend());break;case"Move":case"MoveC":o.coord!=c.mouselastcoord&&(t.MoveECell(o.coord),n=t.range2.right-t.range2.left+o.col,l=t.range2.bottom-t.range2.top+o.row,t.RangeAnchor(Oe.crToCoord(n,l)),t.RangeExtend());break;case"MoveI":case"MoveIC":o.coord==d.startingcoord?(d.filltype=null,d.startingX=p,d.startingY=h):d.filltype?"Vertical"==d.filltype?(a.col=t.range2.left,a.row>=t.range2.top&&a.row<=t.range2.bottom+1&&(a.row=t.range2.bottom+2)):(a.row=t.range2.top,a.col>=t.range2.left&&a.col<=t.range2.right+1&&(a.col=t.range2.right+2)):(10<Math.abs(h-d.startingY)?d.filltype="Vertical":10<Math.abs(p-d.startingX)&&(d.filltype="Horizontal"),a.col=r.col,a.row=r.row),o.coord=Oe.crToCoord(a.col,a.row),o.coord!=c.mouselastcoord&&(t.MoveECell(o.coord),d.filltype?(n=t.range2.right-t.range2.left+a.col,l=t.range2.bottom-t.range2.top+a.row,t.RangeAnchor(Oe.crToCoord(n,l)),t.RangeExtend()):t.RangeRemove())}d.fillinghandle.style.left=p+"px",d.fillinghandle.style.top=h-17+"px",d.fillinghandle.innerHTML=s.s_CHindicatorOperationLookup[d.dragtype]+(s.s_CHindicatorDirectionLookup[t.cellhandles.filltype]||""),d.fillinghandle.style.display="block",c.mouselastcoord=o.coord,Oe.StopPropagation(i)}}else Oe.SetDragAutoRepeat(t,o,Oe.CellHandlesDragAutoRepeat)}},Oe.CellHandlesDragAutoRepeat=function(e,t){var o=Oe.EditorMouseInfo,r=o.editor;if(r){var a,n,l,s=r.cellhandles,i=Oe.coordToCr(r.cellhandles.startingcoord),c=Oe.coordToCr(e),d=0,u=0;switch("left"==t?u=-1:"right"==t?u=1:"up"==t?d=-1:"down"==t&&(d=1),r.ScrollRelativeBoth(d,u),s.dragtype){case"Fill":case"FillC":s.filltype?"Down"==s.filltype?(c.col=i.col,c.row<i.row&&(c.row=i.row)):(c.row=i.row,c.col<i.col&&(c.col=i.col)):(c.col=i.col,c.row=i.row),(a=Oe.crToCoord(c.col,c.row))!=o.mouselastcoord&&(r.MoveECell(e),r.RangeExtend());break;case"Move":case"MoveC":e!=o.mouselastcoord&&(r.MoveECell(e),n=r.range2.right-r.range2.left+r.ecell.col,l=r.range2.bottom-r.range2.top+r.ecell.row,r.RangeAnchor(Oe.crToCoord(n,l)),r.RangeExtend());break;case"MoveI":case"MoveIC":s.filltype?"Vertical"==s.filltype?(c.col=r.range2.left,c.row>=r.range2.top&&c.row<=r.range2.bottom+1&&(c.row=r.range2.bottom+2)):(c.row=r.range2.top,c.col>=r.range2.left&&c.col<=r.range2.right+1&&(c.col=r.range2.right+2)):(c.col=i.col,c.row=i.row),(a=Oe.crToCoord(c.col,c.row))!=o.mouselastcoord&&(r.MoveECell(a),n=r.range2.right-r.range2.left+c.col,l=r.range2.bottom-r.range2.top+c.row,r.RangeAnchor(Oe.crToCoord(n,l)),r.RangeExtend())}o.mouselastcoord=a}},Oe.CellHandlesMouseUp=function(e){var t,o,r,a,n,l,s,i,c,d,u=e||U.event,p=Oe.EditorMouseInfo;if(t=p.editor){var h=t.cellhandles;p.element,p.ignore=!1;var m=Oe.GetElementPositionWithScroll(t.toplevel),f=u.clientX-m.left,g=u.clientY-m.top;switch(o=Oe.GridMousePosition(t,f,g),Oe.SetDragAutoRepeat(t,null),h.mouseDown=!1,h.noCursorSuffix=!1,h.fillinghandle.style.display="none",o||(o={}),o.coord||(o.coord=t.ecell.coord),h.dragtype){case"Fill":case"Move":case"MoveI":a=" all";break;case"FillC":case"MoveC":case"MoveIC":a=" formulas"}switch(h.movedmouse||(h.dragtype="Nothing"),h.dragtype){case"Nothing":t.Range2Remove(),t.RangeRemove();break;case"Fill":case"FillC":n=Oe.coordToCr(h.startingcoord),l=Oe.coordToCr(o.coord),h.filltype&&("Down"==h.filltype?l.col=n.col:l.row=n.row),o.coord=Oe.crToCoord(l.col,l.row),t.MoveECell(o.coord),t.RangeExtend(),r="fill"+("Right"==t.cellhandles.filltype?"right":"down")+" "+Oe.crToCoord(t.range.left,t.range.top)+":"+Oe.crToCoord(t.range.right,t.range.bottom)+a,t.EditorScheduleSheetCommands(r,!0,!1);break;case"Move":case"MoveC":t.context.cursorsuffix="",r="movepaste "+Oe.crToCoord(t.range2.left,t.range2.top)+":"+Oe.crToCoord(t.range2.right,t.range2.bottom)+" "+t.ecell.coord+a,t.EditorScheduleSheetCommands(r,!0,!1),t.Range2Remove();break;case"MoveI":case"MoveIC":t.context.cursorsuffix="",s=t.range2.right-t.range2.left,i=t.range2.bottom-t.range2.top,c=t.ecell.col-t.range2.left,d=t.ecell.row-t.range2.top,r="moveinsert "+Oe.crToCoord(t.range2.left,t.range2.top)+":"+Oe.crToCoord(t.range2.right,t.range2.bottom)+" "+t.ecell.coord+a,t.EditorScheduleSheetCommands(r,!0,!1),t.Range2Remove(),t.RangeRemove()," Horizontal"==t.cellhandles.filltype&&0<c?t.MoveECell(Oe.crToCoord(t.ecell.col-s-1,t.ecell.row)):" Vertical"==t.cellhandles.filltype&&0<d&&t.MoveECell(Oe.crToCoord(t.ecell.col,t.ecell.row-i-1)),t.RangeAnchor(Oe.crToCoord(t.ecell.col+s,t.ecell.row+i)),t.RangeExtend()}return Oe.RemoveMouseMoveUp(Oe.CellHandlesMouseMove,Oe.CellHandlesMouseUp,h.draghandle,u),p.editor=null,!1}},Oe.TableControl=function(e,t,o){var r=Oe.Constants;this.editor=e,this.vertical=t,this.size=o,this.main=null,this.endcap=null,this.paneslider=null,this.lessbutton=null,this.morebutton=null,this.scrollarea=null,this.thumb=null,this.controlborder=null,this.endcapstart=null,this.panesliderstart=null,this.lessbuttonstart=null,this.morebuttonstart=null,this.scrollareastart=null,this.scrollareaend=null,this.scrollareasize=null,this.thumbpos=null,this.controlthickness=r.defaultTableControlThickness,this.sliderthickness=r.defaultTCSliderThickness,this.buttonthickness=r.defaultTCButtonThickness,this.thumbthickness=r.defaultTCThumbThickness,this.minscrollingpanesize=this.buttonthickness+this.buttonthickness+this.thumbthickness+20},Oe.TableControl.prototype.CreateTableControl=function(){return Oe.CreateTableControl(this)},Oe.TableControl.prototype.PositionTableControlElements=function(){Oe.PositionTableControlElements(this)},Oe.TableControl.prototype.ComputeTableControlPositions=function(){Oe.ComputeTableControlPositions(this)},Oe.CreateTableControl=function(e){var t,o,r,a=Oe.AssignID,n=Oe.setStyles,l=Oe.Constants,s=e.editor.imageprefix,i=e.vertical?"v":"h",c=Oe.LocalizeString;return e.main=document.createElement("div"),(t=e.main.style).height=(e.vertical?e.size:e.controlthickness)+"px",t.width=(e.vertical?e.controlthickness:e.size)+"px",t.zIndex=0,n(e.main,l.TCmainStyle),t.backgroundImage="url("+s+"main-"+i+".gif)",l.TCmainClass&&(e.main.className=l.TCmainClass),e.main.style.display="none",e.endcap=document.createElement("div"),(t=e.endcap.style).height=e.controlthickness+"px",t.width=e.controlthickness+"px",t.zIndex=1,t.overflow="hidden",t.position="absolute",n(e.endcap,l.TCendcapStyle),t.backgroundImage="url("+s+"endcap-"+i+".gif)",l.TCendcapClass&&(e.endcap.className=l.TCendcapClass),a(e.editor,e.endcap,"endcap"+i),e.main.appendChild(e.endcap),e.paneslider=document.createElement("div"),(t=e.paneslider.style).height=(e.vertical?e.sliderthickness:e.controlthickness)+"px",t.overflow="hidden",t.width=(e.vertical?e.controlthickness:e.sliderthickness)+"px",t.position="absolute",t[e.vertical?"top":"left"]="4px",t.zIndex=3,t.backgroundImage="url("+s+"paneslider-"+i+".gif)",l.TCpanesliderClass&&(e.paneslider.className=l.TCpanesliderClass),a(e.editor,e.paneslider,"paneslider"+i),e.paneslider.title=c(e.vertical?"Drag to lock pane horizontally":"Drag to lock pane vertically"),(o={MouseDown:Oe.TCPSDragFunctionStart,MouseMove:Oe.TCPSDragFunctionMove,MouseUp:Oe.TCPSDragFunctionStop,Disabled:function(){return e.editor.busy}}).control=e,1!=Oe._app&&Oe.DragRegister(e.paneslider,e.vertical,!e.vertical,o,e.editor.toplevel),e.main.appendChild(e.paneslider),e.lessbutton=document.createElement("div"),(t=e.lessbutton.style).height=(e.vertical?e.buttonthickness:e.controlthickness)+"px",t.width=(e.vertical?e.controlthickness:e.buttonthickness)+"px",t.zIndex=2,t.overflow="hidden",t.position="absolute",n(e.lessbutton,l.TClessbuttonStyle),t.backgroundImage="url("+s+"less-"+i+"n.gif)",l.TClessbuttonClass&&(e.lessbutton.className=l.TClessbuttonClass),a(e.editor,e.lessbutton,"lessbutton"+i),r={repeatwait:l.TClessbuttonRepeatWait,repeatinterval:l.TClessbuttonRepeatInterval,normalstyle:"backgroundImage:url("+s+"less-"+i+"n.gif);",downstyle:"backgroundImage:url("+s+"less-"+i+"d.gif);",hoverstyle:"backgroundImage:url("+s+"less-"+i+"h.gif);"},o={MouseDown:function(){e.editor.busy||e.editor.ScrollRelative(e.vertical,-1)},Repeat:function(){e.editor.busy||e.editor.ScrollRelative(e.vertical,-1)},Disabled:function(){return e.editor.busy}},Oe.ButtonRegister(e.editor,e.lessbutton,r,o),e.main.appendChild(e.lessbutton),e.morebutton=document.createElement("div"),(t=e.morebutton.style).height=(e.vertical?e.buttonthickness:e.controlthickness)+"px",t.width=(e.vertical?e.controlthickness:e.buttonthickness)+"px",t.zIndex=2,t.overflow="hidden",t.position="absolute",n(e.morebutton,l.TCmorebuttonStyle),t.backgroundImage="url("+s+"more-"+i+"n.gif)",l.TCmorebuttonClass&&(e.morebutton.className=l.TCmorebuttonClass),a(e.editor,e.morebutton,"morebutton"+i),r={repeatwait:l.TCmorebuttonRepeatWait,repeatinterval:l.TCmorebuttonRepeatInterval,normalstyle:"backgroundImage:url("+s+"more-"+i+"n.gif);",downstyle:"backgroundImage:url("+s+"more-"+i+"d.gif);",hoverstyle:"backgroundImage:url("+s+"more-"+i+"h.gif);"},o={MouseDown:function(){e.editor.busy||e.editor.ScrollRelative(e.vertical,1)},Repeat:function(){e.editor.busy||e.editor.ScrollRelative(e.vertical,1)},Disabled:function(){return e.editor.busy}},Oe.ButtonRegister(e.editor,e.morebutton,r,o),e.main.appendChild(e.morebutton),e.scrollarea=document.createElement("div"),(t=e.scrollarea.style).height=e.controlthickness+"px",t.width=e.controlthickness+"px",t.zIndex=1,t.overflow="hidden",t.position="absolute",n(e.scrollarea,l.TCscrollareaStyle),t.backgroundImage="url("+s+"scrollarea-"+i+".gif)",l.TCscrollareaClass&&(e.scrollarea.className=l.TCscrollareaClass),a(e.editor,e.scrollarea,"scrollarea"+i),r={repeatwait:l.TCscrollareaRepeatWait,repeatinterval:l.TCscrollareaRepeatWait},(o={MouseDown:Oe.ScrollAreaClick,Repeat:Oe.ScrollAreaClick,Disabled:function(){return e.editor.busy}}).control=e,Oe.ButtonRegister(e.editor,e.scrollarea,r,o),e.main.appendChild(e.scrollarea),e.thumb=document.createElement("div"),(t=e.thumb.style).height=(e.vertical?e.thumbthickness:e.controlthickness)+"px",t.width=(e.vertical?e.controlthickness:e.thumbthickness)+"px",t.zIndex=2,t.overflow="hidden",t.position="absolute",n(e.thumb,l.TCthumbStyle),e.thumb.style.backgroundImage="url("+s+"thumb-"+i+"n.gif)",l.TCthumbClass&&(e.thumb.className=l.TCthumbClass),a(e.editor,e.thumb,"thumb"+i),(o={MouseDown:Oe.TCTDragFunctionStart,MouseMove:Oe.TCTDragFunctionMove,MouseUp:Oe.TCTDragFunctionStop,Disabled:function(){return e.editor.busy}}).control=e,1!=Oe._app&&Oe.DragRegister(e.thumb,e.vertical,!e.vertical,o,e.editor.toplevel),r={normalstyle:"backgroundImage:url("+s+"thumb-"+i+"n.gif)",name:"Thumb",downstyle:"backgroundImage:url("+s+"thumb-"+i+"d.gif)",hoverstyle:"backgroundImage:url("+s+"thumb-"+i+"h.gif)"},Oe.ButtonRegister(e.editor,e.thumb,r,null),e.main.appendChild(e.thumb),e.main},Oe.ScrollAreaClick=function(e,t,o){var r=o.functionobj.control,a=Oe.GetElementPositionWithScroll(r.editor.toplevel),n=r.vertical?t.clientY-a.top:t.clientX-a.left;r.editor.busy||r.editor.PageRelative(r.vertical,n>r.thumbpos?1:-1)},Oe.PositionTableControlElements=function(e){var t,o,r,a=e.editor;e.vertical?(t=e.controlborder+"px",e.endcap.style.top=e.endcapstart+"px",e.endcap.style.left=t,e.paneslider.style.top=e.panesliderstart+"px",e.paneslider.style.left=t,e.lessbutton.style.top=e.lessbuttonstart+"px",e.lessbutton.style.left=t,e.morebutton.style.top=e.morebuttonstart+"px",e.morebutton.style.left=t,e.scrollarea.style.top=e.scrollareastart+"px",e.scrollarea.style.left=t,e.scrollarea.style.height=e.scrollareasize+"px",o=Math.max(a.context.sheetobj.attribs.lastrow,a.firstscrollingrow+1),r=(a.firstscrollingrow-(a.lastnonscrollingrow+1))*(e.scrollareasize-3*e.thumbthickness)/(o-(a.lastnonscrollingrow+1))+e.scrollareastart-1,r=Math.floor(r),e.thumb.style.top=r+"px",e.thumb.style.left=t):(t=e.controlborder+"px",e.endcap.style.left=e.endcapstart+"px",e.endcap.style.top=t,e.paneslider.style.left=e.panesliderstart+"px",e.paneslider.style.top=t,e.lessbutton.style.left=e.lessbuttonstart+"px",e.lessbutton.style.top=t,e.morebutton.style.left=e.morebuttonstart+"px",e.morebutton.style.top=t,e.scrollarea.style.left=e.scrollareastart+"px",e.scrollarea.style.top=t,e.scrollarea.style.width=e.scrollareasize+"px",o=Math.max(a.context.sheetobj.attribs.lastcol,a.firstscrollingcol+1),r=(a.firstscrollingcol-(a.lastnonscrollingcol+1))*(e.scrollareasize-e.thumbthickness)/(o-a.lastnonscrollingcol)+e.scrollareastart-1,r=Math.floor(r),e.thumb.style.left=r+"px",e.thumb.style.top=t),e.thumbpos=r,e.main.style.display="block"},Oe.ComputeTableControlPositions=function(e){var t=e.editor;if(!t.gridposition||!t.headposition)throw"Can't compute table control positions before editor positions";e.vertical?(e.controlborder=t.gridposition.left+t.tablewidth,e.endcapstart=t.gridposition.top,e.panesliderstart=t.firstscrollingrowtop-e.sliderthickness,e.lessbuttonstart=t.firstscrollingrowtop-1,e.morebuttonstart=t.gridposition.top+t.tableheight-e.buttonthickness,e.scrollareastart=t.firstscrollingrowtop-1+e.buttonthickness):(e.controlborder=t.gridposition.top+t.tableheight,e.endcapstart=t.gridposition.left,e.panesliderstart=t.firstscrollingcolleft-e.sliderthickness,e.lessbuttonstart=t.firstscrollingcolleft-1,e.morebuttonstart=t.gridposition.left+t.tablewidth-e.buttonthickness,e.scrollareastart=t.firstscrollingcolleft-1+e.buttonthickness),e.scrollareaend=e.morebuttonstart-1,e.scrollareasize=e.scrollareaend-e.scrollareastart+1},Oe.TCPSDragFunctionStart=function(e,t,o){var r=o.functionobj.control.editor,a=Oe.Constants;Oe.DragFunctionStart(e,t,o),t.trackingline=document.createElement("div"),t.trackingline.style.height=o.vertical?a.TCPStrackinglineThickness:r.tableheight-(r.headposition.top-r.gridposition.top)+"px",t.trackingline.style.width=o.vertical?r.tablewidth-(r.headposition.left-r.gridposition.left)+"px":a.TCPStrackinglineThickness,t.trackingline.style.backgroundImage="url("+r.imageprefix+"trackingline-"+(o.vertical?"v":"h")+".gif)",a.TCPStrackinglineClass&&(t.trackingline.className=a.TCPStrackinglineClass),Oe.setStyles(t.trackingline,a.TCPStrackinglineStyle),o.vertical?(row=Oe.Lookup(t.clientY+o.functionobj.control.sliderthickness,r.rowpositions),t.trackingline.style.top=(r.rowpositions[row]||r.headposition.top)+"px",t.trackingline.style.left=r.headposition.left+"px",t.trackingline.id="trackingline-vertical",r.context.rowpanes.length-1&&(r.context.SetRowPaneFirstLast(1,r.context.rowpanes[0].last+1,r.context.rowpanes[0].last+1),r.FitToEditTable(),r.ScheduleRender())):(col=Oe.Lookup(t.clientX+o.functionobj.control.sliderthickness,r.colpositions),t.trackingline.style.top=r.headposition.top+"px",t.trackingline.style.left=(r.colpositions[col]||r.headposition.left)+"px",t.trackingline.id="trackingline-horizon",r.context.colpanes.length-1&&(r.context.SetColPaneFirstLast(1,r.context.colpanes[0].last+1,r.context.colpanes[0].last+1),r.FitToEditTable(),r.ScheduleRender())),r.griddiv.appendChild(t.trackingline)},Oe.TCPSDragFunctionMove=function(e,t,o){var r,a,n,l,s=o.functionobj.control,i=s.sliderthickness,c=s.editor;if(o.vertical){for(n=s.morebuttonstart-s.minscrollingpanesize-t.offsetY,t.clientY>n&&(t.clientY=n),l=c.headposition.top-i-t.offsetY,t.clientY<l&&(t.clientY=l),r=Oe.Lookup(t.clientY+i,c.rowpositions);"yes"==c.context.sheetobj.rowattribs.hide[r];)r++;t.trackingline.style.top=(c.rowpositions[r]||c.headposition.top)+"px"}else{for(n=s.morebuttonstart-s.minscrollingpanesize-t.offsetX,t.clientX>n&&(t.clientX=n),l=c.headposition.left-i-t.offsetX,t.clientX<l&&(t.clientX=l),a=Oe.Lookup(t.clientX+i,c.colpositions);"yes"==c.context.sheetobj.colattribs.hide[Oe.rcColname(a)];)a++;t.trackingline.style.left=(c.colpositions[a]||c.headposition.left)+"px"}Oe.DragFunctionPosition(e,t,o)},Oe.TCPSDragFunctionStop=function(e,t,o){var r,a,n,l,s=o.functionobj.control,i=s.sliderthickness,c=s.editor;if(o.vertical){for(n=s.morebuttonstart-s.minscrollingpanesize-t.offsetY,t.clientY>n&&(t.clientY=n),l=c.headposition.top-i-t.offsetY,t.clientY<l&&(t.clientY=l),(r=Oe.Lookup(t.clientY+i,c.rowpositions))>c.context.sheetobj.attribs.lastrow&&(r=c.context.sheetobj.attribs.lastrow);"yes"==c.context.sheetobj.rowattribs.hide[r];)r++;c.EditorScheduleSheetCommands("pane row "+r,!0,!1)}else{for(n=s.morebuttonstart-s.minscrollingpanesize-t.offsetX,t.clientX>n&&(t.clientX=n),l=c.headposition.left-i-t.offsetX,t.clientX<l&&(t.clientX=l),(a=Oe.Lookup(t.clientX+i,c.colpositions))>c.context.sheetobj.attribs.lastcol&&(a=c.context.sheetobj.attribs.lastcol);"yes"==c.context.sheetobj.colattribs.hide[Oe.rcColname(a)];)a++;c.EditorScheduleSheetCommands("pane col "+a,!0,!1)}},Oe.TCTDragFunctionStart=function(e,t,o){var r=o.functionobj.control,a=r.editor,n=Oe.Constants;if(Oe.DragFunctionStart(e,t,o),t.thumbstatus&&(t.thumbstatus.rowmsgele&&(t.thumbstatus.rowmsgele=null),t.thumbstatus.rowpreviewele&&(t.thumbstatus.rowpreviewele=null),a.toplevel.removeChild(t.thumbstatus),t.thumbstatus=null),t.thumbstatus=document.createElement("div"),o.vertical){n.TCTDFSthumbstatusvClass&&(t.thumbstatus.className=n.TCTDFSthumbstatusvClass),Oe.setStyles(t.thumbstatus,n.TCTDFSthumbstatusvStyle),t.thumbstatus.style.top=t.clientY+n.TCTDFStopOffsetv+"px",t.thumbstatus.style.left=r.controlborder-10-a.tablewidth/2+"px",t.thumbstatus.style.width=a.tablewidth/2+"px",t.thumbcontext=new Oe.RenderContext(a.context.sheetobj),t.thumbcontext.showGrid=!0,t.thumbcontext.rowpanes=[{first:1,last:1}];var l=a.context.colpanes[a.context.colpanes.length-1];t.thumbcontext.colpanes=[{first:l.first,last:l.last}],t.thumbstatus.innerHTML='<table cellspacing="0" cellpadding="0"><tr><td valign="top" style="'+n.TCTDFSthumbstatusrownumStyle+'" class="'+n.TCTDFSthumbstatusrownumClass+'"><div>msg</div></td><td valign="top"><div style="overflow:hidden;">preview</div></td></tr></table>',t.thumbstatus.rowmsgele=t.thumbstatus.firstChild.firstChild.firstChild.firstChild.firstChild,t.thumbstatus.rowpreviewele=t.thumbstatus.firstChild.firstChild.firstChild.childNodes[1].firstChild,a.toplevel.appendChild(t.thumbstatus),Oe.TCTDragFunctionRowSetStatus(t,a,a.firstscrollingrow||1)}else n.TCTDFSthumbstatushClass&&(t.thumbstatus.className=n.TCTDFSthumbstatushClass),Oe.setStyles(t.thumbstatus,n.TCTDFSthumbstatushStyle),t.thumbstatus.style.top=r.controlborder+n.TCTDFStopOffseth+"px",t.thumbstatus.style.left=t.clientX+n.TCTDFSleftOffseth+"px",a.toplevel.appendChild(t.thumbstatus),t.thumbstatus.innerHTML=n.s_TCTDFthumbstatusPrefixh+Oe.rcColname(a.firstscrollingcol)},Oe.TCTDragFunctionRowSetStatus=function(e,t,o){var r=Oe.Constants.s_TCTDFthumbstatusPrefixv+o+" ";e.thumbstatus.rowmsgele.innerHTML=r,e.thumbcontext.rowpanes=[{first:o,last:o}],e.thumbrowshown=o;e.thumbcontext.RenderSheet(e.thumbstatus.rowpreviewele.firstChild,{type:"html"})},Oe.TCTDragFunctionMove=function(e,t,o){var r,a,n=o.functionobj.control,l=(n.thumbthickness,n.editor),s=Oe.Constants;o.vertical?(t.clientY>n.scrollareaend-t.offsetY-n.thumbthickness+2&&(t.clientY=n.scrollareaend-t.offsetY-n.thumbthickness+2),t.clientY<n.scrollareastart-t.offsetY-1&&(t.clientY=n.scrollareastart-t.offsetY-1),t.thumbstatus.style.top=t.clientY+"px",r=(t.clientY+t.offsetY-n.scrollareastart+1)/(n.scrollareasize-n.thumbthickness)*(l.context.sheetobj.attribs.lastrow-l.lastnonscrollingrow)+l.lastnonscrollingrow+1,(r=Math.floor(r))<=l.lastnonscrollingrow&&(r=l.lastnonscrollingrow+1),r>l.context.sheetobj.attribs.lastrow&&(r=l.context.sheetobj.attribs.lastrow),r!=t.thumbrowshown&&Oe.TCTDragFunctionRowSetStatus(t,l,r)):(t.clientX>n.scrollareaend-t.offsetX-n.thumbthickness+2&&(t.clientX=n.scrollareaend-t.offsetX-n.thumbthickness+2),t.clientX<n.scrollareastart-t.offsetX-1&&(t.clientX=n.scrollareastart-t.offsetX-1),t.thumbstatus.style.left=t.clientX+"px",r=(t.clientX+t.offsetX-n.scrollareastart+1)/(n.scrollareasize-n.thumbthickness)*(l.context.sheetobj.attribs.lastcol-l.lastnonscrollingcol)+l.lastnonscrollingcol+1,(r=Math.floor(r))<=l.lastnonscrollingcol&&(r=l.lastnonscrollingcol+1),r>l.context.sheetobj.attribs.lastcol&&(r=l.context.sheetobj.attribs.lastcol),a=s.s_TCTDFthumbstatusPrefixh+Oe.rcColname(r),t.thumbstatus.innerHTML=a),Oe.DragFunctionPosition(e,t,o)},Oe.TCTDragFunctionStop=function(e,t,o){var r,a=o.functionobj.control,n=a.editor;o.vertical?(r=(t.clientY+t.offsetY-a.scrollareastart+1)/(a.scrollareasize-a.thumbthickness)*(n.context.sheetobj.attribs.lastrow-n.lastnonscrollingrow)+n.lastnonscrollingrow+1,(r=Math.floor(r))<=n.lastnonscrollingrow&&(r=n.lastnonscrollingrow+1),r>n.context.sheetobj.attribs.lastrow&&(r=n.context.sheetobj.attribs.lastrow),n.context.SetRowPaneFirstLast(n.context.rowpanes.length-1,r,r+1)):(r=(t.clientX+t.offsetX-a.scrollareastart+1)/(a.scrollareasize-a.thumbthickness)*(n.context.sheetobj.attribs.lastcol-n.lastnonscrollingcol)+n.lastnonscrollingcol+1,(r=Math.floor(r))<=n.lastnonscrollingcol&&(r=n.lastnonscrollingcol+1),r>n.context.sheetobj.attribs.lastcol&&(r=n.context.sheetobj.attribs.lastcol),n.context.SetColPaneFirstLast(n.context.colpanes.length-1,r,r+1)),n.FitToEditTable(),t.thumbstatus.rowmsgele&&(t.thumbstatus.rowmsgele=null),t.thumbstatus.rowpreviewele&&(t.thumbstatus.rowpreviewele=null),n.toplevel.removeChild(t.thumbstatus),t.thumbstatus=null,n.ScheduleRender()},Oe.DragInfo={registeredElements:[],draggingElement:null,startX:0,startY:0,startZ:0,clientX:0,clientY:0,offsetX:0,offsetY:0,relativeOffset:{left:0,top:0}},Oe.DragRegister=function(e,t,o,r,a){var n=Oe.DragInfo;if(r||(r={MouseDown:Oe.DragFunctionStart,MouseMove:Oe.DragFunctionPosition,MouseUp:Oe.DragFunctionPosition,Disabled:null}),n.registeredElements.push({element:e,vertical:t,horizontal:o,functionobj:r,parent:a}),e.addEventListener)e.addEventListener("mousedown",Oe.DragMouseDown,!1);else{if(!e.attachEvent)throw Oe.Constants.s_BrowserNotSupported;e.attachEvent("onmousedown",Oe.DragMouseDown)}},Oe.DragUnregister=function(e){var t,o=Oe.DragInfo;if(e)for(t=0;t<o.registeredElements.length;t++)if(o.registeredElements[t].element==e)return o.registeredElements.splice(t,1),void(e.removeEventListener?e.removeEventListener("mousedown",Oe.DragMouseDown,!1):e.detachEvent("onmousedown",Oe.DragMouseDown))},Oe.DragMouseDown=function(e){var t=e||U.event,o=Oe.DragInfo,r=Oe.LookupElement(t.target||t.srcElement,o.registeredElements);if(r&&!(r&&r.functionobj&&r.functionobj.Disabled&&r.functionobj.Disabled(t,o,r)))return(o.draggingElement=r).parent&&(o.relativeOffset=Oe.GetElementPositionWithScroll(r.parent)),o.clientX=t.clientX-o.relativeOffset.left,o.clientY=t.clientY-o.relativeOffset.top,o.startX=o.clientX,o.startY=o.clientY,o.startZ=r.element.style.zIndex,o.offsetX=0,o.offsetY=0,r.element.style.zIndex="100",Oe.SetMouseMoveUp(Oe.DragMouseMove,Oe.DragMouseUp,r.element,t),r&&r.functionobj&&r.functionobj.MouseDown&&r.functionobj.MouseDown(t,o,r),!1},Oe.DragMouseMove=function(e){var t=e||U.event,o=Oe.DragInfo,r=o.draggingElement;return o.clientX=t.clientX-o.relativeOffset.left,o.clientY=t.clientY-o.relativeOffset.top,Oe.StopPropagation(t),r&&r.functionobj&&r.functionobj.MouseMove&&r.functionobj.MouseMove(t,o,r),!1},Oe.DragMouseUp=function(e){var t=e||U.event,o=Oe.DragInfo,r=o.draggingElement;return o.clientX=t.clientX-o.relativeOffset.left,o.clientY=t.clientY-o.relativeOffset.top,r.element.style.zIndex=o.startZ,r&&r.functionobj&&r.functionobj.MouseUp&&r.functionobj.MouseUp(t,o,r),Oe.RemoveMouseMoveUp(Oe.DragMouseMove,Oe.DragMouseUp,r.element,t),o.draggingElement=null,!1},Oe.DragFunctionStart=function(e,t,o){var r=o.functionobj.positionobj||o.element;t.offsetY=parseInt(r.style.top)-t.clientY,t.offsetX=parseInt(r.style.left)-t.clientX},Oe.DragFunctionPosition=function(e,t,o){var r=o.functionobj.positionobj||o.element;o.vertical&&(r.style.top=t.clientY+t.offsetY+"px"),o.horizontal&&(r.style.left=t.clientX+t.offsetX+"px")},Oe.ButtonInfo={registeredElements:[],buttonElement:null,doingHover:!1,buttonDown:!1,timer:null,relativeOffset:null,clientX:0,clientY:0},Oe.ButtonRegister=function(e,t,o,r){if(o||(o={}),Oe.ButtonInfo.registeredElements.push({name:o.name,element:t,editor:e,normalstyle:o.normalstyle,hoverstyle:o.hoverstyle,downstyle:o.downstyle,repeatwait:o.repeatwait,repeatinterval:o.repeatinterval,functionobj:r}),t.addEventListener)t.addEventListener("mousedown",Oe.ButtonMouseDown,!1),t.addEventListener("mouseover",Oe.ButtonMouseOver,!1),t.addEventListener("mouseout",Oe.ButtonMouseOut,!1);else{if(!t.attachEvent)throw Oe.Constants.s_BrowserNotSupported;t.attachEvent("onmousedown",Oe.ButtonMouseDown),t.attachEvent("onmouseover",Oe.ButtonMouseOver),t.attachEvent("onmouseout",Oe.ButtonMouseOut)}},Oe.ButtonMouseOver=function(e){var t=e||U.event,o=Oe.ButtonInfo,r=Oe.LookupElement(t.target||t.srcElement,o.registeredElements);r&&(o.buttonDown?o.buttonElement==r&&(o.doingHover=!0):(o.buttonElement&&o.buttonElement!=r&&o.doingHover&&Oe.setStyles(o.buttonElement.element,o.buttonElement.normalstyle),o.buttonElement=r,o.doingHover=!0,Oe.setStyles(r.element,r.hoverstyle),r&&r.functionobj&&r.functionobj.MouseOver&&r.functionobj.MouseOver(t,o,r)))},Oe.ButtonMouseOut=function(e){var t=e||U.event,o=Oe.ButtonInfo;if(o.buttonDown)o.doingHover=!1;else{var r=Oe.LookupElement(t.target||t.srcElement,o.registeredElements);o.doingHover&&(o.buttonElement&&Oe.setStyles(o.buttonElement.element,o.buttonElement.normalstyle),o.buttonElement=null,o.doingHover=!1),r&&r.functionobj&&r.functionobj.MouseOut&&r.functionobj.MouseOut(t,o,r)}},Oe.ButtonMouseDown=function(e){var t=e||U.event,o=Oe.ButtonInfo,r=(Oe.GetViewportInfo(),Oe.LookupElement(t.target||t.srcElement,o.registeredElements));r&&(r&&r.functionobj&&r.functionobj.Disabled&&r.functionobj.Disabled(t,o,r)||(o.buttonElement=r,o.buttonDown=!0,Oe.setStyles(r.element,o.buttonElement.downstyle),document.addEventListener?document.addEventListener("mouseup",Oe.ButtonMouseUp,!0):r.element.attachEvent&&(r.element.setCapture(),r.element.attachEvent("onmouseup",Oe.ButtonMouseUp),r.element.attachEvent("onlosecapture",Oe.ButtonMouseUp)),Oe.StopPropagation(t),o.relativeOffset=Oe.GetElementPositionWithScroll(r.editor.toplevel),o.clientX=t.clientX-o.relativeOffset.left,o.clientY=t.clientY-o.relativeOffset.top,r&&r.functionobj&&r.functionobj.MouseDown&&r.functionobj.MouseDown(t,o,r),r.repeatwait&&(o.timer=U.setTimeout(Oe.ButtonRepeat,r.repeatwait))))},Oe.ButtonMouseUp=function(e){var t=e||U.event,o=Oe.ButtonInfo,r=o.buttonElement;o.timer&&(U.clearTimeout(o.timer),o.timer=null),o.buttonDown&&(Oe.StopPropagation(t),document.removeEventListener?document.removeEventListener("mouseup",Oe.ButtonMouseUp,!0):document.detachEvent&&(r.element.detachEvent("onlosecapture",Oe.ButtonMouseUp),r.element.detachEvent("onmouseup",Oe.ButtonMouseUp),r.element.releaseCapture()),o.buttonElement.downstyle&&(o.doingHover?Oe.setStyles(r.element,o.buttonElement.hoverstyle):Oe.setStyles(r.element,o.buttonElement.normalstyle)),o.buttonDown=!1,r&&r.functionobj&&r.functionobj.MouseUp&&r.functionobj.MouseUp(t,o,r))},Oe.ButtonRepeat=function(){var e=Oe.ButtonInfo,t=e.buttonElement;t&&(t&&t.functionobj&&t.functionobj.Repeat&&t.functionobj.Repeat(null,e,t),e.timer=U.setTimeout(Oe.ButtonRepeat,t.repeatinterval||100))},Oe.MouseWheelInfo={registeredElements:[]},Oe.MouseWheelRegister=function(e,t){if(Oe.MouseWheelInfo.registeredElements.push({element:e,functionobj:t}),e.addEventListener)e.addEventListener("DOMMouseScroll",Oe.ProcessMouseWheel,!1),e.addEventListener("mousewheel",Oe.ProcessMouseWheel,!1);else{if(!e.attachEvent)throw Oe.Constants.s_BrowserNotSupported;e.attachEvent("onmousewheel",Oe.ProcessMouseWheel)}},Oe.ProcessMouseWheel=function(e){var t,o=e||U.event;if(!Oe.Keyboard.passThru){var r,a=Oe.MouseWheelInfo,n=o.target||o.srcElement;for(r=null;!r&&n;n=n.parentNode)r=Oe.LookupElement(n,a.registeredElements);r&&((t=o.wheelDelta?o.wheelDelta/120:-o.detail/3)||(t=0),r.functionobj&&r.functionobj.WheelMove&&r.functionobj.WheelMove(o,t,a,r),o.preventDefault&&o.preventDefault(),o.returnValue=!1)}},Oe.keyboardTables={specialKeysCommon:{8:"[backspace]",9:"[tab]",13:"[enter]",25:"[tab]",27:"[esc]",33:"[pgup]",34:"[pgdn]",35:"[end]",36:"[home]",37:"[aleft]",38:"[aup]",39:"[aright]",40:"[adown]",45:"[ins]",46:"[del]",113:"[f2]"},specialKeysIE:{8:"[backspace]",9:"[tab]",13:"[enter]",25:"[tab]",27:"[esc]",33:"[pgup]",34:"[pgdn]",35:"[end]",36:"[home]",37:"[aleft]",38:"[aup]",39:"[aright]",40:"[adown]",45:"[ins]",46:"[del]",113:"[f2]"},controlKeysIE:{65:"[ctrl-a]",67:"[ctrl-c]",83:"[ctrl-s]",86:"[ctrl-v]",88:"[ctrl-x]",90:"[ctrl-z]"},specialKeysOpera:{8:"[backspace]",9:"[tab]",13:"[enter]",25:"[tab]",27:"[esc]",33:"[pgup]",34:"[pgdn]",35:"[end]",36:"[home]",37:"[aleft]",38:"[aup]",39:"[aright]",40:"[adown]",45:"[ins]",46:"[del]",113:"[f2]"},controlKeysOpera:{65:"[ctrl-a]",67:"[ctrl-c]",83:"[ctrl-s]",86:"[ctrl-v]",88:"[ctrl-x]",90:"[ctrl-z]"},specialKeysSafari:{8:"[backspace]",9:"[tab]",13:"[enter]",25:"[tab]",27:"[esc]",63232:"[aup]",63233:"[adown]",63234:"[aleft]",63235:"[aright]",63272:"[del]",63273:"[home]",63275:"[end]",63276:"[pgup]",63277:"[pgdn]",63237:"[f2]"},controlKeysSafari:{97:"[ctrl-a]",99:"[ctrl-c]",115:"[ctrl-s]",118:"[ctrl-v]",120:"[ctrl-x]",122:"[ctrl-z]"},ignoreKeysSafari:{63236:"[f1]",63238:"[f3]",63239:"[f4]",63240:"[f5]",63241:"[f6]",63242:"[f7]",63243:"[f8]",63244:"[f9]",63245:"[f10]",63246:"[f11]",63247:"[f12]",63289:"[numlock]"},specialKeysFirefox:{8:"[backspace]",9:"[tab]",13:"[enter]",25:"[tab]",27:"[esc]",33:"[pgup]",34:"[pgdn]",35:"[end]",36:"[home]",37:"[aleft]",38:"[aup]",39:"[aright]",40:"[adown]",45:"[ins]",46:"[del]",113:"[f2]"},controlKeysFirefox:{97:"[ctrl-a]",99:"[ctrl-c]",115:"[ctrl-s]",118:"[ctrl-v]",120:"[ctrl-x]",122:"[ctrl-z]"},ignoreKeysFirefox:{16:"[shift]",17:"[ctrl]",18:"[alt]",20:"[capslock]",19:"[pause]",44:"[printscreen]",91:"[windows]",92:"[windows]",112:"[f1]",114:"[f3]",115:"[f4]",116:"[f5]",117:"[f6]",118:"[f7]",119:"[f8]",120:"[f9]",121:"[f10]",122:"[f11]",123:"[f12]",144:"[numlock]",145:"[scrolllock]",224:"[cmd]"}},Oe.Keyboard={areListener:!1,focusTable:null,passThru:null,didProcessKey:!1,statusFromProcessKey:!1,repeatingKeyPress:!1,chForProcessKey:""},Oe.KeyboardSetFocus=function(e){Oe.Keyboard.focusTable=e,Oe.Keyboard.areListener||(document.onkeydown=Oe.ProcessKeyDown,document.onkeypress=Oe.ProcessKeyPress,Oe.Keyboard.areListener=!0),Oe.Keyboard.passThru&&(Oe.Keyboard.passThru.blur&&Oe.Keyboard.passThru.blur(),Oe.Keyboard.passThru=null),U.focus()},Oe.KeyboardFocus=function(){Oe.Keyboard.passThru=null,U.focus()},Oe.ProcessKeyDown=function(e){var t=Oe.keyboardTables;t.didProcessKey=!1,t.statusFromProcessKey=!1;var o="",r=!(t.repeatingKeyPress=!1);if(!Oe._app&&!Oe.Keyboard.passThru){if(null==(e=e||U.event).which){if(!(o=t.specialKeysCommon[e.keyCode])&&(e.ctrlKey&&(o=t.controlKeysIE[e.keyCode]),!o))return!0;(r=Oe.ProcessKey(o,e))||(e.preventDefault&&e.preventDefault(),e.returnValue=!1)}else{if(!(o=t.specialKeysCommon[e.keyCode])&&((e.ctrlKey||e.metaKey)&&(o=t.controlKeysIE[e.keyCode]),!o))return!0;r=Oe.ProcessKey(o,e),t.didProcessKey=!0,t.statusFromProcessKey=r,t.chForProcessKey=o}return r}},Oe.ProcessKeyPress=function(e){var t=Oe.keyboardTables,o="";if(e=e||U.event,!Oe._app&&!Oe.Keyboard.passThru){if(t.didProcessKey)return t.repeatingKeyPress?Oe.ProcessKey(t.chForProcessKey,e):(t.repeatingKeyPress=!0,t.statusFromProcessKey);if(null==e.which)o=String.fromCharCode(e.keyCode);else{if(!e.which)return!1;if(null==e.charCode){if(0==e.which)return!0;if(e.which<32||144==e.which){if(o=t.specialKeysOpera[e.which])return!0}else o=e.ctrlKey?t.controlKeysOpera[e.keyCode]:String.fromCharCode(e.which)}else{if(0==e.keyCode&&0==e.charCode)return;if(e.keyCode==e.charCode){if(!(o=t.specialKeysSafari[e.keyCode])){if(t.ignoreKeysSafari[e.keyCode])return!0;o=e.metaKey?t.controlKeysSafari[e.keyCode]:String.fromCharCode(e.which)}}else{if(t.specialKeysFirefox[e.keyCode])return!0;o=String.fromCharCode(e.which),(e.ctrlKey||e.metaKey)&&(o=t.controlKeysFirefox[e.which])}}}var r=Oe.ProcessKey(o,e);return r||(e.preventDefault&&e.preventDefault(),e.returnValue=!1),r}},Oe.ProcessKey=function(e,t){var o=Oe.Keyboard.focusTable;return!o||o.EditorProcessKey(e,t)},Oe||(Oe={}),Oe.FormatNumber={},Oe.FormatNumber.format_definitions={},Oe.FormatNumber.separatorchar=",",Oe.FormatNumber.decimalchar=".",Oe.FormatNumber.daynames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Oe.FormatNumber.daynames3=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Oe.FormatNumber.monthnames3=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Oe.FormatNumber.monthnames=["January","February","March","April","May","June","July","August","September","October","November","December"],Oe.FormatNumber.allowedcolors={BLACK:"#000000",BLUE:"#0000FF",CYAN:"#00FFFF",GREEN:"#00FF00",MAGENTA:"#FF00FF",RED:"#FF0000",WHITE:"#FFFFFF",YELLOW:"#FFFF00"},Oe.FormatNumber.alloweddates={H:"h]",M:"m]",MM:"mm]",S:"s]",SS:"ss]"},Oe.FormatNumber.commands={copy:1,color:2,integer_placeholder:3,fraction_placeholder:4,decimal:5,currency:6,general:7,separator:8,date:9,comparison:10,section:11,style:12},Oe.FormatNumber.datevalues={julian_offset:2415019,seconds_in_a_day:86400,seconds_in_an_hour:3600},Oe.FormatNumber.formatNumberWithFormat=function(e,t,o){var r,a,n,l,s,i,c,d,u,p,h,m,f,g,v,b,C,y,S,w,x,F,T,k,E,_,P,R,A,L,M,I,D,N,O,U,z,B,G,V=Oe.Constants,H=Oe.FormatNumber,j="";if("string"==typeof e&&!e.length)return"";if(G=e-0,!isFinite(G))return"string"==typeof e?H.formatTextWithFormat(e,t):"NaN";var W=(e=G)<0?1:0;W&&(G=-G);var K=0==G?1:0;if(o=o||V.FormatNumber_DefaultCurrency,H.parse_format_string(H.format_definitions,t),!(C=H.format_definitions[t]))throw"Format not parsed error!";if(y=C.sectioninfo.length-1,C.hascomparison)for(F=S=y=0;;F++){if(r=C.operators[F],a=C.operands[F],!r){S&&(t="General",H.parse_format_string(H.format_definitions,t),C=H.format_definitions[t],y=0);break}if(r!=H.commands.section){if(r==H.commands.comparison){if(E=a.indexOf(":"),w=a.substring(0,E),x=a.substring(E+1)-0,"<"==w&&e<x||"<="==w&&e<=x||"="==w&&e==x||"<>"==w&&e!=x||">="==w&&x<=e||">"==w&&x<e)break;S=1}}else{if(!S)break;S=0,y++}}else 0<y&&(1==y?y=W?(W=0,1):0:2!=y&&3!=y||(y=W?(W=0,1):K?2:0));if(0<(k=C.sectioninfo[y]).commas)for(E=0;E<k.commas;E++)G/=1e3;if(0<k.percent)for(E=0;E<k.percent;E++)G*=100;for(_=1,E=0;E<k.fractiondigits;E++)_*=10;if(P=Math.floor(G*_+.5),"number"!=typeof(P/=_))return"NaN";if(!isFinite(P))return"NaN";if(R=P+"",0==P&&(k.fractiondigits||k.integerdigits)&&(W=0),0<=R.indexOf("e"))return e+"";if(!(A=R.match(/^\+{0,1}(\d*)(?:\.(\d*)){0,1}$/)))return"NaN";if((L=A[1])&&"0"!=L||(L=""),(M=A[2])||(M=""),k.hasdate){if(e<0)return"??-???-??&nbsp;??:??:??";for(i=(e-Math.floor(e))*H.datevalues.seconds_in_a_day,c=e*H.datevalues.seconds_in_a_day,d=Math.floor(i/H.datevalues.seconds_in_an_hour),h=Math.floor(c/H.datevalues.seconds_in_an_hour),i-=d*H.datevalues.seconds_in_an_hour,u=Math.floor(i/60),m=Math.floor(c/60),p=i-60*u,_=1,E=0;E<k.fractiondigits;E++)_*=10;for(p=Math.floor(p*_+.5),p/=_,f=Math.floor(c*_+.5),f/=_,60<=p&&(p=0,m++,60<=++u&&(u=0,h++,24<=++d&&(d=0,e++))),M=(M=p-Math.floor(p)+"").substring(2),v=Oe.FormatNumber.convert_date_julian_to_gregorian(Math.floor(e+H.datevalues.julian_offset)),b=0,mspos=k.sectionstart;(r=C.operators[mspos],a=C.operands[mspos],r)&&r!=H.commands.section;mspos++)r==H.commands.date?("am/pm"!=a.toLowerCase()&&"a/p"!=a.toLowerCase()||g||(g=12<=d?(d-=12,"a/p"==a.toLowerCase()?V.s_FormatNumber_pm1:V.s_FormatNumber_pm):"a/p"==a.toLowerCase()?V.s_FormatNumber_am1:V.s_FormatNumber_am,a.indexOf(g)<0&&(g=g.toLowerCase())),!b||"m"!=a&&"mm"!=a||(C.operands[mspos]+="in"),b="h"==a.charAt(0)?1:0):r!=H.commands.copy&&(b=0);for(b=0,--mspos;(r=C.operators[mspos],a=C.operands[mspos],r)&&r!=H.commands.section;mspos--)r==H.commands.date?(!b||"m"!=a&&"mm"!=a||(C.operands[mspos]+="in"),b="ss"==a?1:0):r!=H.commands.copy&&(b=0)}for(U=O="",(N=D=I=0)<=(z=V.FormatNumber_separatorchar).indexOf(" ")&&(z=z.replace(/ /g,"&nbsp;")),0<=(B=V.FormatNumber_decimalchar).indexOf(" ")&&(B=B.replace(/ /g,"&nbsp;")),T=k.sectionstart;r=C.operators[T];)if(a=C.operands[T++],r==H.commands.copy)j+=a;else if(r==H.commands.color)O=a;else if(r==H.commands.style)U=a;else if(r==H.commands.integer_placeholder){if(W&&(j+="-",W=0),1==++I&&L.length>k.integerdigits)for(;D<L.length-k.integerdigits;D++)j+=L.charAt(D),k.thousandssep&&2<(n=L.length-D-1)&&n%3==0&&(j+=z);L.length<k.integerdigits&&I<=k.integerdigits-L.length?"0"!=a&&"?"!=a||(j+="0"==a?"0":"&nbsp;",k.thousandssep&&2<(n=k.integerdigits-I)&&n%3==0&&(j+=z)):(j+=L.charAt(D),k.thousandssep&&2<(n=L.length-D-1)&&n%3==0&&(j+=z),D++)}else if(r==H.commands.fraction_placeholder)N>=M.length?"0"!=a&&"?"!=a||(j+="0"==a?"0":"&nbsp;"):j+=M.charAt(N),N++;else if(r==H.commands.decimal)W&&(j+="-",W=0),j+=B;else if(r==H.commands.currency)W&&(j+="-",W=0),j+=a;else if(r==H.commands.general){if(0!=G){var $=Math.floor(Math.LOG10E*Math.log(G));if($=Math.pow(10,13-$),G=Math.floor($*G+.5)/$,!isFinite(G))return"NaN"}if(W&&(j+="-"),0<=(R=G+"").indexOf("e")){j+=R;continue}if((L=(A=R.match(/^\+{0,1}(\d*)(?:\.(\d*)){0,1}$/))[1])&&"0"!=L||(L=""),(M=A[2])||(M=""),N=D=0,L.length)for(;D<L.length;D++)j+=L.charAt(D),k.thousandssep&&2<(n=L.length-D-1)&&n%3==0&&(j+=z);else j+="0";if(M.length)for(j+=B;N<M.length;N++)j+=M.charAt(N)}else if(r==H.commands.date)"y"==(s=a.toLowerCase())||"yy"==s?j+=(v.year+"").substring(2):"yyyy"==s?j+=v.year+"":"d"==s?j+=v.day+"":"dd"==s?j+=((l=1e3+v.day)+"").substr(2):"ddd"==s?(l=Math.floor(e+6)%7,j+=V.s_FormatNumber_daynames3[l]):"dddd"==s?(l=Math.floor(e+6)%7,j+=V.s_FormatNumber_daynames[l]):"m"==s?j+=v.month+"":"mm"==s?j+=((l=1e3+v.month)+"").substr(2):"mmm"==s?j+=V.s_FormatNumber_monthnames3[v.month-1]:"mmmm"==s?j+=V.s_FormatNumber_monthnames[v.month-1]:"mmmmm"==s?j+=V.s_FormatNumber_monthnames[v.month-1].charAt(0):"h"==s?j+=d+"":"h]"==s?j+=h+"":"mmin"==s?j+=(l=1e3+u+"").substr(2):"mm]"==s?j+=m<100?(l=1e3+m+"").substr(2):m+"":"min"==s?j+=u+"":"m]"==s?j+=m+"":"hh"==s?j+=(l=1e3+d+"").substr(2):"s"==s?j+=(l=Math.floor(p))+"":"ss"==s?j+=(l=1e3+Math.floor(p)+"").substr(2):"am/pm"==s||"a/p"==s?j+=g:"ss]"==s&&(j+=f<100?(l=1e3+Math.floor(f)+"").substr(2):(l=Math.floor(f))+"");else{if(r==H.commands.section)break;if(r==H.commands.comparison)continue;j+="!! Parse error !!"}return O&&(j='<span style="color:'+O+';">'+j+"</span>"),U&&(j='<span style="'+U+';">'+j+"</span>"),j},Oe.FormatNumber.formatTextWithFormat=function(e,t){Oe.Constants;var o,r,a,n=Oe.FormatNumber,l=e+"",s="",i="",c="";if(n.parse_format_string(n.format_definitions,t),thisformat=n.format_definitions[t],!thisformat)throw"Format not parsed error!";if(0==(o=thisformat.sectioninfo.length-1))o=0;else{if(3!=o)return l;o=3}for(r=thisformat.sectioninfo[o].sectionstart;op=thisformat.operators[r];)a=thisformat.operands[r++],op==n.commands.copy?s+="@"==a?l:a.replace(/ /g,"&nbsp;"):op==n.commands.color?i=a:op==n.commands.style&&(c=a);return i&&(s='<span style="color:'+i+';">'+s+"</span>"),c&&(s='<span style="'+c+';">'+s+"</span>"),s},Oe.FormatNumber.parse_format_string=function(e,t){var o,r,a,n,l,s,i,c,d,u,p,h,m,f,g,v,b,C=Oe.FormatNumber,y=1;if(!e[t]){for(o={operators:[],operands:[],sectioninfo:[{}]},e[t]=o,r=0,sectioninfo=o.sectioninfo[r],sectioninfo.sectionstart=0,sectioninfo.integerdigits=0,sectioninfo.fractiondigits=0,sectioninfo.commas=0,v=sectioninfo.percent=0;v<t.length;v++)if(b=t.charAt(v),i){if('"'==b){i=0,o.operators.push(C.commands.copy),o.operands.push(c);continue}c+=b}else if(d){if("]"==b){if(d=0,(p=Oe.FormatNumber.parse_format_bracket(u)).operator==C.commands.separator){sectioninfo.thousandssep=1;continue}p.operator==C.commands.date&&(sectioninfo.hasdate=1),p.operator==C.commands.comparison&&(o.hascomparison=1),o.operators.push(p.operator),o.operands.push(p.operand);continue}u+=b}else if(n)o.operators.push(C.commands.copy),o.operands.push(b),n=!1;else if(l)o.operators.push(C.commands.copy),o.operands.push(b+b+b+b+b),l=!1;else if(s)o.operators.push(C.commands.copy),o.operands.push("&nbsp;"),s=!1;else{if(h){if("general".charAt(h)==b.toLowerCase()){7==++h&&(o.operators.push(C.commands.general),o.operands.push(b),h=0);continue}h=0}if(g){if(g.charAt(0)==b){g+=b;continue}o.operators.push(C.commands.date),o.operands.push(g),sectioninfo.hasdate=1,g=""}m?(f=(m+=b).toLowerCase())!="am/pm".substring(0,f.length)&&f!="a/p".substring(0,f.length)?ampstr="":"am/pm"!=f&&"a/p"!=f||(o.operators.push(C.commands.date),o.operands.push(m),m=""):"#"==b||"0"==b||"?"==b?(y?(sectioninfo.integerdigits++,sectioninfo.commas&&(sectioninfo.thousandssep=1,sectioninfo.commas=0),a=1,o.operators.push(C.commands.integer_placeholder)):(sectioninfo.fractiondigits++,a=1,o.operators.push(C.commands.fraction_placeholder)),o.operands.push(b)):"."==b?(a=0,o.operators.push(C.commands.decimal),o.operands.push(b),y=0):"$"==b?(a=0,o.operators.push(C.commands.currency),o.operands.push(b)):","==b?a?sectioninfo.commas++:(o.operators.push(C.commands.copy),o.operands.push(b)):"%"==b?(a=0,sectioninfo.percent++,o.operators.push(C.commands.copy),o.operands.push(b)):'"'==b?(a=0,i=1,c=""):"["==b?(a=0,d=1,u=""):"\\"==b?(n=1,a=0):"*"==b?(l=1,a=0):"_"==b?(s=1,a=0):";"==b?(r++,o.sectioninfo[r]={},sectioninfo=o.sectioninfo[r],sectioninfo.sectionstart=1+o.operators.length,sectioninfo.integerdigits=0,sectioninfo.fractiondigits=0,sectioninfo.commas=0,y=1,a=sectioninfo.percent=0,o.operators.push(C.commands.section),o.operands.push(b)):"g"==b.toLowerCase()?(h=1,a=0):"a"==b.toLowerCase()?(m=b,a=0):0<="dmyhHs".indexOf(b)?g=b:(a=0,o.operators.push(C.commands.copy),o.operands.push(b))}g&&(o.operators.push(C.commands.date),o.operands.push(g),sectioninfo.hasdate=1)}},Oe.FormatNumber.parse_format_bracket=function(e){var t,o=Oe.FormatNumber,r=Oe.Constants,a={};return"$"==e.charAt(0)?(a.operator=o.commands.currency,t=e.match(/^\$(.+?)(\-.+?){0,1}$/),a.operand=t?t[1]||r.FormatNumber_defaultCurrency||"$":e.substring(1)||r.FormatNumber_defaultCurrency||"$"):"?$"==e?(a.operator=o.commands.currency,a.operand="[?$]"):o.allowedcolors[e.toUpperCase()]?(a.operator=o.commands.color,a.operand=o.allowedcolors[e.toUpperCase()]):(t=e.match(/^style=([^"]*)$/))?(a.operator=o.commands.style,a.operand=t[1]):","==e?(a.operator=o.commands.separator,a.operand=e):o.alloweddates[e.toUpperCase()]?(a.operator=o.commands.date,a.operand=o.alloweddates[e.toUpperCase()]):(t=e.match(/^[<>=]/))?(t=e.match(/^([<>=]+)(.+)$/),a.operator=o.commands.comparison,a.operand=t[1]+":"+t[2]):(a.operator=o.commands.copy,a.operand="["+e+"]"),a},Oe.FormatNumber.convert_date_gregorian_to_julian=function(e,t,o){var r;return r=o-32075+Oe.intFunc(1461*(e+4800+Oe.intFunc((t-14)/12))/4),r+=Oe.intFunc(367*(t-2-12*Oe.intFunc((t-14)/12))/12),r-=Oe.intFunc(3*Oe.intFunc((e+4900+Oe.intFunc((t-14)/12))/100)/4)},Oe.FormatNumber.convert_date_julian_to_gregorian=function(e){var t,o,r,a,n;return t=e+68569,o=Math.floor(4*t/146097),t-=Math.floor((146097*o+3)/4),r=Math.floor(4e3*(t+1)/1461001),t=t-Math.floor(1461*r/4)+31,a=Math.floor(80*t/2447),n=t-Math.floor(2447*a/80),{year:r=100*(o-49)+r+(t=Math.floor(a/11)),month:a=a+2-12*t,day:n}},Oe.intFunc=function(e){return e<0?-Math.floor(-e):Math.floor(e)},Oe||(Oe={}),Oe.Formula={},Oe.TriggerIoAction={},Oe.Formula.ParseState={num:1,alpha:2,coord:3,string:4,stringquote:5,numexp1:6,numexp2:7,alphanumeric:8,specialvalue:9},Oe.Formula.TokenType={num:1,coord:2,op:3,name:4,error:5,string:6,space:7},Oe.Formula.CharClass={num:1,numstart:2,op:3,eof:4,alpha:5,incoord:6,error:7,quote:8,space:9,specialstart:10},Oe.Formula.CharClassTable={" ":9,"!":3,'"':8,"'":8,"#":10,$:6,"%":3,"&":3,"(":3,")":3,"*":3,"+":3,",":3,"-":3,".":2,"/":3,0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,":":3,"<":3,"=":3,">":3,A:5,B:5,C:5,D:5,E:5,F:5,G:5,H:5,I:5,J:5,K:5,L:5,M:5,N:5,O:5,P:5,Q:5,R:5,S:5,T:5,U:5,V:5,W:5,X:5,Y:5,Z:5,"^":3,_:5,a:5,b:5,c:5,d:5,e:5,f:5,g:5,h:5,i:5,j:5,k:5,l:5,m:5,n:5,o:5,p:5,q:5,r:5,s:5,t:5,u:5,v:5,w:5,x:5,y:5,z:5},Oe.Formula.UpperCaseTable={a:"A",b:"B",c:"C",d:"D",e:"E",f:"F",g:"G",h:"H",i:"I",j:"J",k:"K",l:"L",m:"M",n:"N",o:"O",p:"P",q:"Q",r:"R",s:"S",t:"T",u:"U",v:"V",w:"W",x:"X",y:"Y",z:"Z",A:"A",B:"B",C:"C",D:"D",E:"E",F:"F",G:"G",H:"H",I:"I",J:"J",K:"K",L:"L",M:"M",N:"N",O:"O",P:"P",Q:"Q",R:"R",S:"S",T:"T",U:"U",V:"V",W:"W",X:"X",Y:"Y",Z:"Z"},Oe.Formula.SpecialConstants={"#NULL!":"0,e#NULL!","#NUM!":"0,e#NUM!","#DIV/0!":"0,e#DIV/0!","#VALUE!":"0,e#VALUE!","#REF!":"0,e#REF!","#NAME?":"0,e#NAME?"},Oe.Formula.TokenPrecedence={"!":1,":":2,",":2,M:-3,P:-3,"%":4,"^":5,"*":6,"/":6,"+":7,"-":7,"&":8,"<":9,">":9,G:9,L:9,N:9},Oe.Formula.TokenOpExpansion={G:">=",L:"<=",M:"-",N:"<>",P:"+"},Oe.Formula.TypeLookupTable={unaryminus:{"n*":"|n*:1|","e*":"|e*:1|","t*":"|t*:e#VALUE!|",b:"|b:n|"},unaryplus:{"n*":"|n*:1|","e*":"|e*:1|","t*":"|t*:e#VALUE!|",b:"|b:n|"},unarypercent:{"n*":"|n:n%|n*:n|","e*":"|e*:1|","t*":"|t*:e#VALUE!|",b:"|b:n|"},plus:{"n%":"|n%:n%|nd:n|nt:n|ndt:n|n$:n|n:n|n*:n|b:n|e*:2|t*:e#VALUE!|",nd:"|n%:n|nd:nd|nt:ndt|ndt:ndt|n$:n|n:nd|n*:n|b:n|e*:2|t*:e#VALUE!|",nt:"|n%:n|nd:ndt|nt:nt|ndt:ndt|n$:n|n:nt|n*:n|b:n|e*:2|t*:e#VALUE!|",ndt:"|n%:n|nd:ndt|nt:ndt|ndt:ndt|n$:n|n:ndt|n*:n|b:n|e*:2|t*:e#VALUE!|",n$:"|n%:n|nd:n|nt:n|ndt:n|n$:n$|n:n$|n*:n|b:n|e*:2|t*:e#VALUE!|",nl:"|n%:n|nd:n|nt:n|ndt:n|n$:n|n:n|n*:n|b:n|e*:2|t*:e#VALUE!|",n:"|n%:n|nd:nd|nt:nt|ndt:ndt|n$:n$|n:n|n*:n|b:n|e*:2|t*:e#VALUE!|",b:"|n%:n%|nd:nd|nt:nt|ndt:ndt|n$:n$|n:n|n*:n|b:n|e*:2|t*:e#VALUE!|","t*":"|ni:1|n*:e#VALUE!|t*:e#VALUE!|b:e#VALUE!|e*:2|","n*":"|ni:1|e*:2|","e*":"|e*:1|n*:1|t*:1|b:1|"},concat:{t:"|t:t|th:th|tw:tw|tl:t|tr:tr|t*:2|e*:2|",th:"|t:th|th:th|tw:t|tl:th|tr:t|t*:t|e*:2|",tw:"|t:tw|th:t|tw:tw|tl:tw|tr:tw|t*:t|e*:2|",tl:"|t:tl|th:th|tw:tw|tl:tl|tr:tr|t*:t|e*:2|","t*":"|t*:t|e*:2|","e*":"|e*:1|n*:1|t*:1|"},oneargnumeric:{"n*":"|n*:n|","e*":"|e*:1|","t*":"|t*:e#VALUE!|",b:"|b:n|"},twoargnumeric:{"n*":"|n*:n|t*:e#VALUE!|e*:2|","e*":"|e*:1|n*:1|t*:1|","t*":"|t*:e#VALUE!|n*:e#VALUE!|e*:2|"},propagateerror:{"n*":"|n*:2|e*:2|","e*":"|e*:2|","t*":"|t*:2|e*:2|",b:"|b:2|e*:2|"}},Oe.Formula.ParseFormulaIntoTokens=function(e){var t,o,r,a,n,l,s,i=Oe.Formula,c=Oe.Constants,d=i.ParseState,u=i.TokenType,p=i.CharClass,h=i.CharClassTable,m=i.UpperCaseTable,f=i.ParsePushToken,g=/^\$?[A-Z]{1,2}\$?[1-9]\d*$/i,v=[],b="",C=0,y=!1,S="";for(t=0;t<=e.length;t++)r=t<e.length?h[o=e.charAt(t)]:(o="",p.eof),C==d.num&&(r==p.num?b+=o:r!=p.numstart||y?C="E"==o||"e"==o?(b+=o,y=!1,d.numexp1):(f(v,b,u.num,0),y=!1,0):(y=!0,b+=o)),C==d.numexp1&&(r==d.num?C=d.numexp2:"+"!=o&&"-"!=o||"E"!=m[b.charAt(b.length-1)]?"E"==o||"e"==o||(f(v,c.s_parseerrexponent,u.error,0),C=0):b+=o),C==d.numexp2&&(r==p.num?b+=o:(f(v,b,u.num,0),C=0)),C==d.alpha&&(r==p.num?C=d.coord:r==p.alpha||"."==o?b+=o:C=r==p.incoord?d.coord:(r==p.op||r==p.numstart||r==p.space||r==p.eof?f(v,b.toUpperCase(),u.name,0):f(v,c.s_parseerrchar,u.error,0),0)),C==d.coord&&(r==p.num?b+=o:r==p.incoord?b+=o:C=r==p.alpha?d.alphanumeric:(r==p.op||r==p.numstart||r==p.eof||r==p.space?(s=g.test(b)?u.coord:u.name,f(v,b.toUpperCase(),s,0)):f(v,c.s_parseerrchar,u.error,0),0)),C==d.alphanumeric&&(r==p.num||r==p.alpha?b+=o:C=(r==p.op||r==p.numstart||r==p.space||r==p.eof?f(v,b.toUpperCase(),u.name,0):f(v,c.s_parseerrchar,u.error,0),0)),C==d.string?r==p.quote?C=d.stringquote:r==p.eof?(f(v,c.s_parseerrstring,u.error,0),C=0):b+=o:C==d.stringquote?C=r==p.quote?(b+=o,d.string):(f(v,b,u.string,0),0):C==d.specialvalue&&("!"==b.charAt(b.length-1)?(f(v,b,u.name,0),C=0):r==p.eof?(f(v,c.s_parseerrspecialvalue,u.error,0),C=0):b+=o),0==C&&(r==p.num?(b=o,C=d.num):r==p.numstart?(b=o,y=!0,C=d.num):r==p.alpha||r==p.incoord?(b=o,C=d.alpha):r==p.specialstart?(b=o,C=d.specialvalue):r==p.op?(b=o,0<v.length?(n=(a=v[v.length-1]).type,l=a.text,n==p.op&&("<="!=(S=l+b)&&">="!=S&&"<>"!=S||(b=l+b,v.pop(),l=0<v.length?(n=(a=v[v.length-1]).type,a.text):(n=p.eof,"EOF")))):(n=p.eof,l="EOF"),s=u.op,0==v.length||n==p.op&&")"!=l&&"%"!=l?"-"==b?o=b="M":"+"==b?o=b="P":")"==b&&"("==l||"("!=b&&(s=u.error,b=c.s_parseerrtwoops):1<b.length&&(">="==b?o=b="G":"<="==b?o=b="L":"<>"==b?o=b="N":(s=u.error,b=c.s_parseerrtwoops)),f(v,b,s,o),C=0):r==p.quote?(b="",C=d.string):r==p.space||r==p.eof||f(v,c.s_parseerrchar,u.error,0));return v},Oe.Formula.ParsePushToken=function(e,t,o,r){e.push({text:t,type:o,opcode:r})},Oe.Formula.evaluate_parsed_formula=function(e,t,o){var r,a=Oe.Formula;a.TokenType;return r=a.ConvertInfixToPolish(e),a.EvaluatePolish(e,r,t,o)},Oe.Formula.ConvertInfixToPolish=function(e){var t,o,r,a,n,l,s=Oe.Formula,i=Oe.Constants,c=s.TokenType,d=s.TokenPrecedence,u=[],p=[],h="";for(t=0;t<e.length;t++)if(r=(o=e[t]).type,a=o.text,r==c.num||r==c.coord||r==c.string)u.push(t);else if(r==c.name)p.push(t),u.push(-1);else{if(r==c.space)continue;if(","==a){for(;p.length&&"("!=e[p[p.length-1]].text;)u.push(p.pop());if(0==p.length){h=i.s_parseerrmissingopenparen;break}}else if("("==a)p.push(t);else if(")"==a){for(;p.length&&"("!=e[p[p.length-1]].text;)u.push(p.pop());if(0==p.length){h=i.s_parseerrcloseparennoopen;break}p.pop(),p.length&&e[p[p.length-1]].type==c.name&&u.push(p.pop())}else{if(r!=c.op){if(r==c.error){h=a;break}h="Internal error while processing parsed formula. ";break}for(p.length&&e[p[p.length-1]].type==c.name&&u.push(p.pop());p.length&&e[p[p.length-1]].type==c.op&&"("!=e[p[p.length-1]].text&&(n=d[o.opcode],l=d[e[p[p.length-1]].opcode],!(0<=n&&n<l))&&!(n<0&&(l<0&&(l=-l),(n=-n)<=l));)u.push(p.pop());p.push(t)}}for(;0<p.length;){if("("==e[p[p.length-1]].text){h=i.s_parseerrmissingcloseparen;break}u.push(p.pop())}return h||u},void 0===Oe.debug_log&&(Oe.debug_log=[]),Oe.DebugLog=function(e){},Oe.Formula.EvaluatePolish=function(e,t,o,r){function a(e,t){R.push({type:e,value:t})}var n,l,s,i,c,d,u,p,h,m,f,g,v,b=Oe.Formula,C=Oe.Constants,y=b.TokenType,S=b.LookupResultType,w=b.TypeLookupTable,x=b.OperandAsNumber,F=b.OperandAsText,T=b.OperandValueAndType,k=b.OperandsAsCoordOnSheet,E=Oe.format_number_for_display||function(e,t,o){return e+""},_="",P={value:"",type:"e#VALUE!",error:C.s_parseerrmissingoperand},R=[];if(!(e.length&&t instanceof Array))return{value:"",type:"e#VALUE!",error:"string"==typeof t?t:""};var A=[];for(n=0;n<t.length;n++)if(-1!=(l=t[n]))if(i=(s=e[l]).type,c=s.text,A.push(s),i==y.num)a("n",c-0);else if(i==y.coord)a("coord",c);else if(i==y.string)a("t",c);else if(i==y.op){if(R.length<=0)return P;if("M"==c)a(S((d=x(o,R)).type,d.type,w.unaryminus),-d.value);else if("P"==c)a(S((d=x(o,R)).type,d.type,w.unaryplus),d.value);else if("%"==c)a(S((d=x(o,R)).type,d.type,w.unarypercent),.01*d.value);else if("&"==c){if(R.length<=1)return P;u=F(o,R),a(S((d=F(o,R)).type,d.type,w.concat),d.value+u.value)}else if(":"==c){if(R.length<=1)return P;(d=b.OperandsAsRangeOnSheet(o,R)).error&&(_=_||d.error),a(d.type,d.value)}else if("!"==c){if(R.length<=1)return P;(d=k(o,R)).error&&(_=_||d.error),a(d.type,d.value)}else if("<"==c||"L"==c||"="==c||"G"==c||">"==c||"N"==c){if(R.length<=1){_=C.s_parseerrmissingoperand;break}u=T(o,R),"n"==(d=T(o,R)).type.charAt(0)&&"n"==u.type.charAt(0)?(f=0,"<"==c?f=d.value<u.value?1:0:"L"==c?f=d.value<=u.value?1:0:"="==c?f=d.value==u.value?1:0:"G"==c?f=d.value>=u.value?1:0:">"==c?f=d.value>u.value?1:0:"N"==c&&(f=d.value!=u.value?1:0),a("nl",f)):"e"==d.type.charAt(0)?a(d.type,0):"e"==u.type.charAt(0)?a(u.type,0):(p=d.type.charAt(0),h=u.type.charAt(0),"n"==p?d.value=E(d.value,"n",""):"b"==p&&(d.value=""),"n"==h?u.value=E(u.value,"n",""):"b"==h&&(u.value=""),f=0,d.value=d.value.toLowerCase(),u.value=u.value.toLowerCase(),"<"==c?f=d.value<u.value?1:0:"L"==c?f=d.value<=u.value?1:0:"="==c?f=d.value==u.value?1:0:"G"==c?f=d.value>=u.value?1:0:">"==c?f=d.value>u.value?1:0:"N"==c&&(f=d.value!=u.value?1:0),a("nl",f))}else{if(R.length<=1){_=C.s_parseerrmissingoperand;break}"+"==c?(u=T(o,R),a(S((d=T(o,R)).type,u.type,w.plus),d.value+u.value)):(u=x(o,R),d=x(o,R)),"-"==c?a(S(d.type,u.type,w.plus),d.value-u.value):"*"==c?a(S(d.type,u.type,w.plus),d.value*u.value):"/"==c?0!=u.value?a("n",d.value/u.value):a("e#DIV/0!",0):"^"==c&&(d.value=Math.pow(d.value,u.value),d.type="n",isNaN(d.value)&&(d.value=0,d.type="e#NUM!"),a(d.type,d.value))}}else{if(i!=y.name){_=C.s_InternalError+"Unknown token "+i+" ("+c+"). ";break}if(_=b.CalculateFunction(c,R,o,e.coord))break}else a("start",0);return value=R[0]?R[0].value:"","name"==(p=R[0]?R[0].type:"")&&(d=Oe.Formula.LookupName(o,value),value=d.value,p=d.type,_=_||d.error),"coord"==p&&(d=T(o,R),value=d.value,"b"==(p=d.type)&&(p="n",value=0)),1<R.length&&!_&&(_+=C.s_parseerrerrorinformula),"e"==(m=p).charAt(0)?_=_||p.substring(1)||C.s_calcerrerrorvalueinformula:"range"==p&&(v=(g=value.match(/^(.*)\|(.*)\|/))[1].indexOf("!"),g[1]=0<=v?g[1].substring(v+1)+"!"+g[1].substring(0,v).toUpperCase():g[1].toUpperCase(),value=g[1]+":"+g[2].toUpperCase(),r||(_=C.s_formularangeresult+" "+value)),_&&"e"!=m.charAt(0)&&(value=_,m="e"),"n"!=m.charAt(0)||!isNaN(value)&&isFinite(value)||(value=0,m="e#NUM!",_=isNaN(value)?C.s_calcerrnumericnan:C.s_calcerrnumericoverflow),{value:value,type:m,error:_}},Oe.Formula.LookupResultType=function(e,t,o){var r,a,n,l=o[e];return l||(l=o[e.charAt(0)+"*"])?0<=(r=l.indexOf("|"+t+":"))?(a=l.indexOf("|",r+1))<0?"e#VALUE! (internal error, incorrect LookupResultType "+l+")":"1"==(n=l.substring(r+t.length+2,a))?e:"2"==n?t:n:0<=(r=l.indexOf("|"+t.charAt(0)+"*:"))?(a=l.indexOf("|",r+1))<0?"e#VALUE! (internal error, incorrect LookupResultType "+l+")":"1"==(n=l.substring(r+4,a))?e:"2"==n?t:n:"e#VALUE!":"e#VALUE! (internal error, missing LookupResultType "+e.charAt(0)+"*)"},Oe.Formula.TopOfStackValueAndType=function(e,t){var o=Oe.Formula,r={type:"",value:""},a=t.length;return a?(r.value=t[a-1].value,r.type=t[a-1].type,t.pop(),"name"==r.type&&(r=o.LookupName(e,r.value))):r.error=Oe.Constants.s_InternalError+"no operand on stack",r},Oe.Formula.OperandAsNumber=function(e,t){var o,r,a=Oe.Formula.OperandValueAndType(e,t);return"n"==(o=a.type.charAt(0))?a.value=a.value-0:"b"==o?(a.type="n",a.value=0):"e"==o?a.value=0:("n"==(r=Oe.DetermineValueType?Oe.DetermineValueType(a.value):{value:a.value-0,type:"n"}).type.charAt(0)?a.value=r.value-0:a.value=0,a.type=r.type),a},Oe.Formula.OperandAsText=function(e,t){var o,r=Oe.Formula.OperandValueAndType(e,t);return"t"==(o=r.type.charAt(0))||("n"==o?(r.value=Oe.format_number_for_display?Oe.format_number_for_display(r.value,r.type,""):r.value=r.value+"",r.type="t"):"b"==o?(r.value="",r.type="t"):"e"==o?r.value="":(t.value=r.value+"",t.type="t")),r},Oe.Formula.OperandValueAndType=function(e,t){var o,r,a,n,l=Oe.Formula,s={type:"",value:""},i=t.length;if(!i)return s.error=Oe.Constants.s_InternalError+"no operand on stack",s;if(s.value=t[i-1].value,s.type=t[i-1].type,t.pop(),"name"==s.type&&(s=l.LookupName(e,s.value)),"range"==s.type&&(s=l.StepThroughRangeDown(t,s.value)),"coord"==s.type){if(n=e,-1!=(a=s.value.indexOf("!"))){if(null==(n=l.FindInSheetCache(s.value.substring(a+1))))return s.type="e#REF!",s.error=Oe.Constants.s_sheetunavailable+" "+s.value.substring(a+1),s.value=0,s;s.value=s.value.substring(0,a)}n?(r=n.cells[Oe.Formula.PlainCoord(s.value)])?(o=r.valuetype,s.value=r.datavalue):o="b":(o="e#N/A",s.value=0),s.type=o||"b","b"==s.type&&(s.value=0)}return s},Oe.Formula.OperandAsCoord=function(e,t){return Oe.Formula.OperandAsType(e,t,"coord")},Oe.Formula.OperandAsRange=function(e,t){return Oe.Formula.OperandAsType(e,t,"range")},Oe.Formula.OperandAsType=function(e,t,o){Oe.Formula;var r={type:"",value:""},a=t.length;return r.value=t[a-1].value,r.type=t[a-1].type,t.pop(),"name"==r.type&&(r=Oe.Formula.LookupName(e,r.value)),r.type==o||(r.value=Oe.Constants.s_calcerrcellrefmissing,r.type="e#REF!"),r},Oe.Formula.OperandsAsCoordOnSheet=function(e,t){var o,r,a,n,l={},s={},i=Oe.Formula,c=t.length;return l.value=t[c-1].value,l.type=t[c-1].type,t.pop(),o=i.OperandAsSheetName(e,t),null==(r=i.FindInSheetCache(o.value))?(s.type="e#REF!",s.value=0,s.error=Oe.Constants.s_sheetunavailable+" "+o.value):("name"==l.type&&(l=i.LookupName(r,l.value)),s.type=l.type,"coord"==l.type?s.value=l.value+"!"+o.value:"range"==l.type?(a=l.value.indexOf("|"),n=l.value.indexOf("|",a+1),s.value=l.value.substring(0,a)+"!"+o.value+"|"+l.value.substring(a+1,n)+"|"):"e"==l.type.charAt(0)?s.value=l.value:(s.error=Oe.Constants.s_calcerrcellrefmissing,s.type="e#REF!",s.value=0)),s},Oe.Formula.OperandsAsRangeOnSheet=function(e,t){var o,r,a,n,l={},s=Oe.Formula,i=Oe.Constants,c=t.length;return l.value=t[c-1].value,l.type=t[c-1].type,t.pop(),"coord"!=(o=s.OperandAsCoord(e,t)).type?{value:0,type:"e#REF!"}:(r=e,-1!=(a=o.value.indexOf("!"))&&((n=o.value.indexOf("|",a+1))<0&&(n=o.value.length),null==(r=s.FindInSheetCache(o.value.substring(a+1,n))))?{value:0,type:"e#REF!",errortext:i.s_sheetunavailable+" "+o.value.substring(a+1,n)}:("name"==l.type&&(l=s.LookupName(r,l.value,"end")),"coord"==l.type?{value:o.value+"|"+l.value+"|",type:"range"}:{value:i.s_calcerrcellrefmissing,type:"e#REF!"}))},Oe.Formula.OperandAsSheetName=function(e,t){Oe.Formula;var o,r,a={type:"",value:""},n=t.length;if(a.value=t[n-1].value,a.type=t[n-1].type,t.pop(),"name"==a.type){if(!(o=Oe.Formula.LookupName(e,a.value)).value)return a;a.value=o.value,a.type=o.type}return"coord"==a.type&&((r=e.cells[Oe.Formula.PlainCoord(a.value)])?(a.value=r.datavalue,a.type=r.valuetype):(a.value="",a.type="b")),"t"==a.type.charAt(0)||(a.value="",a.error=Oe.Constants.s_calcerrsheetnamemissing),a},Oe.Formula.LookupName=function(e,t,o){var r,a,n,l=e.names,s={},i=!1;if(l[t.toUpperCase()]){if(s.value=l[t.toUpperCase()].definition,"="==s.value.charAt(0)){if(e.checknamecirc){if(e.checknamecirc[t])return s.type="e#NAME?",s.error=Oe.Constants.s_circularnameref+' "'+t+'".',s}else e.checknamecirc={},i=!0;if(e.checknamecirc[t]=!0,n=Oe.Formula.ParseFormulaIntoTokens(s.value.substring(1)),s=Oe.Formula.evaluate_parsed_formula(n,e,1),delete e.checknamecirc[t],i&&delete e.checknamecirc,"range"!=s.type)return s}return-1!=(r=s.value.indexOf(":"))?(s.type="range",s.value=s.value.substring(0,r)+"|"+s.value.substring(r+1)+"|"):s.type="coord",s.value=s.value.toUpperCase(),s}return(a=Oe.Formula.SpecialConstants[t.toUpperCase()])?(r=a.indexOf(","),s.value=a.substring(0,r)-0,s.type=a.substring(r+1)):/^[a-zA-Z][a-zA-Z]?$/.test(t)?(s.type="coord",s.value=t.toUpperCase()+(o?e.attribs.lastrow:1)):(s.value="",s.type="e#NAME?",s.error=Oe.Constants.s_calcerrunknownname+' "'+t+'"'),s},Oe.Formula.StepThroughRangeDown=function(e,t){var o,r,a,n,l,s,i,c,d,u,p=Oe.Formula;for(n=t.indexOf("|"),l=t.indexOf("|",n+1),o=t.substring(0,n),r=t.substring(n+1,l),a=t.substring(l+1)-0,-1!=(n=o.indexOf("!"))?(s=o.substring(n),o=o.substring(0,n)):s="",-1!=(n=r.indexOf("!"))&&(r=r.substring(0,n)),u=0,d=(i=p.OrderRangeParts(o,r)).r1;d<=i.r2;d++)for(c=i.c1;c<=i.c2;c++)if(a<++u)return d==i.r2&&c==i.c2||p.PushOperand(e,"range",o+s+"|"+r+"|"+u),{value:Oe.crToCoord(c,d)+s,type:"coord"}},Oe.Formula.DecodeRangeParts=function(e,t){var o,r,a,n,l,s,i,c=Oe.Formula;return a=t.indexOf("|"),n=t.indexOf("|",a+1),o=t.substring(0,a),r=t.substring(a+1,n),-1!=(a=o.indexOf("!"))?(l=o.substring(a+1),o=o.substring(0,a)):l="",-1!=(a=r.indexOf("!"))&&(r=r.substring(0,a)),s=e,l&&null==(s=c.FindInSheetCache(l))?null:{sheetdata:s,sheetname:l,col1num:(i=c.OrderRangeParts(o,r)).c1,ncols:i.c2-i.c1+1,row1num:i.r1,nrows:i.r2-i.r1+1}},Oe.Formula.FunctionList||(Oe.Formula.FunctionList={}),Oe.Formula.FunctionClasses=null,Oe.Formula.FunctionArgDefs={},Oe.Formula.StoreIoEventFormula=function(e,t,o,r,a){var n=[];if(Oe.Formula.Clone(n,o),n.reverse(),0!=n.length){if(void 0===r.ioEventTree&&(r.ioEventTree={}),void 0===r.ioParameterList&&(r.ioParameterList={}),void 0===r.ioTimeTriggerList&&(r.ioTimeTriggerList={}),void 0===r.radioGroupList&&(r.radioGroupList={}),void 0===r.ioParameterList[t]&&(r.ioParameterList[t]={}),r.ioParameterList[t]=n,r.ioParameterList[t].function_name=e,"TimeTrigger"==a){function l(e,t,o){var r=o.cells[t];void 0!==r&&"n"==r.valuetype.charAt(0)&&e.push(r.datavalue)}var s=Oe.Formula.PlainCoord(n[0].value),i=[];if("range"==n[0].type)for(var c=Oe.Formula.DecodeRangeParts(r,s),d=0;d<c.ncols;d++)for(var u=0;u<c.nrows;u++){l(i,Oe.crToCoord(c.col1num+d,c.row1num+u),r)}if("coord"==n[0].type&&l(i,s,r),"n"==n[0].type.charAt(0)&&i.push(n[0].value),void 0===r.ioTimeTriggerList[t]||0==Oe.Formula.ArrayValuesEqual(r.ioTimeTriggerList[t],i)){r.ioTimeTriggerList[t]=i;for(var p=(new Date).getTimezoneOffset(),h=[],m=0;m<i.length;++m)h[m]=Math.floor(24*(i[m]-25569)*60+p);r.ScheduleSheetCommands("settimetrigger "+t+" "+h.toString())}}if("EventTree"==a&&("coord"==n[0].type||"range"==n[0].type)){function f(e,t,o){void 0===e[t]&&(e[t]={}),e[t][o]=o}var g=n[0].value.replace(/\$/g,"");if("range"==n[0].type)for(c=Oe.Formula.DecodeRangeParts(r,g),d=0;d<c.ncols;d++)for(u=0;u<c.nrows;u++){var v=Oe.crToCoord(c.col1num+d,c.row1num+u);f(r.ioEventTree,v,t)}"coord"==n[0].type&&f(r.ioEventTree,g,t)}if("Input"==a){var b=null!=Oe.CurrentSpreadsheetControlObject?Oe.CurrentSpreadsheetControlObject.formDataViewer:Oe.CurrentSpreadsheetViewerObject.formDataViewer;if(null!=b&&1==b.loaded){null==b.formFields&&Oe.Formula.LoadFormFields();var C=(e+t).toLowerCase(),y=null;if(null==b.formFields[C]){var S=b.formFields[C]=2+b.formFieldsLength++;y="set "+Oe.crToCoord(S,1)+" text t "+Oe.encodeForSave(e.toLowerCase()+t)}if("t"==n[0].type.charAt(0)||"n"==n[0].type.charAt(0)){var w=Oe.crToCoord(b.formFields[C],2);if(null==b.sheet.cells[w]||b.sheet.cells[w].datavalue!=n[0].value){var x="set "+w+" text t "+Oe.encodeForSave(n[0].value);y=null!=y?y+"\n"+x:x}}null!=y&&b.sheet.ScheduleSheetCommands(y,!1)}}}},Oe.Formula.ArrayValuesEqual=function(e,t){var o=e.length;if(o!=t.length)return!1;for(;o--;)if(e[o]!==t[o])return!1;return!0},Oe.Formula.Clone=function(e,t){for(var o in t)"object"==typeof t[o]&&null!==t[o]&&e[o]?Oe.Formula.Clone(e[o],t[o]):e[o]=t[o]},Oe.Formula.LoadFormFields=function(){var e=null!=Oe.CurrentSpreadsheetControlObject?Oe.CurrentSpreadsheetControlObject.formDataViewer:Oe.CurrentSpreadsheetViewerObject.formDataViewer;e.formFields={},null==e.sheet.cells.A1&&e.sheet.ScheduleSheetCommands("set A1 text t "+Oe.encodeForSave("FieldName:"),!1),null==e.sheet.cells.A2&&e.sheet.ScheduleSheetCommands("set A2 text t "+Oe.encodeForSave("Pending:"),!1);for(var t=2;;){var o=Oe.crToCoord(t,1),r=e.sheet.cells[o];if(!r)break;e.formFields[r.datavalue.toLowerCase()]=t,t++}e.formFieldsLength=t-2},Oe.Formula.CalculateFunction=function(e,t,o,r){var a,n,l,s,i,c=Oe.Formula,d="";if(a=c.FunctionList[e]){if(n=[],l=a[0],s=a[1],c.CopyFunctionArgs(t,n),a[6]&&""!=a[6]&&(Oe.DebugLog("action:"+e),c.StoreIoEventFormula(e,r,n,o,a[6])),100!=s)if(s<0){if(n.length<-s)return d=c.FunctionArgsError(e,t)}else if(n.length!=s)return d=c.FunctionArgsError(e,t);d=l(e,t,n,o,r)}else i=e,t.length&&"start"==t[t.length-1].type?(t.pop(),c.PushOperand(t,"name",i)):d=Oe.Constants.s_sheetfuncunknownfunction+" "+i+". ";return d},Oe.Formula.PushOperand=function(e,t,o){e.push({type:t,value:o})},Oe.Formula.CopyFunctionArgs=function(e,t){for(Oe.Formula;0<e.length&&"start"!=e[e.length-1].type;)t.push(e.pop());e.pop()},Oe.Formula.FunctionArgsError=function(e,t){var o=Oe.Constants.s_calcerrincorrectargstofunction+" "+e+". ";return Oe.Formula.PushOperand(t,"e#VALUE!",o),o},Oe.Formula.FunctionSpecificError=function(e,t,o,r){return Oe.Formula.PushOperand(t,o,r),r},Oe.Formula.CheckForErrorValue=function(e,t){return"e"==t.type.charAt(0)&&(e.push(t),!0)},Oe.Formula.FillFunctionInfo=function(){var e,t,o,r,a,n=Oe.Formula,l=Oe.Constants;if(!n.FunctionClasses){for(e in n.FunctionList)(t=n.FunctionList[e])[2]&&(n.FunctionArgDefs[t[2]]=l["s_farg_"+t[2]]||""),t[3]||l["s_fdef_"+e]&&(n.FunctionList[e][3]=l["s_fdef_"+e]);for(n.FunctionClasses={},a=0;a<l.function_classlist.length;a++)r=l.function_classlist[a],n.FunctionClasses[r]={name:l["s_fclass_"+r],items:[]};for(e in n.FunctionList)for((o=(t=n.FunctionList[e])[4]?t[4].split(","):[]).push("all"),a=0;a<o.length;a++)r=o[a],n.FunctionClasses[r].items.push(e);for(r in n.FunctionClasses)n.FunctionClasses[r].items.sort()}},Oe.Formula.FunctionArgString=function(e){var t,o,r,a=Oe.Formula,n=a.FunctionList[e],l=n[2];if(!l){if(0!=(t=n[1])){if(0<t){for(r="v1",o=2;o<=t;o++)r+=", v"+o;return r}if(t<0){for(r="v1",o=2;o<-t;o++)r+=", v"+o;return r+", ..."}return"nargs: "+t}l=" "}return r=a.FunctionArgDefs[l]||l},Oe.Formula.SeriesFunctions=function(e,o,t,r){function a(e,t){o.push({type:e,value:t})}for(var n,l,s,i,c,d,u,p,h,m=Oe.Formula,f=m.OperandValueAndType,g=m.LookupResultType,v=m.TypeLookupTable.plus,b="",C=0,y="",S=0,w=0,x=0,F=1;0<t.length;)"n"==(l=(n=f(r,t)).type.charAt(0))&&(S+=1),"b"!=l&&(w+=1),"b"==l&&(x+=1),"e"!=l&&"b"!=l&&(b+=n.value),"n"==l?(C+=s=n.value-0,F*=s,i=null!=i?i<s?s:i:s,c=null!=c?s<c?s:c:s,1==S?(p=s,h=0):(h=u=h+(s-p)*(s-(d=p+(s-p)/S)),p=d),y=g(n.type,y||n.type,v)):"e"==l&&"e"!=y.charAt(0)&&(y=n.type);switch(y=y||"n",e){case"CONCAT":case"CONCATENATE":a("t",b);break;case"SUM":a(y,C);break;case"PRODUCT":a(y,F);break;case"MIN":a(y,c||0);break;case"MAX":a(y,i||0);break;case"COUNT":a("n",S);break;case"COUNTA":a("n",w);break;case"COUNTBLANK":a("n",x);break;case"AVERAGE":0<S?a(y,C/S):a("e#DIV/0!",0);break;case"STDEV":1<S?a(y,Math.sqrt(u/(S-1))):a("e#DIV/0!",0);break;case"STDEVP":1<S?a(y,Math.sqrt(u/S)):a("e#DIV/0!",0);break;case"VAR":1<S?a(y,u/(S-1)):a("e#DIV/0!",0);break;case"VARP":1<S?a(y,u/S):a("e#DIV/0!",0)}return null},Oe.Formula.FunctionList.AVERAGE=[Oe.Formula.SeriesFunctions,-1,"vn",null,"stat"],Oe.Formula.FunctionList.CONCAT=[Oe.Formula.SeriesFunctions,-1,"vn",null,"text"],Oe.Formula.FunctionList.CONCATENATE=[Oe.Formula.SeriesFunctions,-1,"vn",null,"text"],Oe.Formula.FunctionList.COUNT=[Oe.Formula.SeriesFunctions,-1,"vn",null,"stat"],Oe.Formula.FunctionList.COUNTA=[Oe.Formula.SeriesFunctions,-1,"vn",null,"stat"],Oe.Formula.FunctionList.COUNTBLANK=[Oe.Formula.SeriesFunctions,-1,"vn",null,"stat"],Oe.Formula.FunctionList.MAX=[Oe.Formula.SeriesFunctions,-1,"vn",null,"stat"],Oe.Formula.FunctionList.MIN=[Oe.Formula.SeriesFunctions,-1,"vn",null,"stat"],Oe.Formula.FunctionList.PRODUCT=[Oe.Formula.SeriesFunctions,-1,"vn",null,"stat"],Oe.Formula.FunctionList.STDEV=[Oe.Formula.SeriesFunctions,-1,"vn",null,"stat"],Oe.Formula.FunctionList.STDEVP=[Oe.Formula.SeriesFunctions,-1,"vn",null,"stat"],Oe.Formula.FunctionList.SUM=[Oe.Formula.SeriesFunctions,-1,"vn",null,"stat"],Oe.Formula.FunctionList.VAR=[Oe.Formula.SeriesFunctions,-1,"vn",null,"stat"],Oe.Formula.FunctionList.VARP=[Oe.Formula.SeriesFunctions,-1,"vn",null,"stat"],Oe.Formula.SumProductFunction=function(e,o,t,r){function a(e,t){o.push({type:e,value:t})}for(var n,l=[],s=0,c=Oe.Formula,d=0,u=0;0<t.length;){if("range"!=(n=c.TopOfStackValueAndType(r,t)).type)return void a("e#VALUE!",0);if(rangeinfo=c.DecodeRangeParts(r,n.value),d){if(d!=rangeinfo.ncols)return void a("e#VALUE!",0)}else d=rangeinfo.ncols;if(u){if(u!=rangeinfo.nrows)return void a("e#VALUE!",0)}else u=rangeinfo.nrows;for(i=0;i<rangeinfo.ncols;i++)for(j=0;j<rangeinfo.nrows;j++)k=i*rangeinfo.nrows+j,cellcr=Oe.crToCoord(rangeinfo.col1num+i,rangeinfo.row1num+j),cell=rangeinfo.sheetdata.GetAssuredCell(cellcr),value="n"==cell.valuetype?cell.datavalue:0,l[k]=(void 0!==l[k]?l[k]:1)*value}for(i=0;i<l.length;i++)s+=l[i];a("n",s)},Oe.Formula.FunctionList.SUMPRODUCT=[Oe.Formula.SumProductFunction,-1,"rangen","","stat"],Oe.Formula.DSeriesFunctions=function(e,o,t,r){function a(e,t){o.push({type:e,value:t})}var n,l,s,i,c,d,u,p,h,m,f,g,v,b,C,y,S,w,x,F,T,k,E,_,P,R=Oe.Formula,A=(R.OperandValueAndType,R.LookupResultType),L=R.TypeLookupTable.plus,M={},I=0,D="",N=0,O=0,U=0,z=1;if(l=R.TopOfStackValueAndType(r,t),s=R.OperandValueAndType(r,t),i=R.TopOfStackValueAndType(r,t),"range"!=l.type||"range"!=i.type)return R.FunctionArgsError(e,o);if(c=R.DecodeRangeParts(r,l.value),d=R.DecodeRangeParts(r,i.value),(u=R.FieldToColnum(c.sheetdata,c.col1num,c.ncols,c.row1num,s.value,s.type))<=0)a("e#VALUE!",0);else{for(p=c.col1num+u-1,v=[],h=0;h<d.ncols;h++){if(g=d.sheetdata.GetAssuredCell(Oe.crToCoord(d.col1num+h,d.row1num)),criterianum=R.FieldToColnum(c.sheetdata,c.col1num,c.ncols,c.row1num,g.datavalue,g.valuetype),criterianum<=0)return void a("e#VALUE!",0);v.push(c.col1num+criterianum-1)}for(h=1;h<c.nrows;h++){b=!1;e:for(m=1;m<d.nrows;m++){for(f=0;f<d.ncols;f++)if(C=Oe.crToCoord(d.col1num+f,d.row1num+m),("string"!=typeof(y=(g=d.sheetdata.GetAssuredCell(C)).datavalue)||0!=y.length)&&(S=v[f],w=Oe.crToCoord(S,c.row1num+h),g=c.sheetdata.GetAssuredCell(w),!R.TestCriteria(g.datavalue,g.valuetype||"b",y)))continue e;b=!0;break e}b&&(n=Oe.crToCoord(p,c.row1num+h),g=c.sheetdata.GetAssuredCell(n),M.value=g.datavalue,M.type=g.valuetype,U+=1,"n"==(x=M.type.charAt(0))&&(N+=1),"b"!=x&&(O+=1),"b"==x&&1,"n"==x?(v1=M.value-0,I+=v1,z*=v1,F=null!=F?v1>F?v1:F:v1,T=null!=T?v1<T?v1:T:v1,1==N?(_=v1,P=0):(k=_+(v1-_)/N,P=E=P+(v1-_)*(v1-k),_=k),D=A(M.type,D||M.type,L)):"e"==x&&"e"!=D.charAt(0)&&(D=M.type))}switch(D=D||"n",e){case"DSUM":a(D,I);break;case"DPRODUCT":a(D,z);break;case"DMIN":a(D,T||0);break;case"DMAX":a(D,F||0);break;case"DCOUNT":a("n",N);break;case"DCOUNTA":a("n",O);break;case"DAVERAGE":0<N?a(D,I/N):a("e#DIV/0!",0);break;case"DSTDEV":1<N?a(D,Math.sqrt(E/(N-1))):a("e#DIV/0!",0);break;case"DSTDEVP":1<N?a(D,Math.sqrt(E/N)):a("e#DIV/0!",0);break;case"DVAR":1<N?a(D,E/(N-1)):a("e#DIV/0!",0);break;case"DVARP":1<N?a(D,E/N):a("e#DIV/0!",0);break;case"DGET":1==U?a(M.type,M.value):a(0==U?"e#VALUE!":"e#NUM!",0)}}},Oe.Formula.FunctionList.DAVERAGE=[Oe.Formula.DSeriesFunctions,3,"dfunc","","stat"],Oe.Formula.FunctionList.DCOUNT=[Oe.Formula.DSeriesFunctions,3,"dfunc","","stat"],Oe.Formula.FunctionList.DCOUNTA=[Oe.Formula.DSeriesFunctions,3,"dfunc","","stat"],Oe.Formula.FunctionList.DGET=[Oe.Formula.DSeriesFunctions,3,"dfunc","","stat"],Oe.Formula.FunctionList.DMAX=[Oe.Formula.DSeriesFunctions,3,"dfunc","","stat"],Oe.Formula.FunctionList.DMIN=[Oe.Formula.DSeriesFunctions,3,"dfunc","","stat"],Oe.Formula.FunctionList.DPRODUCT=[Oe.Formula.DSeriesFunctions,3,"dfunc","","stat"],Oe.Formula.FunctionList.DSTDEV=[Oe.Formula.DSeriesFunctions,3,"dfunc","","stat"],Oe.Formula.FunctionList.DSTDEVP=[Oe.Formula.DSeriesFunctions,3,"dfunc","","stat"],Oe.Formula.FunctionList.DSUM=[Oe.Formula.DSeriesFunctions,3,"dfunc","","stat"],Oe.Formula.FunctionList.DVAR=[Oe.Formula.DSeriesFunctions,3,"dfunc","","stat"],Oe.Formula.FunctionList.DVARP=[Oe.Formula.DSeriesFunctions,3,"dfunc","","stat"],Oe.Formula.FieldToColnum=function(e,t,o,r,a,n){var l;if("n"==n.charAt(0))return(l=a-0)<=0||o<l?0:Math.floor(l);if("t"!=n.charAt(0))return 0;for(a=a?a.toLowerCase():"",l=0;l<o;l++)if((e.GetAssuredCell(Oe.crToCoord(t+l,r)).datavalue+"").toLowerCase()==a)return l+1;return 0},Oe.Formula.LookupFunctions=function(e,o,t,r){function a(e,t){o.push({type:e,value:t})}var n,l,s,i,c,d,u,p,h,m,f,g,v,b,C,y,S=Oe.Formula,w=S.OperandValueAndType;S.LookupResultType,S.TypeLookupTable.plus;if("string"==typeof(y=w(r,t)).value&&(y.value=y.value.toLowerCase()),n=S.TopOfStackValueAndType(r,t),l=1,"MATCH"==e){if(t.length){if("n"!=(l=S.OperandAsNumber(r,t)).type.charAt(0))return void a("e#VALUE!",0);if(t.length)return S.FunctionArgsError(e,o),0;l=l.value-0}}else{if("n"!=(s=S.OperandAsNumber(r,t)).type.charAt(0))return void a("e#VALUE!",0);if(s=Math.floor(s.value),t.length){if("n"!=(l=S.OperandAsNumber(r,t)).type.charAt(0))return void a("e#VALUE!",0);if(t.length)return S.FunctionArgsError(e,o),0;l=l.value?1:0}}if(y.type=y.type.charAt(0),"n"==y.type&&(y.value=y.value-0),"range"!=n.type)return S.FunctionArgsError(e,o),0;if(i=S.DecodeRangeParts(r,n.value,n.type)){if(p=u=d=c=0,"HLOOKUP"==e){if(u=1,s>i.nrows)return void a("e#REF!",0)}else if("VLOOKUP"==e){if(p=1,s>i.ncols)return void a("e#REF!",0)}else{if("MATCH"!=e)return S.FunctionArgsError(e,o),0;if(1<i.ncols){if(1<i.nrows)return void a("e#N/A",0);u=1}else p=1}if(s<1&&"MATCH"!=e)return a("e#VALUE!",0),0;for(;;){if(C=Oe.crToCoord(i.col1num+c,i.row1num+d),v=(g=i.sheetdata.GetAssuredCell(C)).datavalue,"n"==(b=g.valuetype?g.valuetype.charAt(0):"b")&&(v-=0),l){if("n"==y.type&&"n"==b){if(y.value==v)break;if(0<l&&y.value>v||l<0&&y.value<v)h=1,m=c,f=d;else if(h){h=2;break}}else if("t"==y.type&&"t"==b){if(v="string"==typeof v?v.toLowerCase():"",y.value==v)break;if(0<l&&y.value>v||l<0&&y.value<v)h=1,m=c,f=d;else if(h){h=2;break}}}else if("n"==y.type&&"n"==b){if(y.value==v)break}else if("t"==y.type&&"t"==b&&(v="string"==typeof v?v.toLowerCase():"",y.value==v))break;if(c+=u,(d+=p)>=i.nrows||c>=i.ncols){if(h){h=2;break}return void a("e#N/A",0)}}2==h&&(d=f,c=m),a(b="MATCH"==e?(v=c+d+1,"n"):(C=Oe.crToCoord(i.col1num+c+("VLOOKUP"==e?s-1:0),i.row1num+d+("HLOOKUP"==e?s-1:0)),v=(g=i.sheetdata.GetAssuredCell(C)).datavalue,g.valuetype),v)}else a("e#REF!",0)},Oe.Formula.FunctionList.HLOOKUP=[Oe.Formula.LookupFunctions,-3,"hlookup","","lookup"],Oe.Formula.FunctionList.MATCH=[Oe.Formula.LookupFunctions,-2,"match","","lookup"],Oe.Formula.FunctionList.VLOOKUP=[Oe.Formula.LookupFunctions,-3,"vlookup","","lookup"],Oe.Formula.IndexFunction=function(e,o,t,r){function a(e,t){o.push({type:e,value:t})}var n,l,s,i,c,d,u=Oe.Formula;if("range"!=(n=u.TopOfStackValueAndType(r,t)).type)return u.FunctionArgsError(e,o),0;if(l=(s=u.DecodeRangeParts(r,n.value,n.type)).sheetname?"!"+s.sheetname:"",i={value:0},c={value:0},t.length){if("n"!=(i=u.OperandAsNumber(r,t)).type.charAt(0)||i.value<0)return void a("e#VALUE!",0);if(t.length){if("n"!=(c=u.OperandAsNumber(r,t)).type.charAt(0)||c.value<0)return void a("e#VALUE!",0);if(t.length)return u.FunctionArgsError(e,o),0}else 1==s.nrows&&(c.value=i.value,i.value=0)}i.value>s.nrows||c.value>s.ncols?a("e#REF!",0):a(0==i.value?0==c.value?1==s.nrows&&1==s.ncols?(d=Oe.crToCoord(s.col1num,s.row1num)+l,"coord"):(d=Oe.crToCoord(s.col1num,s.row1num)+l+"|"+Oe.crToCoord(s.col1num+s.ncols-1,s.row1num+s.nrows-1)+"|","range"):1==s.nrows?(d=Oe.crToCoord(s.col1num+c.value-1,s.row1num)+l,"coord"):(d=Oe.crToCoord(s.col1num+c.value-1,s.row1num)+l+"|"+Oe.crToCoord(s.col1num+c.value-1,s.row1num+s.nrows-1)+"|","range"):0==c.value?1==s.ncols?(d=Oe.crToCoord(s.col1num,s.row1num+i.value-1)+l,"coord"):(d=Oe.crToCoord(s.col1num,s.row1num+i.value-1)+l+"|"+Oe.crToCoord(s.col1num+s.ncols-1,s.row1num+i.value-1)+"|","range"):(d=Oe.crToCoord(s.col1num+c.value-1,s.row1num+i.value-1)+l,"coord"),d)},Oe.Formula.FunctionList.INDEX=[Oe.Formula.IndexFunction,-1,"index","","lookup"],Oe.Formula.CountifSumifFunctions=function(e,o,t,r){function a(e,t){o.push({type:e,value:t})}var n,l,s,i,c,d,u=0,p="",h=0,m=Oe.Formula,f=m.OperandValueAndType,g=m.LookupResultType,v=m.TypeLookupTable.plus;if(n=m.TopOfStackValueAndType(r,t),l=m.OperandAsText(r,t),"SUMIF"==e)if(1==t.length)s=m.TopOfStackValueAndType(r,t);else{if(0!=t.length)return m.FunctionArgsError(e,o),0;s={value:n.value,type:n.type}}else s={value:n.value,type:n.type};if("n"==l.type.charAt(0)?l.value=l.value+"":"e"==l.type.charAt(0)?l.value=null:"b"==l.type.charAt(0)&&(l.value=null),"coord"!=n.type&&"range"!=n.type)return m.FunctionArgsError(e,o),0;if("SUMIF"==e&&"coord"!=s.type&&"range"!=s.type)return m.FunctionArgsError(e,o),0;for(t.push(n),(i=[]).push(s);t.length;)c=f(r,t),d=f(r,i),m.TestCriteria(c.value,c.type,l.value)&&(h+=1,"n"==d.type.charAt(0)?(u+=d.value-0,p=g(d.type,p||d.type,v)):"e"==d.type.charAt(0)&&"e"!=p.charAt(0)&&(p=d.type));p=p||"n","SUMIF"==e?a(p,u):"COUNTIF"==e&&a("n",h)},Oe.Formula.FunctionList.COUNTIF=[Oe.Formula.CountifSumifFunctions,2,"rangec","","stat"],Oe.Formula.FunctionList.SUMIF=[Oe.Formula.CountifSumifFunctions,-2,"sumif","","stat"],Oe.Formula.SumifsFunction=function(e,t,o,r){var a,n,l,s,i,c,d=0,u="",p=Oe.Formula,h=p.OperandValueAndType,m=p.LookupResultType,f=p.TypeLookupTable.plus;if("coord"!=(l=p.TopOfStackValueAndType(r,o)).type&&"range"!=l.type)return p.FunctionArgsError(e,t),0;for(var g,v,b=[],C=[];o.length;){if(a=p.TopOfStackValueAndType(r,o),"n"==(n=p.OperandAsText(r,o)).type.charAt(0)?n.value=n.value+"":"e"==n.type.charAt(0)?n.value=null:"b"==n.type.charAt(0)&&(n.value=null),"coord"!=a.type&&"range"!=a.type)return p.FunctionArgsError(e,t),0;b.push([a]),C.push(n)}for((s=[]).push(l);s.length;){c=h(r,s);for(var y=!0,S=0;S<b.length;S++)i=h(r,b[S]),y&&(p.TestCriteria(i.value,i.type,C[S].value)||(y=!1));y&&("n"==c.type.charAt(0)?(d+=c.value-0,u=m(c.type,u||c.type,f)):"e"==c.type.charAt(0)&&"e"!=u.charAt(0)&&(u=c.type))}g=u=u||"n",v=d,t.push({type:g,value:v})},Oe.Formula.FunctionList.SUMIFS=[Oe.Formula.SumifsFunction,-3,"sum_range, criteria_range1, criteria1, [criteria_range2, criteria2, ... criteria_range_n, criteria_n]","","stat"],Oe.Formula.IfFunction=function(e,t,o,r){var a,n,l=Oe.Formula;if("n"==(n=(a=Oe.Formula.OperandValueAndType(r,o)).type.charAt(0))||"b"==n){var s,i;if(s=o.pop(),1==o.length)i=o.pop();else{if(0!=o.length)return void l.FunctionArgsError(e,t);i={type:"n",value:0}}t.push(a.value?s:i)}else t.push({type:"e#VALUE!",value:0})},Oe.Formula.FunctionList.IF=[Oe.Formula.IfFunction,-2,"iffunc","","test"],Oe.Formula.DateFunction=function(e,t,o,r){var a=Oe.Formula,n=0,l=a.OperandAsNumber(r,o),s=a.OperandAsNumber(r,o),i=a.OperandAsNumber(r,o),c=a.LookupResultType(l.type,s.type,a.TypeLookupTable.twoargnumeric);"n"==(c=a.LookupResultType(c,i.type,a.TypeLookupTable.twoargnumeric)).charAt(0)&&(n=Oe.FormatNumber.convert_date_gregorian_to_julian(Math.floor(l.value),Math.floor(s.value),Math.floor(i.value))-Oe.FormatNumber.datevalues.julian_offset,c="nd"),a.PushOperand(t,c,n)},Oe.Formula.FunctionList.DATE=[Oe.Formula.DateFunction,3,"date","","datetime"],Oe.Formula.TimeFunction=function(e,t,o,r){var a=Oe.Formula,n=0,l=a.OperandAsNumber(r,o),s=a.OperandAsNumber(r,o),i=a.OperandAsNumber(r,o),c=a.LookupResultType(l.type,s.type,a.TypeLookupTable.twoargnumeric);"n"==(c=a.LookupResultType(c,i.type,a.TypeLookupTable.twoargnumeric)).charAt(0)&&(n=(60*l.value*60+60*s.value+i.value)/86400,c="nt"),a.PushOperand(t,c,n)},Oe.Formula.FunctionList.TIME=[Oe.Formula.TimeFunction,3,"hms","","datetime"],Oe.Formula.DMYFunctions=function(e,t,o,r){var a,n,l,s=Oe.Formula,i=0,c=s.OperandAsNumber(r,o),d=s.LookupResultType(c.type,c.type,s.TypeLookupTable.oneargnumeric);if("n"==d.charAt(0))switch(a=Oe.FormatNumber.convert_date_julian_to_gregorian(Math.floor(c.value+Oe.FormatNumber.datevalues.julian_offset)),e){case"DAY":i=a.day;break;case"MONTH":i=a.month;break;case"YEAR":i=a.year;break;case"WEEKDAY":if(n={value:1},o.length){if("n"!=(n=s.OperandAsNumber(r,o)).type.charAt(0)||n.value<1||3<n.value)return void s.PushOperand(t,"e#VALUE!",0);if(o.length)return void s.FunctionArgsError(e,t)}l=6,1<n.value&&(l-=1),i=Math.floor(c.value+l)%7+(n.value<3?1:0)}s.PushOperand(t,d,i)},Oe.Formula.FunctionList.DAY=[Oe.Formula.DMYFunctions,1,"v","","datetime"],Oe.Formula.FunctionList.MONTH=[Oe.Formula.DMYFunctions,1,"v","","datetime"],Oe.Formula.FunctionList.YEAR=[Oe.Formula.DMYFunctions,1,"v","","datetime"],Oe.Formula.FunctionList.WEEKDAY=[Oe.Formula.DMYFunctions,-1,"weekday","","datetime"],Oe.Formula.HMSFunctions=function(e,t,o,r){var a,n,l,s,i=Oe.Formula,c=0,d=i.OperandAsNumber(r,o),u=i.LookupResultType(d.type,d.type,i.TypeLookupTable.oneargnumeric);if("n"==u.charAt(0)){if(d.value<0)return void i.PushOperand(t,"e#NUM!",0);s=d.value-Math.floor(d.value),s*=24,a=Math.floor(s),s-=Math.floor(s),s*=60,n=Math.floor(s),s-=Math.floor(s),s*=60,l=Math.floor(s+(0<=d.value?.5:-.5)),"HOUR"==e?c=a:"MINUTE"==e?c=n:"SECOND"==e&&(c=l)}i.PushOperand(t,u,c)},Oe.Formula.FunctionList.HOUR=[Oe.Formula.HMSFunctions,1,"v","","datetime"],Oe.Formula.FunctionList.MINUTE=[Oe.Formula.HMSFunctions,1,"v","","datetime"],Oe.Formula.FunctionList.SECOND=[Oe.Formula.HMSFunctions,1,"v","","datetime"],Oe.Formula.ExactFunction=function(e,t,o,r){var a=Oe.Formula,n=0,l="nl",s=a.OperandValueAndType(r,o),i=s.type.charAt(0),c=a.OperandValueAndType(r,o),d=c.type.charAt(0);"t"==i?"t"==d?n=s.value==c.value?1:0:"b"==d?n=s.value.length?0:1:"n"==d?n=s.value==c.value+""?1:0:"e"==d?(n=c.value,l=c.type):n=0:"n"==i?"n"==d?n=s.value-0==c.value-0?1:0:"b"==d?n=0:"t"==d?n=s.value+""==c.value?1:0:"e"==d?(n=c.value,l=c.type):n=0:"b"==i?"t"==d?n=c.value.length?0:1:"b"==d?n=1:"n"==d?n=0:"e"==d?(n=c.value,l=c.type):n=0:"e"==i&&(n=s.value,l=s.type),a.PushOperand(t,l,n)},Oe.Formula.FunctionList.EXACT=[Oe.Formula.ExactFunction,2,"","","text"],Oe.Formula.ArgList={FIND:[1,1,0],LEFT:[1,0],LEN:[1],LOWER:[1],MID:[1,0,0],PROPER:[1],REPLACE:[1,0,0,1],REPT:[1,0],RIGHT:[1,0],SUBSTITUTE:[1,1,1,0],TRIM:[1],HEXCODE:[1],UPPER:[1]},Oe.Formula.StringFunctions=function(e,t,o,r){var a,n,l,s,i,c,d=Oe.Formula,u=0,p="e#VALUE!",h=o.length,m=d.ArgList[e],f=[],g=[];for(a=1;a<=h;a++){if(a>m.length)return void d.FunctionArgsError(e,t);if(0==m[a-1]?n=d.OperandAsNumber(r,o):1==m[a-1]?n=d.OperandAsText(r,o):-1==m[a-1]&&(n=d.OperandValueAndType(r,o)),f[a]=n.value,g[a]=n.type,"e"==n.type.charAt(0))return void d.PushOperand(t,n.type,u)}switch(e){case"FIND":(l=g[3]?f[3]-1:0)<0?u="Start is before string":0<=(u=f[2].indexOf(f[1],l))?(u+=1,p="n"):u="Not found";break;case"LEFT":(s=g[2]?f[2]-0:1)<0?u="Negative length":(u=f[1].substring(0,s),p="t");break;case"LEN":u=f[1].length,p="n";break;case"LOWER":u=f[1].toLowerCase(),p="t";break;case"MID":i=f[2]-0,(s=f[3]-0)<1||i<1?u="Bad arguments":(u=f[1].substring(i-1,i+s-1),p="t");break;case"PROPER":u=f[1].replace(/\b\w+\b/g,function(e){return e.substring(0,1).toUpperCase()+e.substring(1)}),p="t";break;case"REPLACE":i=f[2]-0,(s=f[3]-0)<0||i<1?u="Bad arguments":(u=f[1].substring(0,i-1)+f[4]+f[1].substring(i-1+s),p="t");break;case"REPT":if((c=f[2]-0)<0)u="Negative count";else{for(u="";0<c;c--)u+=f[1];p="t"}break;case"RIGHT":(s=g[2]?f[2]-0:1)<0?u="Negative length":(u=f[1].slice(-s),p="t");break;case"SUBSTITUTE":if(fulltext=f[1],oldtext=f[2],newtext=f[3],null!=f[4]){if(which=f[4]-0,which<=0){u="Non-positive instance number";break}}else which=0;for(oldpos=c=0,u="";;){if(pos=fulltext.indexOf(oldtext,oldpos),!(0<=pos)){u+=fulltext.substring(oldpos);break}if(c++,u+=fulltext.substring(oldpos,pos),0==which)u+=newtext;else{if(which==c){u+=newtext+fulltext.substring(pos+oldtext.length);break}u+=oldtext}oldpos=pos+oldtext.length}p="t";break;case"TRIM":u=(u=(u=(u=f[1]).replace(/^ */,"")).replace(/ *$/,"")).replace(/ +/g," "),p="t";break;case"HEXCODE":var v=(u=String(f[1])).charCodeAt(0);if(55296<=v&&v<=56319){var b=u.charCodeAt(1);56320<=b&&b<=57343&&(v=1024*(v-55296)+(b-56320)+65536)}u=v.toString(16).toUpperCase(),p="t";break;case"UPPER":u=f[1].toUpperCase(),p="t"}d.PushOperand(t,p,u)},Oe.Formula.FunctionList.FIND=[Oe.Formula.StringFunctions,-2,"find","","text"],Oe.Formula.FunctionList.LEFT=[Oe.Formula.StringFunctions,-2,"tc","","text"],Oe.Formula.FunctionList.LEN=[Oe.Formula.StringFunctions,1,"txt","","text"],Oe.Formula.FunctionList.LOWER=[Oe.Formula.StringFunctions,1,"txt","","text"],Oe.Formula.FunctionList.MID=[Oe.Formula.StringFunctions,3,"mid","","text"],Oe.Formula.FunctionList.PROPER=[Oe.Formula.StringFunctions,1,"v","","text"],Oe.Formula.FunctionList.REPLACE=[Oe.Formula.StringFunctions,4,"replace","","text"],Oe.Formula.FunctionList.REPT=[Oe.Formula.StringFunctions,2,"tc","","text"],Oe.Formula.FunctionList.RIGHT=[Oe.Formula.StringFunctions,-1,"tc","","text"],Oe.Formula.FunctionList.SUBSTITUTE=[Oe.Formula.StringFunctions,-3,"subs","","text"],Oe.Formula.FunctionList.TRIM=[Oe.Formula.StringFunctions,1,"v","","text"],Oe.Formula.FunctionList.HEXCODE=[Oe.Formula.StringFunctions,1,"v","","text"],Oe.Formula.FunctionList.UPPER=[Oe.Formula.StringFunctions,1,"v","","text"],Oe.Formula.IsFunctions=function(e,t,o,r){var a=Oe.Formula,n=0,l=a.OperandValueAndType(r,o),s=l.type.charAt(0);switch(e){case"ISBLANK":n="b"==l.type?1:0;break;case"ISERR":n="e"==s?"e#N/A"==l.type?0:1:0;break;case"ISERROR":n="e"==s?1:0;break;case"ISLOGICAL":n="nl"==l.type?1:0;break;case"ISNA":n="e#N/A"==l.type?1:0;break;case"ISNONTEXT":n="t"==s?0:1;break;case"ISNUMBER":n="n"==s?1:0;break;case"ISTEXT":n="t"==s?1:0}a.PushOperand(t,"nl",n)},Oe.Formula.FunctionList.ISBLANK=[Oe.Formula.IsFunctions,1,"v","","test"],Oe.Formula.FunctionList.ISERR=[Oe.Formula.IsFunctions,1,"v","","test"],Oe.Formula.FunctionList.ISERROR=[Oe.Formula.IsFunctions,1,"v","","test"],Oe.Formula.FunctionList.ISLOGICAL=[Oe.Formula.IsFunctions,1,"v","","test"],Oe.Formula.FunctionList.ISNA=[Oe.Formula.IsFunctions,1,"v","","test"],Oe.Formula.FunctionList.ISNONTEXT=[Oe.Formula.IsFunctions,1,"v","","test"],Oe.Formula.FunctionList.ISNUMBER=[Oe.Formula.IsFunctions,1,"v","","test"],Oe.Formula.FunctionList.ISTEXT=[Oe.Formula.IsFunctions,1,"v","","test"],Oe.Formula.NTVFunctions=function(e,t,o,r){var a=Oe.Formula,n=0,l="e#VALUE!",s=a.OperandValueAndType(r,o),i=s.type.charAt(0);switch(e){case"N":n="n"==i?s.value-0:0,l="n";break;case"T":n="t"==i?s.value+"":"",l="t";break;case"VALUE":"n"==i||"b"==i?(n=s.value||0,l="n"):"t"==i&&(l="n"!=(s=Oe.DetermineValueType(s.value)).type.charAt(0)?(n=0,"e#VALUE!"):(n=s.value-0,"n"))}"e"==i&&(l=s.type),a.PushOperand(t,l,n)},Oe.Formula.FunctionList.N=[Oe.Formula.NTVFunctions,1,"v","","math"],Oe.Formula.FunctionList.T=[Oe.Formula.NTVFunctions,1,"v","","text"],Oe.Formula.FunctionList.VALUE=[Oe.Formula.NTVFunctions,1,"v","","text"],Oe.Formula.Math1Functions=function(e,t,o,r){var a,n,l,s={},i=Oe.Formula;if(n=(a=i.OperandAsNumber(r,o)).value,s.type=i.LookupResultType(a.type,a.type,i.TypeLookupTable.oneargnumeric),"n"==s.type)switch(e){case"ABS":n=Math.abs(n);break;case"ACOS":-1<=n&&n<=1?n=Math.acos(n):s.type="e#NUM!";break;case"ASIN":-1<=n&&n<=1?n=Math.asin(n):s.type="e#NUM!";break;case"ATAN":n=Math.atan(n);break;case"COS":n=Math.cos(n);break;case"DEGREES":n=180*n/Math.PI;break;case"EVEN":(n=n<0?-n:n)!=Math.floor(n)?n=Math.floor(n+1)+Math.floor(n+1)%2:n+=n%2,a.value<0&&(n=-n);break;case"EXP":n=Math.exp(n);break;case"FACT":for(l=1,n=Math.floor(n);0<n;n--)l*=n;n=l;break;case"INT":n=Math.floor(n);break;case"LN":n<=0&&(s.type="e#NUM!",s.error=Oe.Constants.s_sheetfunclnarg),n=Math.log(n);break;case"LOG10":n<=0&&(s.type="e#NUM!",s.error=Oe.Constants.s_sheetfunclog10arg),n=Math.log(n)/Math.log(10);break;case"ODD":(n=n<0?-n:n)!=Math.floor(n)?n=Math.floor(n+1)+(1-Math.floor(n+1)%2):n+=1-n%2,a.value<0&&(n=-n);break;case"RADIANS":n=n*Math.PI/180;break;case"SIN":n=Math.sin(n);break;case"SQRT":0<=n?n=Math.sqrt(n):s.type="e#NUM!";break;case"TAN":0!=Math.cos(n)?n=Math.tan(n):s.type="e#NUM!"}return s.value=n,t.push(s),null},Oe.Formula.FunctionList.ABS=[Oe.Formula.Math1Functions,1,"v","","math"],Oe.Formula.FunctionList.ACOS=[Oe.Formula.Math1Functions,1,"v","","math"],Oe.Formula.FunctionList.ASIN=[Oe.Formula.Math1Functions,1,"v","","math"],Oe.Formula.FunctionList.ATAN=[Oe.Formula.Math1Functions,1,"v","","math"],Oe.Formula.FunctionList.COS=[Oe.Formula.Math1Functions,1,"v","","math"],Oe.Formula.FunctionList.DEGREES=[Oe.Formula.Math1Functions,1,"v","","math"],Oe.Formula.FunctionList.EVEN=[Oe.Formula.Math1Functions,1,"v","","math"],Oe.Formula.FunctionList.EXP=[Oe.Formula.Math1Functions,1,"v","","math"],Oe.Formula.FunctionList.FACT=[Oe.Formula.Math1Functions,1,"v","","math"],Oe.Formula.FunctionList.INT=[Oe.Formula.Math1Functions,1,"v","","math"],Oe.Formula.FunctionList.LN=[Oe.Formula.Math1Functions,1,"v","","math"],Oe.Formula.FunctionList.LOG10=[Oe.Formula.Math1Functions,1,"v","","math"],Oe.Formula.FunctionList.ODD=[Oe.Formula.Math1Functions,1,"v","","math"],Oe.Formula.FunctionList.RADIANS=[Oe.Formula.Math1Functions,1,"v","","math"],Oe.Formula.FunctionList.SIN=[Oe.Formula.Math1Functions,1,"v","","math"],Oe.Formula.FunctionList.SQRT=[Oe.Formula.Math1Functions,1,"v","","math"],Oe.Formula.FunctionList.TAN=[Oe.Formula.Math1Functions,1,"v","","math"],Oe.Formula.Math2Functions=function(e,t,o,r){var a,n,l,s,i,c={},d=Oe.Formula;if(a=d.OperandAsNumber(r,o),n=d.OperandAsNumber(r,o),0,c.type=d.LookupResultType(a.type,n.type,d.TypeLookupTable.twoargnumeric),"n"==c.type)switch(e){case"ATAN2":0==a.value&&0==n.value?c.type="e#DIV/0!":c.value=Math.atan2(n.value,a.value);break;case"POWER":c.value=Math.pow(a.value,n.value),isNaN(c.value)&&(c.value=0,c.type="e#NUM!");break;case"MOD":0==n.value?c.type="e#DIV/0!":(l=a.value/n.value,l=Math.floor(l),c.value=a.value-l*n.value);break;case"TRUNC":if(s=1,0<=n.value){for(n.value=Math.floor(n.value),i=0;i<n.value;i++)s*=10;c.value=Math.floor(Math.abs(a.value)*s)/s}else if(n.value<0){for(n.value=Math.floor(-n.value),i=0;i<n.value;i++)s*=10;c.value=Math.floor(Math.abs(a.value)/s)*s}a.value<0&&(c.value=-c.value)}return t.push(c),null},Oe.Formula.FunctionList.ATAN2=[Oe.Formula.Math2Functions,2,"xy","","math"],Oe.Formula.FunctionList.MOD=[Oe.Formula.Math2Functions,2,"","","math"],Oe.Formula.FunctionList.POWER=[Oe.Formula.Math2Functions,2,"","","math"],Oe.Formula.FunctionList.TRUNC=[Oe.Formula.Math2Functions,2,"valpre","","math"],Oe.Formula.LogFunction=function(e,t,o,r){var a,n,l={},s=Oe.Formula;if(l.value=0,a=s.OperandAsNumber(r,o),l.type=s.LookupResultType(a.type,a.type,s.TypeLookupTable.oneargnumeric),1==o.length){if("n"!=(n=s.OperandAsNumber(r,o)).type.charAt(0)||n.value<=0)return s.FunctionSpecificError(e,t,"e#NUM!",Oe.Constants.s_sheetfunclogsecondarg),0}else{if(0!=o.length)return s.FunctionArgsError(e,t),0;n={value:Math.E,type:"n"}}if("n"==l.type){if(a.value<=0)return s.FunctionSpecificError(e,t,"e#NUM!",Oe.Constants.s_sheetfunclogfirstarg),0;l.value=Math.log(a.value)/Math.log(n.value)}t.push(l)},Oe.Formula.FunctionList.LOG=[Oe.Formula.LogFunction,-1,"log","","math"],Oe.Formula.RoundFunction=function(e,t,o,r){var a,n,l,s=Oe.Formula,i=0,c=s.OperandValueAndType(r,o),d=s.LookupResultType(c.type,c.type,s.TypeLookupTable.oneargnumeric);if(1==o.length){if("n"!=(a=s.OperandValueAndType(r,o)).type.charAt(0))return s.FunctionSpecificError(e,t,"e#NUM!",Oe.Constants.s_sheetfuncroundsecondarg),0}else{if(0!=o.length)return s.FunctionArgsError(e,t),0;a={value:0,type:"n"}}if("n"==d)if(a.value=a.value-0,0==a.value)i=Math.round(c.value);else if(0<a.value){for(n=1,a.value=Math.floor(a.value),l=0;l<a.value;l++)n*=10;i=Math.round(c.value*n)/n}else if(a.value<0){for(n=1,a.value=Math.floor(-a.value),l=0;l<a.value;l++)n*=10;i=Math.round(c.value/n)*n}s.PushOperand(t,d,i)},Oe.Formula.FunctionList.ROUND=[Oe.Formula.RoundFunction,-1,"vp","","math"],Oe.Formula.CeilingFloorFunctions=function(e,o,t,r){function a(e,t){o.push({type:e,value:t})}var n,l,s=Oe.Formula;if("n"==(n=s.OperandValueAndType(r,t)).type.charAt(0))if(0!=n.value){if(1==t.length){if(l=s.OperandValueAndType(r,t),"n"!=n.type.charAt(0))return void a("e#VALUE!",0)}else{if(0!=t.length)return void a("e#VALUE!",0);l={type:"n",value:0<n.value?1:-1}}if(0!=l.value)if(l.value*n.value<0)a("e#NUM!",0);else switch(e){case"CEILING":a("n",Math.ceil(n.value/l.value)*l.value);break;case"FLOOR":a("n",Math.floor(n.value/l.value)*l.value)}else a("n",0)}else a("n",0);else a("e#VALUE!",0)},Oe.Formula.FunctionList.CEILING=[Oe.Formula.CeilingFloorFunctions,-1,"vsig","","math"],Oe.Formula.FunctionList.FLOOR=[Oe.Formula.CeilingFloorFunctions,-1,"vsig","","math"],Oe.Formula.AndOrFunctions=function(e,t,o,r){var a,n,l=Oe.Formula,s="";for("AND"==e?n=1:"OR"==e&&(n=0);o.length;)"n"==(a=l.OperandValueAndType(r,o)).type.charAt(0)?(a.value=a.value-0,"AND"==e?n=0!=a.value?n:0:"OR"==e&&(n=0!=a.value?1:n),s=l.LookupResultType(a.type,s||"nl",l.TypeLookupTable.propagateerror)):"e"==a.type.charAt(0)&&"e"!=s.charAt(0)&&(s=a.type);s.length<1&&(s="e#VALUE!",n=0),l.PushOperand(t,s,n)},Oe.Formula.FunctionList.AND=[Oe.Formula.AndOrFunctions,-1,"vn","","test"],Oe.Formula.FunctionList.OR=[Oe.Formula.AndOrFunctions,-1,"vn","","test"],Oe.Formula.NotFunction=function(e,t,o,r){var a=0,n=Oe.Formula,l=n.OperandValueAndType(r,o),s=n.LookupResultType(l.type,l.type,n.TypeLookupTable.propagateerror);"n"==l.type.charAt(0)||"b"==l.type?(a=l.value-0!=0?0:1,s="nl"):"t"==l.type.charAt(0)&&(s="e#VALUE!"),n.PushOperand(t,s,a)},Oe.Formula.FunctionList.NOT=[Oe.Formula.NotFunction,1,"v","","test"],Oe.Formula.ChooseFunction=function(e,t,o,r){var a,n,l,s=0,i=Oe.Formula,c=i.OperandAsNumber(r,o);for("n"!=c.type.charAt(0)&&(c.value=0),c.value=Math.floor(c.value),n=0;o.length;)if(l=i.TopOfStackValueAndType(r,o),n+=1,c.value==n){s=l.value,a=l.type;break}a?i.PushOperand(t,a,s):i.PushOperand(t,"e#VALUE!",0)},Oe.Formula.FunctionList.CHOOSE=[Oe.Formula.ChooseFunction,-2,"choose","","lookup"],Oe.Formula.ColumnsRowsFunctions=function(e,t,o,r){var a,n,l=0,s=Oe.Formula,i=s.TopOfStackValueAndType(r,o);a="coord"==i.type?(l=1,"n"):"range"==i.type?(n=s.DecodeRangeParts(r,i.value),"COLUMNS"==e?l=n.ncols:"ROWS"==e&&(l=n.nrows),"n"):(l=0,"e#VALUE!"),s.PushOperand(t,a,l)},Oe.Formula.FunctionList.COLUMNS=[Oe.Formula.ColumnsRowsFunctions,1,"range","","lookup"],Oe.Formula.FunctionList.ROWS=[Oe.Formula.ColumnsRowsFunctions,1,"range","","lookup"],Oe.Formula.ZeroArgFunctions=function(e,t,o,r){var a,n,l,s={value:0};switch(e){case"FALSE":s.type="nl",s.value=0;break;case"NA":s.type="e#N/A";break;case"NOW":n=(a=new Date).getTimezoneOffset(),l=25569+(a=a.getTime()/1e3)/86400-n/1440,s.value=l,s.type="ndt",Oe.Formula.FreshnessInfo.volatile.NOW=!0;break;case"PI":s.type="n",s.value=Math.PI;break;case"TODAY":n=(a=new Date).getTimezoneOffset(),l=25569+(a=a.getTime()/1e3)/86400-n/1440,s.value=Math.floor(l),s.type="nd",Oe.Formula.FreshnessInfo.volatile.TODAY=!0;break;case"TRUE":s.type="nl",s.value=1;break;case"RAND":s.type="n",s.value=Math.random(),Oe.Formula.FreshnessInfo.volatile.RAND=!0}return t.push(s),null},Oe.Formula.FunctionList.FALSE=[Oe.Formula.ZeroArgFunctions,0,"","","test"],Oe.Formula.FunctionList.NA=[Oe.Formula.ZeroArgFunctions,0,"","","test"],Oe.Formula.FunctionList.NOW=[Oe.Formula.ZeroArgFunctions,0,"","","datetime"],Oe.Formula.FunctionList.RAND=[Oe.Formula.ZeroArgFunctions,0,"","","math"],Oe.Formula.FunctionList.PI=[Oe.Formula.ZeroArgFunctions,0,"","","math"],Oe.Formula.FunctionList.TODAY=[Oe.Formula.ZeroArgFunctions,0,"","","datetime"],Oe.Formula.FunctionList.TRUE=[Oe.Formula.ZeroArgFunctions,0,"","","test"],Oe.Formula.DDBFunction=function(e,t,o,r){var a,n,l,s,i=Oe.Formula,c=i.OperandAsNumber(r,o),d=i.OperandAsNumber(r,o),u=i.OperandAsNumber(r,o),p=i.OperandAsNumber(r,o);if(!(i.CheckForErrorValue(t,c)||i.CheckForErrorValue(t,d)||i.CheckForErrorValue(t,u)||i.CheckForErrorValue(t,p))){if(u.value<1)return i.FunctionSpecificError(e,t,"e#NUM!",Oe.Constants.s_sheetfuncddblife),0;if(a={value:2,type:"n"},0<o.length&&(a=i.OperandAsNumber(r,o)),0!=o.length)return i.FunctionArgsError(e,t),0;if(!i.CheckForErrorValue(t,a)){for(l=n=0,s=1;s<=p.value-0&&s<=u.value;s++)n=(c.value-l)*(a.value/u.value),c.value-l-n<d.value&&(n=c.value-l-d.value),l+=n;i.PushOperand(t,"n$",n)}}},Oe.Formula.FunctionList.DDB=[Oe.Formula.DDBFunction,-4,"ddb","","financial"],Oe.Formula.SLNFunction=function(e,t,o,r){var a,n=Oe.Formula,l=n.OperandAsNumber(r,o),s=n.OperandAsNumber(r,o),i=n.OperandAsNumber(r,o);if(!n.CheckForErrorValue(t,l)&&!n.CheckForErrorValue(t,s)&&!n.CheckForErrorValue(t,i)){if(i.value<1)return n.FunctionSpecificError(e,t,"e#NUM!",Oe.Constants.s_sheetfuncslnlife),0;a=(l.value-s.value)/i.value,n.PushOperand(t,"n$",a)}},Oe.Formula.FunctionList.SLN=[Oe.Formula.SLNFunction,3,"csl","","financial"],Oe.Formula.SYDFunction=function(e,t,o,r){var a,n,l=Oe.Formula,s=l.OperandAsNumber(r,o),i=l.OperandAsNumber(r,o),c=l.OperandAsNumber(r,o),d=l.OperandAsNumber(r,o);if(!(l.CheckForErrorValue(t,s)||l.CheckForErrorValue(t,i)||l.CheckForErrorValue(t,c)||l.CheckForErrorValue(t,d))){if(c.value<1||d.value<=0)return l.PushOperand(t,"e#NUM!",0),0;n=(c.value+1)*c.value/2,a=(s.value-i.value)*(c.value-d.value+1)/n,l.PushOperand(t,"n$",a)}},Oe.Formula.FunctionList.SYD=[Oe.Formula.SYDFunction,4,"cslp","","financial"],Oe.Formula.InterestFunctions=function(e,t,o,r){var a,n,l,s,i,c,d,u,p,h,m,f,g,v,b,C,y,S,w,x=Oe.Formula,F=x.OperandAsNumber(r,o),T=x.OperandAsNumber(r,o),k=x.OperandAsNumber(r,o);if(a=x.LookupResultType(F.type,T.type,x.TypeLookupTable.twoargnumeric),a=x.LookupResultType(a,k.type,x.TypeLookupTable.twoargnumeric),o.length&&(l=x.OperandAsNumber(r,o),a=x.LookupResultType(a,l.type,x.TypeLookupTable.twoargnumeric),o.length&&(s=x.OperandAsNumber(r,o),a=x.LookupResultType(a,s.type,x.TypeLookupTable.twoargnumeric),o.length))){if("RATE"!=e)return x.FunctionArgsError(e,t),0;i=x.OperandAsNumber(r,o),a=x.LookupResultType(a,i.type,x.TypeLookupTable.twoargnumeric)}if("n"==a)switch(e){case"FV":y=F.value,u=T.value,p=k.value,c=null!=l?l.value:0,h=null!=s&&s.value?1:0,n=d=0==y?-c-p*u:-(c*Math.pow(1+y,u)+p*(1+y*h)*(Math.pow(1+y,u)-1)/y),a="n$";break;case"NPER":if(y=F.value,p=T.value,c=k.value,d=null!=l?l.value:0,h=null!=s&&s.value?1:0,0==y){if(0==p)return void x.PushOperand(t,"e#NUM!",0);u=(c+d)/-p}else{if(0==(g=c+(f=p*(1+y*h)/y))||y<=-1)return void x.PushOperand(t,"e#NUM!",0);if((v=(f-d)/g)<=0)return void x.PushOperand(t,"e#NUM!",0);u=Math.log(v)/Math.log(1+y)}n=u,a="n";break;case"PMT":if(y=F.value,u=T.value,c=k.value,d=null!=l?l.value:0,h=null!=s&&s.value?1:0,0==u)return void x.PushOperand(t,"e#NUM!",0);n=p=0==y?(d-c)/u:(0-d-c*Math.pow(1+y,u))/((1+y*h)*(Math.pow(1+y,u)-1)/y),a="n$";break;case"PV":if(y=F.value,u=T.value,p=k.value,d=null!=l?l.value:0,h=null!=s&&s.value?1:0,-1==y)return void x.PushOperand(t,"e#DIV/0!",0);n=c=0==y?-d-p*u:(-d-p*(1+y*h)*(Math.pow(1+y,u)-1)/y)/Math.pow(1+y,u),a="n$";break;case"RATE":for(u=F.value,p=T.value,c=k.value,d=null!=l?l.value:0,h=null!=s&&s.value?1:0,m=null!=i?i.value:.1,100,C=0,delta=1,epsilon=1e-7,y=m||1e-8;(0<=delta?delta:-delta)>epsilon&&y!=S;)if(delta=d+c*Math.pow(1+y,u)+p*(1+y*h)*(Math.pow(1+y,u)-1)/y,b=(null!=b?(w=(delta-b)/(y-S)||.001,S=y,y-=delta/w):(S=y,y*=1.1),delta),100<=++C)return void x.PushOperand(t,"e#NUM!",0);n=y,a="n%"}x.PushOperand(t,a,n)},Oe.Formula.FunctionList.FV=[Oe.Formula.InterestFunctions,-3,"fv","","financial"],Oe.Formula.FunctionList.NPER=[Oe.Formula.InterestFunctions,-3,"nper","","financial"],Oe.Formula.FunctionList.PMT=[Oe.Formula.InterestFunctions,-3,"pmt","","financial"],Oe.Formula.FunctionList.PV=[Oe.Formula.InterestFunctions,-3,"pv","","financial"],Oe.Formula.FunctionList.RATE=[Oe.Formula.InterestFunctions,-3,"rate","","financial"],Oe.Formula.NPVFunction=function(e,t,o,r){var a,n,l,s,i=Oe.Formula,c=i.OperandAsNumber(r,o);if(!i.CheckForErrorValue(t,c)){for(n=0,a="n",l=1;o.length;)if("n"==(s=i.OperandValueAndType(r,o)).type.charAt(0)){if(0==(l*=1+c.value))return void i.PushOperand(t,"e#DIV/0!",0);n+=s.value/l,a=i.LookupResultType(s.type,a||s.type,i.TypeLookupTable.plus)}else if("e"==s.type.charAt(0)&&"e"!=a.charAt(0)){a=s.type;break}"n"==a.charAt(0)&&(a="n$"),i.PushOperand(t,a,n)}},Oe.Formula.FunctionList.NPV=[Oe.Formula.NPVFunction,-2,"npv","","financial"],Oe.Formula.IRRFunction=function(e,t,o,r){var a,n,l,s,i,c,d,u,p,h,m=[],f=[],g=Oe.Formula;for(m.push(o.pop());m.length;)if("n"==(a=g.OperandValueAndType(r,m)).type.charAt(0))f.push(a.value);else if("e"==a.type.charAt(0))return void g.PushOperand(t,"e#VALUE!",0);if(f.length){if(n={value:0},o.length){if("n"!=(n=g.OperandAsNumber(r,o)).type.charAt(0)&&"b"!=n.type.charAt(0))return void g.PushOperand(t,"e#VALUE!",0);if(o.length)return void g.FunctionArgsError(e,t)}for(n.value=n.value||.1,20,s=0,1e-7,i=n.value,u=1;1e-7<(0<=u?u:-u)&&i!=c;){for(p=1,h=u=0;h<f.length;h++){if(0==(p*=1+i))return void g.PushOperand(t,"e#DIV/0!",0);u+=f[h]/p}if(l=(null!=l?(d=(u-l)/(i-c),c=i,i-=u/d):(c=i,i*=1.1),u),20<=++s)return void g.PushOperand(t,"e#NUM!",0)}g.PushOperand(t,"n%",i)}else g.PushOperand(t,"e#NUM!",0)},Oe.Formula.FunctionList.IRR=[Oe.Formula.IRRFunction,-1,"irr","","financial"],Oe.Formula.IoFunctions=function(e,t,o,r,a){var n,l,s,i=Oe.Formula,c=0,d="e#VALUE!",u=o.length,p={BUTTON:[2],IMAGEBUTTON:[2],EMAIL:[14,14,14,14],EMAILIF:[13,14,14,14,14],EMAILONEDIT:[14,14,14,14,14],EMAILAT:[13,14,14,14,14],EMAILONEDITIF:[14,13,14,14,14,14],EMAILATIF:[13,13,14,14,14,14],SUBMIT:[2],TEXTBOX:[2],AUTOCOMPLETE:[2,14],SELECT:[2,14,1,1],CHECKBOX:[3],RADIOBUTTON:[2,2],COPYVALUE:[4,12,15],COPYFORMULA:[4,12,12],INSERT:[4,8,-12,-15],DELETEIF:[4,7,8],COMMAND:[4,14],COMMANDIF:[4,13,14],PANEL:[15,-12],SPLASH:[12],STYLE:[6]}[e],h=[],m=[],f=-1;for(L=1;L<=u;L++){if(-1!=f)s=Math.abs(p[l+(L-1-l)%f]);else{if(L>p.length)return void i.FunctionArgsError(e,t);(s=p[L-1])<0&&(f=p.length-(L-1),l=L-1,s=Math.abs(s))}if(1==s)n=i.OperandAsNumber(r,o);else if(2==s)n=i.OperandAsText(r,o);else if(3==s)n=i.OperandValueAndType(r,o);else{var g=o[o.length-1].type,v=!1;if(("n"==g.charAt(0)&&0!=(1&s)||"t"==g.charAt(0)&&0!=(2&s))&&(v=!0,n=i.OperandValueAndType(r,o)),"coord"==g&&0!=(4&s)&&(v=!0,(n=i.OperandAsCoord(r,o)).value=Oe.Formula.PlainCoord(n.value)),"range"==g&&0!=(8&s)&&(v=!0,(n=i.OperandAsRange(r,o)).value=Oe.Formula.PlainCoord(n.value)),0==v)return void i.FunctionArgsError(e,t)}if(h[L]=n.value,m[L]=n.type,"e"==n.type.charAt(0))return void i.PushOperand(t,n.type,c)}switch(e){case"STYLE":if(C=r.ioParameterList[a]){var b=Oe.Formula.getStandardizedList(r,{value:h[1],type:m[1]});0<b.length&&(C.css=b[0],C.cssParameter="t"==m[1]?'"'+h[1]+'"':h[1]),c="",d="ni"}break;case"SELECT":var C=r.ioParameterList[a],y=Oe.Formula.getStandardizedList(r,C[1]);if(C.html=[],C.html[0]=1==h[4]?"multiple":"",C.html[1]=h[3]?""+h[3]:"1",0<y.length){var S="<option>"+y.join("</option><option>")+"</option>",w=new RegExp("<option>"+h[1],"");C.html[2]=S.replace(w,"<option selected>"+h[1])}c=h[1],d="ti"+e;break;case"SUBMIT":c="Submit";case"BUTTON":case"IMAGEBUTTON":case"TEXTBOX":case"AUTOCOMPLETE":0<u&&(c=h[1]),d="ti"+e;break;case"EMAIL":case"EMAILIF":d="ti"+e,c="Send";break;case"EMAILONEDIT":case"EMAILONEDITIF":case"EMAILAT":case"EMAILATIF":d="ti"+e,c="Send Now";break;case"CHECKBOX":case"RADIOBUTTON":c="t"==m[1].charAt(0)?"TRUE"==h[1].toUpperCase()?1:0:0==h[1]?0:1,d="ni"+e;break;case"COPYVALUE":case"COPYFORMULA":case"INSERT":case"DELETEIF":case"COMMAND":case"COMMANDIF":var x=r.cells[h[1]];if(void 0===x)break;c=x.datavalue,c=(c=String(c).split("/"))[c.length-1],d="t";break;case"PANEL":case"SPLASH":var F,T=2;if("SPLASH"==e){if(c="SPLASH:"+h[1],d="t",1==r.splashdone)break;r.splashdone=!0,T=1,F=[0]}else c=e+":"+(F=Oe.Formula.getStandardizedList(r,{value:h[1],type:m[1]}));if(d="t",Oe._app){for(var k=[],E=[],_=T;_<h.length;++_){var P=!1;for(var R in F)if(F[R]==_-1){P=!0;break}if(!1!==P){for(var A=Oe.Formula.getStandardizedCoords(r,{value:h[_],type:m[_]}),L=0;L<A.ncols;L++)E[A.col1num+L]=!0;for(var M=0;M<A.nrows;M++)k[A.row1num+M]=!0}}var I=U.spreadsheet;null==I&&(I=U.ss);function D(e,t,o,r,a){for(var n=1;n<=t;n++){var l=a(n);void 0===o[l]?!0!==r[n]?(o[l]="yes",N=!0):O=n:!0===r[n]&&(delete o[l],N=!0,O=n)}}var N=!1,O=0;D(0,r.attribs.lastrow,r.rowattribs.hide,k,function(e){return e}),D(O=0,r.attribs.lastcol,r.colattribs.hide,E,Oe.rcColname),r.attribs.usermaxcol=O,N&&(r.renderneeded=!0,r.widgetsClean=!1,I.editor.context.rowpanes[0].first=1,I.editor.context.CalculateColWidthData(),I.width=I.editor.context.totalwidth,I.height=2500,I.editor.ResizeTableEditor(I.editor.context.totalwidth,2500))}}i.PushOperand(t,d,c)},Oe.Formula.FunctionList.BUTTON=[Oe.Formula.IoFunctions,1,"label","","gui","<button type='button' onclick=\"SocialCalc.TriggerIoAction.Button('<%=cell_reference%>');\"><%=formated_value%></button>","ParameterList"],Oe.Formula.FunctionList.IMAGEBUTTON=[Oe.Formula.IoFunctions,1,"imageurl","","gui","<input type='image' src='<%=display_value%>' alt='Submit' onclick=\"SocialCalc.TriggerIoAction.Button('<%=cell_reference%>');\">","ParameterList"],Oe.Formula.FunctionList.EMAIL=[Oe.Formula.IoFunctions,-3,"to_range subject_range, body_range","","action","<button type='button' onclick=\"SocialCalc.TriggerIoAction.Email('<%=cell_reference%>');\"><%=formated_value%></button>","ParameterList"],Oe.Formula.FunctionList.EMAILIF=[Oe.Formula.IoFunctions,-4,"condition_range, to_range subject_range, body_range","","action","<button type='button' onclick=\"SocialCalc.TriggerIoAction.Email('<%=cell_reference%>');\"><%=formated_value%></button>","ParameterList"],Oe.Formula.FunctionList.EMAILONEDIT=[Oe.Formula.IoFunctions,-4,"editRange, to_range subject_range, body_range","","action","<button type='button' onclick=\"SocialCalc.TriggerIoAction.Email('<%=cell_reference%>');\"><%=formated_value%></button>","EventTree"],Oe.Formula.FunctionList.EMAILAT=[Oe.Formula.IoFunctions,-4,"datetime_value, to_range subject_range, body_range","","action","<button type='button' onclick=\"SocialCalc.TriggerIoAction.Email('<%=cell_reference%>');\"><%=formated_value%></button>","TimeTrigger"],Oe.Formula.FunctionList.EMAILONEDITIF=[Oe.Formula.IoFunctions,-5,"editRange, condition, to_range subject_range, body_range","","action","<button type='button' onclick=\"SocialCalc.TriggerIoAction.Email('<%=cell_reference%>');\"><%=formated_value%></button>","EventTree"],Oe.Formula.FunctionList.EMAILATIF=[Oe.Formula.IoFunctions,-5,"datetime_value, condition, to_range subject_range, body_range","","action","<button type='button' onclick=\"SocialCalc.TriggerIoAction.Email('<%=cell_reference%>');\"><%=formated_value%></button>","TimeTrigger"],Oe.Formula.FunctionList.SUBMIT=[Oe.Formula.IoFunctions,100,"[label]","","action","<button type='button' onclick=\"SocialCalc.TriggerIoAction.Submit('<%=cell_reference%>');\"><%=formated_value%></button>","ParameterList"],Oe.Formula.FunctionList.TEXTBOX=[Oe.Formula.IoFunctions,1,"value","","gui","<input type='text' id='TEXTBOX_<%=cell_reference%>' onblur='SocialCalc.CmdGotFocus(null);' oninput=\"SocialCalc.TriggerIoAction.TextBox('<%=cell_reference%>')\" value='<%=display_value%>' >","Input"],Oe.Formula.FunctionList.AUTOCOMPLETE=[Oe.Formula.IoFunctions,2,"value, range or csv_text","","gui","<input type='text' id='AUTOCOMPLETE_<%=cell_reference%>' onfocus=\"SocialCalc.TriggerIoAction.AddAutocomplete('<%=cell_reference%>');\" onblur='SocialCalc.CmdGotFocus(null);' value='<%=display_value%>' >","Input"],Oe.Formula.FunctionList.SELECT=[Oe.Formula.IoFunctions,-2,"value, range or csv_text [,size]","","gui","<select size='<%=html1_value%>' id='SELECT_<%=cell_reference%>' onchange=\"SocialCalc.TriggerIoAction.SelectList('<%=cell_reference%>')\" <%=html0_value%>><%=html2_value%></select>","Input"],Oe.Formula.FunctionList.CHECKBOX=[Oe.Formula.IoFunctions,1,"value","","gui","<input type='checkbox' id='CHECKBOX_<%=cell_reference%>' <%=checked%> onblur='SocialCalc.CmdGotFocus(null);' onchange=\"SocialCalc.TriggerIoAction.CheckBox('<%=cell_reference%>')\" >","Input"],Oe.Formula.FunctionList.RADIOBUTTON=[Oe.Formula.IoFunctions,2,"value, groupname","","gui","<input type='radio' value='<%=cell_reference%>' id='RADIOBUTTON_<%=cell_reference%>' <%=checked%> name='<%=parameter1_value%>' onblur=\"SocialCalc.CmdGotFocus(null);\" onclick=\"SocialCalc.TriggerIoAction.RadioButton('<%=parameter1_value%>');\" >","Input"],Oe.Formula.FunctionList.COPYVALUE=[Oe.Formula.IoFunctions,3,"trigger_cell, destinationCell, value_or_range","","action","","EventTree"],Oe.Formula.FunctionList.COPYFORMULA=[Oe.Formula.IoFunctions,3,"trigger_cell, destinationCell, formula_range","","action","","EventTree"],Oe.Formula.FunctionList.INSERT=[Oe.Formula.IoFunctions,-2,"trigger_cell, destination_range [,formula_range,value_or_range,formula_range, ...]","","action","","EventTree"],Oe.Formula.FunctionList.DELETEIF=[Oe.Formula.IoFunctions,-1,"trigger_cell, criteria , test_range","","action","","EventTree"],Oe.Formula.FunctionList.COMMAND=[Oe.Formula.IoFunctions,-1,"trigger_cell, commands","","action","","EventTree"],Oe.Formula.FunctionList.COMMANDIF=[Oe.Formula.IoFunctions,-1,"trigger_cell, conditions, commands","","action","","EventTree"],Oe.Formula.FunctionList.PANEL=[Oe.Formula.IoFunctions,-1,"showindices_range_or_csv, panel1_range [, panel2_range , ...]","","gui",""],Oe.Formula.FunctionList.SPLASH=[Oe.Formula.IoFunctions,-1,"splash_panel_range","","gui",""],Oe.Formula.FunctionList.STYLE=[Oe.Formula.IoFunctions,-1,"css","","gui",""],Oe.TriggerIoAction.AddAutocomplete=function(o){var e=U.spreadsheet;null==e&&(e=U.ss);var t=e.sheet,r=(Oe.Formula,t.ioParameterList[o]);if(void 0!==r){var a=Oe.Formula.getStandardizedList(t,r[1]);$.ui.autocomplete.filter=function(e,t){var o=new RegExp("\\b"+$.ui.autocomplete.escapeRegex(t),"i");return $.grep(e,function(e){return o.test(e.label||e.value||e)})},$("#AUTOCOMPLETE_"+o).autocomplete({source:a,minLength:1,autoFocus:!0,select:function(e,t){$(this).val(t.item.label),Oe.TriggerIoAction.AutoComplete(o)},change:function(e,t){null===t.item&&$(this).val(""),Oe.TriggerIoAction.AutoComplete(o)}})}},Oe.TriggerIoAction.Button=function(e){var t=U.spreadsheet;null==t&&(t=U.ss);var o=t.sheet;Oe.Formula;if(void 0!==o.ioEventTree&&void 0!==o.ioParameterList&&"undefined"!==o.ioEventTree[e])for(var r in o.ioEventTree[e]){var a=o.ioParameterList[r],n=null;switch(a.function_name){case"COPYVALUE":var l=Oe.Formula.getStandardizedValues(o,a[2]),s=Oe.coordToCr(a[1].value),i=Oe.TriggerIoAction.CopyValueToRange(l,s);t.editor.EditorScheduleSheetCommands(i,!0,!1);break;case"COPYFORMULA":l=Oe.Formula.getStandardizedValues(o,a[2]),s=Oe.coordToCr(a[1].value),i=Oe.TriggerIoAction.CopyFormulaToRange(l,s);t.editor.EditorScheduleSheetCommands(i,!0,!1);break;case"INSERT":var c;if("range"!=(l=Oe.Formula.getStandardizedValues(o,a[1])).type)break;1<l.ncols&&(p=1,h=0,c="insertcol"),1<l.nrows&&(p=0,h=1,c="insertrow");for(var d=l.cellcoord[p][h],u=(i=c+" "+d,s=Oe.coordToCr(d),2);u<a.length;)"range"!=a[u].type&&"coord"!=a[u].type&&u%2!=1||(copyCellRange=Oe.Formula.getStandardizedValues(o,a[u]),i=u%2==0?i+"\n"+Oe.TriggerIoAction.CopyFormulaToRange(copyCellRange,s):i+"\n"+Oe.TriggerIoAction.CopyValueToRange(copyCellRange,s),1<l.nrows&&(s.col+=copyCellRange.ncols),1<l.ncols&&(s.row+=copyCellRange.nrows)),u++;t.editor.EditorScheduleSheetCommands(i,!0,!1);break;case"DELETEIF":var p,h,m,f=Oe.Formula.getStandardizedValues(o,a[1]),g=Oe.Formula.getStandardizedValues(o,a[2]);i="";if(1<g.ncols&&1<g.nrows)return;1<g.ncols&&(p=1,h=0,m="deletecol"),1<g.nrows&&(p=0,h=1,m="deleterow");for(var v=f.celldata[0][0].datavalue,b=g.ncols-p-1;p<=b;b--)for(var C=g.nrows-h-1;h<=C;C--){var y=g.celldata[b][C];1==Oe.Formula.TestCriteria(y.datavalue,y.valuetype,v)&&(""!=i&&(i+="\n"),i=i+m+" "+g.cellcoord[b][C])}""!=i&&t.editor.EditorScheduleSheetCommands(i,!0,!1);break;case"COMMANDIF":n=Oe.Formula.getStandardizedValues(o,a[1]);case"COMMAND":i="";if(null!=n){var S=Oe.Formula.getStandardizedValues(o,a[2]);if(n.ncols!=S.ncols||n.nrows!=S.nrows)break}else S=Oe.Formula.getStandardizedValues(o,a[1]);for(b=0;b<S.ncols;b++)for(C=0;C<S.nrows;C++){if(null!=n)if(0==n.celldata[b][C].datavalue)continue;""!=i&&(i+="\n"),i+=S.celldata[b][C].datavalue.toString().trim()}""!=i&&t.editor.EditorScheduleSheetCommands(i,!0,!1)}}},Oe.TriggerIoAction.CopyFormulaToRange=function(e,t){for(var o,r="",a=0;a<e.ncols;a++)for(var n=0;n<e.nrows;n++){var l=e.celldata[a][n],s=Oe.crToCoord(t.col+a,t.row+n);if(0==a&&0==n||(r+="\n"),void 0!==l&&"b"!=l.valuetype){var i=l.datatype,c=l.valuetype,d=l.datavalue,u=l.formula;"f"==i?(u=Oe.OffsetFormulaCoords(u,t.col-e.col1num,t.row-e.row1num),c=d=""):"c"!=i&&(u=""),o="set "+s+" "+Oe.Constants.cellDataType[i]+" "+c+" "+Oe.encodeForSave(d)+" "+u}else o="set "+s+" empty";r+=o.trim()}return r},Oe.TriggerIoAction.CopyValueToRange=function(e,t){for(var o,r="",a=0;a<e.ncols;a++)for(var n=0;n<e.nrows;n++){var l=e.celldata[a][n],s=Oe.crToCoord(t.col+a,t.row+n);if(0==a&&0==n||(r+="\n"),void 0!==l&&"b"!=l.valuetype){var i=l.datatype,c=l.valuetype,d=l.datavalue,u=l.formula;"f"==i?(u="","n"!=(i=c)&&"t"!=c.charAt(0)&&(i="c",u=l.displaystring),"t"==c.charAt(0)&&(i="t")):"c"!=i&&(u=""),o="set "+s+" "+Oe.Constants.cellDataType[i]+" "+c+" "+Oe.encodeForSave(d)+" "+u}else o="set "+s+" empty";r+=o.trim()}return r},Oe.TriggerIoAction.Email=function(e,t){t=void 0!==t?t:null;var o=Oe.Formula,r=U.spreadsheet;null==r&&(r=U.ss);var a=r.sheet,n=a.cells[e];if(void 0!==a.ioParameterList){var l=a.ioParameterList[e];if(void 0!==l){for(var s=[],i=[],c=1,d=0;d<l.length;d++)if("t"==l[d].type.charAt(0)&&(s[d]=[String(l[d].value).replace(/ /g,"%20")]),"coord"==l[d].type&&(s[d]=[String(a.GetAssuredCell(l[d].value).datavalue).replace(/ /g,"%20")]),"range"==l[d].type){var u=o.DecodeRangeParts(a,l[d].value);s[d]=[],i[d]=[];for(var p=0,h=0;h<u.ncols;h++)for(var m=0;m<u.nrows;m++){var f=Oe.crToCoord(u.col1num+h,u.row1num+m);n=u.sheetdata.GetAssuredCell(f);s[d].push(n.datavalue.toString().replace(/ /g,"%20")),i[d].push(f),p++}c<p&&(c=p)}var g=-1,v=0;switch(l.function_name){case"EMAILIF":g=0;case"EMAILAT":case"EMAILONEDIT":v=1;break;case"EMAILONEDITIF":case"EMAILATIF":g=1,v=2}switch(l.function_name){case"EMAILONEDIT":case"EMAILONEDITIF":t&&"coord"==l[0].type&&l[0].value==t&&(t=null);break;default:t=null}for(var b=!1,C=[],y=c-1;-1<y;y--){if(-1!=g){var S=y>=s[g].length?0:y;if(0==s[g][S])continue}if(!t||t==i[0][y]){var w=y>=s[v].length?0:y,x=y>=s[v+1].length?0:y,F=y>=s[v+2].length?0:y,T=s[v][w]+" "+s[v+1][x]+" "+s[v+2][F];b=!0,a.ScheduleSheetCommands("sendemail "+T,!1),C.push([s[v][w],s[v+1][x],s[v+2][F]])}}return b&&Oe.EditorSheetStatusCallback(null,"emailing",null,r.editor),C}}},Oe.TriggerIoAction.Submit=function(e){var t=null!=Oe.CurrentSpreadsheetControlObject?Oe.CurrentSpreadsheetControlObject.formDataViewer:Oe.CurrentSpreadsheetViewerObject.formDataViewer;if(null!=t&&1==t.loaded){var o=U.spreadsheet;null==o&&(o=U.ss);for(var r=o.sheet,a=new Date,n=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds(),l=2;l<=t.formFieldsLength+1;l++){var s=Oe.crToCoord(l,2);n+="\r"+t.sheet.cells[s].datavalue}r.ScheduleSheetCommands("submitform \r"+n,!1)}},Oe.TriggerIoAction.SelectList=function(e){Oe.TriggerIoAction.updateInputWidgetFormula("SELECT",e,function(e){return e.value})},Oe.TriggerIoAction.AutoComplete=function(e){Oe.TriggerIoAction.updateInputWidgetFormula("AUTOCOMPLETE",e,function(e){return e.value})},Oe.TriggerIoAction.TextBox=function(e){Oe.TriggerIoAction.updateInputWidgetFormula("TEXTBOX",e,function(e){return e.value})},Oe.TriggerIoAction.CheckBox=function(e){Oe.TriggerIoAction.updateInputWidgetFormula("CHECKBOX",e,function(e){return e.checked?"TRUE":"FALSE"})},Oe.TriggerIoAction.RadioButton=function(e){function t(e){return e.checked?"TRUE":"FALSE"}$('input[name="'+e+'"]').each(function(){Oe.TriggerIoAction.updateInputWidgetFormula("RADIOBUTTON",$(this).attr("id").replace(/RADIOBUTTON_/,""),t)})},Oe.TriggerIoAction.updateInputWidgetFormula=function(e,t,o){var r=U.spreadsheet;null==r&&(r=U.ss);var a=r.sheet,n=(a.cells[t],a.ioParameterList[t]);if(void 0!==n){for(var l=o(document.getElementById(e+"_"+t)),s="set "+t+" formula "+e+'("'+(l=Oe.encodeForSave(l))+'"',i=1;i<n.length;i++)"n"==n[i].type.charAt(0)&&(s+=","+n[i].value),"t"==n[i].type.charAt(0)&&(s+=',"'+n[i].value+'"'),"range"==n[i].type&&(s+=","+n[i].value.toString().replace(/(\$?[A-Z]+\$?[0-9]+)([!]?)([^|]*)[|](\$?[A-Z]+\$?[0-9]+)[|]/i,"$3$2$1:$4")),"coord"==n[i].type&&(s+=","+n[i].value);s+=")",n.cssParameter&&(s+="+style("+n.cssParameter+")"),r.editor.EditorScheduleSheetCommands(s,!0,!1),Oe.TriggerIoAction.UpdateFormDataSheet(e,t,l)}},Oe.TriggerIoAction.UpdateFormDataSheet=function(e,t,o){var r=null!=Oe.CurrentSpreadsheetControlObject?Oe.CurrentSpreadsheetControlObject.formDataViewer:Oe.CurrentSpreadsheetViewerObject.formDataViewer;if(null!=r){var a=(e+t).toLowerCase();if(null!=r.formFields[a]){var n=Oe.crToCoord(r.formFields[a],2);r.sheet.ScheduleSheetCommands("set "+n+" text t "+o,!1)}}},Oe.Formula.getStandardizedValues=function(e,t){return Oe.Formula.getStandardizedParameter(e,t,!0,!0)},Oe.Formula.getStandardizedCoords=function(e,t){return Oe.Formula.getStandardizedParameter(e,t,!0,!1)},Oe.Formula.getStandardizedList=function(e,t){var o=[],r=Oe.Formula.getStandardizedValues(e,t);if(1==r.ncols&&1==r.nrows)o=String(r.celldata[0][0].datavalue).split(",");else for(var a=0;a<r.ncols;a++)for(var n=0;n<r.nrows;n++){var l=r.celldata[a][n];o.push(l.datavalue.toString())}return o},Oe.Formula.getStandardizedParameter=function(e,t,o,r){var a={type:t.type,value:t.value};if(r&&(a.celldata=[]),"coord"!=t.type&&"range"!=t.type){if(a.ncols=1,a.nrows=1,a.col1num=1,a.row1num=1,o&&(a.cellcoord=null),r){a.celldata[0]=[];var n="n"==t.type?"v":"t"==t.type?t.type:"c";a.celldata[0][0]={coord:null,datatype:n,valuetype:t.type,datavalue:t.value}}}else{var l,s=Oe.Formula;if("coord"==t.type){var i=Oe.Formula.PlainCoord(t.value);l=s.DecodeRangeParts(e,i+"|"+i+"|")}"range"==t.type&&(l=s.DecodeRangeParts(e,t.value)),o&&(a.cellcoord=[]);for(var c=0;c<l.ncols;c++)for(var d=0;d<l.nrows;d++){var u=Oe.crToCoord(l.col1num+c,l.row1num+d);if(o&&(void 0===a.cellcoord[c]&&(a.cellcoord[c]=[]),a.cellcoord[c][d]=u),r){void 0===a.celldata[c]&&(a.celldata[c]=[]);var p=l.sheetdata.GetAssuredCell(u);a.celldata[c][d]=p}}a.ncols=l.ncols,a.nrows=l.nrows,a.col1num=l.col1num,a.row1num=l.row1num}return a},Oe.Formula.SheetCache={sheets:{},waitingForLoading:null,constants:{asloaded:0,recalcing:1,recalcdone:2},loadsheet:null},Oe.Formula.FindInSheetCache=function(e){var t=Oe.Formula.SheetCache,o=Oe.Formula.NormalizeSheetName(e);return t.sheets[o]?t.sheets[o].sheet:t.waitingForLoading?null:t.loadsheet?(alert("Using SocialCalc.Formula.SheetCache.loadsheet - deprecated"),Oe.Formula.AddSheetToCache(o,t.loadsheet(o))):(t.waitingForLoading=o,null)},Oe.Formula.AddSheetToCache=function(e,t,o){var r=null,a=Oe.Formula.SheetCache,n=a.constants,l=Oe.Formula.NormalizeSheetName(e);return t&&(r=new Oe.Sheet).ParseSheetSave(t),a.sheets[l]={sheet:r,recalcstate:n.asloaded,name:l},Oe.Formula.FreshnessInfo.sheets[l]=void 0===o||!1===o,r},Oe.Formula.NormalizeSheetName=function(e){return Oe.Callbacks.NormalizeSheetName?Oe.Callbacks.NormalizeSheetName(e):e.toLowerCase()},Oe.Formula.RemoteFunctionInfo={waitingForServer:null},Oe.Formula.FreshnessInfo={sheets:{},volatile:{},recalc_completed:!1},Oe.Formula.FreshnessInfoReset=function(){var e=Oe.Formula.FreshnessInfo,t=Oe.Formula.SheetCache;for(var o in e.sheets)!1===e.sheets[o]&&delete t.sheets[o];e.sheets={},e.volatile={},e.recalc_completed=!1},Oe.Formula.PlainCoord=function(e){return-1==e.indexOf("$")?e:e.replace(/\$/g,"")},Oe.Formula.OrderRangeParts=function(e,t){var o,r,a={};return o=Oe.coordToCr(e),r=Oe.coordToCr(t),o.col>r.col?(a.c1=r.col,a.c2=o.col):(a.c1=o.col,a.c2=r.col),o.row>r.row?(a.r1=r.row,a.r2=o.row):(a.r1=o.row,a.r2=r.row),a},Oe.Formula.TestCriteria=function(e,t,o){var r,a,n,l,s;if(null==o)return!1;if(a="="==(r=(o+="").charAt(0))||"<"==r||">"==r?o.substring(1):-1!=o.search(/([^~]\*|^\*)/)||-1!=o.search(/([^~]\?|^\?)/)?(r="regex","^"+(a="*"==o?".+":(a=(a=o.split("").reverse().join("")).replace(/\?(?=[^~])|\?$/g,"?.").replace(/\?~/g,"?\\").replace(/\*(?=[^~])|\*$/g,"*.").replace(/\*~/,"*\\")).split("").reverse().join(""))+"$"):"<="==(r=o.substring(0,2))||"<>"==r||">="==r?o.substring(2):(r="none",o),!(n=Oe.DetermineValueType(a)).type){if("none"==r)return!1;if("b"==t.charAt(0)){if("="==r)return!0}else if("<>"==r)return!0;return!1}if(l=!1,"n"==n.type.charAt(0)&&"t"==t.charAt(0)&&"n"==(s=Oe.DetermineValueType(e)).type.charAt(0)&&(e=s.value,t=s.type),"n"==t.charAt(0)&&"n"==n.type.charAt(0))switch(e-=0,n.value=n.value-0,r){case"<":l=e<n.value;break;case"<=":l=e<=n.value;break;case"=":case"none":l=e==n.value;break;case">=":l=e>=n.value;break;case">":l=e>n.value;break;case"<>":l=e!=n.value}else if("e"==t.charAt(0))l=!1;else if("e"==n.type.charAt(0))l=!1;else{if("n"==t.charAt(0)&&(e=Oe.format_number_for_display(e,"n","")),"n"==n.type.charAt(0))return!1;switch(e=e?e.toLowerCase():"",n.value=n.value?n.value.toLowerCase():"",r){case"<":l=e<n.value;break;case"<=":l=e<=n.value;break;case"=":l=e==n.value;break;case"none":l=e.substring(0,n.value.length)==n.value;break;case">=":l=e>=n.value;break;case">":l=e>n.value;break;case"<>":l=e!=n.value;break;case"regex":try{l=-1!=e.search(new RegExp(n.value))}catch(e){l=!1}}}return l},Oe||(Oe={}),Oe.Popup={},Oe.Popup.Types={},Oe.Popup.Controls={},Oe.Popup.Current={},Oe.Popup.LocalizeString=function(e){return e},Oe.Popup.Create=function(e,t,o){var r=Oe.Popup.Types[e];r&&r.Create&&r.Create(e,t,o),Oe.Popup.imagePrefix=Oe.Constants.defaultImagePrefix},Oe.Popup.SetValue=function(e,t){var o=Oe.Popup,r=o.Types,a=o.Controls;if(a[e]){var n=a[e].type,l=r[n],s=a[e].data;l&&l.Create&&(l.SetValue(n,e,t),s.attribs&&s.attribs.changedcallback&&s.attribs.changedcallback(s.attribs,e,t))}else alert("Unknown control "+e)},Oe.Popup.SetDisabled=function(e,t){var o=Oe.Popup,r=o.Types,a=o.Controls;if(a[e]){var n=a[e].type,l=r[n];l&&l.Create&&(o.Current.id&&e==o.Current.id&&(l.Hide(n,o.Current.id),o.Current.id=null),l.SetDisabled(n,e,t))}else alert("Unknown control "+e)},Oe.Popup.GetValue=function(e){var t=Oe.Popup,o=t.Types,r=t.Controls;if(r[e]){var a=r[e].type,n=o[a];return n&&n.Create?n.GetValue(a,e):null}alert("Unknown control "+e)},Oe.Popup.Initialize=function(e,t){var o=Oe.Popup,r=o.Types,a=o.Controls;if(a[e]){var n=a[e].type,l=r[n];l&&l.Initialize&&l.Initialize(n,e,t)}else alert("Unknown control "+e)},Oe.Popup.Reset=function(e){var t=Oe.Popup,o=t.Types;t.Controls;o[e].Reset&&o[e].Reset(e)},Oe.Popup.CClick=function(e){var t=Oe.Popup,o=t.Types,r=t.Controls;if(r[e]){if(!r[e].data||!r[e].data.disabled){var a=r[e].type,n=o[a];t.Current.id&&(o[r[t.Current.id].type].Hide(a,t.Current.id),e==t.Current.id)?t.Current.id=null:(n&&n.Show&&n.Show(a,e),t.Current.id=e)}}else alert("Unknown control "+e)},Oe.Popup.Close=function(){var e=Oe.Popup;e.Types,e.Controls;e.Current.id&&e.CClick(e.Current.id)},Oe.Popup.Cancel=function(){var e=Oe.Popup,t=e.Types,o=e.Controls;if(e.Current.id){var r=o[e.Current.id].type;t[r].Cancel(r,e.Current.id),e.Current.id=null}},Oe.Popup.CreatePopupDiv=function(e,t){var o,r=Oe.Popup.Controls[e].data,a=document.createElement("div");return a.style.position="absolute",o=Oe.GetElementPosition(r.mainele),a.style.top=o.top+r.mainele.offsetHeight+"px",a.style.left=o.left+"px",a.style.zIndex=100,a.style.backgroundColor="#FFF",a.style.border="1px solid black",t.width&&(a.style.width=t.width),r.mainele.appendChild(a),t.title&&(a.innerHTML='<table cellspacing="0" cellpadding="0" style="border-bottom:1px solid black;"><tr><td style="font-size:10px;cursor:default;width:100%;background-color:#999;color:#FFF;">'+t.title+'</td><td style="font-size:10px;cursor:default;color:#666;" onclick="SocialCalc.Popup.Cancel();">&nbsp;X&nbsp;</td></tr></table>',t.moveable&&(r.dragregistered=a.firstChild.firstChild.firstChild.firstChild,Oe.DragRegister(r.dragregistered,!0,!0,{MouseDown:Oe.DragFunctionStart,MouseMove:Oe.DragFunctionPosition,MouseUp:Oe.DragFunctionPosition,Disabled:null,positionobj:a},r.mainele))),a},Oe.Popup.EnsurePosition=function(e,t){var o=Oe.Popup.Controls[e].data,r=o.mainele.firstChild;if(r){var a=o.popupele,n=i(a),l=i(t),s=i(r);s.bottom+n.height<l.bottom&&s.left+n.width<l.right?(a.style.top=s.bottom+"px",a.style.left=s.left+"px",1):s.top-n.height>l.top&&s.left+n.width<l.right?(a.style.top=s.top-n.height+"px",a.style.left=s.left+"px",2):s.bottom+n.height<l.bottom&&s.right-n.width>l.left?(a.style.top=s.bottom+"px",a.style.left=s.right-n.width+"px",3):s.top-n.height>l.top&&s.right-n.width>l.left?(a.style.top=s.top-n.height+"px",a.style.left=s.right-n.width+"px",4):s.bottom+n.height<l.bottom&&n.width<l.width?(a.style.top=s.bottom+"px",a.style.left=l.left+Math.floor((l.width-n.width)/2)+"px",5):s.top-n.height>l.top&&n.width<l.width?(a.style.top=s.top-n.height+"px",a.style.left=l.left+Math.floor((l.width-n.width)/2)+"px",6):n.height<l.height&&s.right+n.width<l.right?(a.style.top=l.top+Math.floor((l.height-n.height)/2)+"px",a.style.left=s.right+"px",7):n.height<l.height&&s.left-n.width>l.left&&(a.style.top=l.top+Math.floor((l.height-n.height)/2)+"px",a.style.left=s.left-n.width+"px",8)}else alert("No main popup element firstChild.");function i(e){var t=Oe.GetElementPosition(e);return t.height=e.offsetHeight,t.width=e.offsetWidth,t.bottom=t.top+t.height,t.right=t.left+t.width,t}},Oe.Popup.DestroyPopupDiv=function(e,t){e&&(e.innerHTML="",Oe.DragUnregister(t),e.parentNode&&e.parentNode.removeChild(e))},Oe.Popup.RGBToHex=function(e){var t=Oe.Popup;if(""==e)return"000000";var o=e.match(/(\d+)\D+(\d+)\D+(\d+)/);return o?t.ToHex(o[1])+t.ToHex(o[2])+t.ToHex(o[3]):"000000"},Oe.Popup.HexDigits="0123456789ABCDEF",Oe.Popup.ToHex=function(e){var t=Oe.Popup,o=Math.floor(e/16),r=e%16;return t.HexDigits.charAt(o)+t.HexDigits.charAt(r)},Oe.Popup.FromHex=function(e){var t=Oe.Popup,o=t.HexDigits.indexOf(e.charAt(0).toUpperCase()),r=t.HexDigits.indexOf(e.charAt(1).toUpperCase());return 16*(0<=o?o:0)+(0<=r?r:0)},Oe.Popup.HexToRGB=function(e){var t=Oe.Popup;return"rgb("+t.FromHex(e.substring(1,3))+","+t.FromHex(e.substring(3,5))+","+t.FromHex(e.substring(5,7))+")"},Oe.Popup.makeRGB=function(e,t,o){return"rgb("+(0<e?e:0)+","+(0<t?t:0)+","+(0<o?o:0)+")"},Oe.Popup.splitRGB=function(e){var t=e.match(/(\d+)\D+(\d+)\D+(\d+)\D/);return t?{r:t[1]-0,g:t[2]-0,b:t[3]-0}:{r:0,g:0,b:0}},Oe.Popup.Types.List={},Oe.Popup.Types.List.Create=function(e,t,o){var r=Oe.Popup,a=(r.Types,{type:e,value:"",display:"",data:{}}),n=(r.Controls[t]=a).data;n.attribs=o||{};var l=document.getElementById(t);l?((n.mainele=l).innerHTML='<input style="cursor:pointer;width:100px;font-size:smaller;" onfocus="this.blur();" onclick="SocialCalc.Popup.CClick(\''+t+'\');" value="">',n.options=[]):alert("Missing element "+t)},Oe.Popup.Types.List.SetValue=function(e,t,r){var a,n=Oe.Popup,l=(n.Types,n.Controls[t].data);for(l.value=r,l.custom=!1,a=0;a<l.options.length;a++)if(o=l.options[a],!(o.a&&(o.a.skip||o.a.custom||o.a.cancel)||o.v!=l.value)){l.display=o.o;break}a==l.options.length&&(l.display="Custom",l.custom=!0),l.mainele&&l.mainele.firstChild&&(l.mainele.firstChild.value=l.display)},Oe.Popup.Types.List.SetDisabled=function(e,t,o){var r=Oe.Popup,a=(r.Types,r.Controls[t].data);a.disabled=o,a.mainele&&a.mainele.firstChild&&(a.mainele.firstChild.disabled=o)},Oe.Popup.Types.List.GetValue=function(e,t){var o=Oe.Popup;o.Types;return o.Controls[t].data.value},Oe.Popup.Types.List.Initialize=function(e,t,o){var r,a=Oe.Popup,n=(a.Types,a.Controls[t].data);for(r in o.attribs)n.attribs[r]=o.attribs[r];n.options=o?o.options:[],o.value&&a.SetValue(t,o.value)},Oe.Popup.Types.List.Reset=function(e){var t=Oe.Popup,o=t.Types,r=t.Controls;t.Current.id&&r[t.Current.id].type==e&&(o[e].Hide(e,t.Current.id),t.Current.id=null)},Oe.Popup.Types.List.Show=function(e,t){var o,r=Oe.Popup,a=(r.Types,r.Controls[t].data),n="";a.popupele=r.CreatePopupDiv(t,a.attribs),a.custom?(n=Oe.Popup.Types.List.MakeCustom(e,t),(o=document.createElement("div")).innerHTML='<div style="cursor:default;padding:4px;background-color:#CCC;">'+n+"</div>",a.customele=o.firstChild.firstChild.childNodes[1],a.listdiv=null):(n=Oe.Popup.Types.List.MakeList(e,t),(o=document.createElement("div")).innerHTML='<div style="cursor:default;padding:4px;">'+n+"</div>",a.customele=null,a.listdiv=o.firstChild),a.contentele=o,a.mainele&&a.mainele.firstChild&&(a.mainele.firstChild.disabled=!0),a.popupele.appendChild(o),a.attribs.ensureWithin&&Oe.Popup.EnsurePosition(t,a.attribs.ensureWithin)},Oe.Popup.Types.List.MakeList=function(e,t){var o,r,a=Oe.Popup,n=(a.Types,a.Controls[t].data),l='<table cellspacing="0" cellpadding="0"><tr>',s='<td style="vertical-align:top;">';for(l+=s,n.ncols=1,o=0;o<n.options.length;o++){if((r=n.options[o]).a){if(r.a.newcol){l+="</td>"+s+"&nbsp;&nbsp;&nbsp;&nbsp;</td>"+s,n.ncols+=1;continue}if(r.a.skip){l+='<div style="font-size:x-small;white-space:nowrap;">'+r.o+"</div>";continue}}l+='<div style="font-size:x-small;white-space:nowrap;'+(r.v!=n.value||r.a&&(r.a.custom||r.a.cancel)?"":"background-color:#DDF;")+'" onclick="SocialCalc.Popup.Types.List.ItemClicked(\''+t+"','"+o+"');\" onmousemove=\"SocialCalc.Popup.Types.List.MouseMove('"+t+"',this);\">"+r.o+"</div>"}return l+="</td></tr></table>"},Oe.Popup.Types.List.MakeCustom=function(e,t){var o=Oe.Popup.LocalizeString,r=Oe.Popup,a=(r.Types,'style="font-size:smaller;"'),n=r.Controls[t].data.value;return'<div style="white-space:nowrap;"><br><input id="customvalue" value="'+(n=Oe.special_chars(n))+'"><br><br><input '+a+' type="button" value="'+o("OK")+'" onclick="SocialCalc.Popup.Types.List.CustomOK(\''+t+"');return false;\"><input "+a+' type="button" value="'+o("List")+'" onclick="SocialCalc.Popup.Types.List.CustomToList(\''+t+"');\"><input "+a+' type="button" value="'+o("Cancel")+'" onclick="SocialCalc.Popup.Close();"><br></div>'},Oe.Popup.Types.List.ItemClicked=function(e,t){var o,r,a,n=Oe.Popup,l=(n.Types,n.Controls[e].data),s=l.options[t].a;if(s&&s.custom)return o=l.contentele,r=Oe.Popup.Types.List.MakeCustom("List",e),(a=document.createElement("div")).innerHTML='<div style="cursor:default;padding:4px;background-color:#CCC;">'+r+"</div>",l.customele=a.firstChild.firstChild.childNodes[1],l.listdiv=null,l.contentele=a,l.popupele.replaceChild(a,o),void(l.attribs.ensureWithin&&Oe.Popup.EnsurePosition(e,l.attribs.ensureWithin));s&&s.cancel||Oe.Popup.SetValue(e,l.options[t].v),Oe.Popup.Close()},Oe.Popup.Types.List.CustomToList=function(e){var t,o,r,a=Oe.Popup,n=(a.Types,a.Controls[e].data);t=n.contentele,o=Oe.Popup.Types.List.MakeList("List",e),(r=document.createElement("div")).innerHTML='<div style="cursor:default;padding:4px;">'+o+"</div>",n.customele=null,n.listdiv=r.firstChild,n.contentele=r,n.popupele.replaceChild(r,t),n.attribs.ensureWithin&&Oe.Popup.EnsurePosition(e,n.attribs.ensureWithin)},Oe.Popup.Types.List.CustomOK=function(e){var t=Oe.Popup,o=(t.Types,t.Controls[e].data);Oe.Popup.SetValue(e,o.customele.value),Oe.Popup.Close()},Oe.Popup.Types.List.MouseMove=function(e,t){var o,r,a=Oe.Popup,n=(a.Types,a.Controls[e].data),l=n.listdiv;if(l){var s=l.firstChild.firstChild.firstChild;for(o=0;o<n.ncols;o++)for(r=0;r<s.childNodes[2*o].childNodes.length;r++)s.childNodes[2*o].childNodes[r].style.backgroundColor="#FFF";t.style.backgroundColor="#DDF"}},Oe.Popup.Types.List.Hide=function(e,t){var o=Oe.Popup,r=(o.Types,o.Controls[t].data);o.DestroyPopupDiv(r.popupele,r.dragregistered),r.popupele=null,r.mainele&&r.mainele.firstChild&&(r.mainele.firstChild.disabled=!1)},Oe.Popup.Types.List.Cancel=function(e,t){Oe.Popup.Types.List.Hide(e,t)},Oe.Popup.Types.ColorChooser={},Oe.Popup.Types.ColorChooser.Create=function(e,t,o){var r=Oe.Popup,a=(r.Types,{type:e,value:"",display:"",data:{}}),n=(r.Controls[t]=a).data;n.attribs=o||{};var l=n.attribs;n.value="";var s=document.getElementById(t);s?(n.mainele=s).innerHTML='<div style="cursor:pointer;border:1px solid black;vertical-align:top;width:'+(l.sampleWidth||"15px")+";height:"+(l.sampleHeight||"15px")+';" onclick="SocialCalc.Popup.Types.ColorChooser.ControlClicked(\''+t+"');\">&nbsp;</div>":alert("Missing element "+t)},Oe.Popup.Types.ColorChooser.SetValue=function(e,t,o){var r,a,n=Oe.Popup,l=(n.Types,n.Controls[t].data),s=l.attribs;l.value=o,l.custom=!1,l.mainele&&l.mainele.firstChild&&(a=l.value?(l.mainele.firstChild.style.backgroundColor=l.value,r=s.backgroundImage?"url("+n.imagePrefix+s.backgroundImage+")":"","center center"):(l.mainele.firstChild.style.backgroundColor="#FFF",s.backgroundImageDefault?(r="url("+n.imagePrefix+s.backgroundImageDefault+")","center center"):(r="url("+n.imagePrefix+"defaultcolor.gif)","left top")),l.mainele.firstChild.style.backgroundPosition=a,l.mainele.firstChild.style.backgroundImage=r)},Oe.Popup.Types.ColorChooser.SetDisabled=function(e,t,o){var r=Oe.Popup,a=(r.Types,r.Controls[t].data),n=a.attribs;a.disabled=o,a.mainele&&a.mainele.firstChild&&(o?(a.mainele.firstChild.style.backgroundColor="#DDD",n.backgroundImageDisabled?(img="url("+r.imagePrefix+n.backgroundImageDisabled+")",pos="center center"):(img="url("+r.imagePrefix+"defaultcolor.gif)",pos="left top"),a.mainele.firstChild.style.backgroundPosition=pos,a.mainele.firstChild.style.backgroundImage=img):r.SetValue(t,a.value))},Oe.Popup.Types.ColorChooser.GetValue=function(e,t){var o=Oe.Popup;o.Types;return o.Controls[t].data.value},Oe.Popup.Types.ColorChooser.Initialize=function(e,t,o){var r,a=Oe.Popup,n=(a.Types,a.Controls[t].data);for(r in o.attribs)n.attribs[r]=o.attribs[r];o.value&&a.SetValue(t,o.value)},Oe.Popup.Types.ColorChooser.Reset=function(e){var t=Oe.Popup,o=t.Types,r=t.Controls;t.Current.id&&r[t.Current.id].type==e&&(o[e].Hide(e,t.Current.id),t.Current.id=null)},Oe.Popup.Types.ColorChooser.Show=function(e,t){var o,r,a=Oe.Popup,n=(a.Types,a.Controls[t].data),l="";n.oldvalue=n.value,n.popupele=a.CreatePopupDiv(t,n.attribs),n.custom?(l=Oe.Popup.Types.ColorChooser.MakeCustom(e,t),(o=document.createElement("div")).innerHTML='<div style="cursor:default;padding:4px;background-color:#CCC;">'+l+"</div>",n.customele=o.firstChild.firstChild.childNodes[2]):(r=Oe.Popup.Types.ColorChooser.CreateGrid(e,t),(o=document.createElement("div")).style.padding="3px",o.style.backgroundColor="#CCC",o.appendChild(r),n.customele=null),n.contentele=o,n.popupele.appendChild(o),n.attribs.ensureWithin&&Oe.Popup.EnsurePosition(t,n.attribs.ensureWithin)},Oe.Popup.Types.ColorChooser.MakeCustom=function(e,t){var o=Oe.Popup,r=(o.Types,o.Controls[t].data),a=o.LocalizeString,n='style="font-size:smaller;"';return'<div style="white-space:nowrap;"><br>#<input id="customvalue" style="width:75px;" value="'+r.value+'"><br><br><input '+n+' type="button" value="'+a("OK")+'" onclick="SocialCalc.Popup.Types.ColorChooser.CustomOK(\''+t+"');return false;\"><input "+n+' type="button" value="'+a("Grid")+'" onclick="SocialCalc.Popup.Types.ColorChooser.CustomToGrid(\''+t+"');\"><br></div>"},Oe.Popup.Types.ColorChooser.ItemClicked=function(e,t){var o=Oe.Popup;o.Types,o.Controls[e].data;Oe.Popup.Close()},Oe.Popup.Types.ColorChooser.CustomToList=function(e){var t=Oe.Popup;t.Types,t.Controls[e].data},Oe.Popup.Types.ColorChooser.CustomOK=function(e){var t=Oe.Popup,o=(t.Types,t.Controls[e].data);t.SetValue(e,o.customele.value),t.Close()},Oe.Popup.Types.ColorChooser.Hide=function(e,t){var o=Oe.Popup,r=(o.Types,o.Controls[t].data);o.DestroyPopupDiv(r.popupele,r.dragregistered),r.popupele=null},Oe.Popup.Types.ColorChooser.Cancel=function(e,t){var o=Oe.Popup,r=(o.Types,o.Controls[t].data);o.SetValue(t,r.oldvalue),Oe.Popup.Types.ColorChooser.Hide(e,t)},Oe.Popup.Types.ColorChooser.CreateGrid=function(e,t){var o,r,a,n,l,s=Oe.Popup,i=s.Types,c=s.Controls,d=s.LocalizeString,u=c[t].data;u.grid={};var p=u.grid,h=document.createElement("div");for((o=document.createElement("table")).cellSpacing=0,o.cellPadding=0,o.style.width="100px",p.table=o,o=document.createElement("tbody"),p.table.appendChild(o),p.tbody=o,r=0;r<16;r++){for(a=document.createElement("tr"),n=0;n<5;n++)l={},p[r+","+n]=l,(o=document.createElement("td")).style.fontSize="1px",o.innerHTML="&nbsp;",o.style.height="10px",n<=1?(o.style.width="17px",o.style.borderRight="3px solid white"):(o.style.width="20px",o.style.backgroundRepeat="no-repeat"),a.appendChild(o),l.ele=o;p.tbody.appendChild(a)}return h.appendChild(p.table),(o=document.createElement("div")).style.marginTop="3px",o.innerHTML='<table cellspacing="0" cellpadding="0"><tr><td style="width:17px;background-color:#FFF;background-image:url('+s.imagePrefix+'defaultcolor.gif);height:16px;font-size:10px;cursor:pointer;" title="'+d("Default")+'">&nbsp;</td><td style="width:23px;height:16px;font-size:10px;text-align:center;cursor:pointer;" title="'+d("Custom")+'">#</td><td style="width:60px;height:16px;font-size:10px;text-align:center;cursor:pointer;">'+d("OK")+"</td></tr></table>",p.defaultbox=o.firstChild.firstChild.firstChild.childNodes[0],p.defaultbox.onclick=i.ColorChooser.DefaultClicked,p.custom=o.firstChild.firstChild.firstChild.childNodes[1],p.custom.onclick=i.ColorChooser.CustomClicked,p.msg=o.firstChild.firstChild.firstChild.childNodes[2],p.msg.onclick=i.ColorChooser.CloseOK,h.appendChild(o),p.table.onmousedown=i.ColorChooser.GridMouseDown,i.ColorChooser.DetermineColors(t),i.ColorChooser.SetColors(t),h},Oe.Popup.Types.ColorChooser.gridToG=function(e,t,o){return e[t+","+o]},Oe.Popup.Types.ColorChooser.DetermineColors=function(e){var t,o,r=Oe.Popup,a=r.Types.ColorChooser,n=r.Controls[e].data,l=n.grid,s=r.splitRGB(n.value);for(t=2,o=16-Math.floor((s.r+16)/16),l["selectedrow"+t]=o,o=0;o<16;o++)a.gridToG(l,o,t).rgb=r.makeRGB(17*(15-o),0,0);for(t=3,o=16-Math.floor((s.g+16)/16),l["selectedrow"+t]=o,o=0;o<16;o++)a.gridToG(l,o,t).rgb=r.makeRGB(0,17*(15-o),0);for(t=4,o=16-Math.floor((s.b+16)/16),l["selectedrow"+t]=o,o=0;o<16;o++)a.gridToG(l,o,t).rgb=r.makeRGB(0,0,17*(15-o));for(t=1,o=0;o<16;o++)a.gridToG(l,o,t).rgb=r.makeRGB(17*(15-o),17*(15-o),17*(15-o));var i,c=[t=0,68,153,204,255],d=["400","310","420","440","442","340","040","042","032","044","024","004","204","314","402","414"];for(o=0;o<16;o++)i=d[o],a.gridToG(l,o,t).rgb="rgb("+c[i.charAt(0)-0]+","+c[i.charAt(1)-0]+","+c[i.charAt(2)-0]+")"},Oe.Popup.Types.ColorChooser.SetColors=function(e){var t,o,r,a,n=Oe.Popup,l=n.Types.ColorChooser,s=n.Controls[e].data,i=s.grid;for(t=0;t<16;t++)for(o=0;o<5;o++)(r=l.gridToG(i,t,o)).ele.style.backgroundColor=r.rgb,r.ele.title=n.RGBToHex(r.rgb),i["selectedrow"+o]==t?r.ele.style.backgroundImage="url("+n.imagePrefix+"chooserarrow.gif)":r.ele.style.backgroundImage="";n.SetValue(e,s.value),i.msg.style.backgroundColor=s.value,(a=n.splitRGB(s.value||"rgb(255,255,255)")).r+a.g+a.b<220?i.msg.style.color="#FFF":i.msg.style.color="#000",s.value?(i.msg.style.backgroundImage="",i.msg.title=n.RGBToHex(s.value)):(i.msg.style.backgroundColor="#FFF",i.msg.style.backgroundImage="url("+n.imagePrefix+"defaultcolor.gif)",i.msg.title="Default")},Oe.Popup.Types.ColorChooser.GridMouseDown=function(e){var t=e||U.event,o=Oe.Popup,r=o.Types.ColorChooser,a=o.Controls,n=o.Current.id;if(n){var l=a[n].data,s=l.grid;switch(t.type){case"mousedown":s.mousedown=!0;break;case"mouseup":s.mousedown=!1;break;case"mousemove":if(!s.mousedown)return}var i=Oe.GetElementPositionWithScroll(l.mainele),c=t.clientX-i.left,d=t.clientY-i.top,u=Oe.GetElementPositionWithScroll(s.table);u.left-=i.left,u.top-=i.top;var p=Math.floor((d-u.top-2)/10);p=p<0?0:p;var h=Math.floor((c-u.left)/20);p=p<0?0:15<p?15:p,h=h<0?0:4<h?4:h;var m=r.gridToG(s,p,h).ele.style.backgroundColor,f=o.splitRGB(m),g=o.splitRGB(l.value);switch(h){case 2:l.value=o.makeRGB(f.r,g.g,g.b);break;case 3:l.value=o.makeRGB(g.r,f.g,g.b);break;case 4:l.value=o.makeRGB(g.r,g.g,f.b);break;case 0:case 1:l.value=m}r.DetermineColors(n),r.SetColors(n)}},Oe.Popup.Types.ColorChooser.ControlClicked=function(e){var t=Oe.Popup,o=t.Types.ColorChooser,r=(t.Controls,t.Current.id);r&&e==r?o.CloseOK():t.CClick(e)},Oe.Popup.Types.ColorChooser.DefaultClicked=function(e){e||U.event;var t=Oe.Popup,o=(t.Types.ColorChooser,t.Controls),r=t.Current.id;if(r){var a=o[r].data;a.value="",Oe.Popup.SetValue(r,a.value),Oe.Popup.Close()}},Oe.Popup.Types.ColorChooser.CustomClicked=function(e){e||U.event;var t=Oe.Popup,o=(t.Types.ColorChooser,t.Controls),r=t.Current.id;if(r){var a,n,l,s=o[r].data;a=s.contentele,n=Oe.Popup.Types.ColorChooser.MakeCustom("ColorChooser",r),(l=document.createElement("div")).innerHTML='<div style="cursor:default;padding:4px;background-color:#CCC;">'+n+"</div>",s.customele=l.firstChild.firstChild.childNodes[2],s.contentele=l,s.popupele.replaceChild(l,a),s.customele.value=t.RGBToHex(s.value),s.attribs.ensureWithin&&Oe.Popup.EnsurePosition(r,s.attribs.ensureWithin)}},Oe.Popup.Types.ColorChooser.CustomToGrid=function(e){var t,o,r,a=Oe.Popup,n=(a.Types,a.Controls[e].data);Oe.Popup.SetValue(e,a.HexToRGB("#"+n.customele.value)),t=n.contentele,o=Oe.Popup.Types.ColorChooser.CreateGrid("ColorChooser",e),(r=document.createElement("div")).style.padding="3px",r.style.backgroundColor="#CCC",r.appendChild(o),n.customele=null,n.contentele=r,n.popupele.replaceChild(r,t),n.attribs.ensureWithin&&Oe.Popup.EnsurePosition(e,n.attribs.ensureWithin)},Oe.Popup.Types.ColorChooser.CustomOK=function(e){var t=Oe.Popup,o=(t.Types,t.Controls[e].data);Oe.Popup.SetValue(e,t.HexToRGB("#"+o.customele.value)),Oe.Popup.Close()},Oe.Popup.Types.ColorChooser.CloseOK=function(e){e||U.event;var t=Oe.Popup,o=(t.Types.ColorChooser,t.Controls),r=t.Current.id;if(r){var a=o[r].data;Oe.Popup.SetValue(r,a.value),Oe.Popup.Close()}},Oe||(alert("Main SocialCalc code module needed"),Oe={}),Oe.TableEditor||alert("SocialCalc TableEditor code module needed"),Oe.CurrentSpreadsheetControlObject=null,Oe.SpreadsheetControl=function(e){var t=Oe.Constants;this.parentNode=null,this.spreadsheetDiv=null,this.requestedHeight=0,this.requestedWidth=0,this.requestedSpaceBelow=0,this.height=0,this.width=0,this.viewheight=0,this.tabs=[],this.tabnums={},this.tabreplacements={},this.currentTab=-1,this.views={},this.sheet=null,this.context=null,this.editor=null,this.spreadsheetDiv=null,this.editorDiv=null,this.sortrange="",this.moverange="",this.idPrefix=e||"SocialCalc-",this.multipartBoundary="SocialCalcSpreadsheetControlSave",this.imagePrefix=t.defaultImagePrefix,this.toolbarbackground=t.SCToolbarbackground,this.tabbackground=t.SCTabbackground,this.tabselectedCSS=t.SCTabselectedCSS,this.tabplainCSS=t.SCTabplainCSS,this.toolbartext=t.SCToolbartext,this.formulabarheight=t.SCFormulabarheight,this.statuslineheight=t.SCStatuslineheight,this.statuslineCSS=t.SCStatuslineCSS,this.ExportCallback=null,void 0===Oe.debug_log&&(Oe.debug_log=[]),this.sheet=new Oe.Sheet,this.context=new Oe.RenderContext(this.sheet),this.context.showGrid=!0,this.context.showRCHeaders=!0,this.editor=new Oe.TableEditor(this.context),this.editor.StatusCallback.statusline={func:Oe.SpreadsheetControlStatuslineCallback,params:{statuslineid:this.idPrefix+"statusline",recalcid1:this.idPrefix+"divider_recalc",recalcid2:this.idPrefix+"button_recalc"}},(Oe.CurrentSpreadsheetControlObject=this).editor.MoveECellCallback.movefrom=function(e){var t=Oe.GetSpreadsheetControlObject();t.context.cursorsuffix="",e.range2.hasrange&&!e.cellhandles.noCursorSuffix&&(e.ecell.row==e.range2.top&&(e.ecell.col<e.range2.left||e.ecell.col>e.range2.right+1)&&(t.context.cursorsuffix="insertleft"),e.ecell.col==e.range2.left&&(e.ecell.row<e.range2.top||e.ecell.row>e.range2.bottom+1)&&(t.context.cursorsuffix="insertup"))},this.formulabuttons={formulafunctions:{image:"insertformula.png",tooltip:"Functions",command:Oe.SpreadsheetControl.DoFunctionList},multilineinput:{image:"listbox.png",tooltip:"Multi-line Input Box",command:Oe.SpreadsheetControl.DoMultiline},link:{image:"inserthyperlink.png",tooltip:"Link Input Box",command:Oe.SpreadsheetControl.DoLink},sum:{image:"autosum.png",tooltip:"Auto Sum",command:Oe.SpreadsheetControl.DoSum}},this.findbuttons={last:{image:"upsearch.png",tooltip:"Find Previous",command:Oe.SpreadsheetControl.SearchUp},next:{image:"downsearch.png",tooltip:"Find Next",command:Oe.SpreadsheetControl.SearchDown}},this.tabnums.edit=this.tabs.length,this.tabs.push({name:"edit",text:"Edit",html:' <div id="%id.edittools" style="padding:10px 0px 0px 0px;">&nbsp;<img id="%id.button_undo" src="%img.undo.png" style="vertical-align:bottom;"> <img id="%id.button_redo" src="%img.redo.png" style="vertical-align:bottom;"> &nbsp;<img src="%img.divider1.png" style="vertical-align:bottom;">&nbsp; <img id="%id.button_copy" src="%img.copy.png" style="vertical-align:bottom;"> <img id="%id.button_cut" src="%img.cut.png" style="vertical-align:bottom;"> <img id="%id.button_paste" src="%img.paste.png" style="vertical-align:bottom;"> &nbsp;<img src="%img.divider1.png" style="vertical-align:bottom;">&nbsp; <img id="%id.button_delete" src="%img.delete.png" style="vertical-align:bottom;"> <img id="%id.button_pasteformats" src="%img.formatpaintbrush.png" style="vertical-align:bottom;"> &nbsp;<img src="%img.divider1.png" style="vertical-align:bottom;">&nbsp;  <span id="%id.locktools"><img id="%id.button_lock" src="%img.lock.png" style="vertical-align:bottom;"> <img id="%id.button_unlock" src="%img.unlock.png" style="vertical-align:bottom;"> &nbsp;<img src="%img.divider1.png" style="vertical-align:bottom;">&nbsp;</span> <img id="%id.button_filldown" src="%img.filldown.png" style="vertical-align:bottom;"> <img id="%id.button_fillright" src="%img.fillright.png" style="vertical-align:bottom;"> &nbsp;<img src="%img.divider1.png" style="vertical-align:bottom;">&nbsp; <img id="%id.button_movefrom" src="%img.movefromoff.gif" style="vertical-align:bottom;"> <img id="%id.button_movepaste" src="%img.movepasteoff.gif" style="vertical-align:bottom;"> <img id="%id.button_moveinsert" src="%img.moveinsertoff.gif" style="vertical-align:bottom;"> &nbsp;<img src="%img.divider1.png" style="vertical-align:bottom;">&nbsp; <img id="%id.button_alignleft" src="%img.alignleft.png" style="vertical-align:bottom;"> <img id="%id.button_aligncenter" src="%img.aligncenter.png" style="vertical-align:bottom;"> <img id="%id.button_alignright" src="%img.alignright.png" style="vertical-align:bottom;"> &nbsp;<img src="%img.divider1.png" style="vertical-align:bottom;">&nbsp; <img id="%id.button_borderon" src="%img.borderson.png" style="vertical-align:bottom;">  <img id="%id.button_borderoff" src="%img.bordersoff.png" style="vertical-align:bottom;">  <img id="%id.button_swapcolors" src="%img.swapcolors.png" style="vertical-align:bottom;">  &nbsp;<img src="%img.divider1.png" style="vertical-align:bottom;">&nbsp; <img id="%id.button_merge" src="%img.mergecells.png" style="vertical-align:bottom;">  &nbsp;<img src="%img.divider1.png" style="vertical-align:bottom;">&nbsp; <img id="%id.button_insertrow" src="%img.insertrows.png" style="vertical-align:bottom;">  <img id="%id.button_insertcol" src="%img.insertcolumns.png" style="vertical-align:bottom;">  <img id="%id.button_deleterow" src="%img.deleterows.png" style="vertical-align:bottom;">  <img id="%id.button_deletecol" src="%img.deletecolumns.png" style="vertical-align:bottom;">  <img id="%id.button_hiderow" src="%img.hiderow.png" style="vertical-align:bottom;">  <img id="%id.button_hidecol" src="%img.hidecol.png" style="vertical-align:bottom;">  &nbsp;<img id="%id.divider_recalc" src="%img.divider1.png" style="vertical-align:bottom;">&nbsp; <img id="%id.button_recalc" src="%img.recalc.png" style="vertical-align:bottom;">  </div>',oncreate:null,onclick:null}),this.tabnums.settings=this.tabs.length,this.tabs.push({name:"settings",text:"Format",html:'<div id="%id.settingstools" style="display:none;"> <div id="%id.sheetsettingstoolbar" style="display:none;">  <table cellspacing="0" cellpadding="0"><tr><td>   <div style="%tbt.">%loc!SHEET SETTINGS!:</div>   </td></tr><tr><td>   <input id="%id.settings-savesheet" type="button" value="%loc!Save!" onclick="SocialCalc.SettingsControlSave(\'sheet\');">   <input type="button" value="%loc!Cancel!" onclick="SocialCalc.SettingsControlSave(\'cancel\');">   <input type="button" value="%loc!Show Cell Settings!" onclick="SocialCalc.SpreadsheetControlSettingsSwitch(\'cell\');return false;">   </td></tr></table> </div> <div id="%id.cellsettingstoolbar" style="display:none;">  <table cellspacing="0" cellpadding="0"><tr><td>   <div style="%tbt.">%loc!CELL SETTINGS!: <span id="%id.settingsecell">&nbsp;</span></div>   </td></tr><tr><td>  <input id="%id.settings-savecell" type="button" value="%loc!Save!" onclick="SocialCalc.SettingsControlSave(\'cell\');">  <input type="button" value="%loc!Cancel!" onclick="SocialCalc.SettingsControlSave(\'cancel\');">  <input type="button" value="%loc!Show Sheet Settings!" onclick="SocialCalc.SpreadsheetControlSettingsSwitch(\'sheet\');return false;">  </td></tr></table> </div></div>',view:"settings",onclick:function(e,t){Oe.SettingsControls.idPrefix=e.idPrefix,Oe.SettingControlReset();var o,r=e.sheet.EncodeSheetAttributes(),a=e.sheet.EncodeCellAttributes(e.editor.ecell.coord);Oe.SettingsControlLoadPanel(e.views.settings.values.sheetspanel,r),Oe.SettingsControlLoadPanel(e.views.settings.values.cellspanel,a),document.getElementById(e.idPrefix+"settingsecell").innerHTML=e.editor.ecell.coord,Oe.SpreadsheetControlSettingsSwitch("cell"),e.views.settings.element.style.height=e.viewheight+"px",e.views.settings.element.firstChild.style.height=e.viewheight+"px",o=e.editor.range.hasrange?Oe.crToCoord(e.editor.range.left,e.editor.range.top)+":"+Oe.crToCoord(e.editor.range.right,e.editor.range.bottom):e.editor.ecell.coord,document.getElementById(e.idPrefix+"settings-savecell").value=Oe.LocalizeString("Save to")+": "+o},onclickFocus:!0}),this.views.settings={name:"settings",values:{},oncreate:function(e,t){var o=Oe.Constants;t.values.sheetspanel={colorchooser:{id:e.idPrefix+"scolorchooser"},formatnumber:{setting:"numberformat",type:"PopupList",id:e.idPrefix+"formatnumber",initialdata:o.SCFormatNumberFormats},formattext:{setting:"textformat",type:"PopupList",id:e.idPrefix+"formattext",initialdata:o.SCFormatTextFormats},fontfamily:{setting:"fontfamily",type:"PopupList",id:e.idPrefix+"fontfamily",initialdata:o.SCFormatFontfamilies},fontlook:{setting:"fontlook",type:"PopupList",id:e.idPrefix+"fontlook",initialdata:o.SCFormatFontlook},fontsize:{setting:"fontsize",type:"PopupList",id:e.idPrefix+"fontsize",initialdata:o.SCFormatFontsizes},textalignhoriz:{setting:"textalignhoriz",type:"PopupList",id:e.idPrefix+"textalignhoriz",initialdata:o.SCFormatTextAlignhoriz},numberalignhoriz:{setting:"numberalignhoriz",type:"PopupList",id:e.idPrefix+"numberalignhoriz",initialdata:o.SCFormatNumberAlignhoriz},alignvert:{setting:"alignvert",type:"PopupList",id:e.idPrefix+"alignvert",initialdata:o.SCFormatAlignVertical},textcolor:{setting:"textcolor",type:"ColorChooser",id:e.idPrefix+"textcolor"},bgcolor:{setting:"bgcolor",type:"ColorChooser",id:e.idPrefix+"bgcolor"},padtop:{setting:"padtop",type:"PopupList",id:e.idPrefix+"padtop",initialdata:o.SCFormatPadsizes},padright:{setting:"padright",type:"PopupList",id:e.idPrefix+"padright",initialdata:o.SCFormatPadsizes},padbottom:{setting:"padbottom",type:"PopupList",id:e.idPrefix+"padbottom",initialdata:o.SCFormatPadsizes},padleft:{setting:"padleft",type:"PopupList",id:e.idPrefix+"padleft",initialdata:o.SCFormatPadsizes},colwidth:{setting:"colwidth",type:"PopupList",id:e.idPrefix+"colwidth",initialdata:o.SCFormatColwidth},recalc:{setting:"recalc",type:"PopupList",id:e.idPrefix+"recalc",initialdata:o.SCFormatRecalc},usermaxcol:{setting:"usermaxcol",type:"PopupList",id:e.idPrefix+"usermaxcol",initialdata:o.SCFormatUserMaxCol},usermaxrow:{setting:"usermaxrow",type:"PopupList",id:e.idPrefix+"usermaxrow",initialdata:o.SCFormatUserMaxRow}},t.values.cellspanel={name:"cell",colorchooser:{id:e.idPrefix+"scolorchooser"},cformatnumber:{setting:"numberformat",type:"PopupList",id:e.idPrefix+"cformatnumber",initialdata:o.SCFormatNumberFormats},cformattext:{setting:"textformat",type:"PopupList",id:e.idPrefix+"cformattext",initialdata:o.SCFormatTextFormats},cfontfamily:{setting:"fontfamily",type:"PopupList",id:e.idPrefix+"cfontfamily",initialdata:o.SCFormatFontfamilies},cfontlook:{setting:"fontlook",type:"PopupList",id:e.idPrefix+"cfontlook",initialdata:o.SCFormatFontlook},cfontsize:{setting:"fontsize",type:"PopupList",id:e.idPrefix+"cfontsize",initialdata:o.SCFormatFontsizes},calignhoriz:{setting:"alignhoriz",type:"PopupList",id:e.idPrefix+"calignhoriz",initialdata:o.SCFormatTextAlignhoriz},calignvert:{setting:"alignvert",type:"PopupList",id:e.idPrefix+"calignvert",initialdata:o.SCFormatAlignVertical},ctextcolor:{setting:"textcolor",type:"ColorChooser",id:e.idPrefix+"ctextcolor"},cbgcolor:{setting:"bgcolor",type:"ColorChooser",id:e.idPrefix+"cbgcolor"},cbt:{setting:"bt",type:"BorderSide",id:e.idPrefix+"cbt"},cbr:{setting:"br",type:"BorderSide",id:e.idPrefix+"cbr"},cbb:{setting:"bb",type:"BorderSide",id:e.idPrefix+"cbb"},cbl:{setting:"bl",type:"BorderSide",id:e.idPrefix+"cbl"},cpadtop:{setting:"padtop",type:"PopupList",id:e.idPrefix+"cpadtop",initialdata:o.SCFormatPadsizes},cpadright:{setting:"padright",type:"PopupList",id:e.idPrefix+"cpadright",initialdata:o.SCFormatPadsizes},cpadbottom:{setting:"padbottom",type:"PopupList",id:e.idPrefix+"cpadbottom",initialdata:o.SCFormatPadsizes},cpadleft:{setting:"padleft",type:"PopupList",id:e.idPrefix+"cpadleft",initialdata:o.SCFormatPadsizes}},Oe.SettingsControlInitializePanel(t.values.sheetspanel),Oe.SettingsControlInitializePanel(t.values.cellspanel)},replacements:{itemtitle:{regex:/\%itemtitle\./g,replacement:'style="padding:12px 10px 0px 10px;font-weight:bold;text-align:right;vertical-align:top;font-size:small;"'},sectiontitle:{regex:/\%sectiontitle\./g,replacement:'style="padding:16px 10px 0px 0px;font-weight:bold;vertical-align:top;font-size:small;color:#C00;"'},parttitle:{regex:/\%parttitle\./g,replacement:'style="font-weight:bold;font-size:x-small;padding:0px 0px 3px 0px;"'},itembody:{regex:/\%itembody\./g,replacement:'style="padding:12px 0px 0px 0px;vertical-align:top;font-size:small;"'},bodypart:{regex:/\%bodypart\./g,replacement:'style="padding:0px 10px 0px 0px;font-size:small;vertical-align:top;"'}},divStyle:"border:1px solid black;overflow:auto;",html:'<div id="%id.scolorchooser" style="display:none;position:absolute;z-index:20;"></div><table cellspacing="0" cellpadding="0"> <tr><td style="vertical-align:top;"><table id="%id.sheetsettingstable" style="display:none;" cellspacing="0" cellpadding="0"><tr> <td %itemtitle.><br>%loc!Default Format!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Number!</div>     <span id="%id.formatnumber"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Text!</div>     <span id="%id.formattext"></span>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Default Alignment!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Text Horizontal!</div>     <span id="%id.textalignhoriz"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Number Horizontal!</div>     <span id="%id.numberalignhoriz"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Vertical!</div>     <span id="%id.alignvert"></span>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Default Font!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Family!</div>     <span id="%id.fontfamily"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Bold &amp; Italics!</div>     <span id="%id.fontlook"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Size!</div>     <span id="%id.fontsize"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Color!</div>     <div id="%id.textcolor"></div>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Background!</div>     <div id="%id.bgcolor"></div>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Default Padding!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Top!</div>     <span id="%id.padtop"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Right!</div>     <span id="%id.padright"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Bottom!</div>     <span id="%id.padbottom"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Left!</div>     <span id="%id.padleft"></span>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Default Column Width!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>&nbsp;</div>     <span id="%id.colwidth"></span>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Recalculation!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>&nbsp;</div>     <span id="%id.recalc"></span>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Dimensions!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Columns!</div>     <span id="%id.usermaxcol"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Rows!</div>     <span id="%id.usermaxrow"></span>    </td>   </tr></table> </td></tr></table><table id="%id.cellsettingstable" cellspacing="0" cellpadding="0"><tr> <td %itemtitle.><br>%loc!Format!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Number!</div>     <span id="%id.cformatnumber"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Text!</div>     <span id="%id.cformattext"></span>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Alignment!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Horizontal!</div>     <span id="%id.calignhoriz"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Vertical!</div>     <span id="%id.calignvert"></span>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Font!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Family!</div>     <span id="%id.cfontfamily"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Bold &amp; Italics!</div>     <span id="%id.cfontlook"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Size!</div>     <span id="%id.cfontsize"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Color!</div>     <div id="%id.ctextcolor"></div>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Background!</div>     <div id="%id.cbgcolor"></div>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Borders!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0">    <tr><td %bodypart. colspan="3"><div %parttitle.>%loc!Top Border!</div></td>     <td %bodypart. colspan="3"><div %parttitle.>%loc!Right Border!</div></td>     <td %bodypart. colspan="3"><div %parttitle.>%loc!Bottom Border!</div></td>     <td %bodypart. colspan="3"><div %parttitle.>%loc!Left Border!</div></td>    </tr><tr>    <td %bodypart.>     <input id="%id.cbt-onoff-bcb" onclick="SocialCalc.SettingsControlOnchangeBorder(this);" type="checkbox">    </td>    <td %bodypart.>     <div id="%id.cbt-color"></div>    </td>    <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>    <td %bodypart.>     <input id="%id.cbr-onoff-bcb" onclick="SocialCalc.SettingsControlOnchangeBorder(this);" type="checkbox">    </td>    <td %bodypart.>     <div id="%id.cbr-color"></div>    </td>    <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>    <td %bodypart.>     <input id="%id.cbb-onoff-bcb" onclick="SocialCalc.SettingsControlOnchangeBorder(this);" type="checkbox">    </td>    <td %bodypart.>     <div id="%id.cbb-color"></div>    </td>    <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>    <td %bodypart.>     <input id="%id.cbl-onoff-bcb" onclick="SocialCalc.SettingsControlOnchangeBorder(this);" type="checkbox">    </td>    <td %bodypart.>     <div id="%id.cbl-color"></div>    </td>    <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Padding!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Top!</div>     <span id="%id.cpadtop"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Right!</div>     <span id="%id.cpadright"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Bottom!</div>     <span id="%id.cpadbottom"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Left!</div>     <span id="%id.cpadleft"></span>    </td>   </tr></table> </td></tr></table> </td><td style="vertical-align:top;padding:12px 0px 0px 12px;">  <div style="width:100px;height:100px;overflow:hidden;border:1px solid black;background-color:#EEE;padding:6px;">   <table cellspacing="0" cellpadding="0"><tr>    <td id="sample-text" style="height:100px;width:100px;"><div>%loc!This is a<br>sample!</div><div>-1234.5</div></td>   </tr></table>  </div> </td></tr></table><br>'},this.tabnums.sort=this.tabs.length,this.tabs.push({name:"sort",text:"Sort",html:' <div id="%id.sorttools" style="display:none;">  <table cellspacing="0" cellpadding="0"><tr>   <td style="vertical-align:top;padding-right:4px;width:160px;">    <div style="%tbt.">%loc!Set Cells To Sort!</div>    <select id="%id.sortlist" size="1" onfocus="%s.CmdGotFocus(this);"><option selected>[select range]</option><option value="all">Sort All</option></select>    <input type="button" value="%loc!OK!" onclick="%s.DoCmd(this, \'ok-setsort\');" style="font-size:x-small;">   </td>   <td style="vertical-align:middle;padding-right:16px;width:100px;text-align:right;">    <div style="%tbt.">&nbsp;</div>    <input type="button" id="%id.sortbutton" value="%loc!Sort Cells! A1:A1" onclick="%s.DoCmd(this, \'dosort\');" style="visibility:hidden;">   </td>   <td style="vertical-align:top;padding-right:16px;">    <table cellspacing="0" cellpadding="0"><tr>     <td style="vertical-align:top;">      <div style="%tbt.">%loc!Major Sort!</div>      <select id="%id.majorsort" size="1" onfocus="%s.CmdGotFocus(this);"></select>     </td><td>      <input type="radio" name="majorsort" id="%id.majorsortup" value="up" checked><span style="font-size:x-small;color:#555753;">%loc!Up!</span><br>      <input type="radio" name="majorsort" id="%id.majorsortdown" value="down"><span style="font-size:x-small;color:#555753;">%loc!Down!</span>     </td>    </tr></table>   </td>   <td style="vertical-align:top;padding-right:16px;">    <table cellspacing="0" cellpadding="0"><tr>     <td style="vertical-align:top;">      <div style="%tbt.">%loc!Minor Sort!</div>      <select id="%id.minorsort" size="1" onfocus="%s.CmdGotFocus(this);"></select>     </td><td>      <input type="radio" name="minorsort" id="%id.minorsortup" value="up" checked><span style="font-size:x-small;color:#555753;">%loc!Up!</span><br>      <input type="radio" name="minorsort" id="%id.minorsortdown" value="down"><span style="font-size:x-small;color:#555753;">%loc!Down!</span>     </td>    </tr></table>   </td>   <td style="vertical-align:top;padding-right:16px;">    <table cellspacing="0" cellpadding="0"><tr>     <td style="vertical-align:top;">      <div style="%tbt.">%loc!Last Sort!</div>      <select id="%id.lastsort" size="1" onfocus="%s.CmdGotFocus(this);"></select>     </td><td>      <input type="radio" name="lastsort" id="%id.lastsortup" value="up" checked><span style="font-size:x-small;color:#555753;">%loc!Up!</span><br>      <input type="radio" name="lastsort" id="%id.lastsortdown" value="down"><span style="font-size:x-small;color:#555753;">%loc!Down!</span>     </td>    </tr></table>   </td>  </tr></table> </div>',onclick:Oe.SpreadsheetControlSortOnclick}),this.editor.SettingsCallbacks.sort={save:Oe.SpreadsheetControlSortSave,load:Oe.SpreadsheetControlSortLoad},this.tabnums.audit=this.tabs.length,this.tabs.push({name:"audit",text:"Audit",html:'<div id="%id.audittools" style="display:none;"> <div style="%tbt.">&nbsp;</div></div>',view:"audit",onclick:function(e,t){var o,r,a=Oe.LocalizeString,n='<table cellspacing="0" cellpadding="0" style="margin-bottom:10px;"><tr><td style="font-size:small;padding:6px;"><b>'+a("Audit Trail This Session")+":</b><br><br>",l=e.sheet.changes.stack,s=e.sheet.changes.tos;for(o=0;o<l.length;o++)for(o==s+1&&(n+='<br></td></tr><tr><td style="font-size:small;background-color:#EEE;padding:6px;">'+a("UNDONE STEPS")+":<br>"),r=0;r<l[o].command.length;r++)n+=Oe.special_chars(l[o].command[r])+"<br>";var i=function(e){if("string"==typeof e)return e;if(!e)return"null";if("object"==typeof e){i.check||(i.check=new Array);for(var t=0,o=i.check.length;t<o;++t)if(i.check[t]==e)return"{}";i.check.push(e)}o="";var r=void 0===e.length?1:0,a="";for(var n in e)r&&(o="'"+n+"':"),"string"==typeof e[n]?a+=o+"'"+e[n]+"',":"object"==typeof e[n]?a+=o+i(e[n])+",":a+=o+e[n]+",";return"object"==typeof e&&i.check.pop(),r?"{"+a.slice(0,-1)+"}":"["+a.slice(0,-1)+"]"};if(void 0!==Oe.debug_log)for(var c in Oe.debug_log)n+=i(Oe.debug_log[c])+"<br>";e.views.audit.element.innerHTML=n+"</td></tr></table>",Oe.CmdGotFocus(!0)},onclickFocus:!0}),this.views.audit={name:"audit",divStyle:"border:1px solid black;overflow:auto;",html:"Audit Trail"},this.tabnums.comment=this.tabs.length,this.tabs.push({name:"comment",text:"Comment",html:'<div id="%id.commenttools" style="display:none;"><table cellspacing="0" cellpadding="0"><tr><td><textarea id="%id.commenttext" style="font-size:small;height:32px;width:600px;overflow:auto;" onfocus="%s.CmdGotFocus(this);"></textarea></td><td style="vertical-align:top;">&nbsp;<input type="button" value="%loc!Save!" onclick="%s.SpreadsheetControlCommentSet();" style="font-size:x-small;"></td></tr></table></div>',view:"sheet",onclick:Oe.SpreadsheetControlCommentOnclick,onunclick:Oe.SpreadsheetControlCommentOnunclick}),this.tabnums.names=this.tabs.length,this.tabs.push({name:"names",text:"Names",html:'<div id="%id.namestools" style="display:none;">  <table cellspacing="0" cellpadding="0"><tr>   <td style="vertical-align:top;padding-right:24px;">    <div style="%tbt.">%loc!Existing Names!</div>    <select id="%id.nameslist" size="1" onchange="%s.SpreadsheetControlNamesChangedName();" onfocus="%s.CmdGotFocus(this);"><option selected>[New]</option></select>   </td>   <td style="vertical-align:top;padding-right:6px;">    <div style="%tbt.">%loc!Name!</div>    <input type="text" id="%id.namesname" style="font-size:x-small;width:75px;" onfocus="%s.CmdGotFocus(this);">   </td>   <td style="vertical-align:top;padding-right:6px;">    <div style="%tbt.">%loc!Description!</div>    <input type="text" id="%id.namesdesc" style="font-size:x-small;width:150px;" onfocus="%s.CmdGotFocus(this);">   </td>   <td style="vertical-align:top;padding-right:6px;">    <div style="%tbt.">%loc!Value!</div>    <input type="text" id="%id.namesvalue" width="16" style="font-size:x-small;width:100px;" onfocus="%s.CmdGotFocus(this);">   </td>   <td style="vertical-align:top;padding-right:12px;width:100px;">    <div style="%tbt.">%loc!Set Value To!</div>    <input type="button" id="%id.namesrangeproposal" value="A1" onclick="%s.SpreadsheetControlNamesSetValue();" style="font-size:x-small;">   </td>   <td style="vertical-align:top;padding-right:6px;">    <div style="%tbt.">&nbsp;</div>    <input type="button" value="%loc!Save!" onclick="%s.SpreadsheetControlNamesSave();" style="font-size:x-small;">    <input type="button" value="%loc!Delete!" onclick="%s.SpreadsheetControlNamesDelete()" style="font-size:x-small;">   </td>  </tr></table></div>',view:"sheet",onclick:Oe.SpreadsheetControlNamesOnclick,onunclick:Oe.SpreadsheetControlNamesOnunclick}),this.tabnums.clipboard=this.tabs.length,this.tabs.push({name:"clipboard",text:"Clipboard",html:'<div id="%id.clipboardtools" style="display:none;">  <table cellspacing="0" cellpadding="0"><tr>   <td style="vertical-align:top;padding-right:24px;">    <div style="%tbt.">     &nbsp;    </div>   </td>  </tr></table></div>',view:"clipboard",onclick:Oe.SpreadsheetControlClipboardOnclick,onclickFocus:"clipboardtext"}),this.views.clipboard={name:"clipboard",divStyle:"overflow:auto;",html:' <div style="font-size:x-small;padding:5px 0px 10px 0px;">  <b>%loc!Display Clipboard in!:</b>  <input type="radio" id="%id.clipboardformat-tab" name="%id.clipboardformat" checked onclick="%s.SpreadsheetControlClipboardFormat(\'tab\');"> %loc!Tab-delimited format! &nbsp;  <input type="radio" id="%id.clipboardformat-csv" name="%id.clipboardformat" onclick="%s.SpreadsheetControlClipboardFormat(\'csv\');"> %loc!CSV format! &nbsp;  <input type="radio" id="%id.clipboardformat-scsave" name="%id.clipboardformat" onclick="%s.SpreadsheetControlClipboardFormat(\'scsave\');"> %loc!SocialCalc-save format! </div> <input type="button" value="%loc!Load SocialCalc Clipboard With This!" style="font-size:x-small;" onclick="%s.SpreadsheetControlClipboardLoad();">&nbsp;  <input type="button" value="%loc!Clear SocialCalc Clipboard!" style="font-size:x-small;" onclick="%s.SpreadsheetControlClipboardClear();">&nbsp;  <br> <textarea id="%id.clipboardtext" style="font-size:small;height:350px;width:800px;overflow:auto;" onfocus="%s.CmdGotFocus(this);"></textarea>'}},Oe.SpreadsheetControl.prototype.InitializeSpreadsheetControl=function(e,t,o,r){return Oe.InitializeSpreadsheetControl(this,e,t,o,r)},Oe.SpreadsheetControl.prototype.DoOnResize=function(){return Oe.DoOnResize(this)},Oe.SpreadsheetControl.prototype.SizeSSDiv=function(){return Oe.SizeSSDiv(this)},Oe.SpreadsheetControl.prototype.ExecuteCommand=function(e,t){return Oe.SpreadsheetControlExecuteCommand(this,e,t)},Oe.SpreadsheetControl.prototype.CreateSheetHTML=function(){return Oe.SpreadsheetControlCreateSheetHTML(this)},Oe.SpreadsheetControl.prototype.CreateSpreadsheetSave=function(e){return Oe.SpreadsheetControlCreateSpreadsheetSave(this,e)},Oe.SpreadsheetControl.prototype.DecodeSpreadsheetSave=function(e){return Oe.SpreadsheetControlDecodeSpreadsheetSave(this,e)},Oe.SpreadsheetControl.prototype.CreateCellHTML=function(e){return Oe.SpreadsheetControlCreateCellHTML(this,e)},Oe.SpreadsheetControl.prototype.CreateCellHTMLSave=function(e){return Oe.SpreadsheetControlCreateCellHTMLSave(this,e)},Oe.SpreadsheetControl.prototype.ParseSheetSave=function(e){return this.sheet.ParseSheetSave(e)},Oe.SpreadsheetControl.prototype.CreateSheetSave=function(){return this.sheet.CreateSheetSave()},Oe.InitializeSpreadsheetControl=function(e,t,o,r,a){var n,l,s,i,c,d,u,p,h=Oe.Constants,m=Oe.LocalizeString,f=Oe.LocalizeSubstrings,g=e.tabs,v=e.views;for(e.requestedHeight=o,e.requestedWidth=r,e.requestedSpaceBelow=a,"string"==typeof t&&(t=document.getElementById(t)),null==t&&alert("SocialCalc.SpreadsheetControl not given parent node."),e.parentNode=t,e.spreadsheetDiv=document.createElement("div"),e.SizeSSDiv(),l=t.firstChild;null!=l;l=t.firstChild)t.removeChild(l);for(n="<div>",n+='<div style="'+e.tabbackground+'"><table cellpadding="0" cellspacing="0"><tr>',s=0;s<g.length;s++)n+='  <td id="%id.'+g[s].name+'tab" style="'+(0==s?e.tabselectedCSS:e.tabplainCSS)+'" onclick="%s.SetTab(this);">'+m(g[s].text)+"</td>";for(n+=" </tr></table></div>",n+='<div style="'+e.toolbarbackground+'padding:12px 10px 10px 4px;">',s=0;s<g.length;s++)n+=g[s].html;for(d in n+="</div>",n+="</div>",e.currentTab=0,e.tabreplacements)n=n.replace(e.tabreplacements[d].regex,e.tabreplacements[d].replacement);for(u in n=f(n=(n=(n=(n=n.replace(/\%s\./g,"SocialCalc.")).replace(/\%id\./g,e.idPrefix)).replace(/\%tbt\./g,e.toolbartext)).replace(/\%img\./g,e.imagePrefix)),e.spreadsheetDiv.innerHTML=n,t.appendChild(e.spreadsheetDiv),e.Buttons={button_undo:{tooltip:"Undo",command:"undo"},button_redo:{tooltip:"Redo",command:"redo"},button_copy:{tooltip:"Copy",command:"copy"},button_cut:{tooltip:"Cut",command:"cut"},button_paste:{tooltip:"Paste",command:"paste"},button_pasteformats:{tooltip:"Paste Formats",command:"pasteformats"},button_lock:{tooltip:"Lock Cell",command:"lock"},button_unlock:{tooltip:"Unlock Cell",command:"unlock"},button_delete:{tooltip:"Delete Cell Contents",command:"delete"},button_filldown:{tooltip:"Fill Down",command:"filldown"},button_fillright:{tooltip:"Fill Right",command:"fillright"},button_movefrom:{tooltip:"Set/Clear Move From",command:"movefrom"},button_movepaste:{tooltip:"Move Paste",command:"movepaste"},button_moveinsert:{tooltip:"Move Insert",command:"moveinsert"},button_alignleft:{tooltip:"Align Left",command:"align-left"},button_aligncenter:{tooltip:"Align Center",command:"align-center"},button_alignright:{tooltip:"Align Right",command:"align-right"},button_borderon:{tooltip:"Borders On",command:"borderon"},button_borderoff:{tooltip:"Borders Off",command:"borderoff"},button_swapcolors:{tooltip:"Swap Colors",command:"swapcolors"},button_merge:{tooltip:"Merge/Unmerge Cells",command:"merge"},button_insertrow:{tooltip:"Insert Row Before",command:"insertrow"},button_insertcol:{tooltip:"Insert Column Before",command:"insertcol"},button_deleterow:{tooltip:"Delete Row",command:"deleterow"},button_deletecol:{tooltip:"Delete Column",command:"deletecol"},button_hiderow:{tooltip:"Hide Row",command:"hiderow"},button_hidecol:{tooltip:"Hide Column",command:"hidecol"},button_recalc:{tooltip:"Recalculate",command:"recalc"}},e.Buttons)(p=document.getElementById(e.idPrefix+u))?(p.style.border="1px solid "+h.ISCButtonBorderNormal,p.title=m(e.Buttons[u].tooltip),Oe.ButtonRegister(e.editor,p,{normalstyle:"border:1px solid "+h.ISCButtonBorderNormal+";background-color:"+h.ISCButtonNormalBackground+";",hoverstyle:"border:1px solid "+h.ISCButtonBorderHover+";background-color:"+h.ISCButtonHoverBackground+";",downstyle:"border:1px solid "+h.ISCButtonBorderDown+";background-color:"+h.ISCButtonDownBackground+";"},{MouseDown:Oe.DoButtonCmd,command:e.Buttons[u].command})):alert("Button "+(e.idPrefix+u)+" missing");e.formulabarDiv=document.createElement("div"),e.formulabarDiv.innerHTML='<input type="text" size="60" value="">&nbsp;',e.spreadsheetDiv.appendChild(e.formulabarDiv);new Oe.InputBox(e.formulabarDiv.firstChild,e.editor);for(u in e.formulabuttons)(p=document.createElement("img")).id=e.idPrefix+u,p.src=(e.formulabuttons[u].skipImagePrefix?"":e.imagePrefix)+e.formulabuttons[u].image,p.style.verticalAlign="middle",p.style.border="1px solid #FFF",p.style.marginLeft="4px",p.title=m(e.formulabuttons[u].tooltip),Oe.ButtonRegister(e.editor,p,{normalstyle:"border:1px solid #FFF;backgroundColor:#FFF;",hoverstyle:"border:1px solid #CCC;backgroundColor:#FFF;",downstyle:"border:1px solid #000;backgroundColor:#FFF;"},{MouseDown:e.formulabuttons[u].command,Disabled:function(){return e.editor.ECellReadonly()}}),e.formulabarDiv.appendChild(p);var b=$("<input id='searchbarinput' value='' placeholder='Search sheet'>"),C=$("<span id='searchbar'></span>");for(u in C.append("<div id='searchstatus'></div>"),C.append(b),e.findbuttons)(p=document.createElement("img")).id=e.idPrefix+u,p.src=e.imagePrefix+e.findbuttons[u].image,p.style.verticalAlign="middle",p.style.border="1px solid #FFF",p.title=m(e.findbuttons[u].tooltip),Oe.ButtonRegister(e.editor,p,{normalstyle:"border:1px solid #FFF;backgroundColor:#FFF;",hoverstyle:"border:1px solid #CCC;backgroundColor:#FFF;",downstyle:"border:1px solid #000;backgroundColor:#FFF;"},{MouseDown:e.findbuttons[u].command,Disabled:function(){return!1}}),C[0].appendChild(p);for(b.on("input",Oe.SpreadsheetControl.FindInSheet),b.on("focus",function(){Oe.Keyboard.passThru=!0}),b.on("blur",function(){Oe.Keyboard.passThru=!1}),b.keyup(function(e){13==e.keyCode&&(e.shiftKey?Oe.SpreadsheetControl.SearchUp():Oe.SpreadsheetControl.SearchDown())}),e.formulabarDiv.appendChild(C[0]),s=0;s<g.length;s++)g[s].oncreate&&g[s].oncreate(e,g[s].name);Oe.CalculateSheetNonViewHeight(e),e.viewheight=e.height-e.nonviewheight,e.editorDiv=e.editor.CreateTableEditor(e.width,e.viewheight);var y=document.createElement("div");y.id="te_appView",y.appendChild(e.editorDiv),e.editorDiv=y;var S=document.createElement("div");for(i in S.id="te_formData",S.style.display="none",e.editorDiv.appendChild(S),e.spreadsheetDiv.appendChild(e.editorDiv),e.formDataViewer=new Oe.SpreadsheetViewer("te_FormData-"),e.formDataViewer.InitializeSpreadsheetViewer(S.id,180,0,200),e.formDataViewer.editor.ignoreRender=!0,v){for(d in n=v[i].html,v[i].replacements)n=n.replace(v[i].replacements[d].regex,v[i].replacements[d].replacement);n=(n=(n=(n=n.replace(/\%s\./g,"SocialCalc.")).replace(/\%id\./g,e.idPrefix)).replace(/\%tbt\./g,e.toolbartext)).replace(/\%img\./g,e.imagePrefix),c=document.createElement("div"),Oe.setStyles(c,v[i].divStyle),c.style.display="none",c.style.width=e.width+"px",c.style.height=e.viewheight+"px",c.id=e.idPrefix+v[i].name+"view",n=f(n),c.innerHTML=n,e.spreadsheetDiv.appendChild(c),v[i].element=c,v[i].oncreate&&v[i].oncreate(e,v[i])}if(v.sheet={name:"sheet",element:e.editorDiv},e.statuslineDiv=document.createElement("div"),e.statuslineDiv.style.cssText=e.statuslineCSS,e.statuslineDiv.style.height=e.statuslineheight-(e.statuslineDiv.style.paddingTop.slice(0,-2)-0)-(e.statuslineDiv.style.paddingBottom.slice(0,-2)-0)+"px",e.statuslineDiv.id=e.idPrefix+"statusline",e.spreadsheetDiv.appendChild(e.statuslineDiv),e.spreadsheetDiv.addEventListener)e.spreadsheetDiv.addEventListener("mousedown",function(){Oe.SetSpreadsheetControlObject(e)},!1),e.spreadsheetDiv.addEventListener("mouseover",function(){Oe.SetSpreadsheetControlObject(e)},!1);else{if(!e.spreadsheetDiv.attachEvent)throw Oe.Constants.s_BrowserNotSupported;e.spreadsheetDiv.attachEvent("onmousedown",function(){Oe.SetSpreadsheetControlObject(e)}),e.spreadsheetDiv.attachEvent("onmouseover",function(){Oe.SetSpreadsheetControlObject(e)})}},Oe.CalculateSheetNonViewHeight=function(e){e.nonviewheight=e.statuslineheight;for(var t=0;t<e.spreadsheetDiv.childNodes.length;t++)"SocialCalc-statusline"!=e.spreadsheetDiv.childNodes[t].id&&(e.nonviewheight+=e.spreadsheetDiv.childNodes[t].offsetHeight)},Oe.LocalizeString=function(e){var t=Oe.LocalizeStringList[e];return t||(t=Oe.Constants["s_loc_"+e.toLowerCase().replace(/\s/g,"_").replace(/\W/g,"X")]||e,Oe.LocalizeStringList[e]=t),t},Oe.LocalizeStringList={},Oe.LocalizeSubstrings=function(e){var r=Oe.LocalizeString;return e.replace(/%(loc|ssc)!(.*?)!/g,function(e,t,o){return"ssc"==t?Oe.Constants[o]||alert("Missing constant: "+o):r(o)})},Oe.GetSpreadsheetControlObject=function(){var e=null!=Oe.CurrentSpreadsheetControlObject?Oe.CurrentSpreadsheetControlObject:Oe.CurrentSpreadsheetViewerObject;if(e)return e},Oe.SetSpreadsheetControlObject=function(e){Oe.CurrentSpreadsheetControlObject=e,Oe.Keyboard.focusTable&&e&&(Oe.Keyboard.focusTable=e.editor)},Oe.DoOnResize=function(e){var t,o=e.views;if(e.SizeSSDiv()){for(vname in o)(t=o[vname].element).style.width=e.width+"px",t.style.height=e.height-e.nonviewheight+"px";e.editor.ResizeTableEditor(e.width,e.height-e.nonviewheight)}},Oe.SizeSSDiv=function(e){var t,o,r,a,n;return r=!1,t=Oe.GetViewportInfo(),(o=Oe.GetElementPosition(e.parentNode)).bottom=0,o.right=0,(a=e.parentNode.style).marginTop&&(o.top+=a.marginTop.slice(0,-2)-0),a.marginBottom&&(o.bottom+=a.marginBottom.slice(0,-2)-0),a.marginLeft&&(o.left+=a.marginLeft.slice(0,-2)-0),a.marginRight&&(o.right+=a.marginRight.slice(0,-2)-0),n=e.requestedHeight||t.height-(o.top+o.bottom+10)-(e.requestedSpaceBelow||0),e.height!=n&&(e.height=n,e.spreadsheetDiv.style.height=n+"px",r=!0),n=e.requestedWidth||t.width-(o.left+o.right+10)||700,e.width!=n&&(e.width=n,e.spreadsheetDiv.style.width=n+"px",r=!0),e.spreadsheetDiv.style.position="relative",r},Oe.SetTab=function(e){var t,o,r,a,n,l,s,i={},c={},d=Oe.GetSpreadsheetControlObject(),u=d.tabs,p=d.views;if(t="string"==typeof e?e:e.id.slice(d.idPrefix.length,-3),d.editor.busy&&(!u[d.currentTab].view||"sheet"==u[d.currentTab].view))for(n=0;n<u.length;n++)if(u[n].name==t&&u[n].view&&"sheet"!=u[n].view)return;for(d.tabs[d.currentTab].onunclick&&d.tabs[d.currentTab].onunclick(d,d.tabs[d.currentTab].name),n=0;n<u.length;n++)i[o=u[n].name]=document.getElementById(d.idPrefix+o+"tab"),c[o]=document.getElementById(d.idPrefix+o+"tools"),o==t?(r=n,c[o].style.display="block",i[o].style.cssText=d.tabselectedCSS):(c[o].style.display="none",i[o].style.cssText=d.tabplainCSS);for(l in u[d.currentTab=r].onclick&&u[r].onclick(d,t),p)!u[r].view&&"sheet"==l||u[r].view==l?(p[l].element.style.display="block",a=l):p[l].element.style.display="none";u[r].onclickFocus?("string"==typeof(s=u[r].onclickFocus)&&(s=document.getElementById(d.idPrefix+s)).focus(),Oe.CmdGotFocus(s)):Oe.KeyboardFocus(),p[a].needsresize&&p[a].onresize&&(p[a].needsresize=!1,p[a].onresize(d,p[a])),"sheet"==a?(d.statuslineDiv.style.display="block",d.editor.ScheduleRender()):d.statuslineDiv.style.display="none"},Oe.SpreadsheetControlStatuslineCallback=function(e,t,o,r){var a,n,l=document.getElementById(r.statuslineid);switch(l&&(l.innerHTML=e.GetStatuslineString(t,o,r)),t){case"cmdendnorender":case"calcfinished":case"doneposcalc":if(a=document.getElementById(r.recalcid1),n=document.getElementById(r.recalcid2),!a||!n)break;"yes"==e.context.sheetobj.attribs.needsrecalc?(a.style.display="inline",n.style.display="inline"):(a.style.display="none",n.style.display="none")}},Oe.UpdateSortRangeProposal=function(e){var t=document.getElementById(Oe.GetSpreadsheetControlObject().idPrefix+"sortlist");e.range.hasrange?t.options[0].text=Oe.crToCoord(e.range.left,e.range.top)+":"+Oe.crToCoord(e.range.right,e.range.bottom):t.options[0].text=Oe.LocalizeString("[select range]")},Oe.LoadColumnChoosers=function(e){var t,o,r,a,n,l,s=Oe.LocalizeString;t=e.sortrange&&-1==e.sortrange.indexOf(":")?"range"==(o=Oe.Formula.LookupName(e.sheet,e.sortrange||"")).type?(r=o.value.match(/^(.*)\|(.*)\|$/))[1]+":"+r[2]:"A1:A1":e.sortrange;var i=Oe.ParseRange(t);l=(n=document.getElementById(e.idPrefix+"majorsort")).selectedIndex,n.options.length=0,n.options[n.options.length]=new Option(s("[None]"),"");for(var c=i.cr1.col;c<=i.cr2.col;c++)a=Oe.rcColname(c),n.options[n.options.length]=new Option(s("Column ")+a,a);n.selectedIndex=1<l&&l<=i.cr2.col-i.cr1.col+1?l:1,l=(n=document.getElementById(e.idPrefix+"minorsort")).selectedIndex,n.options.length=0,n.options[n.options.length]=new Option(s("[None]"),"");for(c=i.cr1.col;c<=i.cr2.col;c++)a=Oe.rcColname(c),n.options[n.options.length]=new Option(a,a);n.selectedIndex=0<l&&l<=i.cr2.col-i.cr1.col+1?l:0,l=(n=document.getElementById(e.idPrefix+"lastsort")).selectedIndex,n.options.length=0,n.options[n.options.length]=new Option(s("[None]"),"");for(c=i.cr1.col;c<=i.cr2.col;c++)a=Oe.rcColname(c),n.options[n.options.length]=new Option(a,a);n.selectedIndex=0<l&&l<=i.cr2.col-i.cr1.col+1?l:0},Oe.CmdGotFocus=function(e){Oe.Keyboard.passThru=e},Oe.DoButtonCmd=function(e,t,o){Oe.DoCmd(o.element,o.functionobj.command)},Oe.DoCmd=function(e,t){var o,r,a,n,l,s,i,c,d,u,p,h,m,f,g,v,b,C,y,S,w,x=Oe.GetSpreadsheetControlObject(),F=x.editor;switch(t){case"undo":x.ExecuteCommand("undo","");break;case"redo":x.ExecuteCommand("redo","");break;case"fill-rowcolstuff":case"fill-text":for(a=t.substring(5),n=(l=document.getElementById(x.idPrefix+a+"list")).length=0;n<Oe.SpreadsheetCmdTable[a].length;n++)l.options[n]=new Option(Oe.SpreadsheetCmdTable[a][n].t);t="changed-"+a;case"changed-rowcolstuff":case"changed-text":for(a=t.substring(8),l=document.getElementById(x.idPrefix+a+"list"),s=Oe.SpreadsheetCmdTable.slists[Oe.SpreadsheetCmdTable[a][l.selectedIndex].s],n=(i=document.getElementById(x.idPrefix+a+"slist")).length=0;n<(s.length||0);n++)i.options[n]=new Option(s[n].t,s[n].s);return;case"ok-rowcolstuff":case"ok-text":a=t.substring(3),l=document.getElementById(x.idPrefix+a+"list"),i=document.getElementById(x.idPrefix+a+"slist"),o=Oe.SpreadsheetCmdTable[a][l.selectedIndex].c,r=i[i.selectedIndex].value,Oe.SpreadsheetControlExecuteCommand(e,o,r);break;case"ok-setsort":if(0==(p=document.getElementById(x.idPrefix+"sortlist")).selectedIndex)F.range.hasrange?x.sortrange=Oe.crToCoord(F.range.left,F.range.top)+":"+Oe.crToCoord(F.range.right,F.range.bottom):x.sortrange=F.ecell.coord+":"+F.ecell.coord;else if("all"==p.options[p.selectedIndex].value){var T=x.sheet.cells,k=-1,E=-1,_=-1,P=-1;for(var R in T){var A=Oe.coordToCr(R);(-1==_||A.row<_)&&(_=A.row),(-1==k||A.col<k)&&(k=A.col),(-1==P||A.row>P)&&(P=A.row),(-1==E||A.col>E)&&(E=A.col)}x.sortrange=Oe.crToCoord(k,_)+":"+Oe.crToCoord(E,P),p.options[p.selectedIndex].text+=" ("+x.sortrange+")"}else x.sortrange=p.options[p.selectedIndex].value;return(h=document.getElementById(x.idPrefix+"sortbutton")).value=Oe.LocalizeString("Sort ")+x.sortrange,h.style.visibility="visible",Oe.LoadColumnChoosers(x),e&&e.blur&&e.blur(),void Oe.KeyboardFocus();case"dosort":if(x.sortrange&&-1==x.sortrange.indexOf(":")){if("range"!=(f=Oe.Formula.LookupName(x.sheet,x.sortrange||"")).type)return;m=(g=f.value.match(/^(.*)\|(.*)\|$/))[1]+":"+g[2]}else m=x.sortrange;if("A1:A1"==m)return;c="sort "+m+" ",d=document.getElementById(x.idPrefix+"majorsort"),u=document.getElementById(x.idPrefix+"majorsortup"),c+=d.options[d.selectedIndex].value+(u.checked?" up":" down"),0<(d=document.getElementById(x.idPrefix+"minorsort")).selectedIndex&&(u=document.getElementById(x.idPrefix+"minorsortup"),c+=" "+d.options[d.selectedIndex].value+(u.checked?" up":" down")),0<(d=document.getElementById(x.idPrefix+"lastsort")).selectedIndex&&(u=document.getElementById(x.idPrefix+"lastsortup"),c+=" "+d.options[d.selectedIndex].value+(u.checked?" up":" down")),x.ExecuteCommand(c,"");break;case"merge":o=Oe.SpreadsheetCmdLookup[t]||"",r=Oe.SpreadsheetCmdSLookup[t]||"",x.ExecuteCommand(o,r),F.range.hasrange&&(F.MoveECell(Oe.crToCoord(F.range.left,F.range.top)),F.RangeRemove());break;case"movefrom":F.range2.hasrange?(x.context.cursorsuffix="",F.Range2Remove(),x.ExecuteCommand("redisplay","")):F.range.hasrange?(F.range2.top=F.range.top,F.range2.right=F.range.right,F.range2.bottom=F.range.bottom,F.range2.left=F.range.left,F.range2.hasrange=!0,F.MoveECell(Oe.crToCoord(F.range.left,F.range.top))):(F.range2.top=F.ecell.row,F.range2.right=F.ecell.col,F.range2.bottom=F.ecell.row,F.range2.left=F.ecell.col,F.range2.hasrange=!0),c=F.range2.hasrange?"":"off",(h=document.getElementById(x.idPrefix+"button_movefrom")).src=x.imagePrefix+"movefrom"+c+".gif",(h=document.getElementById(x.idPrefix+"button_movepaste")).src=x.imagePrefix+"movepaste"+c+".gif",(h=document.getElementById(x.idPrefix+"button_moveinsert")).src=x.imagePrefix+"moveinsert"+c+".gif",F.range2.hasrange&&F.RangeRemove();break;case"movepaste":case"moveinsert":F.range2.hasrange&&(x.context.cursorsuffix="",o=t+" "+Oe.crToCoord(F.range2.left,F.range2.top)+":"+Oe.crToCoord(F.range2.right,F.range2.bottom)+" "+F.ecell.coord,x.ExecuteCommand(o,""),F.Range2Remove(),(h=document.getElementById(x.idPrefix+"button_movefrom")).src=x.imagePrefix+"movefromoff.gif",(h=document.getElementById(x.idPrefix+"button_movepaste")).src=x.imagePrefix+"movepasteoff.gif",(h=document.getElementById(x.idPrefix+"button_moveinsert")).src=x.imagePrefix+"moveinsertoff.gif");break;case"swapcolors":b=(v=x.sheet).GetAssuredCell(F.ecell.coord),S=v.attribs.defaultcolor?v.colors[v.attribs.defaultcolor]:"rgb(0,0,0)",w=v.attribs.defaultbgcolor?v.colors[v.attribs.defaultbgcolor]:"rgb(255,255,255)",(C=b.color?v.colors[b.color]:S)==w&&(C=""),(y=b.bgcolor?v.colors[b.bgcolor]:w)==S&&(y=""),x.ExecuteCommand("set %C color "+y+"%Nset %C bgcolor "+C,"");break;default:o=Oe.SpreadsheetCmdLookup[t]||"",r=Oe.SpreadsheetCmdSLookup[t]||"",x.ExecuteCommand(o,r)}e&&e.blur&&e.blur(),Oe.KeyboardFocus()},Oe.SpreadsheetCmdLookup={copy:"copy %C all",cut:"cut %C all",paste:"paste %C all",pasteformats:"paste %C formats",lock:"set %C readonly yes",unlock:"set %C readonly no",delete:"erase %C formulas",filldown:"filldown %C all",fillright:"fillright %C all",erase:"erase %C all",borderon:"set %C bt %S%Nset %C br %S%Nset %C bb %S%Nset %C bl %S",borderoff:"set %C bt %S%Nset %C br %S%Nset %C bb %S%Nset %C bl %S",merge:"merge %C",unmerge:"unmerge %C","align-left":"set %C cellformat left","align-center":"set %C cellformat center","align-right":"set %C cellformat right","align-default":"set %C cellformat",insertrow:"insertrow %C",insertcol:"insertcol %C",deleterow:"deleterow %C",deletecol:"deletecol %C",hiderow:"set %H hide yes",hidecol:"set %W hide yes",undo:"undo",redo:"redo",recalc:"recalc"},Oe.SpreadsheetCmdSLookup={borderon:"1px solid rgb(0,0,0)",borderoff:""},Oe.SpreadsheetControlExecuteCommand=function(e,t,o){var r=Oe.GetSpreadsheetControlObject().editor,a={P:"%",N:"\n"};r.range.hasrange?(a.R=Oe.crToCoord(r.range.left,r.range.top)+":"+Oe.crToCoord(r.range.right,r.range.bottom),a.C=a.R,a.W=Oe.rcColname(r.range.left)+":"+Oe.rcColname(r.range.right),a.H=r.range.top+":"+r.range.bottom):r.ecell?(a.C=r.ecell.coord,a.R=r.ecell.coord+":"+r.ecell.coord,a.W=Oe.rcColname(Oe.coordToCr(r.ecell.coord).col),a.H=Oe.coordToCr(r.ecell.coord).row):(a.C="A1",a.R="A1:A1",a.W=Oe.rcColname(Oe.coordToCr("A1").col),a.H=Oe.coordToCr("A1").row),a.S=o,t=(t=(t=(t=(t=(t=(t=t.replace(/%C/g,a.C)).replace(/%R/g,a.R)).replace(/%N/g,a.N)).replace(/%S/g,a.S)).replace(/%W/g,a.W)).replace(/%H/g,a.H)).replace(/%P/g,a.P),r.EditorScheduleSheetCommands(t,!0,!1)},Oe.SpreadsheetControlCreateSheetHTML=function(e){var t,o,r,a;return t=new Oe.RenderContext(e.sheet),o=document.createElement("div"),r=t.RenderSheet(null,{type:"html"}),o.appendChild(r),delete t,a=o.innerHTML,delete r,delete o,a},Oe.SpreadsheetControlCreateCellHTML=function(e,t,o){var r="",a=e.sheet.cells[t];return a?("&nbsp;"==(r=null==a.displaystring?Oe.FormatValueForDisplay(e.sheet,a.datavalue,t,o||e.context.defaultHTMLlinkstyle):a.displaystring)&&(r=""),r):""},Oe.SpreadsheetControlCreateCellHTMLSave=function(e,t,o){var r,a,n,l,s,i,c,d,u=[];for(r=(d=t?Oe.ParseRange(t):{cr1:{row:1,col:1},cr2:{row:e.sheet.attribs.lastrow,col:e.sheet.attribs.lastcol}}).cr1,a=d.cr2,u.push("version:1.0"),n=r.row;n<=a.row;n++)for(l=r.col;l<=a.col;l++)s=Oe.crToCoord(l,n),(i=e.sheet.cells[s])&&"&nbsp;"!=(c=null==i.displaystring?Oe.FormatValueForDisplay(e.sheet,i.datavalue,s,o||e.context.defaultHTMLlinkstyle):i.displaystring)&&u.push(s+":"+Oe.encodeForSave(c));return u.push(""),u.join("\n")},Oe.SpreadsheetControl.DoFunctionList=function(){var e,t,o,r=Oe.Formula,a=Oe.Constants.function_classlist,n=Oe.GetSpreadsheetControlObject(),l=n.idPrefix+"function";if(!(o=document.getElementById(l+"dialog"))){for(r.FillFunctionInfo(),t='<table><tr><td><span style="font-size:x-small;font-weight:bold">%loc!Category!</span><br><select id="'+l+'class" size="'+a.length+'" style="width:120px;" onchange="SocialCalc.SpreadsheetControl.FunctionClassChosen(this.options[this.selectedIndex].value);">',e=0;e<a.length;e++)t+='<option value="'+a[e]+'"'+(0==e?" selected>":">")+Oe.special_chars(r.FunctionClasses[a[e]].name)+"</option>";t+='</select></td><td>&nbsp;&nbsp;</td><td id="'+l+'list"><span style="font-size:x-small;font-weight:bold">%loc!Functions!</span><br><select id="'+l+'name" size="'+a.length+'" style="width:240px;" onchange="SocialCalc.SpreadsheetControl.FunctionChosen(this.options[this.selectedIndex].value);" ondblclick="SocialCalc.SpreadsheetControl.DoFunctionPaste();">',t+=Oe.SpreadsheetControl.GetFunctionNamesStr("all"),t+='</td></tr><tr><td colspan="3"><div id="'+l+'desc" style="width:380px;height:80px;overflow:auto;font-size:x-small;">'+Oe.SpreadsheetControl.GetFunctionInfoStr(r.FunctionClasses[a[0]].items[0])+'</div><div style="width:380px;text-align:right;padding-top:6px;font-size:small;"><input type="button" value="%loc!Paste!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.DoFunctionPaste();">&nbsp;<input type="button" value="%loc!Cancel!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.HideFunctions();"></div></td></tr></table>';var s=document.createElement("div");s.id=l+"dialog",s.style.position="absolute";var i=Oe.GetViewportInfo(),c=Oe.GetElementPositionWithScroll(n.spreadsheetDiv);s.style.top=i.height/3-c.top+"px",s.style.left=i.width/3-c.left+"px",s.style.zIndex=100,s.style.backgroundColor="#FFF",s.style.border="1px solid black",s.style.width="400px",t='<table cellspacing="0" cellpadding="0" style="border-bottom:1px solid black;"><tr><td style="font-size:10px;cursor:default;width:100%;background-color:#999;color:#FFF;">&nbsp;%loc!Function List!</td><td style="font-size:10px;cursor:default;color:#666;" onclick="SocialCalc.SpreadsheetControl.HideFunctions();">&nbsp;X&nbsp;</td></tr></table><div style="background-color:#DDD;">'+t+"</div>",t=Oe.LocalizeSubstrings(t),s.innerHTML=t,Oe.DragRegister(s.firstChild.firstChild.firstChild.firstChild,!0,!0,{MouseDown:Oe.DragFunctionStart,MouseMove:Oe.DragFunctionPosition,MouseUp:Oe.DragFunctionPosition,Disabled:null,positionobj:s},n.spreadsheetDiv),n.spreadsheetDiv.appendChild(s),(o=document.getElementById(l+"name")).focus(),Oe.CmdGotFocus(o)}},Oe.SpreadsheetControl.GetFunctionNamesStr=function(e){var t,o,r="";for(o=Oe.Formula.FunctionClasses[e],t=0;t<o.items.length;t++)r+='<option value="'+o.items[t]+'"'+(0==t?" selected>":">")+o.items[t]+"</option>";return r},Oe.SpreadsheetControl.FillFunctionNames=function(e,t){var o,r,a=Oe.Formula;for(t.length=0,r=a.FunctionClasses[e],o=0;o<r.items.length;o++)t.options[o]=new Option(r.items[o],r.items[o]),0==o&&(t.options[o].selected=!0)},Oe.SpreadsheetControl.GetFunctionInfoStr=function(e){var t=Oe.Formula,o=t.FunctionList[e],r=Oe.special_chars,a="<b>"+e+"("+r(t.FunctionArgString(e))+")</b><br>";return a+=r(o[3])},Oe.SpreadsheetControl.FunctionClassChosen=function(e){var t=Oe.GetSpreadsheetControlObject().idPrefix+"function",o=Oe.Formula;Oe.SpreadsheetControl.FillFunctionNames(e,document.getElementById(t+"name")),Oe.SpreadsheetControl.FunctionChosen(o.FunctionClasses[e].items[0])},Oe.SpreadsheetControl.FunctionChosen=function(e){var t=Oe.GetSpreadsheetControlObject().idPrefix+"function";document.getElementById(t+"desc").innerHTML=Oe.SpreadsheetControl.GetFunctionInfoStr(e)},Oe.SpreadsheetControl.HideFunctions=function(){var e=Oe.GetSpreadsheetControlObject(),t=document.getElementById(e.idPrefix+"functiondialog");t.innerHTML="",Oe.DragUnregister(t),Oe.KeyboardFocus(),t.parentNode&&t.parentNode.removeChild(t)},Oe.SpreadsheetControl.DoFunctionPaste=function(){var e=Oe.GetSpreadsheetControlObject(),t=e.editor,o=document.getElementById(e.idPrefix+"functionname"),r=document.getElementById(e.idPrefix+"multilinetextarea"),a=o.value+"(";Oe.SpreadsheetControl.HideFunctions(),r?(r.value+=a,r.focus(),Oe.CmdGotFocus(r)):t.EditorAddToInput(a,"=")},Oe.SpreadsheetControl.DoMultiline=function(){var e,t,o,r,a=Oe.LocalizeSubstrings,n=(Oe.Constants,(r=Oe.GetSpreadsheetControlObject()).editor),l=n.workingvalues,s=(r=Oe.GetSpreadsheetControlObject()).idPrefix+"multiline";if(!(t=document.getElementById(s+"dialog"))){switch(n.state){case"start":l.ecoord=n.ecell.coord,l.erow=n.ecell.row,l.ecol=n.ecell.col,n.RangeRemove(),o=Oe.GetCellContents(n.context.sheetobj,l.ecoord);break;case"input":case"inputboxdirect":o=n.inputBox.GetText()}n.inputBox.element.disabled=!0,e='<textarea id="'+s+'textarea" style="width:380px;height:120px;margin:10px 0px 0px 6px;">'+(o=Oe.special_chars(o))+'</textarea><div style="width:380px;text-align:right;padding:6px 0px 4px 6px;font-size:small;">'+a('<input type="button" value="%loc!Set Cell Contents!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.DoMultilinePaste();">&nbsp;<input type="button" value="%loc!Clear!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.DoMultilineClear();">&nbsp;<input type="button" value="%loc!Cancel!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.HideMultiline();"></div></div>');var i=document.createElement("div");i.id=s+"dialog",i.style.position="absolute";var c=Oe.GetViewportInfo(),d=Oe.GetElementPositionWithScroll(r.spreadsheetDiv);i.style.top=c.height/3-d.top+"px",i.style.left=c.width/3-d.left+"px",i.style.zIndex=100,i.style.backgroundColor="#FFF",i.style.border="1px solid black",i.style.width="400px",i.innerHTML='<table cellspacing="0" cellpadding="0" style="border-bottom:1px solid black;"><tr><td style="font-size:10px;cursor:default;width:100%;background-color:#999;color:#FFF;">'+a("&nbsp;%loc!Multi-line Input Box!")+'</td><td style="font-size:10px;cursor:default;color:#666;" onclick="SocialCalc.SpreadsheetControl.HideMultiline();">&nbsp;X&nbsp;</td></tr></table><div style="background-color:#DDD;">'+e+"</div>",Oe.DragRegister(i.firstChild.firstChild.firstChild.firstChild,!0,!0,{MouseDown:Oe.DragFunctionStart,MouseMove:Oe.DragFunctionPosition,MouseUp:Oe.DragFunctionPosition,Disabled:null,positionobj:i},r.spreadsheetDiv),r.spreadsheetDiv.appendChild(i),(t=document.getElementById(s+"textarea")).focus(),Oe.CmdGotFocus(t)}},Oe.SpreadsheetControl.HideMultiline=function(){Oe.Constants;var e=Oe.GetSpreadsheetControlObject(),t=e.editor,o=document.getElementById(e.idPrefix+"multilinedialog");switch(o.innerHTML="",Oe.DragUnregister(o),Oe.KeyboardFocus(),o.parentNode&&o.parentNode.removeChild(o),t.state){case"start":t.inputBox.DisplayCellContents(null);break;case"input":case"inputboxdirect":t.inputBox.element.disabled=!1,t.inputBox.Focus()}},Oe.SpreadsheetControl.DoMultilineClear=function(){var e=Oe.GetSpreadsheetControlObject(),t=document.getElementById(e.idPrefix+"multilinetextarea");t.value="",t.focus()},Oe.SpreadsheetControl.DoMultilinePaste=function(){var e=Oe.GetSpreadsheetControlObject(),t=e.editor,o=t.workingvalues,r=document.getElementById(e.idPrefix+"multilinetextarea").value;switch(Oe.SpreadsheetControl.HideMultiline(),t.state){case"start":o.partialexpr="",o.ecoord=t.ecell.coord,o.erow=t.ecell.row,o.ecol=t.ecell.col;break;case"input":case"inputboxdirect":t.inputBox.Blur(),t.inputBox.ShowInputBox(!1),t.state="start"}t.EditorSaveEdit(r)},Oe.SpreadsheetControl.DoLink=function(){var e,t,o,r,a,n,l,s=Oe.LocalizeString,i=(Oe.Constants,(l=Oe.GetSpreadsheetControlObject()).editor),c=i.workingvalues,d=(l=Oe.GetSpreadsheetControlObject()).idPrefix+"link";if(!(t=document.getElementById(d+"dialog"))){switch(i.state){case"start":c.ecoord=i.ecell.coord,c.erow=i.ecell.row,c.ecol=i.ecell.col,i.RangeRemove(),o=Oe.GetCellContents(i.context.sheetobj,c.ecoord);break;case"input":case"inputboxdirect":o=i.inputBox.GetText()}i.inputBox.element.disabled=!0,"'"==o.charAt(0)&&(o=o.slice(1));var u=Oe.ParseCellLinkText(o);o=Oe.special_chars(o),a=(r=l.sheet.cells[i.ecell.coord])&&r.textvalueformat?"":" checked",n=u.newwin?" checked":"",e='<div style="padding:6px 0px 4px 6px;"><span style="font-size:smaller;">'+s("Description")+'</span><br><input type="text" id="'+d+'desc" style="width:380px;" value="'+Oe.special_chars(u.desc)+'"><br><span style="font-size:smaller;">'+s("URL")+'</span><br><input type="text" id="'+d+'url" style="width:380px;" value="'+Oe.special_chars(u.url)+'"><br>',Oe.Callbacks.MakePageLink&&(e+='<span style="font-size:smaller;">'+s("Page Name")+'</span><br><input type="text" id="'+d+'pagename" style="width:380px;" value="'+Oe.special_chars(u.pagename)+'"><br><span style="font-size:smaller;">'+s("Workspace")+'</span><br><input type="text" id="'+d+'workspace" style="width:380px;" value="'+Oe.special_chars(u.workspace)+'"><br>'),e+=Oe.LocalizeSubstrings('<input type="checkbox" id="'+d+'format"'+a+'>&nbsp;<span style="font-size:smaller;">%loc!Set to Link format!</span><br><input type="checkbox" id="'+d+'popup"'+n+'>&nbsp;<span style="font-size:smaller;">%loc!Show in new browser window!</span></div><div style="width:380px;text-align:right;padding:6px 0px 4px 6px;font-size:small;"><input type="button" value="%loc!Set Cell Contents!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.DoLinkPaste();">&nbsp;<input type="button" value="%loc!Clear!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.DoLinkClear();">&nbsp;<input type="button" value="%loc!Cancel!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.HideLink();"></div></div>');var p=document.createElement("div");p.id=d+"dialog",p.style.position="absolute";var h=Oe.GetViewportInfo(),m=Oe.GetElementPositionWithScroll(l.spreadsheetDiv);p.style.top=h.height/3-m.top+"px",p.style.left=h.width/3-m.left+"px",p.style.zIndex=100,p.style.backgroundColor="#FFF",p.style.border="1px solid black",p.style.width="400px",p.innerHTML='<table cellspacing="0" cellpadding="0" style="border-bottom:1px solid black;"><tr><td style="font-size:10px;cursor:default;width:100%;background-color:#999;color:#FFF;">&nbsp;'+s("Link Input Box")+'</td><td style="font-size:10px;cursor:default;color:#666;" onclick="SocialCalc.SpreadsheetControl.HideLink();">&nbsp;X&nbsp;</td></tr></table><div style="background-color:#DDD;">'+e+"</div>",Oe.DragRegister(p.firstChild.firstChild.firstChild.firstChild,!0,!0,{MouseDown:Oe.DragFunctionStart,MouseMove:Oe.DragFunctionPosition,MouseUp:Oe.DragFunctionPosition,Disabled:null,positionobj:p},l.spreadsheetDiv),l.spreadsheetDiv.appendChild(p),(t=document.getElementById(d+"url")).focus(),Oe.CmdGotFocus(t)}},Oe.SpreadsheetControl.HideLink=function(){Oe.Constants;var e=Oe.GetSpreadsheetControlObject(),t=e.editor,o=document.getElementById(e.idPrefix+"linkdialog");switch(o.innerHTML="",Oe.DragUnregister(o),Oe.KeyboardFocus(),o.parentNode&&o.parentNode.removeChild(o),t.state){case"start":t.inputBox.DisplayCellContents(null);break;case"input":case"inputboxdirect":t.inputBox.element.disabled=!1,t.inputBox.Focus()}},Oe.SpreadsheetControl.DoLinkClear=function(){var e=Oe.GetSpreadsheetControlObject();document.getElementById(e.idPrefix+"linkdesc").value="",document.getElementById(e.idPrefix+"linkpagename").value="",document.getElementById(e.idPrefix+"linkworkspace").value="";var t=document.getElementById(e.idPrefix+"linkurl");t.value="",t.focus()},Oe.SpreadsheetControl.DoLinkPaste=function(){var e,t,o,r,a=Oe.GetSpreadsheetControlObject(),n=a.editor,l=n.workingvalues,s=document.getElementById(a.idPrefix+"linkdesc"),i=document.getElementById(a.idPrefix+"linkurl"),c=document.getElementById(a.idPrefix+"linkpagename"),d=document.getElementById(a.idPrefix+"linkworkspace"),u=document.getElementById(a.idPrefix+"linkformat"),p="";switch(r=document.getElementById(a.idPrefix+"linkpopup").checked?(e="<<",t=">>",o="[[","]]"):(e="<",t=">",o="[","]"),p=c&&c.value?d.value?s.value+"{"+d.value+o+c.value+r+"}":s.value+o+c.value+r:s.value+e+i.value+t,Oe.SpreadsheetControl.HideLink(),n.state){case"start":l.partialexpr="",l.ecoord=n.ecell.coord,l.erow=n.ecell.row,l.ecol=n.ecell.col;break;case"input":case"inputboxdirect":n.inputBox.Blur(),n.inputBox.ShowInputBox(!1),n.state="start"}u.checked&&Oe.SpreadsheetControlExecuteCommand(null,"set %C textvalueformat text-link",""),n.EditorSaveEdit(p)},Oe.SpreadsheetControl.DoSum=function(){var e,t,o,r,a,n,l,s=Oe.GetSpreadsheetControlObject().editor,i=s.context.sheetobj;if(s.range.hasrange)a=Oe.crToCoord(s.range.left,s.range.top)+":"+Oe.crToCoord(s.range.right,s.range.bottom),e="set "+Oe.crToCoord(s.range.right,s.range.bottom+1)+" formula sum("+a+")";else if(o=s.ecell.row-1,r=s.ecell.col,o<=1)e="set "+s.ecell.coord+" constant e#REF! 0 #REF!";else{for(l=!1;0<o;){if(n=Oe.crToCoord(r,o),(t=i.GetAssuredCell(n)).datatype&&"t"!=t.datatype)l=!0;else if(l){o++;break}o--}e="set "+s.ecell.coord+" formula sum("+Oe.crToCoord(r,o)+":"+Oe.crToCoord(r,s.ecell.row-1)+")"}s.EditorScheduleSheetCommands(e,!0,!1)},Oe.SpreadsheetControl.FindInSheet=function(){var e=$("#searchstatus"),t=Oe.GetSpreadsheetControlObject();if(!this.value.length)return e.text(""),t.sheet.search_cells=[],void(t.sheet.selected_search_cell=void 0);var o,r,a=t.sheet.cells,n=new RegExp(this.value,"im"),l=[];for(var s in a){o=a[s];var i=Oe.coordToCr(s);"yes"!==t.sheet.rowattribs.hide[i.row]&&"yes"!==t.sheet.colattribs.hide[Oe.rcColname(i.col)]&&void 0!==(r="c"===o.datatype?o.displaystring:String(o.datavalue))&&r.match(n)&&l.push(s)}(t.sheet.search_cells=l).length?(t.sheet.selected_search_cell=0,t.editor.MoveECell(l[0]),e.text("1 of "+l.length)):(t.sheet.selected_search_cell=void 0,e.text("No Matches"))},Oe.SpreadsheetControl.SearchSheet=function(e){var t=Oe.GetSpreadsheetControlObject(),o=t.sheet,r=o.search_cells;if(r.length){var a=o.selected_search_cell;a===(0===e?0:r.length-1)?a=0===e?r.length-1:0:a+=0===e?-1:1;var n=r[a];o.selected_search_cell=a,t.editor.MoveECell(n),document.getElementById("searchstatus").textContent=String(a+1)+" of "+r.length}},Oe.SpreadsheetControl.SearchUp=function(){Oe.SpreadsheetControl.SearchSheet(0)},Oe.SpreadsheetControl.SearchDown=function(){Oe.SpreadsheetControl.SearchSheet(1)},Oe.SpreadsheetControlSortOnclick=function(e,t){var o,r,a=[],n=document.getElementById(e.idPrefix+"sortlist");for(o in Oe.LoadColumnChoosers(e),e.editor.RangeChangeCallback.sort=Oe.UpdateSortRangeProposal,e.sheet.names)a.push(o);for(a.sort(),n.length=0,n.options[0]=new Option(Oe.LocalizeString("[select range]")),n.options[1]=new Option(Oe.LocalizeString("Sort All"),"all"),n_options=n.options.length,r=0;r<a.length;r++)o=a[r],n.options[r+n_options]=new Option(o,o),o==e.sortrange&&(n.options[r+n_options].selected=!0);""==e.sortrange&&(n.options[0].selected=!0),Oe.UpdateSortRangeProposal(e.editor),Oe.KeyboardFocus()},Oe.SpreadsheetControlSortSave=function(e,t){var o,r,a,n=Oe.GetSpreadsheetControlObject();return o="sort:"+Oe.encodeForSave(n.sortrange)+":",r=document.getElementById(n.idPrefix+"majorsort"),a=document.getElementById(n.idPrefix+"majorsortup"),o+=r.selectedIndex+(a.checked?":up":":down"),0<(r=document.getElementById(n.idPrefix+"minorsort")).selectedIndex?(a=document.getElementById(n.idPrefix+"minorsortup"),o+=":"+r.selectedIndex+(a.checked?":up":":down")):o+="::",0<(r=document.getElementById(n.idPrefix+"lastsort")).selectedIndex?(a=document.getElementById(n.idPrefix+"lastsortup"),o+=":"+r.selectedIndex+(a.checked?":up":":down")):o+="::",o+"\n"},Oe.SpreadsheetControlSortLoad=function(e,t,o,r){var a,n,l=Oe.GetSpreadsheetControlObject();return a=o.split(":"),l.sortrange=Oe.decodeFromSave(a[1]),n=document.getElementById(l.idPrefix+"sortbutton"),l.sortrange?(n.value=Oe.LocalizeString("Sort ")+l.sortrange,n.style.visibility="visible"):n.style.visibility="hidden",Oe.LoadColumnChoosers(l),sele=document.getElementById(l.idPrefix+"majorsort"),sele.selectedIndex=a[2]-0,document.getElementById(l.idPrefix+"majorsort"+a[3]).checked=!0,sele=document.getElementById(l.idPrefix+"minorsort"),a[4]?(sele.selectedIndex=a[4]-0,document.getElementById(l.idPrefix+"minorsort"+a[5]).checked=!0):(sele.selectedIndex=0,document.getElementById(l.idPrefix+"minorsortup").checked=!0),sele=document.getElementById(l.idPrefix+"lastsort"),a[6]?(sele.selectedIndex=a[6]-0,document.getElementById(l.idPrefix+"lastsort"+a[7]).checked=!0):(sele.selectedIndex=0,document.getElementById(l.idPrefix+"lastsortup").checked=!0),!0},Oe.SpreadsheetControlCommentOnclick=function(e,t){e.editor.MoveECellCallback.comment=Oe.SpreadsheetControlCommentMoveECell,Oe.SpreadsheetControlCommentDisplay(e,t),Oe.KeyboardFocus()},Oe.SpreadsheetControlCommentDisplay=function(e,t){var o="";e.editor.ecell&&e.editor.ecell.coord&&e.sheet.cells[e.editor.ecell.coord]&&(o=e.sheet.cells[e.editor.ecell.coord].comment||""),document.getElementById(e.idPrefix+"commenttext").value=o},Oe.SpreadsheetControlCommentMoveECell=function(e){Oe.SpreadsheetControlCommentDisplay(Oe.GetSpreadsheetControlObject(),"comment")},Oe.SpreadsheetControlCommentSet=function(){var e=Oe.GetSpreadsheetControlObject();e.ExecuteCommand("set %C comment "+Oe.encodeForSave(document.getElementById(e.idPrefix+"commenttext").value));var t=Oe.GetEditorCellElement(e.editor,e.editor.ecell.row,e.editor.ecell.col);e.editor.ECellReadonly()||(t.element.title=document.getElementById(e.idPrefix+"commenttext").value,e.editor.UpdateCellCSS(t,e.editor.ecell.row,e.editor.ecell.col)),Oe.KeyboardFocus()},Oe.SpreadsheetControlCommentOnunclick=function(e,t){delete e.editor.MoveECellCallback.comment},Oe.SpreadsheetControlNamesOnclick=function(e,t){document.getElementById(e.idPrefix+"namesname").value="",document.getElementById(e.idPrefix+"namesdesc").value="",document.getElementById(e.idPrefix+"namesvalue").value="",e.editor.RangeChangeCallback.names=Oe.SpreadsheetControlNamesRangeChange,e.editor.MoveECellCallback.names=Oe.SpreadsheetControlNamesRangeChange,Oe.SpreadsheetControlNamesRangeChange(e.editor),Oe.SpreadsheetControlNamesFillNameList(),Oe.SpreadsheetControlNamesChangedName()},Oe.SpreadsheetControlNamesFillNameList=function(){var e,t,o=Oe.LocalizeString,r=[],a=Oe.GetSpreadsheetControlObject(),n=document.getElementById(a.idPrefix+"nameslist"),l=document.getElementById(a.idPrefix+"namesname").value.toUpperCase().replace(/[^A-Z0-9_\.]/g,"");for(e in a.sheet.names)r.push(e);for(r.sort(),(n.length=0)<r.length?n.options[0]=new Option(o("[New]")):n.options[0]=new Option(o("[None]")),t=0;t<r.length;t++)e=r[t],n.options[t+1]=new Option(e,e),e==l&&(n.options[t+1].selected=!0);""==l&&(n.options[0].selected=!0)},Oe.SpreadsheetControlNamesChangedName=function(){var e=Oe.GetSpreadsheetControlObject(),t=document.getElementById(e.idPrefix+"nameslist"),o=t.options[t.selectedIndex].value;e.sheet.names[o]?(document.getElementById(e.idPrefix+"namesname").value=o,document.getElementById(e.idPrefix+"namesdesc").value=e.sheet.names[o].desc||"",document.getElementById(e.idPrefix+"namesvalue").value=e.sheet.names[o].definition||""):(document.getElementById(e.idPrefix+"namesname").value="",document.getElementById(e.idPrefix+"namesdesc").value="",document.getElementById(e.idPrefix+"namesvalue").value="")},Oe.SpreadsheetControlNamesRangeChange=function(e){var t=Oe.GetSpreadsheetControlObject(),o=document.getElementById(t.idPrefix+"namesrangeproposal");e.range.hasrange?o.value=Oe.crToCoord(e.range.left,e.range.top)+":"+Oe.crToCoord(e.range.right,e.range.bottom):o.value=e.ecell.coord},Oe.SpreadsheetControlNamesOnunclick=function(e,t){delete e.editor.RangeChangeCallback.names,delete e.editor.MoveECellCallback.names},Oe.SpreadsheetControlNamesSetValue=function(){var e=Oe.GetSpreadsheetControlObject();document.getElementById(e.idPrefix+"namesvalue").value=document.getElementById(e.idPrefix+"namesrangeproposal").value,Oe.KeyboardFocus()},Oe.SpreadsheetControlNamesSave=function(){var e=Oe.GetSpreadsheetControlObject(),t=document.getElementById(e.idPrefix+"namesname").value;Oe.SetTab(e.tabs[0].name),Oe.KeyboardFocus(),""!=t&&e.ExecuteCommand("name define "+t+" "+document.getElementById(e.idPrefix+"namesvalue").value+"\nname desc "+t+" "+document.getElementById(e.idPrefix+"namesdesc").value)},Oe.SpreadsheetControlNamesDelete=function(){var e=Oe.GetSpreadsheetControlObject(),t=document.getElementById(e.idPrefix+"namesname").value;Oe.SetTab(e.tabs[0].name),Oe.KeyboardFocus(),""!=t&&e.ExecuteCommand("name delete "+t),Oe.KeyboardFocus()},Oe.SpreadsheetControlClipboardOnclick=function(e,t){e=Oe.GetSpreadsheetControlObject();clipele=document.getElementById(e.idPrefix+"clipboardtext"),document.getElementById(e.idPrefix+"clipboardformat-tab").checked=!0;try{clipele.value=Oe.ConvertSaveToOtherFormat(Oe.Clipboard.clipboard,"tab")}catch(e){console.error(e)}},Oe.SpreadsheetControlClipboardFormat=function(e){var t=Oe.GetSpreadsheetControlObject();clipele=document.getElementById(t.idPrefix+"clipboardtext"),clipele.value=Oe.ConvertSaveToOtherFormat(Oe.Clipboard.clipboard,e)},Oe.SpreadsheetControlClipboardLoad=function(){var e=Oe.GetSpreadsheetControlObject(),t="tab";Oe.SetTab(e.tabs[0].name),Oe.KeyboardFocus(),document.getElementById(e.idPrefix+"clipboardformat-csv").checked?t="csv":document.getElementById(e.idPrefix+"clipboardformat-scsave").checked&&(t="scsave"),e.editor.pastescclipboard=!0,e.editor.EditorScheduleSheetCommands("loadclipboard "+Oe.encodeForSave(Oe.ConvertOtherFormatToSave(document.getElementById(e.idPrefix+"clipboardtext").value,t)),!0,!1)},Oe.SpreadsheetControlClipboardClear=function(){var e=Oe.GetSpreadsheetControlObject(),t=document.getElementById(e.idPrefix+"clipboardtext");t.value="",e.editor.EditorScheduleSheetCommands("clearclipboard",!0,!1),t.focus()},Oe.SpreadsheetControlClipboardExport=function(){var e=Oe.GetSpreadsheetControlObject();e.ExportCallback&&e.ExportCallback(e),Oe.SetTab(e.tabs[0].name),Oe.KeyboardFocus()},Oe.SpreadsheetControlSettingsSwitch=function(e){Oe.SettingControlReset();var t=Oe.GetSpreadsheetControlObject(),o=document.getElementById(t.idPrefix+"sheetsettingstable"),r=document.getElementById(t.idPrefix+"cellsettingstable"),a=document.getElementById(t.idPrefix+"sheetsettingstoolbar"),n=document.getElementById(t.idPrefix+"cellsettingstoolbar");"sheet"==e?(o.style.display="block",r.style.display="none",a.style.display="block",n.style.display="none",Oe.SettingsControlSetCurrentPanel(t.views.settings.values.sheetspanel)):(o.style.display="none",r.style.display="block",a.style.display="none",n.style.display="block",Oe.SettingsControlSetCurrentPanel(t.views.settings.values.cellspanel))},Oe.SettingsControlSave=function(e){var t,o,r=Oe.GetSpreadsheetControlObject(),a=Oe.SettingsControls.CurrentPanel,n=Oe.SettingsControlUnloadPanel(a);Oe.SetTab(r.tabs[0].name),Oe.KeyboardFocus(),"sheet"==e?o=r.sheet.DecodeSheetAttributes(n):"cell"==e&&(r.editor.range.hasrange&&(t=Oe.crToCoord(r.editor.range.left,r.editor.range.top)+":"+Oe.crToCoord(r.editor.range.right,r.editor.range.bottom)),o=r.sheet.DecodeCellAttributes(r.editor.ecell.coord,n,t)),o&&r.editor.EditorScheduleSheetCommands(o,!0,!1)},Oe.SpreadsheetControlCreateSpreadsheetSave=function(e,t){var o,r,a="",n="";if(t)for(o in t)r="\n"!=t[o].charAt(t[o]-1)?"\n":"",a+="--"+e.multipartBoundary+"\nContent-type: text/plain; charset=UTF-8\n\n"+t[o]+r,n+="part:"+o+"\n";return"socialcalc:version:1.0\nMIME-Version: 1.0\nContent-Type: multipart/mixed; boundary="+e.multipartBoundary+"\n--"+e.multipartBoundary+"\nContent-type: text/plain; charset=UTF-8\n\n# SocialCalc Spreadsheet Control Save\nversion:1.0\npart:sheet\npart:edit\npart:audit\n"+n+"--"+e.multipartBoundary+"\nContent-type: text/plain; charset=UTF-8\n\n"+e.CreateSheetSave()+"--"+e.multipartBoundary+"\nContent-type: text/plain; charset=UTF-8\n\n"+e.editor.SaveEditorSettings()+"--"+e.multipartBoundary+"\nContent-type: text/plain; charset=UTF-8\n\n"+e.sheet.CreateAuditString()+a+"--"+e.multipartBoundary+"--\n"},Oe.SpreadsheetControlDecodeSpreadsheetSave=function(e,t){var o,r,a,n,l,s,i,c,d,u,p,h={},m=[];if((o=t.search(/^MIME-Version:\s1\.0/im))<0)return h;if((r=/^Content-Type:\s*multipart\/mixed;\s*boundary=(\S+)/gim).lastIndex=o,a=r.exec(t),r.lastIndex<=0)return h;if(n=a[1],(l=new RegExp("^--"+n+"(?:\r\n|\n)","mg")).lastIndex=r.lastIndex,a=l.exec(t),(s=/(?:\r\n|\n)(?:\r\n|\n)/gm).lastIndex=l.lastIndex,!(a=s.exec(t)))return h;if(i=s.lastIndex,l.lastIndex=i,!(a=l.exec(t)))return h;for(c=a.index,u=t.substring(i,c).split(/\r\n|\n/),d=0;d<u.length;d++)switch(line=u[d],(p=line.split(":"))[0]){case"version":break;case"part":m.push(p[1])}for(pnum=0;pnum<m.length;pnum++){if(s.lastIndex=c,!(a=s.exec(t)))return h;if(i=s.lastIndex,pnum==m.length-1&&(l=new RegExp("^--"+n+"--$","mg")),l.lastIndex=i,!(a=l.exec(t)))return h;c=a.index,h[m[pnum]]={start:i,end:c}}return h},Oe.SettingsControls={Controls:{},CurrentPanel:null},Oe.SettingsControlSetCurrentPanel=function(e){Oe.SettingsControls.CurrentPanel=e,Oe.SettingsControls.PopupChangeCallback({panelobj:e},"",null)},Oe.SettingsControlInitializePanel=function(e){var t,o=Oe.SettingsControls;for(t in e)"name"!=t&&(ctrl=o.Controls[e[t].type],ctrl&&ctrl.Initialize&&ctrl.Initialize(e,t))},Oe.SettingsControlLoadPanel=function(e,t){var o,r=Oe.SettingsControls;for(o in e)"name"!=o&&(ctrl=r.Controls[e[o].type],ctrl&&ctrl.SetValue&&ctrl.SetValue(e,o,t[e[o].setting]))},Oe.SettingsControlUnloadPanel=function(e){var t,o=Oe.SettingsControls,r={};for(t in e)"name"!=t&&(ctrl=o.Controls[e[t].type],ctrl&&ctrl.GetValue&&(r[e[t].setting]=ctrl.GetValue(e,t)));return r},Oe.SettingsControls.PopupChangeCallback=function(e,t,o){var r=Oe.Constants,a=document.getElementById("sample-text");if(a&&e&&e.panelobj){var n,l,s,i,c,d=Oe.CurrentSpreadsheetControlObject.idPrefix,u="cell"==e.panelobj.name?"c":"";s=r.defaultCellLayout.match(/^padding.(\S+) (\S+) (\S+) (\S+).vertical.align.(\S+);$/)||[];var p={color:["textcolor"],backgroundColor:["bgcolor","#FFF"],fontSize:["fontsize",r.defaultCellFontSize],fontFamily:["fontfamily"],paddingTop:["padtop",s[1]],paddingRight:["padright",s[2]],paddingBottom:["padbottom",s[3]],paddingLeft:["padleft",s[4]],verticalAlign:["alignvert",s[5]]};for(l in p)n=Oe.Popup.GetValue(d+u+p[l][0])||p[l][1]||"",a.style[l]=n;if("c"==u){for(l in p={borderTop:"cbt",borderRight:"cbr",borderBottom:"cbb",borderLeft:"cbl"})n=Oe.SettingsControls.BorderSideGetValue(e.panelobj,p[l]),a.style[l]=n&&n.val||"";n=Oe.Popup.GetValue(d+"calignhoriz"),a.style.textAlign=n||"left",a.childNodes[1].style.textAlign=n||"right"}else a.style.border="",n=Oe.Popup.GetValue(d+"textalignhoriz"),a.style.textAlign=n||"left",n=Oe.Popup.GetValue(d+"numberalignhoriz"),a.childNodes[1].style.textAlign=n||"right";s=(n=Oe.Popup.GetValue(d+u+"fontlook"))&&n.match(/^(\S+) (\S+)$/)||[],a.style.fontStyle=s[1]||"",a.style.fontWeight=s[2]||"",n=Oe.Popup.GetValue(d+u+"formatnumber")||"General",i=Oe.FormatNumber.formatNumberWithFormat(9.8765,n,""),"??-???-??&nbsp;??:??:??"!=(c=Oe.FormatNumber.formatNumberWithFormat(-1234.5,n,""))&&(i+="<br>"+c),a.childNodes[1].innerHTML=i}},Oe.SettingsControls.PopupListSetValue=function(e,t,o){if(o){var r=Oe.Popup;o.def?r.SetValue(e[t].id,""):r.SetValue(e[t].id,o.val)}else alert(t+" no value")},Oe.SettingsControls.PopupListGetValue=function(e,t){var o=e[t];if(!o)return null;var r=Oe.Popup.GetValue(o.id);return r?{def:!1,val:r}:{def:!0,val:0}},Oe.SettingsControls.PopupListInitialize=function(e,t){var o,r,a,n,l=Oe.SettingsControls,s=e[t].initialdata||l.Controls[e[t].type].InitialData||"",i=(s=Oe.LocalizeSubstrings(s)).split(/\|/),c=[];for(o=0;o<(i.length||0);o++)a=(r=i[o]).indexOf(":"),-1!=(n=r.substring(0,a)).indexOf("\\")&&(n=(n=n.replace(/\\c/g,":")).replace(/\\b/g,"\\")),n=Oe.special_chars(n),c[o]="[custom]"==n?{o:Oe.Constants.s_PopupListCustom,v:r.substring(a+1),a:{custom:!0}}:"[cancel]"==n?{o:Oe.Constants.s_PopupListCancel,v:"",a:{cancel:!0}}:"[break]"==n?{o:"-----",v:"",a:{skip:!0}}:"[newcol]"==n?{o:"",v:"",a:{newcol:!0}}:{o:n,v:r.substring(a+1)};Oe.Popup.Create("List",e[t].id,{}),Oe.Popup.Initialize(e[t].id,{options:c,attribs:{changedcallback:Oe.SettingsControls.PopupChangeCallback,panelobj:e}})},Oe.SettingsControls.PopupListReset=function(e){Oe.Popup.Reset("List")},Oe.SettingsControls.Controls.PopupList={SetValue:Oe.SettingsControls.PopupListSetValue,GetValue:Oe.SettingsControls.PopupListGetValue,Initialize:Oe.SettingsControls.PopupListInitialize,OnReset:Oe.SettingsControls.PopupListReset,ChangedCallback:null},Oe.SettingsControls.ColorChooserSetValue=function(e,t,o){if(o){var r=Oe.Popup;o.def?r.SetValue(e[t].id,""):r.SetValue(e[t].id,o.val)}else alert(t+" no value")},Oe.SettingsControls.ColorChooserGetValue=function(e,t){var o=Oe.Popup.GetValue(e[t].id);return o?{def:!1,val:o}:{def:!0,val:0}},Oe.SettingsControls.ColorChooserInitialize=function(e,t){Oe.SettingsControls;Oe.Popup.Create("ColorChooser",e[t].id,{}),Oe.Popup.Initialize(e[t].id,{attribs:{title:"&nbsp;",moveable:!0,width:"106px",changedcallback:Oe.SettingsControls.PopupChangeCallback,panelobj:e}})},Oe.SettingsControls.ColorChooserReset=function(e){Oe.Popup.Reset("ColorChooser")},Oe.SettingsControls.Controls.ColorChooser={SetValue:Oe.SettingsControls.ColorChooserSetValue,GetValue:Oe.SettingsControls.ColorChooserGetValue,Initialize:Oe.SettingsControls.ColorChooserInitialize,OnReset:Oe.SettingsControls.ColorChooserReset,ChangedCallback:null},Oe.SettingsControls.BorderSideSetValue=function(e,t,o){Oe.SettingsControls;var r,a,n,l=e[t].id;o?(r=document.getElementById(l+"-onoff-bcb"))&&(o.val?(r.checked=!0,r.value=o.val,n=o.val.match(/(\S+)\s+(\S+)\s+(\S.+)/),a=l+"-color",Oe.Popup.SetValue(a,n[3]),Oe.Popup.SetDisabled(a,!1)):(r.checked=!1,r.value=o.val,a=l+"-color",Oe.Popup.SetValue(a,""),Oe.Popup.SetDisabled(a,!0))):alert(t+" no value")},Oe.SettingsControls.BorderSideGetValue=function(e,t){Oe.SettingsControls;var o,r=e[t].id;if(o=document.getElementById(r+"-onoff-bcb"))return o.checked?{def:!1,val:"1px solid "+(Oe.Popup.GetValue(r+"-color")||"rgb(0,0,0)")}:{def:!1,val:""}},Oe.SettingsControls.BorderSideInitialize=function(e,t){Oe.SettingsControls;var o=e[t].id;Oe.Popup.Create("ColorChooser",o+"-color",{}),Oe.Popup.Initialize(o+"-color",{attribs:{title:"&nbsp;",width:"106px",moveable:!0,changedcallback:Oe.SettingsControls.PopupChangeCallback,panelobj:e}})},Oe.SettingsControlOnchangeBorder=function(e){var t=Oe.SettingsControls,o=t.CurrentPanel,r=e.id.match(/(^.*\-)(\w+)\-(\w+)\-(\w+)$/);if(r){r[1];var a=r[2],n=(r[3],r[4]),l=o[a].type;switch(n){case"bcb":e.checked?t.Controls[l].SetValue(t.CurrentPanel,a,{def:!1,val:e.value||"1px solid rgb(0,0,0)"}):t.Controls[l].SetValue(t.CurrentPanel,a,{def:!1,val:""})}}},Oe.SettingsControls.Controls.BorderSide={SetValue:Oe.SettingsControls.BorderSideSetValue,GetValue:Oe.SettingsControls.BorderSideGetValue,OnClick:Oe.SettingsControls.ColorComboOnClick,Initialize:Oe.SettingsControls.BorderSideInitialize,InitialData:{thickness:"1 pixel:1px",style:"Solid:solid"},ChangedCallback:null},Oe.SettingControlReset=function(){var e,t=Oe.SettingsControls;for(e in t.Controls)t.Controls[e].OnReset&&t.Controls[e].OnReset(e)},Oe.OtherSaveParts={},Oe.CtrlSEditor=function(e){var t,o;if(0<e.length)t=Oe.special_chars(Oe.OtherSaveParts[e]||"");else for(o in t="Listing of Parts\n",Oe.OtherSaveParts)t+=Oe.special_chars("\nPart: "+o+"\n=====\n"+Oe.OtherSaveParts[o]+"\n");var r=document.createElement("div");r.style.cssText="position:absolute;z-index:500;width:300px;height:300px;left:100px;top:200px;border:1px solid black;background-color:#EEE;text-align:center;",r.id="socialcalc-editbox",r.innerHTML=e+'<br><br><textarea id="socialcalc-editbox-textarea" style="width:250px;height:200px;">'+t+"</textarea><br><br><input type=button onclick=\"SocialCalc.CtrlSEditorDone ('socialcalc-editbox', '"+e+'\');" value="OK">',document.body.appendChild(r);var a=document.getElementById("socialcalc-editbox-textarea");a.focus(),Oe.CmdGotFocus(a)},Oe.CtrlSEditorDone=function(e,t){var o=document.getElementById(e+"-textarea").value;0<t.length&&(0<o.length?Oe.OtherSaveParts[t]=o:delete Oe.OtherSaveParts[t]);var r=document.getElementById(e);Oe.KeyboardFocus(),r.parentNode.removeChild(r)},Oe||(alert("Main SocialCalc code module needed"),Oe={}),Oe.TableEditor||alert("SocialCalc TableEditor code module needed"),Oe.CurrentSpreadsheetViewerObject=null,Oe.SpreadsheetViewer=function(e){var t=Oe.Constants;this.parentNode=null,this.spreadsheetDiv=null,this.requestedHeight=0,this.requestedWidth=0,this.requestedSpaceBelow=0,this.height=0,this.width=0,this.viewheight=0,this.sheet=null,this.context=null,this.editor=null,this.spreadsheetDiv=null,this.editorDiv=null,this.sortrange="",this.idPrefix=e||"SocialCalc-",this.imagePrefix=t.defaultImagePrefix,this.statuslineheight=t.SVStatuslineheight,this.statuslineCSS=t.SVStatuslineCSS,this.sheet=new Oe.Sheet,this.context=new Oe.RenderContext(this.sheet),1!=Oe._app&&1!=Oe._view||(t.defaultImagePrefix=this.imagePrefix="../"+this.imagePrefix),1==Oe._app?(this.context.showGrid=!1,this.context.showRCHeaders=!1,this.context.highlightTypes.range.style="",this.context.sheetobj.cells.A1=new Oe.Cell("A1"),this.context.sheetobj.cells.A1.displaystring="Loading ... "):(this.context.showGrid=!0,this.context.showRCHeaders=!0),this.editor=new Oe.TableEditor(this.context),this.editor.noEdit=!0,this.editor.StatusCallback.statusline={func:Oe.SpreadsheetViewerStatuslineCallback,params:{}},this.hasStatusLine=!0,this.statuslineHTML='<table cellspacing="0" cellpadding="0"><tr><td width="100%" style="overflow:hidden;">{status}</td><td>&nbsp;</td></tr></table>',this.statuslineFull=!0,this.noRecalc=!0,this.repeatingMacroTimer=null,this.repeatingMacroInterval=60,this.repeatingMacroCommands="",Oe.CurrentSpreadsheetViewerObject=this},Oe.SpreadsheetViewer.prototype.InitializeSpreadsheetViewer=function(e,t,o,r){return Oe.InitializeSpreadsheetViewer(this,e,t,o,r)},Oe.SpreadsheetViewer.prototype.LoadSave=function(e){return Oe.SpreadsheetViewerLoadSave(this,e)},Oe.SpreadsheetViewer.prototype.DoOnResize=function(){return Oe.DoOnResize(this)},Oe.SpreadsheetViewer.prototype.SizeSSDiv=function(){return Oe.SizeSSDiv(this)},Oe.SpreadsheetViewer.prototype.DecodeSpreadsheetSave=function(e){return Oe.SpreadsheetViewerDecodeSpreadsheetSave(this,e)},Oe.SpreadsheetViewer.prototype.ParseSheetSave=function(e){return this.sheet.ParseSheetSave(e)},Oe.InitializeSpreadsheetViewer=function(e,t,o,r,a){var n;Oe.Constants,Oe.LocalizeString,Oe.LocalizeSubstrings,e.tabs,e.views;for(e.requestedHeight=o,e.requestedWidth=r,e.requestedSpaceBelow=a,"string"==typeof t&&(t=document.getElementById(t)),null==t&&alert("SocialCalc.SpreadsheetControl not given parent node."),e.parentNode=t,e.spreadsheetDiv=document.createElement("div"),e.SizeSSDiv(),n=t.firstChild;null!=n;n=t.firstChild)t.removeChild(n);t.appendChild(e.spreadsheetDiv),e.nonviewheight=e.hasStatusLine?e.statuslineheight:0,e.viewheight=e.height-e.nonviewheight,e.editorDiv=e.editor.CreateTableEditor(e.width,e.viewheight),e.spreadsheetDiv.appendChild(e.editorDiv),e.hasStatusLine&&(e.statuslineDiv=document.createElement("div"),e.statuslineDiv.style.cssText=e.statuslineCSS,e.statuslineDiv.style.height=e.statuslineheight-(e.statuslineDiv.style.paddingTop.slice(0,-2)-0)-(e.statuslineDiv.style.paddingBottom.slice(0,-2)-0)+"px",e.statuslineDiv.id=e.idPrefix+"statusline",e.spreadsheetDiv.appendChild(e.statuslineDiv),e.editor.StatusCallback.statusline={func:Oe.SpreadsheetViewerStatuslineCallback,params:{spreadsheetobj:e}}),1==Oe._app&&(e.formDataViewer=new Oe.SpreadsheetViewer("te_FormData-"),e.formDataViewer.sheet.statuscallback=null,Oe.CurrentSpreadsheetViewerObject=e)},Oe.SpreadsheetViewerLoadSave=function(e,t){var o,r,a,n,l=e.DecodeSpreadsheetSave(t);l&&(l.sheet&&(e.sheet.ResetSheet(),e.sheet.ParseSheetSave(t.substring(l.sheet.start,l.sheet.end))),l.edit&&e.editor.LoadEditorSettings(t.substring(l.edit.start,l.edit.end)),l.startupmacro&&e.editor.EditorScheduleSheetCommands(t.substring(l.startupmacro.start,l.startupmacro.end),!1,!0),l.repeatingmacro&&0<(r=(o=(o=t.substring(l.repeatingmacro.start,l.repeatingmacro.end)).replace("\r","")).indexOf("\n"))&&(n=a=o.substring(0,r)-0,e.repeatingMacroInterval=a,e.repeatingMacroCommands=o.substring(r+1),0<n&&(e.repeatingMacroTimer=U.setTimeout(Oe.SpreadsheetViewerDoRepeatingMacro,1e3*e.repeatingMacroInterval)))),"off"==e.editor.context.sheetobj.attribs.recalc||e.noRecalc?e.editor.ScheduleRender():e.editor.EditorScheduleSheetCommands("recalc")},Oe.SpreadsheetViewerDoRepeatingMacro=function(){var e=Oe.GetSpreadsheetViewerObject(),t=e.editor;e.repeatingMacroTimer=null,Oe.SheetCommandInfo.CmdExtensionCallbacks.repeatmacro={func:Oe.SpreadsheetViewerRepeatMacroCommand,data:null},t.EditorScheduleSheetCommands(e.repeatingMacroCommands)},Oe.SpreadsheetViewerRepeatMacroCommand=function(e,t,o,r,a){var n=Oe.GetSpreadsheetViewerObject(),l=r.RestOfString()-0;0<l||(l=n.repeatingMacroInterval),n.repeatingMacroInterval=l,n.repeatingMacroTimer=U.setTimeout(Oe.SpreadsheetViewerDoRepeatingMacro,1e3*n.repeatingMacroInterval)},Oe.SpreadsheetViewerStopRepeatingMacro=function(){var e=Oe.GetSpreadsheetViewerObject();e.repeatingMacroTimer&&(U.clearTimeout(e.repeatingMacroTimer),e.repeatingMacroTimer=null)},Oe.SpreadsheetViewerDoButtonCmd=function(e,t,o){var r=o.element,a=o.functionobj.command,n=Oe.GetSpreadsheetViewerObject().editor;switch(a){case"recalc":n.EditorScheduleSheetCommands("recalc")}r&&r.blur&&r.blur(),Oe.KeyboardFocus()},Oe.LocalizeString=function(e){var t=Oe.LocalizeStringList[e];return t||(t=Oe.Constants["s_loc_"+e.toLowerCase().replace(/\s/g,"_").replace(/\W/g,"X")]||e,Oe.LocalizeStringList[e]=t),t},Oe.LocalizeStringList={},Oe.LocalizeSubstrings=function(e){var r=Oe.LocalizeString;return e.replace(/%(loc|ssc)!(.*?)!/g,function(e,t,o){return"ssc"==t?Oe.Constants[o]||alert("Missing constant: "+o):r(o)})},Oe.GetSpreadsheetViewerObject=function(){var e=Oe.CurrentSpreadsheetViewerObject;if(e)return e;throw"No current SpreadsheetViewer object."},Oe.DoOnResize=function(e){var t,o=e.views;if(e.SizeSSDiv()){for(vname in o)(t=o[vname].element).style.width=e.width+"px",t.style.height=e.height-e.nonviewheight+"px";Oe._app||e.editor.ResizeTableEditor(e.width,e.height-e.nonviewheight)}},Oe.SizeSSDiv=function(e){var t,o,r,a,n;return r=!1,t=Oe.GetViewportInfo(),(o=Oe.GetElementPosition(e.parentNode)).bottom=0,o.right=0,(a=e.parentNode.style).marginTop&&(o.top+=a.marginTop.slice(0,-2)-0),a.marginBottom&&(o.bottom+=a.marginBottom.slice(0,-2)-0),a.marginLeft&&(o.left+=a.marginLeft.slice(0,-2)-0),a.marginRight&&(o.right+=a.marginRight.slice(0,-2)-0),n=e.requestedHeight||t.height-(o.top+o.bottom+10)-(e.requestedSpaceBelow||0),e.height!=n&&(e.height=n,e.spreadsheetDiv.style.height=n+"px",r=!0),n=e.requestedWidth||t.width-(o.left+o.right+10)||700,e.width!=n&&(e.width=n,e.spreadsheetDiv.style.width=n+"px",r=!0),e.spreadsheetDiv.style.position="relative",r},Oe.SpreadsheetViewerStatuslineCallback=function(e,t,o,r){var a=r.spreadsheetobj,n="";a&&a.statuslineDiv&&(n=a.statuslineFull?e.GetStatuslineString(t,o,r):e.ecell.coord,n=a.statuslineHTML.replace(/\{status\}/,n),a.statuslineDiv.innerHTML=n)},Oe.CmdGotFocus=function(e){Oe.Keyboard.passThru=e},Oe.SpreadsheetViewerCreateSheetHTML=function(e){var t,o,r,a;return t=new Oe.RenderContext(e.sheet),o=document.createElement("div"),r=t.RenderSheet(null,{type:"html"}),o.appendChild(r),delete t,a=o.innerHTML,delete r,delete o,a},Oe.SpreadsheetViewerDecodeSpreadsheetSave=function(e,t){var o,r,a,n,l,s,i,c,d,u,p,h={},m=[];if(/[^\n]\r[^\n]/.test(t)&&(t=t.replace(/([^\n])\r([^\n])/g,"$1\r\n$2")),(o=t.search(/^MIME-Version:\s1\.0/im))<0)return h;if((r=/^Content-Type:\s*multipart\/mixed;\s*boundary=(\S+)/gim).lastIndex=o,a=r.exec(t),r.lastIndex<=0)return h;if(n=a[1],(l=new RegExp("^--"+n+"(?:\r\n|\n)","mg")).lastIndex=r.lastIndex,a=l.exec(t),(s=/(?:\r\n|\n)(?:\r\n|\n)/gm).lastIndex=l.lastIndex,!(a=s.exec(t)))return h;if(i=s.lastIndex,l.lastIndex=i,!(a=l.exec(t)))return h;for(c=a.index,u=t.substring(i,c).split(/\r\n|\n/),d=0;d<u.length;d++)switch(line=u[d],(p=line.split(":"))[0]){case"version":break;case"part":m.push(p[1])}for(pnum=0;pnum<m.length;pnum++){if(s.lastIndex=c,!(a=s.exec(t)))return h;if(i=s.lastIndex,pnum==m.length-1&&(l=new RegExp("^--"+n+"--$","mg")),l.lastIndex=i,!(a=l.exec(t)))return h;c=a.index,h[m[pnum]]={start:i,end:c}}return h},"undefined"==typeof document&&(Oe.GetEditorCellElement=function(){},Oe.ReplaceCell=function(){},Oe.EditorRenderSheet=function(){},Oe.SpreadsheetControlSortSave=function(){return""},Oe.SpreadsheetControlStatuslineCallback=function(){},Oe.DoPositionCalculations=function(e){Oe.EditorSheetStatusCallback(null,"doneposcalc",null,e)}),"undefined"!=typeof self&&self.thread&&(U.setTimeout=function(e,t){t<=1&&self.thread.nextTick(e)},U.clearTimeout=function(){}),Oe});